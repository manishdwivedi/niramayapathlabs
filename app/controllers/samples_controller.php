<?php
//use PHPMailer\PHPMailer\PHPMailer;
//use PHPMailer\PHPMailer\Exception;
require "/home2/niramovh/lib/PHPMailer/class.phpmailer.php";
require "/home2/niramovh/lib/PHPMailer/class.smtp.php";
App::import('Vendor', '/fpdf/fpdf');
App::import('Vendor', '/fpdf/fpdi');
class SamplesController extends AppController
{
	var $name = "Samples";
	var $breadcrumb = array();
	var $uses=array('UserDocument','DocumentTypeMaster','ConfirmBooking','JsonData','AgentDoc','LabMessageMaster','PaymentType','Ticket','ProcessingLabs','TicketTracking','PincodeMaster','Samplemaster','Healthsample','Page','Pagelocale','Locale','Test','Sample','City','Timelab','Health','User','Agent','Billing','Banner','State','Paytrack','Admin','Package','Lab','Vial','Discount','UserBmiBp','RequestTest','UserCollectionReport','ActivityLog','Api','Ratelist','ServicedByApi','LabPincodeServicibility','RelationMaster');
	var $helpers = array('Form','Html','Javascript', 'Ajax','Utility');
	public $components = array('RequestHandler','Cookie','Utility');
	public $paginate = array('maxLimit' => 10);
 
	function admin_index($form=NULL)
	{
		$this->Ticket = ClassRegistry::init('Ticket');
		$this->PaymentType = ClassRegistry::init('PaymentType');
		$p_type = $this->PaymentType->find('list',array('fields'=>array('PaymentType.id','PaymentType.type')));
		$this->set('p_type',$p_type);
		$usertype = $this->Session->read('Admin.userType');
		$this->ProcessingLabs = ClassRegistry::init("ProcessingLabs");
		$plab = $this->ProcessingLabs->find('list',array('conditions'=>array('ProcessingLabs.status'=>1),'fields'=>array('id','name')));
		$pcc_list = $this->Lab->find('list',array('conditions'=>array('Lab.status'=>1),'fields'=>array('Lab.id','Lab.pcc_name')));
		$this->set('plab',$plab);
		$userlab = $this->Session->read('userlab');
		$this->set('title_for_layout','Manage Sample Request(s)');
		$this->set('userType',$usertype);
		if(isset($this->params['named']['form_name']) && $this->params['named']['form_name'] == 'first')
		{
			if(isset($this->params['named']['from_date']) && $this->params['named']['from_date']!='')
			{
				$this->data['Filter']['req_from_date'] = $this->params['named']['from_date'];
				$options['from_date'] = $this->params['named']['from_date'];
			}
			if(isset($this->params['named']['to_date']) && $this->params['named']['to_date']!='')
			{
				$this->data['Filter']['req_to_date'] = $this->params['named']['to_date'];
				$options['to_date'] = $this->params['named']['to_date'];
			}
			if(isset($this->params['named']['city']) && $this->params['named']['city']!='')
			{
				$this->data['Filter']['req_city'] = $this->params['named']['city'];
				$options['city'] = $this->params['named']['city'];
			}
			if(isset($this->params['named']['lab']) && $this->params['named']['lab']!='')
			{
				$this->data['Filter']['req_lab'] = $this->params['named']['lab'];
				if(in_array($usertype,array('A','BM','Agent','DA')))
				{
					$options['lab'] = $this->params['named']['lab'];
				}
				else
				{
					$options['lab'] = $this->Session->read('Admin.labId');
				}
				
			}
            
			if(isset($this->params['named']['lab1']) && $this->params['named']['lab1']!='')
			{
				$this->data['Filter']['req_lab1'] = $this->params['named']['lab1'];
				$options['lab1'] = $this->params['named']['lab1'];
			}
			if(isset($this->params['named']['agent']) && $this->params['named']['agent']!='')
			{
				$this->data['Filter']['req_agent'] = $this->params['named']['agent'];
				$options['agent'] = $this->params['named']['agent'];
			}
			if(isset($this->params['named']['report']) && $this->params['named']['report']!='')
			{
				$this->data['Filter']['req_report'] = $this->params['named']['report'];
				$options['report'] = $this->params['named']['report'];
			}
			if(isset($this->params['named']['req_status']) && $this->params['named']['req_status']!='')
			{
				$this->data['Filter']['req_status'] = $this->params['named']['req_status'];
				$options['req_status'] = $this->params['named']['req_status'];
			}
			if(isset($this->params['named']['pay_status']) && $this->params['named']['pay_status']!='')
			{
				$this->data['Filter']['pay_status'] = $this->params['named']['pay_status'];
				$options['pay_status'] = $this->params['named']['pay_status'];
			}
			if(isset($this->params['named']['source']) && $this->params['named']['source']!='')
			{
				$this->data['Filter']['source'] = $this->params['named']['source'];
				$options['source'] = $this->params['named']['source'];
			}

			if(isset($this->params['named']['form_name']) && $this->params['named']['form_name']!='')
			{
				$form = $this->params['named']['form_name'];
				$options['form_name'] = $this->params['named']['form_name'];
			}
		}
		if(isset($this->params['named']['form_name']) && $this->params['named']['form_name'] == 'second')
		{
			if(isset($this->params['named']['name']) && $this->params['named']['name']!='')
			{
				$this->data['Filter']['req_name'] = $this->params['named']['name'];
				$options['name'] = $this->params['named']['name'];
			}
			if(isset($this->params['named']['phone']) && $this->params['named']['phone']!='')
			{
				$this->data['Filter']['req_phone'] = $this->params['named']['phone'];
				$options['phone'] = $this->params['named']['phone'];
			}
			if(isset($this->params['named']['refnum']) && $this->params['named']['refnum']!='')
			{
				$this->data['Filter']['ref_num'] = $this->params['named']['refnum'];
				$options['refnum'] = $this->params['named']['refnum'];
			}
			if(isset($this->params['named']['form_name']) && $this->params['named']['form_name']!='')
			{
				$form = $this->params['named']['form_name'];
				$options['form_name'] = $this->params['named']['form_name'];
			}
			if(isset($this->params['named']['reference']) && $this->params['named']['reference']!='')
			{
				$this->data['Filter']['reference'] = $this->params['named']['reference'];
				$options['reference'] = $this->params['named']['reference'];
			}
		}
		if(!isset($this->params['named']['from_date']) && !isset($this->params['named']['to_date']) && !isset($this->params['named']['city']) && !isset($this->params['named']['lab']) && !isset($this->params['named']['lab1']) && !isset($this->params['named']['agent']) && !isset($this->params['named']['report']) && !isset($this->params['named']['req_status']))
		{
			$t_date = date('Y-m-d');
			$t_date_to = date('Y-m-d',strtotime(" +1 days "));
			$conditions=array();
			$user_type=$this->Session->read('Admin.userType');
			$user_type_array=array('A','BM','Agent','DA');
			if(in_array($user_type,$user_type_array))
			{
				$conditions=array('Health.status'=>1,'Health.s_date >='=>$t_date,'Health.s_date <='=>$t_date_to);//,'Health.s_date'=>$t_date
			}
			else
			{
				$this->set('pccLab',$this->Session->read('Admin.labId'));
				$conditions=array('OR'=>array('Health.created_by'=>$this->Session->read('Admin.labId'),'Health.assigned_lab'=>$this->Session->read('Admin.labId')),'Health.status'=>1,'Health.s_date >='=>$t_date,'Health.s_date <='=>$t_date_to,'SUBSTRING(Health.flags,1,1) NOT LIKE'=>"5");//'Health.s_date'=>$t_date
				//print_R($conditions);die;
			}
			$this->paginate = array('Health' => array('limit' =>'10','order'=>array('Health.sample_date'=>'ASC','Health.sample_date1'=>'ASC','Health.sample_time'=>'ASC','Health.sample_time1'=>'ASC'),'conditions'=>$conditions));
			
			$samplerequestlist=$this->paginate('Health');
			$k = 0;
			foreach($samplerequestlist as $key => $val)
			{
				$ticket = $this->Ticket->find('first',array('conditions'=>array('Ticket.request_id'=>$val['Health']['id'])));
				if(!empty($ticket))
				{
					$samplerequestlist[$k]['Health']['ticket_raised'] = 1;
					$samplerequestlist[$k]['Health']['ticket_id'] = $ticket['Ticket']['id'];
					$samplerequestlist[$k]['Health']['ticket_status'] = $ticket['Ticket']['status'];
				}
				else
				{
					$samplerequestlist[$k]['Health']['ticket_raised'] = 0;
				}
				$this->PhleboConfirmedNotify = ClassRegistry::init('PhleboConfirmedNotify');
				$phlebo = $this->PhleboConfirmedNotify->find('first',array('conditions'=>array('PhleboConfirmedNotify.health_id'=>$val['Health']['id'])));
				if(!empty($phlebo))
				{
					$samplerequestlist[$k]['Health']['phlebo_name'] = $phlebo['PhleboConfirmedNotify']['name'];
					$samplerequestlist[$k]['Health']['phlebo_contact'] = $phlebo['PhleboConfirmedNotify']['phone'];
					$samplerequestlist[$k]['Health']['phlebo_tracking'] = $phlebo['PhleboConfirmedNotify']['tracking_url'];
				}
				else
				{
					$this->Agent = ClassRegistry::init('Agent');
					$agent = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
					//print_R($agent);die;
					$samplerequestlist[$k]['Health']['phlebo_name'] = $agent['Agent']['name'];
					$samplerequestlist[$k]['Health']['phlebo_contact'] = $agent['Agent']['contact'];
					$samplerequestlist[$k]['Health']['phlebo_tracking'] = "-";
				}
				
				$booking_from = substr($val['Health']['flags'], 0, 1);
				$samplerequestlist[$k]['Health']['source'] = 'N/A';

				if($booking_from == "1")
					$samplerequestlist[$k]['Health']['source'] = 'Online';
				if($booking_from == "2")
					$samplerequestlist[$k]['Health']['source'] = 'Manual';
				if($booking_from == "3")
					$samplerequestlist[$k]['Health']['source'] = 'Excel';
				if($booking_from == "4")
					$samplerequestlist[$k]['Health']['source'] = 'API';
				if($booking_from == "5")
					$samplerequestlist[$k]['Health']['source'] = 'LIS Sync';
									
				$city='';
					$city = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['city_id'])));
					$samplerequestlist[$k]['Health']['city'] = $city['City']['name'];
				if($val['Health']['assigned_lab'] != 'Home')
				{
					$pcc_detail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val['Health']['assigned_lab'])));
					$samplerequestlist[$k]['Health']['assigned_lab'] = $pcc_detail['Lab']['pcc_name'];
				}
				else
				{
					$samplerequestlist[$k]['Health']['assigned_lab'] = 'Home';
				}
				if($val['Health']['processing_lab'] == 0)
				{
					$samplerequestlist[$k]['Health']['processing_lab'] = 'None';
				}
				else
				{
					$samplerequestlist[$k]['Health']['processing_lab'] = $val['Health']['processing_lab'];
				}
				if($val['Health']['agent_id'] == 0)
				{
					$samplerequestlist[$k]['Health']['agent_name'] = 'No';
				}
				else
				{
					$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
					$samplerequestlist[$k]['Health']['agent_name'] = $agent_name['Agent']['name'];
				}
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
				$visit_lab_2 = $val['Health']['sample_time'];
				$visit_lab_3 = $val['Health']['sample_date'];
				$home_collection_1 = $val['Health']['sample_time1'];
				$home_collection_2 = $val['Health']['sample_date1'];

				if(!empty($visit_lab_3))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
				}
				if(!empty($visit_lab_2))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];			
				}

				if(!empty($home_collection_2))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;	
				}

				if(!empty($home_collection_1))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}

				/*if($visit_lab_3 != '' && ($home_collection_1 == '' && $home_collection_2 == ''))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
				}
				if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];			
				}
				if($home_collection_2 != '' && ($visit_lab_2 == '' && $visit_lab_3 == ''))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;	
				}
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
				}
				$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];*/

				$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				if($contact['User']['parent_child']=="parent")
					$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
				else
				{
					if(!empty($contact['User']['alternate_contact']))
						$samplerequestlist[$k]['Health']['landline'] = $contact['User']['alternate_contact'];
					else
						$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
				}
				
				$billing_status = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
				$samplerequestlist[$k]['Health']['bill_amount'] = $billing_status['Billing']['sub_total'];
				$user_email = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				$samplerequestlist[$k]['Health']['email'] = $user_email['User']['email'];
				$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
				$samplerequestlist[$k]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
				if($val['Health']['locality'] == '')
				{
					$samplerequestlist[$k]['Health']['locality'] = $user_email['User']['locality'];
				}
				$k++;
			}
		}
		$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city);
		//echo "<pre>"; print_r($samplerequestlist); die;
	
		if(!in_array($usertype,array('A','BM','Agent','DA')))
		{
			$this->set('pccLab',$this->Session->read('Admin.labId'));
		}
		if($form == 'first')
		{
			if(!empty($this->data))
			{
				$conditions=array();
				//echo "<pre>"; print_r($this->data); die;
				$from_date = $this->data['Filter']['req_from_date'];
				$to_date = $this->data['Filter']['req_to_date'];
				$city = $this->data['Filter']['req_city'];
				$lab = $this->data['Filter']['req_lab'];
				if(in_array($usertype,array('A','BM','Agent','DA')))
				{
					$booked_by = $this->data['Filter']['req_lab1'];
				}
				else
				{
					$booked_by = $this->Session->read('Admin.labId');
				}
				$agent = $this->data['Filter']['req_agent'];
				$report = $this->data['Filter']['req_report'];
				$req_status = $this->data['Filter']['req_status'];
				$pay_stat = $this->data['Filter']['pay_status'];
				$req_src = $this->data['Filter']['source'];

				if(isset($from_date) && $from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($from_date));
					$options['from_date'] = date('d-m-Y',strtotime($from_date));
				}
				if(isset($to_date) && $to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($to_date));
					$options['to_date'] = date('d-m-Y',strtotime($to_date));
				}
				if(isset($city) && $city != '')
				{
					$conditions['Health.visit_pat_city'] = $city;
					$options['city'] = $city;
				}
				if(isset($lab) && $lab != '')
				{
					$conditions['Health.assigned_lab'] = $lab;
					$options['lab'] = $lab;
				}
                                if(isset($booked_by) && $booked_by != '')
				{
					$conditions['Health.created_by'] = $booked_by;
					$options['lab1'] = $booked_by;
				}
				if(isset($agent) && $agent != '')
				{
					$conditions['Health.agent_id'] = $agent;
					$options['agent'] = $agent;
				}
				if(isset($report) && $report != '')
				{
					if($report == 1)
					{
						$conditions['Health.patient_report <>'] = '';
						$conditions['Health.requ_status'] = 6;
					}
					if($report == 0)
					{
						$conditions['Health.patient_report'] = '';
					}
					if($report == 2)
					{
						$conditions['Health.requ_status'] = 7;
					}
					$options['report'] = $report;
				}
				if(isset($req_status) && $req_status != '')
				{
					if($req_status == 11)
					{
						$conditions['Health.requ_status'] = 11;
					}
					if($req_status == 12)
					{
						$conditions['Health.requ_status'] = 12;
					}
					if($req_status == 13)
					{
						$conditions['Health.requ_status'] = 13;
					}
					if($req_status == 10)
					{
						$conditions['Health.requ_status'] = 10;
					}
					if($req_status == 14)
					{
						$conditions['Health.requ_status'] = 14;
					}
					if($req_status == 4)
					{
						$conditions['Health.requ_status'] = 4;
					}
					if($req_status == 5)
					{
						$conditions['Health.requ_status'] = 5;
					}
					if($req_status == 0)
					{
						$conditions['Health.requ_status'] = 0;
					}
					//code edit by sanjeet
					if($req_status == 6)
					{
						$conditions['Health.requ_status'] = 6;
					}
					if($req_status == 9)
					{
						$conditions['Health.requ_status'] = 9;
					}
					//Code Edit By Ashish 05-06-14 Starts
					if($req_status == 8)
					{
						$conditions['Health.requ_status'] = 8;
					}
	
					if($req_status == 7)
					{
						$conditions['Health.requ_status'] = 7;
					}
					
					if($req_status == 15)
					{
						$conditions['Health.requ_status'] = 15;
					}
					
					if($req_status == 1)
					{
						$conditions['Health.requ_status'] = 1;
					}
					
					if($req_status == 2)
					{
						$conditions['Health.requ_status'] = 2;
					}
					
					if($req_status == 3)
					{
						$conditions['Health.requ_status'] = 3;
					}
					
					if($req_status == 16)
					{
						$conditions['Health.requ_status'] = 16;
					}
					
					if($req_status == 17)
					{
						$conditions['Health.requ_status'] = 17;
					}
					
					if($req_status == 18)
					{
						$conditions['Health.requ_status'] = 18;
					}
					
					if($req_status == 19)
					{
						$conditions['Health.requ_status'] = 19;
					}
					
					if($req_status == 20)
					{
						$conditions['Health.requ_status'] = 20;
					}
					
					if($req_status == 21)
					{
						$conditions['Health.requ_status'] = 21;
					}
					if($req_status == 22)
					{
						$conditions['Health.requ_status'] = 22;
					}
					if($req_status == 23)
					{
						$conditions['Health.requ_status'] = 23;
					}
					//Code Edit By Ashish 05-06-14 Ends
					$options['req_status'] = $req_status;
				}
				if(isset($pay_stat) && $pay_stat != '')
				{
					if($pay_stat == 'balance_due')
					{
						$conditions['(Health.total_amount - Health.received_amount) >'] = 0;
					}
					if($pay_stat == 'fully_paid')
					{
						$conditions['(Health.total_amount - Health.received_amount)'] = 0;
					}
					//$conditions['Health.requ_status !'] = 8;
					$options['pay_status'] = $pay_stat;
				}

				if(isset($req_src) && $req_src != '')
				{
					if($req_src == 'lis_sync')
					{
						$conditions['SUBSTRING(Health.flags,1,1)'] = "5";
					}
					if($req_src == 'without_lis')
					{
						$conditions['SUBSTRING(Health.flags,1,1) NOT LIKE '] = "5";
					}
					$options['source'] = $req_src;
				}

				$options['form_name'] = $form;
				$conditions['Health.status'] = 1;
				//print_R($conditions);die;
				$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.sample_date'=>'ASC','Health.sample_date1'=>'ASC','Health.sample_time'=>'ASC','Health.sample_time1'=>'ASC'),'conditions'=>$conditions));
				$samplerequestlist=$this->paginate('Health');
				$k = 0;
				foreach($samplerequestlist as $key => $val)
				{
					$ticket = $this->Ticket->find('first',array('conditions'=>array('Ticket.request_id'=>$val['Health']['id'])));
					if(!empty($ticket))
					{
						$samplerequestlist[$k]['Health']['ticket_raised'] = 1;
						$samplerequestlist[$k]['Health']['ticket_id'] = $ticket['Ticket']['id'];
						$samplerequestlist[$k]['Health']['ticket_status'] = $ticket['Ticket']['status'];
					}
					else
					{
						$samplerequestlist[$k]['Health']['ticket_raised'] = 0;
					}
					$lablist = array();
					$lablist[$val['Health']['created_by']] = $pcc_list[$val['Health']['created_by']];
					$pin_labs = $this->LabPincodeServicibility->find('all',array('LabPincodeServicibility.pincode'=>$val['Health']['pincode']));
					foreach($pin_labs as $val1)
					{
						$lablist[$val1['LabPincodeServicibility']['lab_id']] = $pcc_list[$val1['LabPincodeServicibility']['lab_id']];
						//$lab_name = $this->Lab->find('first',array('Lab.id'=>$val['LabPincodeServicibility']['lab_id']));
					}
					$samplerequestlist[$k]['Health']['lab_list'] = $lablist;
					$this->PhleboConfirmedNotify = ClassRegistry::init('PhleboConfirmedNotify');
					$phlebo = $this->PhleboConfirmedNotify->find('first',array('conditions'=>array('PhleboConfirmedNotify.health_id'=>$val['Health']['id'])));
					if(!empty($phlebo))
					{
						$samplerequestlist[$k]['Health']['phlebo_name'] = $phlebo['PhleboConfirmedNotify']['name'];
						$samplerequestlist[$k]['Health']['phlebo_contact'] = $phlebo['PhleboConfirmedNotify']['phone'];
						$samplerequestlist[$k]['Health']['phlebo_tracking'] = $phlebo['PhleboConfirmedNotify']['tracking_url'];
					}
					else
					{
						$this->Agent = ClassRegistry::init('Agent');
						$agent = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
						$samplerequestlist[$k]['Health']['phlebo_name'] = $agent['Agent']['name'];
						$samplerequestlist[$k]['Health']['phlebo_contact'] = $agent['Agent']['contact'];
						$samplerequestlist[$k]['Health']['phlebo_tracking'] = "-";
					}
					$city1='';
					$city1 = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['city_id'])));
					$samplerequestlist[$k]['Health']['city'] = $city1['City']['name'];
					if($val['Health']['assigned_lab'] != 'Home')
					{
						$pcc_detail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val['Health']['assigned_lab'])));
						$samplerequestlist[$k]['Health']['assigned_lab'] = $pcc_detail['Lab']['pcc_name'];
					}
					else
					{
						$samplerequestlist[$k]['Health']['assigned_lab'] = 'Home';
					}
					if($val['Health']['agent_id'] == 0)
					{
						$samplerequestlist[$k]['Health']['agent_name'] = 'No';
					}
					else
					{
						$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
						$samplerequestlist[$k]['Health']['agent_name'] = $agent_name['Agent']['name'];
					}
					if($val['Health']['processing_lab'] == 0)
					{
						$samplerequestlist[$k]['Health']['processing_lab'] = 'None';
					}
					else
					{
						$samplerequestlist[$k]['Health']['processing_lab'] = $val['Health']['processing_lab'];
					}

					$booking_from = substr($val['Health']['flags'], 0, 1);
					$samplerequestlist[$k]['Health']['source'] = 'N/A';

					if($booking_from == "1")
						$samplerequestlist[$k]['Health']['source'] = 'Online';
					if($booking_from == "2")
						$samplerequestlist[$k]['Health']['source'] = 'Manual';
					if($booking_from == "3")
						$samplerequestlist[$k]['Health']['source'] = 'Excel';
					if($booking_from == "4")
						$samplerequestlist[$k]['Health']['source'] = 'API';
					if($booking_from == "5")
						$samplerequestlist[$k]['Health']['source'] = 'LIS Synch';

					$visit_lab_2 = $val['Health']['sample_time'];
					$visit_lab_3 = $val['Health']['sample_date'];
					$home_collection_1 = $val['Health']['sample_time1'];
					$home_collection_2 = $val['Health']['sample_date1'];
					$this->Timelab = ClassRegistry::init('Timelab');
					$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));

					if(!empty($visit_lab_3))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
						
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
					}
					if(!empty($visit_lab_2))
					{
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];			
					}

					if(!empty($home_collection_2))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;	
					}

					if(!empty($home_collection_1))
					{
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
					}

					/*if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];
					}
					if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];
					}
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
					}
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
					}*/
					$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
					if($contact['User']['parent_child']=="parent")
						$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
					else
					{
						if(!empty($contact['User']['alternate_contact']))
							$samplerequestlist[$k]['Health']['landline'] = $contact['User']['alternate_contact'];
						else
							$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
					}
					
					$billing_status = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
					$samplerequestlist[$k]['Health']['bill_amount'] = $billing_status['Billing']['sub_total'];
					$user_email = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
					$samplerequestlist[$k]['Health']['email'] = $user_email['User']['email'];
					$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
					$samplerequestlist[$k]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
					if($val['Health']['locality'] == '')
					{
						$samplerequestlist[$k]['Health']['locality'] = $user_email['User']['locality'];
					}
					$k++;
				}
				$this->set('samplerequestlist',$samplerequestlist);
				$this->set('data_req_from_date',$from_date);
				$this->set('data_req_to_date',$to_date);
				if(isset($city))
				{
					$city = $this->City->find('first',array('conditions'=>array('City.id'=>$city)));
				}
				$this->set('data_req_city',$city['City']['id']);
				$this->set('data_req_lab',$lab);
                                $this->set('data_req_lab1',$booked_by);
				$this->set('data_req_agent',$agent);
				$this->set('data_req_report',$report);
				$this->set('data_req_request',$req_status);
				$this->set('data_req_pay_status',$pay_stat);
				$this->set('data_req_source',$req_src);
				$this->set('options',$options);
			}
		}
		if($form == 'second')
		{
			$conditions=array();
			//echo "<pre>"; print_r($this->data); die;
			$req_num = $this->data['Filter']['req_num'];
			$name = $this->data['Filter']['req_name'];
			$phone = $this->data['Filter']['req_phone'];
			$reference = $this->data['Filter']['reference'];
			$labnum = $this->data['Filter']['ref_num'];
			$mrn = $this->data['Filter']['mrn'];
			$barcode = $this->data['Filter']['barcode'];
			if(!in_array($usertype,array('A','BM','Agent','DA')))
			{
				$booked_by = $this->Session->read('Admin.labId');
				$conditions['Health.created_by'] = $booked_by;
				$options['lab1'] = $booked_by;
			}
			
			if(isset($req_num) && $req_num != '')
			{
				
				$order_num = $this->Billing->find('first',array('conditions'=>array('Billing.order_id'=>$this->data['Filter']['req_num'])));
				$conditions_req = array();
				if($usertype !='A' && $usertype !='BM')
				{
					$conditions_req['created_by'] = $this->Session->read('Admin.labId');;
				}
				$conditions_req['Health.id'] = $order_num['Billing']['request_id'];
				$conditions_req['Health.status'] = 1;
				$this->paginate = array('Health' => array('limit' =>'20','conditions'=>$conditions_req));
				$samplerequestlist=$this->paginate('Health');
			}
			if(isset($labnum) && $labnum != '')
			{
				$conditions['Health.ref_num'] = $labnum;
				$options['refnum'] = $labnum;
				$options['form_name'] = $form;
				$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.s_date'=>'ASC'),'conditions'=>$conditions));
				$samplerequestlist=$this->paginate('Health');
			}
			if(isset($mrn) && $mrn != '')
			{
				$conditions['Health.medical_reference_number LIKE'] = '%'.$mrn.'%';
				$options['medical_reference_number'] = $mrn;
			}
			if((isset($name) || isset($phone)||isset($barcode)||isset($reference)) && $req_num == '')
			{
				if(isset($name) && $name != '')
				{
					$conditions['Health.name LIKE'] = '%'.$name.'%';
					$options['name'] = $name;
				}
				if(isset($phone) && $phone != '')
				{
					$conditions['Health.landline LIKE'] = '%'.$phone.'%';
					$options['phone'] = $phone;
				}
				if(isset($reference) && $reference != '')
				{
					$conditions['Health.reference'] = $reference;
					$options['reference'] = $reference;
				}
				$options['form_name'] = $form;
				$conditions['Health.status'] = 1;
				//print_R($conditions);die;
				$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.s_date'=>'DESC'),'conditions'=>$conditions));
				if(isset($barcode) && $barcode != '')
				{
					$this->paginate = array('Health' => array('limit' =>'20','group'=>array('Health.id'),'order'=>array('Health.id'=>'DESC'),'conditions'=>array('Healthsample.barcode_id'=>$barcode),'joins' => array(
						array(
						    'alias' => 'Healthsample',
						    'table' => 'health_sample',
						    'type' => 'INNER',
						    'conditions' => '`Healthsample`.`health_id` = `Health`.`id`'
						)
					    )));
				}
				$samplerequestlist=$this->paginate('Health');
			}
			$k = 0;
			foreach($samplerequestlist as $key => $val)
			{
				$ticket = $this->Ticket->find('first',array('conditions'=>array('Ticket.request_id'=>$val['Health']['id'])));
				if(!empty($ticket))
				{
					$samplerequestlist[$k]['Health']['ticket_raised'] = 1;
					$samplerequestlist[$k]['Health']['ticket_id'] = $ticket['Ticket']['id'];
					$samplerequestlist[$k]['Health']['ticket_status'] = $ticket['Ticket']['status'];
				}
				else
				{
					$samplerequestlist[$k]['Health']['ticket_raised'] = 0;
				}
				$lablist = array();
				$lablist[$val['Health']['created_by']] = $pcc_list[$val['Health']['created_by']];
				$pin_labs = $this->LabPincodeServicibility->find('all',array('LabPincodeServicibility.pincode'=>$val['Health']['pincode']));
				foreach($pin_labs as $val1)
				{
					$lablist[$val1['LabPincodeServicibility']['lab_id']] = $pcc_list[$val1['LabPincodeServicibility']['lab_id']];
					//$lab_name = $this->Lab->find('first',array('Lab.id'=>$val['LabPincodeServicibility']['lab_id']));
				}
				$samplerequestlist[$k]['Health']['lab_list'] = $lablist;
				
				$this->PhleboConfirmedNotify = ClassRegistry::init('PhleboConfirmedNotify');
				$phlebo = $this->PhleboConfirmedNotify->find('first',array('conditions'=>array('PhleboConfirmedNotify.health_id'=>$val['Health']['id'])));
				if(!empty($phlebo))
				{
					$samplerequestlist[$k]['Health']['phlebo_name'] = $phlebo['PhleboConfirmedNotify']['name'];
					$samplerequestlist[$k]['Health']['phlebo_contact'] = $phlebo['PhleboConfirmedNotify']['phone'];
					$samplerequestlist[$k]['Health']['phlebo_tracking'] = $phlebo['PhleboConfirmedNotify']['tracking_url'];
				}
				else
				{
					$this->Agent = ClassRegistry::init('Agent');
					$agent = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
					//print_R($agent);die;
					$samplerequestlist[$k]['Health']['phlebo_name'] = $agent['Agent']['name'];
					$samplerequestlist[$k]['Health']['phlebo_contact'] = $agent['Agent']['contact'];
					$samplerequestlist[$k]['Health']['phlebo_tracking'] = "-";
				}
					//print_R($samplerequestlist);die;
					$city='';
					$city = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['city_id'])));
					$samplerequestlist[$k]['Health']['city'] = $city['City']['name'];
				if($val['Health']['assigned_lab'] != 'Home')
				{
					$pcc_detail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val['Health']['assigned_lab'])));
					$samplerequestlist[$k]['Health']['assigned_lab'] = $pcc_detail['Lab']['pcc_name'];
				}
				else
				{
					$samplerequestlist[$k]['Health']['assigned_lab'] = 'Home';
				}
				if($val['Health']['agent_id'] == 0)
				{
					$samplerequestlist[$k]['Health']['agent_name'] = 'No';
				}
				else
				{
					$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
					$samplerequestlist[$k]['Health']['agent_name'] = $agent_name['Agent']['name'];
				}
				$visit_lab_2 = $val['Health']['sample_time'];
				$visit_lab_3 = $val['Health']['sample_date'];
				$home_collection_1 = $val['Health']['sample_time1'];
				$home_collection_2 = $val['Health']['sample_date1'];
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));

				if(!empty($visit_lab_3))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
				}
				if(!empty($visit_lab_2))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];			
				}

				if(!empty($home_collection_2))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;	
				}

				if(!empty($home_collection_1))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}

				/*if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];
				}
				if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];
				}
				
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}*/
				$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				if($contact['User']['parent_child']=="parent")
					$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
				else
				{
					if(!empty($contact['User']['alternate_contact']))
						$samplerequestlist[$k]['Health']['landline'] = $contact['User']['alternate_contact'];
					else
						$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
				}
				
				$booking_from = substr($val['Health']['flags'], 0, 1);
				$samplerequestlist[$k]['Health']['source'] = 'N/A';

				if($booking_from == "1")
					$samplerequestlist[$k]['Health']['source'] = 'Online';
				if($booking_from == "2")
					$samplerequestlist[$k]['Health']['source'] = 'Manual';
				if($booking_from == "3")
					$samplerequestlist[$k]['Health']['source'] = 'Excel';
				if($booking_from == "4")
					$samplerequestlist[$k]['Health']['source'] = 'API';
				if($booking_from == "5")
					$samplerequestlist[$k]['Health']['source'] = 'LIS Synch';

				$billing_status = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
				$samplerequestlist[$k]['Health']['bill_amount'] = $billing_status['Billing']['sub_total'];
				$user_email = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				$samplerequestlist[$k]['Health']['email'] = $user_email['User']['email'];
				$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
				$samplerequestlist[$k]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
				if($val['Health']['locality'] == '')
				{
					$samplerequestlist[$k]['Health']['locality'] = $user_email['User']['locality'];
				}
				
				$k++;
			}
			//print_R($samplerequestlist);die;
			$this->set('samplerequestlist',$samplerequestlist);
			if($req_num != '')
			{
				$this->set('req_number',$this->data['Filter']['req_num']);
			}
			else
			{
				$this->set('data_req_name',$name);
				$this->set('data_req_phone',$phone);
				$this->set('data_req_regis',$restion);
				$this->set('reference',$reference);
				$this->set('mrn',$mrn);
				$this->set('barcode',$barcode);
			}
		}
		$j = 0;
		foreach($samplerequestlist as $key => $val)
		{
			$test_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val['Sample']['test_id'])));
			$samplerequestlist[$j]['Sample']['test_name'] = $test_name['Test']['test_parameter'];
			$j++;
		}
		$this->set('samplerequestlist',$samplerequestlist);
		//print_R($samplerequestlist);die;
		$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
        
		
		$agent_list = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
		$this->set('agent_list',$agent_list);
		$this->set('pcc',$pcc);
                $this->set('pcc_list',$pcc_list);
	}

	function admin_create_subuser()
	{
		$this->User = ClassRegistry::init('User');
		$check_user = $this->User->find('first',array('conditions'=>array('OR'=>array('User.contact'=>$_REQUEST['alt_contact'],'User.alternate_contact'=>$_REQUEST['alt_contact']))));
		if($check_user)
		{
			$this->data = $this->User->create();
			$name = explode(" ",$_REQUEST['name']);
			if($_REQUEST['parent_id']!=0 && isset($_REQUEST['parent_id']))
			{
				//print_R(json_encode($_REQUEST['parent_id']));
				$parent_data = $this->User->find('first',array('conditions'=>array('User.id'=>$_REQUEST['parent_id'])));
				//print_R(json_encode($parent_data));die;
				$this->data['User']['contact'] = $parent_data['User']['contact'];
			}
			else
			{
				$this->data['User']['contact'] = $_REQUEST['contact'];
			}
			if($_REQUEST['type']!='' && isset($_REQUEST['type']))
			{
				$this->data['User']['type'] = $_REQUEST['type'];
			}
			else
			{
				$parent_data = $this->User->find('first',array('conditions'=>array('User.id'=>$_REQUEST['parent_id'])));
				$this->data['User']['type'] = $parent_data['User']['type'];
			}
			
			$username = strtolower($name[0]).mt_rand(1000,9999);
			$pass2 = substr(strtolower($name[0]),0,3);
			//$pass3 = .mt_rand(1000,9999);
			$password = $pass2.mt_rand(100000,999999);
			$this->data['User']['first_name'] = $name[0];
			$this->data['User']['last_name'] = $name[1];
			$this->data['User']['name'] = $_REQUEST['name'];
			$this->data['User']['username'] = $username;
			$this->data['User']['passwd'] = $password;
			$this->data['User']['alternate_contact'] = $_REQUEST['alt_contact'];
			$this->data['User']['email'] = $_REQUEST['email'];
			$this->data['User']['alternate_email'] = $_REQUEST['alt_email'];
			$this->data['User']['age'] = $_REQUEST['age'];
			$this->data['User']['gender'] = $_REQUEST['gender'];
			$this->data['User']['address'] = $_REQUEST['address1']." ".$_REQUEST['address2'];
			$this->data['User']['parent_id'] = $_REQUEST['parent_id'];
			$this->data['User']['city'] = $_REQUEST['city_id'];
			$this->data['User']['state'] = $_REQUEST['state'];
			$this->data['User']['pincode'] = $_REQUEST['pincode'];
			$this->data['User']['status'] = 1;
			$this->data['User']['created_by'] = $this->Session->read('Admin.labId');
			if($_REQUEST['sub_user'] == "new_sub_patient" && $_REQUEST['parent_id']!=0)
			{
				$this->data['User']['relation'] = $_REQUEST['relation'];
				$this->data['User']['parent_child'] = "child";
			}
			else
			{
				$this->data['User']['relation'] = "self";
				$this->data['User']['parent_child'] = "parent";
			}
			//print_R(json_encode($this->User->save($this->data)));die;
			if($this->User->save($this->data))
			{
				$getLastInsertId = $this->User->getLastInsertId();
				if($_REQUEST['parent_id']==0)
				{
					$this->User->query("Update users set parent_id='".$getLastInsertId."' where id='".$getLastInsertId."'");	
				}
				
				if($_REQUEST['email']){
					$this->set('user_name' , strtoupper($_REQUEST['name'] ));
					$this->set('user_email' , $_REQUEST['email'] );
					$this->set('user_pass' , $password);
					$this->Email->template = 'login_detail';
					$this->Email->from = $this->data['Health']['email'];
					$this->Email->fromName = 'info@niramayahealthcare.com';
					$this->Email->subject = 'Login details for niramaya member panel';
					$this->Email->to = $this->data['Health']['email'];
					$this->Email->sendAs = 'html'; // because we like to send pretty mail
					$this->Email->delivery = 'mail';
					$this->Email->send();
				}
				
				$x['user_id'] = $getLastInsertId;
				$x['success'] = 'success';
				$m['user_info'] = $x;
			}
			else
			{
				$x['success'] = 'notsuccess';
				$m['user_info'] = $x;	
			}	
		}
		else
		{
			$x['user_id'] = $check_user['User']['id'];
			$x['success'] = 'success';
			$m['user_info'] = $x;
		}
		
		echo json_encode($m);
		//print_R(json_encode($this->data));
		exit;
	}

	function admin_add_request()
	{
        $this->Admin = ClassRegistry::init('Admin');
        $agents_booked = $this->Admin->find('list',array('conditions'=>array('Admin.status'=>1)));
        $this->set('agents_booked',$agents_booked);
		$usertype = $this->Session->read('Admin.userType');
		$userlab = $this->Session->read('userlab');
		$this->set('usertype',$usertype);
		$this->set('title_for_layout','Add Sample');
		$login_type = $this->Session->read('Admin.userType');
        	if($login_type == 'A')
		{
			$this->set('LoginType','Super');
		}
		elseif($login_type == 'Agent')
		{
			$this->set('LoginType','Agent');
		}
		elseif($login_type == 'BM')
		{
			$this->set('LoginType','BM');
		}
		else
		{
			$this->set('LoginType','PCC');
		}
                
		if(!empty($this->data))
		{
			$this->User = ClassRegistry::init('User');
			$user_data = $this->User->find('first',array('conditions'=>array('User.id'=>$this->data['Health']['user_id'])));
			$this->data['Health']['name'] = $user_data['User']['name'];
			$this->data['Health']['age'] = $user_data['User']['age'];
			$this->data['Health']['email'] = $user_data['User']['email'];
			$this->data['Health']['gender'] = $user_data['User']['gender'];
			if($user_data['User']['parent_child']=="parent")
				$this->data['Health']['landline'] = $user_data['User']['contact'];	
			else
				$this->data['Health']['landline'] = $user_data['User']['alternate_contact'];
			$this->data['Health']['address'] = $user_data['User']['address'];
			$this->data['Health']['address1'] = "";
			$this->data['Health']['state'] = $user_data['User']['state'];
			$this->data['Health']['locality'] = $user_data['User']['locality'];
			$this->data['Health']['pincode'] = $user_data['User']['pincode'];
			$this->data['Health']['landmark'] = $user_data['User']['landmark'];
			$this->data['Health']['city'] = $user_data['User']['city'];
			$this->data['Health']['city_id'] = $user_data['User']['city'];
			if(!isset($this->data['Health']['same_city']))
			{
				$this->data['Health']['same_city'] = $user_data['User']['city'];
			}
			if(!isset($this->data['Health']['same_state']))
			{
				$this->data['Health']['same_state'] = $user_data['User']['state'];
			}
			if(!isset($this->data['Health']['same_locality']))
			{
				$this->data['Health']['same_locality'] = $user_data['User']['locality'];
			}
			if(!isset($this->data['Health']['same_pincode']))
			{
				$this->data['Health']['same_pincode'] = $user_data['User']['pincode'];
			}
			if(!isset($this->data['Health']['same_landmark']))
			{
				$this->data['Health']['same_landmark'] = $user_data['User']['landmark'];
			}
			if(!isset($this->data['Health']['same_address1']))
			{
				$this->data['Health']['same_address1'] = $user_data['User']['address'];
			}
			if(!isset($this->data['Health']['same_address2']))
			{
				$this->data['Health']['same_address2'] = " ";
			}
			$this->data['Health']['user_id'] = $user_data['User']['id'];
			$this->data['Health']['status'] = 1;
			if(!empty($this->data['Health']['test_id']))
			{
				$implode = $this->data['Health']['test_id'];
			}
			else
			{
				$implode = '';
			}
			
			if(!empty($this->data['Health']['profile_id']) && isset($this->data['Health']['profile_id']))
			{
				$implode_profile = $this->data['Health']['profile_id'];
			}
			else
			{
				$implode_profile = '';
			}
			if(!empty($this->data['Health']['offer_id']) && isset($this->data['Health']['offer_id']))
			{
				$implode_offer = $this->data['Health']['offer_id'];
			}
			else
			{
				$implode_offer = '';
			}
			if(!empty($this->data['Health']['package_id']) && isset($this->data['Health']['package_id']))
			{
				$implode_package = $this->data['Health']['package_id'];
			}
			else
			{
				$implode_package = '';
			}
			if(!empty($this->data['Health']['service_id']) && isset($this->data['Health']['service_id']))
			{
				$implode_service = $this->data['Health']['service_id'];
			}
			else
			{
				$implode_service = '';
			}
			$this->data['Health']['test_id'] = $implode;
			$this->data['Health']['profile_id'] = $implode_profile;
			$this->data['Health']['offer_id'] = $implode_offer;
			$this->data['Health']['package_id'] = $implode_package;
			$this->data['Health']['service_id'] = $implode_service;
			$amt_t = 0;
			if(!empty($this->data['Health']['test_id']))
			{
                $amt_tst = $this->Test->find('all',array('fields'=>array('Test.id','Test.mrp'),'conditions'=>array('Test.id'=>explode(',',$this->data['Health']['test_id']))));
                foreach($amt_tst as $k => $v)
                {
                    $amt_t = $amt_t + $v['Test']['mrp'];
                    
                }
			}
                        //for profile
            if(!empty($this->data['Health']['profile_id']))
			{
                $amt_tst = $this->Test->find('all',array('fields'=>array('Test.id','Test.mrp'),'conditions'=>array('Test.id'=>explode(',',$this->data['Health']['profile_id']))));
                foreach($amt_tst as $k => $v)
                {
                    $amt_t = $amt_t + $v['Test']['mrp'];
                }
			}
                        //for offer
            if(!empty($this->data['Health']['offer_id']))
			{
                $amt_tst = $this->Banner->find('all',array('fields'=>array('Banner.id','Banner.banner_mrp'),'conditions'=>array('Banner.id'=>explode(',',$this->data['Health']['offer_id']))));
                
                foreach($amt_tst as $k => $v)
                {
                    $amt_t = $amt_t + $v['Banner']['banner_mrp'];
                }
			}
                        //for package
            if(!empty($this->data['Health']['package_id']))
			{
                $amt_tst = $this->Package->find('all',array('fields'=>array('Package.id','Package.package_mrp'),'conditions'=>array('Package.id'=>explode(',',$this->data['Health']['package_id']))));
                
                foreach($amt_tst as $k => $v)
                {
                    $amt_t = $amt_t + $v['Package']['package_mrp'];
                }
			}
                        //for service
            if(!empty($this->data['Health']['service_id']))
			{
                $amt_tst = $this->Test->find('all',array('fields'=>array('Test.id','Test.mrp'),'conditions'=>array('Test.id'=>explode(',',$this->data['Health']['service_id']))));
                foreach($amt_tst as $k => $v)
                {
                    $amt_t = $amt_t + $v['Test']['mrp'];
                }
			}
			$this->data['Health']['total_amount'] = $amt_t;
            
			if(!empty($this->data['Health']['discount']))
			{
				$find_discount = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$this->data['Health']['discount'],'Discount.status'=>1)));
				if(!empty($find_discount))
				{
					$get_type = $find_discount['Discount']['type'];
					if($get_type == 'Percent')
					{
						$value_1 = ($find_discount['Discount']['amount']/100);
						$value_2 = ($value_1*$this->data['Health']['total_amount']);
						$value_3 = ($this->data['Health']['total_amount']-$value_2);
						if($this->data['Health']['discount'] == 'Comp100')
						{
							$this->data['Health']['total_amount'] = round($value_3);
							$this->data['Health']['received_amount'] = $this->data['Health']['total_amount'];
						}
						else
						{
							$this->data['Health']['total_amount'] = round($value_3);
						}
						$this->data['Health']['discount_id'] = $find_discount['Discount']['id'];
					}
					if($get_type == 'Rupees')
					{
						$value_3 = ($this->data['Health']['total_amount']-$find_discount['Discount']['amount']);
						$this->data['Health']['total_amount'] = round($value_3);
						$this->data['Health']['discount_id'] = $find_discount['Discount']['id'];
					}
				}
			}
			//24 Sep 2013 Ends
			if(!empty($this->data['Health']['discount_amount']))
			{
				//echo $this->data['Health']['total_amount']; exit;
				$value_3 = ($this->data['Health']['total_amount']-$this->data['Health']['discount_amount']);
				$this->data['Health']['total_amount'] = $value_3;
				$this->data['Health']['discount_amount'] = $this->data['Health']['discount_amount'];
			}
			$this->data['Health']['balance_amount'] = $this->data['Health']['total_amount'];
			if(empty($this->data['Health']['discount_amount']))
			{
				$this->data['Health']['discount_amount'] = 0;
			}
			if(empty($this->data['Health']['created_by']))
                            $this->data['Health']['created_by']=$this->Session->read('Admin.labId');
                        if(isset($this->data['Health']['created_by_agent']) && !empty($this->data['Health']['created_by_agent']))
                        {
                        }
                        elseif($this->Session->check('Admin.id'))
                        {
                            $this->data['Health']['created_by_agent'] = $this->Session->read('Admin.id');
                        }
			/*if book by BM set lab id 31*/
			if(empty($this->data['Health']['created_by']))
				$this->data['Health']['created_by']=31;			
                            
            $this->data['Health']['processing_lab']=1;	                        
			if($this->Health->create($this->data))
			{
				$this->data['Health']['agent_id'] = 0;
				//$this->data['Health']['user_id'] = 0;
				$this->data['Health']['pay_status'] = 0;
				$this->data['Health']['print_status'] = 0;
				$this->data['Health']['trf_status'] = 0;
				$this->data['Health']['sent_pathcorp'] = 0;
				$this->data['Health']['receive_pathcorp'] = 0;
				$this->data['Health']['reschduled'] = 0;
				$this->data['Health']['cancelled_status'] = 0;
				$this->data['Health']['cancelled_reason'] = '';
				$this->data['Health']['published'] = 0;
				$this->data['Health']['published_reason'] = '';
				$this->data['Health']['old_date'] = '0000-00-00';
				$this->data['Health']['old_time'] = '';
				$this->data['Health']['book_date'] = date('Y-m-d H:i:s');
				$this->data['Health']['flags'] = "2000000000";
				if($this->data['Health']['city'] != '')
				{
					$this->data['Health']['city_id'] = 0;
					$this->data['Health']['assigned_lab'] = $this->data['Health']['city'];
					if(empty($this->data['Health']['user_id']))
					{
						$city_v = $this->data['Health']['city'];
						$state_v = $this->data['Health']['state'];
						$locality_v = $this->data['Health']['locality'];
						$pincode_v = $this->data['Health']['pincode'];
						$landmark_v = $this->data['Health']['landmark'];
						$this->data['Health']['address'] = '';
						$this->data['Health']['locality'] = '';
						$this->data['Health']['city_id'] = 0;
						$this->data['Health']['state'] = 0;
						$this->data['Health']['pincode'] = '';
						$this->data['Health']['landmark'] = '';
					}
					$this->data['Health']['visit_pat_city'] = $this->data['Health']['city'];
					$this->data['Health']['s_date'] = date('Y-m-d',strtotime($this->data['Health']['sample_date']));
					$this->data['Health']['requ_status'] = 0;
					$this->data['Health']['requ_type'] = 'visit_lab';
				}
				if(!empty($this->data['Health']['sample_time1']) && !empty($this->data['Health']['sample_date1']))
				{
					$city_v = $this->data['Health']['same_city'];
					$state_v = $this->data['Health']['same_state'];
					$locality_v = $this->data['Health']['same_locality'];
					$pincode_v = $this->data['Health']['same_pincode'];
					$landmark_v = $this->data['Health']['same_landmark'];
					$this->data['Health']['assigned_lab'] = 'Home';
					if(!empty($this->data['Health']['same_address1']) && empty($this->data['Health']['same_address2']))
					{
						$this->data['Health']['address'] = $this->data['Health']['same_address1'];
					}
					if(!empty($this->data['Health']['same_address1']) && !empty($this->data['Health']['same_address2']))
					{
						$this->data['Health']['address'] = $this->data['Health']['same_address1'].'*'.$this->data['Health']['same_address2'];
					}
					$this->data['Health']['locality'] = $this->data['Health']['same_locality'];
					$this->data['Health']['city_id'] = $this->data['Health']['same_city'];
					$this->data['Health']['state'] = $this->data['Health']['same_state'];
					$this->data['Health']['pincode'] = $this->data['Health']['same_pincode'];
					$this->data['Health']['landmark'] = $this->data['Health']['same_landmark'];
					$this->data['Health']['s_date'] = date('Y-m-d',strtotime($this->data['Health']['sample_date1']));
					$this->data['Health']['visit_pat_city'] = $this->data['Health']['same_city'];
					$this->data['Health']['requ_status'] = 0;
					$this->data['Health']['requ_type'] = 'home_collection';
				}
				if(isset($this->data['Health']['old_home_report']) && $this->data['Health']['old_home_report'] == 0)
				{
					if($this->data['Health']['home_report'] == 1)
					{
						$find_tot_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
						$new_tot_amt = ($find_tot_amt['Health']['total_amount']+50);
						$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."' WHERE id='".$this->data['Health']['id']."'");
					}
				}
				if(isset($this->data['Health']['old_home_report']) && $this->data['Health']['old_home_report'] == 1)
				{
					if($this->data['Health']['home_report'] == 0)
					{
						$find_tot_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
						$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
						$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."' WHERE id='".$this->data['Health']['id']."'");
					}
				}
				if(empty($this->data['Health']['old_home_report']))
				{
					if($this->data['Health']['home_report'] == 1)
					{
						$this->data['Health']['total_amount'] = ($this->data['Health']['total_amount']+50);
					}
				}
				
				$this->data['Health']['amount_to_be_collected'] = $this->data['Health']['total_amount'];
				$this->data['Health']['amount_collected'] = '0';
				$this->data['Health']['payment_type'] = '3';
				
				if(empty($this->data['Health']['s_date']) || $this->data['Health']['s_date']=='1970-01-01')
                {
                    $this->data['Health']['s_date'] = date('Y-m-d');
                }
				if($this->Health->save($this->data,false))
				{
					//print_R($this->data);die;
					$last_insert_id = $this->Health->getLastInsertId();
					$fetch_saved_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$last_insert_id)));
					
					$explode_test_ids_db = explode(',',$fetch_saved_detail['Health']['test_id']);
					if(!empty($explode_test_ids_db))
					{
						foreach($explode_test_ids_db as $k_test_db => $v_test_db)
						{
							$find_test_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_test_db)));
							$this->data['RequestTest']['type'] = 'TE';
							$this->data['RequestTest']['health_id'] = $last_insert_id;
							$this->data['RequestTest']['test_id'] = $v_test_db;
							$this->data['RequestTest']['mrp'] =$find_test_mrp['Test']['mrp'];
							$this->data['RequestTest']['test_book_date'] =$fetch_saved_detail['Health']['book_date'];
							$this->data['RequestTest']['status'] =1;
							if($this->RequestTest->create($this->data))
							{
								$this->RequestTest->save($this->data);
							}
						}
					}
					$explode_profile_ids_db = explode(',',$fetch_saved_detail['Health']['profile_id']);
					if(!empty($explode_profile_ids_db[0]))
					{
						foreach($explode_profile_ids_db as $k_profile_db => $v_profile_db)
						{
							$find_profile_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_profile_db)));
							$this->data['RequestTest']['type'] = 'PR';
							$this->data['RequestTest']['health_id'] = $last_insert_id;
							$this->data['RequestTest']['test_id'] = $v_profile_db;
							$this->data['RequestTest']['mrp'] =$find_profile_mrp['Test']['mrp'];
							$this->data['RequestTest']['test_book_date'] =$fetch_saved_detail['Health']['book_date'];
							$this->data['RequestTest']['status'] =1;
							if($this->RequestTest->create($this->data))
							{
								$this->RequestTest->save($this->data);
							}
						}
					}
					$explode_offer_ids_db = explode(',',$fetch_saved_detail['Health']['offer_id']);
					if(!empty($explode_offer_ids_db[0]))
					{
						foreach($explode_offer_ids_db as $k_offer_db => $v_offer_db)
						{
							$find_offer_mrp = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v_offer_db)));
							$this->data['RequestTest']['type'] = 'OF';
							$this->data['RequestTest']['health_id'] = $last_insert_id;
							$this->data['RequestTest']['test_id'] = $v_offer_db;
							$this->data['RequestTest']['mrp'] =$find_offer_mrp['Banner']['banner_mrp'];
							$this->data['RequestTest']['test_book_date'] =$fetch_saved_detail['Health']['book_date'];
							$this->data['RequestTest']['status'] =1;
							if($this->RequestTest->create($this->data))
							{
								$this->RequestTest->save($this->data);
							}
						}
					}
					$explode_package_ids_db = explode(',',$fetch_saved_detail['Health']['package_id']);
					if(!empty($explode_package_ids_db[0]))
					{
						foreach($explode_package_ids_db as $k_package_db => $v_package_db)
						{
							$find_package_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v_package_db)));
							$this->data['RequestTest']['type'] = 'PA';
							$this->data['RequestTest']['health_id'] = $last_insert_id;
							$this->data['RequestTest']['test_id'] = $v_package_db;
							$this->data['RequestTest']['mrp'] =$find_package_mrp['Package']['package_mrp'];
							$this->data['RequestTest']['test_book_date'] =$fetch_saved_detail['Health']['book_date'];
							$this->data['RequestTest']['status'] =1;
							if($this->RequestTest->create($this->data))
							{
								$this->RequestTest->save($this->data);
							}
						}
					}
					$explode_service_ids_db = explode(',',$fetch_saved_detail['Health']['service_id']);
					if(!empty($explode_service_ids_db[0]))
					{
						foreach($explode_service_ids_db as $k_service_db => $v_service_db)
						{
							$find_service_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_service_db)));
							$this->data['RequestTest']['type'] = 'SR';
							$this->data['RequestTest']['health_id'] = $last_insert_id;
							$this->data['RequestTest']['test_id'] = $v_service_db;
							$this->data['RequestTest']['mrp'] =$find_service_mrp['Test']['mrp'];
							$this->data['RequestTest']['test_book_date'] =$fetch_saved_detail['Health']['book_date'];
							$this->data['RequestTest']['status'] =1;
							if($this->RequestTest->create($this->data))
							{
								$this->RequestTest->save($this->data);
							}
						}
					}
                    if(isset($this->data['Health']['discount_id']) && !empty($this->data['Health']['discount_id']))
                    {
                        $get_use_time_type = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$this->data['Health']['discount_id'])));
                        if($get_use_time_type['Discount']['use_time'] == 1)
                        {
                                $update_disc_status = $this->Discount->query("UPDATE discounts SET used_status='1' WHERE id='".$this->data['Health']['discount_id']."'");
                        }
                    }
					
					$someOneArray = array();
					$someOneArray['Health']['name'] = strtoupper($this->data['Health']['name']);
					if($this->data['Health']['gender'] == 1)
					{
						$someOneArray['Health']['gender'] = 'Male';
					}
					if($this->data['Health']['gender'] == 2)
					{
						$someOneArray['Health']['gender'] = 'Female';
					}
					if(!empty($implode))
					{
                        $find_test_name = $this->Test->find('all',array('conditions'=>array('Test.id'=>explode(',',$implode))));
                        $someOneArray['Health']['test_id']="";
                        foreach($find_test_name as $key=>$value)
                        {
                            $someOneArray['Health']['test_id'] .= $value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$value['Test']['mrp'].',';
                        }
                        $someOneArray['Health']['test_id']=substr($someOneArray['Health']['test_id'],0,strlen($someOneArray['Health']['test_id'])-1);
					}
					if(!empty($implode_profile))
					{
                        $find_profile_name = $this->Test->find('all',array('conditions'=>array('Test.id'=>explode(',',$implode_profile))));
                        $someOneArray['Health']['profile_id']="";
                        foreach($find_profile_name as $key=>$value)
                        {
                            $someOneArray['Health']['profile_id'] .= $value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$value['Test']['mrp'].',';
                        }
                        $someOneArray['Health']['profile_id']=substr($someOneArray['Health']['profile_id'],0,strlen($someOneArray['Health']['profile_id'])-1);
                    }
                                        
					if(!empty($implode_offer))
					{
                        $find_offer_name = $this->Banner->find('all',array('conditions'=>array('Banner.id'=>explode(',',$implode_offer))));
                        $someOneArray['Health']['offer_id']="";
                        foreach($find_offer_name as $key=>$value)
                        {
                            $someOneArray['Health']['offer_id'] .= $value['Banner']['banner_code'].' - '.$value['Banner']['banner_name'].' - Rs.'.$value['Banner']['banner_mrp'].',';
                        }
                        $someOneArray['Health']['offer_id']=substr($someOneArray['Health']['offer_id'],0,strlen($someOneArray['Health']['offer_id'])-1);
					}
					if(!empty($implode_package))
					{
                        $find_package_name = $this->Package->find('all',array('conditions'=>array('Package.id'=>explode(',',$implode_package))));
                        $someOneArray['Health']['package_id']="";
                        foreach($find_package_name as $key=>$value)
                        {
                            $someOneArray['Health']['package_id'] .= $value['Package']['package_name'].' - Rs.'.$value['Package']['package_mrp'].',';
                        }
                        $someOneArray['Health']['package_id']=substr($someOneArray['Health']['package_id'],0,strlen($someOneArray['Health']['package_id'])-1);
					}
					if(!empty($implode_service))
					{
                        $find_service_name = $this->Test->find('all',array('conditions'=>array('Test.id'=>explode(',',$implode_service))));
                        $someOneArray['Health']['service_id']="";
                        foreach($find_service_name as $key=>$value)
                        {
                            $someOneArray['Health']['service_id'] .= $value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$value['Test']['mrp'].',';
                        }
                        $someOneArray['Health']['service_id']=substr($someOneArray['Health']['service_id'],0,strlen($someOneArray['Health']['service_id'])-1);
	                }
					if($this->data['Health']['sample_time'] == 25) {$someOneArray['Health']['sample_time'] = '6:00 - 6:30';}
					if($this->data['Health']['sample_time'] == 26) {$someOneArray['Health']['sample_time'] = '6:30 - 7:00';}
										
					if($this->data['Health']['sample_time'] == 1) {$someOneArray['Health']['sample_time'] = '7:00 - 7:30';}
					if($this->data['Health']['sample_time'] == 2) {$someOneArray['Health']['sample_time'] = '7:30 - 8:00';}
					if($this->data['Health']['sample_time'] == 3) {$someOneArray['Health']['sample_time'] = '8:00 - 8:30';}
					if($this->data['Health']['sample_time'] == 4) {$someOneArray['Health']['sample_time'] = '8:30 - 9:00';}
					if($this->data['Health']['sample_time'] == 5) {$someOneArray['Health']['sample_time'] = '9:00 - 9:30';}
					if($this->data['Health']['sample_time'] == 6) {$someOneArray['Health']['sample_time'] = '9:30 - 10:00';}
					if($this->data['Health']['sample_time'] == 7) {$someOneArray['Health']['sample_time'] = '10:00 - 10:30';}
					if($this->data['Health']['sample_time'] == 8) {$someOneArray['Health']['sample_time'] = '10:30 - 11:00';}
					if($this->data['Health']['sample_time'] == 9) {$someOneArray['Health']['sample_time'] = '11:00 - 11:30';}
					if($this->data['Health']['sample_time'] == 10) {$someOneArray['Health']['sample_time'] = '11:30 - 12:00';}
					if($this->data['Health']['sample_time'] == 11) {$someOneArray['Health']['sample_time'] = '12:00 - 12:30';}
					if($this->data['Health']['sample_time'] == 12) {$someOneArray['Health']['sample_time'] = '12:30 - 13:00';}
					if($this->data['Health']['sample_time'] == 13) {$someOneArray['Health']['sample_time'] = '13:00 - 13:30';}
					if($this->data['Health']['sample_time'] == 14) {$someOneArray['Health']['sample_time'] = '13:30 - 14:00';}
					if($this->data['Health']['sample_time'] == 15) {$someOneArray['Health']['sample_time'] = '14:00 - 14:30';}
					if($this->data['Health']['sample_time'] == 16) {$someOneArray['Health']['sample_time'] = '14:30 - 15:00';}
					if($this->data['Health']['sample_time'] == 17) {$someOneArray['Health']['sample_time'] = '15:00 - 15:30';}
					if($this->data['Health']['sample_time'] == 18) {$someOneArray['Health']['sample_time'] = '15:30 - 16:00';}
					if($this->data['Health']['sample_time'] == 19) {$someOneArray['Health']['sample_time'] = '16:00 - 16:30';}
					if($this->data['Health']['sample_time'] == 20) {$someOneArray['Health']['sample_time'] = '16:30 - 17:00';}
					if($this->data['Health']['sample_time'] == 21) {$someOneArray['Health']['sample_time'] = '17:00 - 17:30';}
					if($this->data['Health']['sample_time'] == 22) {$someOneArray['Health']['sample_time'] = '17:30 - 18:00';}
					if($this->data['Health']['sample_time'] == 23) {$someOneArray['Health']['sample_time'] = '18:00 - 18:30';}
					
					if($this->data['Health']['sample_time'] == 24) {$someOneArray['Health']['sample_time'] = '18:30 - 17:00';}
				
					if($this->data['Health']['sample_time1'] == 25) {$someOneArray['Health']['sample_time1'] = '6:00 - 6:30';}
					if($this->data['Health']['sample_time1'] == 26) {$someOneArray['Health']['sample_time1'] = '6:30 - 7:00';}
					if($this->data['Health']['sample_time1'] == 1) {$someOneArray['Health']['sample_time1'] = '7:00 - 7:30';}
					if($this->data['Health']['sample_time1'] == 2) {$someOneArray['Health']['sample_time1'] = '7:30 - 8:00';}
					if($this->data['Health']['sample_time1'] == 3) {$someOneArray['Health']['sample_time1'] = '8:00 - 8:30';}
					if($this->data['Health']['sample_time1'] == 4) {$someOneArray['Health']['sample_time1'] = '8:30 - 9:00';}
					if($this->data['Health']['sample_time1'] == 5) {$someOneArray['Health']['sample_time1'] = '9:00 - 9:30';}
					if($this->data['Health']['sample_time1'] == 6) {$someOneArray['Health']['sample_time1'] = '9:30 - 10:00';}
					if($this->data['Health']['sample_time1'] == 7) {$someOneArray['Health']['sample_time1'] = '10:00 - 10:30';}
					if($this->data['Health']['sample_time1'] == 8) {$someOneArray['Health']['sample_time1'] = '10:30 - 11:00';}
					if($this->data['Health']['sample_time1'] == 9) {$someOneArray['Health']['sample_time1'] = '11:00 - 11:30';}
					if($this->data['Health']['sample_time1'] == 10) {$someOneArray['Health']['sample_time1'] = '11:30 - 12:00';}
					if($this->data['Health']['sample_time1'] == 11) {$someOneArray['Health']['sample_time1'] = '12:00 - 12:30';}
					if($this->data['Health']['sample_time1'] == 12) {$someOneArray['Health']['sample_time1'] = '12:30 - 13:00';}
					if($this->data['Health']['sample_time1'] == 13) {$someOneArray['Health']['sample_time1'] = '13:00 - 13:30';}
					if($this->data['Health']['sample_time1'] == 14) {$someOneArray['Health']['sample_time1'] = '13:30 - 14:00';}
					if($this->data['Health']['sample_time1'] == 15) {$someOneArray['Health']['sample_time1'] = '14:00 - 14:30';}
					if($this->data['Health']['sample_time1'] == 16) {$someOneArray['Health']['sample_time1'] = '14:30 - 15:00';}
					if($this->data['Health']['sample_time1'] == 17) {$someOneArray['Health']['sample_time1'] = '15:00 - 15:30';}
					if($this->data['Health']['sample_time1'] == 18) {$someOneArray['Health']['sample_time1'] = '15:30 - 16:00';}
					if($this->data['Health']['sample_time1'] == 19) {$someOneArray['Health']['sample_time1'] = '16:00 - 16:30';}
					if($this->data['Health']['sample_time1'] == 20) {$someOneArray['Health']['sample_time1'] = '16:30 - 17:00';}
					if($this->data['Health']['sample_time1'] == 21) {$someOneArray['Health']['sample_time1'] = '17:00 - 17:30';}
					if($this->data['Health']['sample_time1'] == 22) {$someOneArray['Health']['sample_time1'] = '17:30 - 18:00';}
					if($this->data['Health']['sample_time1'] == 23) {$someOneArray['Health']['sample_time1'] = '18:00 - 18:30';}
					
					if($this->data['Health']['sample_time1'] == 24) {$someOneArray['Health']['sample_time1'] = '18:30 - 17:00';}
					if(!empty($this->data['Health']['same_address1']) && empty($this->data['Health']['same_address2']))
					{
						$someOneArray['Health']['address'] = $this->data['Health']['same_address1'];
					}
					if(!empty($this->data['Health']['same_address1']) && !empty($this->data['Health']['same_address2']))
					{
						$someOneArray['Health']['address'] = $this->data['Health']['same_address1'].'*'.$this->data['Health']['same_address2'];
					}
					if(!empty($this->data['Health']['same_locality']))
					{
						$someOneArray['Health']['locality'] = $this->data['Health']['same_locality'];
					}
					if(!empty($this->data['Health']['same_city']))
					{
						$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$this->data['Health']['same_city'])));
						$someOneArray['Health']['city_id'] = $city_name['City']['name'];
					}
					if(!empty($this->data['Health']['same_state']))
					{
						$state_name = $this->State->find('first',array('conditions'=>array('State.id'=>$this->data['Health']['same_state'])));
						$someOneArray['Health']['state'] = $state_name['State']['name'];
					}
					if(!empty($this->data['Health']['same_pincode']))
					{
						$someOneArray['Health']['pincode'] = $this->data['Health']['same_pincode'];
					}
					if(!empty($this->data['Health']['same_landmark']))
					{
						$someOneArray['Health']['landmark'] = $this->data['Health']['same_landmark'];
					}
					if(empty($this->data['Health']['same_address1']) && empty($this->data['Health']['same_address2']))
					{
						if(!empty($this->data['Health']['address1']) && empty($this->data['Health']['address2']))
						{
							$someOneArray['Health']['address'] = $this->data['Health']['address1'];
						}
						if(!empty($this->data['Health']['address1']) && !empty($this->data['Health']['address2']))
						{
							$someOneArray['Health']['address'] = $this->data['Health']['address1'].'*'.$this->data['Health']['address2'];
						}
					}
					if(empty($this->data['Health']['same_locality']))
					{
						$someOneArray['Health']['locality'] = $this->data['Health']['locality'];
					}
					if(empty($this->data['Health']['same_city']))
					{
						$city_name2 = $this->City->find('first',array('conditions'=>array('City.id'=>$this->data['Health']['city_id'])));
						$someOneArray['Health']['city_id'] = $city_name2['City']['name'];
					}
					if(empty($this->data['Health']['same_state']))
					{
						$state_name2 = $this->State->find('first',array('conditions'=>array('State.id'=>$this->data['Health']['state'])));
						$someOneArray['Health']['state'] = $state_name2['State']['name'];
					}
					if(empty($this->data['Health']['same_pincode']))
					{
						$someOneArray['Health']['pincode'] = $this->data['Health']['pincode'];
					}
					if(empty($this->data['Health']['same_landmark']))
					{
						$someOneArray['Health']['landmark'] = $this->data['Health']['landmark'];
					}
					$someOneArray['Health']['age'] = $this->data['Health']['age'];
					$someOneArray['Health']['email'] = $this->data['Health']['email'];
					$someOneArray['Health']['landline'] = $this->data['Health']['landline'];
					$someOneArray['Health']['remark'] = $this->data['Health']['remark'];
					$someOneArray['Health']['city'] = $this->data['Health']['city'];
					$someOneArray['Health']['sample_date'] = $this->data['Health']['sample_date'];
					$someOneArray['Health']['sample_date1'] = $this->data['Health']['sample_date1'];
					//echo "<pre>"; print_r($this->data); exit;
					$this->set('mailContent' , $someOneArray );
					$this->Email->template = 'home_collection2';
					$this->Email->from = $this->data['Health']['email'];
					$this->Email->fromName = strtoupper($this->data['Health']['name']);
					$this->Email->subject = 'Booking Request Test ';
					if($this->data['Health']['city'] != '')
					{
						$get_email_info = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$this->data['Health']['city'])));
						$this->Email->to = $get_email_info['Lab']['pcc_email'];
					}
					//if($this->data['Health']['city'] == 'Indirapuram')
					//{
					//$this->Email->to = 'indirapuramlab@niramayahealthcare.com,bookatest@niramayahealthcare.com,itcombinetesting@gmail.com';
					//$this->Email->to = 'nisha.kathait@gmail.com';
					//}
					if($this->data['Health']['city'] == '')
					{
						$this->Email->to = 'homecollection@niramayahealthcare.com,bookatest@niramayahealthcare.com,itcombinetesting@gmail.com';
						//$this->Email->to = 'tripathi.ashish2007@gmail.com';
					}
					//if($this->data['Health']['city'] == 'Noida')
					//{
					//$this->Email->to = 'sector31noida@niramayahealthcare.com,bookatest@niramayahealthcare.com,itcombinetesting@gmail.com';
					//$this->Email->to = 'surbhi.tandon07@gmail.com';
					//}
					//Send as 'html', 'text' or 'both' (default is 'text')
					$this->Email->sendAs = 'html'; // because we like to send pretty mail
					$this->Email->delivery = 'mail';
					/*					if($this->Email->send())
					{*/
			
					//$update_user = $this->User->query("UPDATE users SET alternate_email='".$this->data['Health']['alternate_email']."',alternate_contact='".$this->data['Health']['alternate_contact']."' WHERE id='".$this->data['Health']['user_id']."'");
					$update_user_id = $this->Health->query("UPDATE healths SET user_id='".$this->data['Health']['user_id']."' WHERE id='".$last_insert_id."'");
					if(!empty($this->data['Health']['address1']) && empty($this->data['Health']['address2']))
					{
						$billing_add = $this->data['Health']['address1'];
					}
					if(!empty($this->data['Health']['address1']) && !empty($this->data['Health']['address2']))
					{
						$billing_add = $this->data['Health']['address1'].'*'.$this->data['Health']['address2'];
					}
					/*$find_desc = $this->Billing->find('first',array('order'=>array('Billing.order_id DESC')));
					if(empty($find_desc))
					{
						$this->data['Billing']['order_id'] = 1000;
					}
					if(!empty($find_desc))
					{
						$this->data['Billing']['order_id'] = ($find_desc['Billing']['order_id']+1);
					}*/
					$get_user_detail = $this->User->find('first',array('conditions'=>array('User.id'=>$this->data['Health']['user_id'])));
					$this->data['Billing']['order_id'] = $last_insert_id * 2;
					$this->data['Billing']['request_id'] = $last_insert_id;
					$this->data['Billing']['user_id'] = $this->data['Health']['user_id'];
					$this->data['Billing']['test_id'] = $this->data['Health']['test_id'];
					$this->data['Billing']['profile_id'] = $this->data['Health']['profile_id'];
					$this->data['Billing']['offer_id'] = $this->data['Health']['offer_id'];
					$this->data['Billing']['package_id'] = $this->data['Health']['package_id'];
					$this->data['Billing']['service_id'] = $this->data['Health']['service_id'];
					$this->data['Billing']['first_name'] = $get_user_detail['User']['name'];
					$this->data['Billing']['contact'] = $get_user_detail['User']['contact'];
					$this->data['Billing']['address'] = $get_user_detail['User']['address'];
					$this->data['Billing']['locality'] = $get_user_detail['User']['locality'];
					$this->data['Billing']['city'] = $get_user_detail['User']['city'];
					$this->data['Billing']['state'] = $get_user_detail['User']['state'];
					$this->data['Billing']['zip'] = $get_user_detail['User']['pincode'];
					$this->data['Billing']['landmark'] = $get_user_detail['User']['landmark'];
					$this->data['Billing']['book_date'] = date('Y-m-d H:i:s');
					$this->data['Billing']['sub_total'] = $this->data['Health']['total_amount'];
					
					if($this->Billing->create($this->data))
					{
						//Configure::write('debug', 2);
						//echo "<pre>"; print_r($this->Billing->save($this->data,false)); exit;
						if($this->Billing->save($this->data,false))
						{
							$get_request_detail_book = $this->Health->find('first',array('conditions'=>array('Health.id'=>$last_insert_id)));
							if(!empty($get_request_detail_book['Health']['email']))
							{
								//Email to user for Request Number Starts
								$this->set('user_Name',strtoupper($get_request_detail_book['Health']['name']));
								$this->set('request_Number',$this->data['Billing']['order_id']);
								$this->Email->to = $get_request_detail_book['Health']['email'];
								$this->Email->subject = 'Request Number for Booked Request';
								$this->Email->from = 'info@niramayahealthcare.com';
								$this->Email->template = 'request_number';
								$this->Email->sendAs = 'both';
								$this->Email->send();
								//Email to user for Request Number Ends
							}
							if($this->data['Health']['requ_type'] == 'visit_lab')
							{
								//echo "asas<pre>"; print_r($get_request_detail_book);
								
							if($get_request_detail_book['Health']['sample_time'] == 25) {$get_collection_time_info = '6:00 - 6:30';}
							if($get_request_detail_book['Health']['sample_time'] == 26) {$get_collection_time_info = '6:30 - 7:00';}
												
							if($get_request_detail_book['Health']['sample_time'] == 1) {$get_collection_time_info = '7:00 - 7:30';}
							if($get_request_detail_book['Health']['sample_time'] == 2) {$get_collection_time_info = '7:30 - 8:00';}
							if($get_request_detail_book['Health']['sample_time'] == 3) {$get_collection_time_info = '8:00 - 8:30';}
							if($get_request_detail_book['Health']['sample_time'] == 4) {$get_collection_time_info = '8:30 - 9:00';}
							if($get_request_detail_book['Health']['sample_time'] == 5) {$get_collection_time_info = '9:00 - 9:30';}
							if($get_request_detail_book['Health']['sample_time'] == 6) {$get_collection_time_info = '9:30 - 10:00';}
						   if($get_request_detail_book['Health']['sample_time'] == 7) {$get_collection_time_info = '10:00 - 10:30';}
							if($get_request_detail_book['Health']['sample_time'] == 8) {$get_collection_time_info = '10:30 - 11:00';}
							if($get_request_detail_book['Health']['sample_time'] == 9) {$get_collection_time_info = '11:00 - 11:30';}
							if($get_request_detail_book['Health']['sample_time'] == 10) {$get_collection_time_info = '11:30 - 12:00';}
							if($get_request_detail_book['Health']['sample_time'] == 11) {$get_collection_time_info = '12:00 - 12:30';}
							if($get_request_detail_book['Health']['sample_time'] == 12) {$get_collection_time_info = '12:30 - 13:00';}
							if($get_request_detail_book['Health']['sample_time'] == 13) {$get_collection_time_info = '13:00 - 13:30';}
						if($get_request_detail_book['Health']['sample_time'] == 14) {$get_collection_time_info = '13:30 - 14:00';}
						if($get_request_detail_book['Health']['sample_time'] == 15) {$get_collection_time_info = '14:00 - 14:30';}
							if($get_request_detail_book['Health']['sample_time'] == 16) {$get_collection_time_info = '14:30 - 15:00';}
							if($get_request_detail_book['Health']['sample_time'] == 17) {$get_collection_time_info = '15:00 - 15:30';}
							if($get_request_detail_book['Health']['sample_time'] == 18) {$get_collection_time_info = '15:30 - 16:00';}
							if($get_request_detail_book['Health']['sample_time'] == 19) {$get_collection_time_info = '16:00 - 16:30';}
							if($get_request_detail_book['Health']['sample_time'] == 20) {$get_collection_time_info = '16:30 - 17:00';}
							if($get_request_detail_book['Health']['sample_time'] == 21) {$get_collection_time_info = '17:00 - 17:30';}
							if($get_request_detail_book['Health']['sample_time'] == 22) {$get_collection_time_info = '17:30 - 18:00';}
							if($get_request_detail_book['Health']['sample_time'] == 23) {$get_collection_time_info = '18:00 - 18:30';}
							
							if($get_request_detail_book['Health']['sample_time'] == 24) {$get_collection_time_info = '18:30 - 17:00';}
								
								
								
								$number = $this->data['Health']['landline'];
								$get_info_city = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$this->data['Health']['city'])));
								$message = 'Test Req. No:'.$this->data['Billing']['order_id'].' Thank you for booking your tests & opting for visiting our'.$get_info_city['Lab']['pcc_name'].' Centre '.$get_info_city['Lab']['pcc_address'].' on '.$get_request_detail_book['Health']['sample_date'].' '.$get_collection_time_info.' after applicable discounts. For assistance: call NirAmaya Pathlabs +91-9555009009 or visit www.NHcare.in';
								//echo $message; exit;
							}
							if($this->data['Health']['requ_type'] == 'home_collection')
							{
							
							if($get_request_detail_book['Health']['sample_time1'] == 25) {$get_collection_time_info1 = '6:00 - 6:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 26) {$get_collection_time_info1 = '6:00 - 7:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 1) {$get_collection_time_info1 = '7:00 - 7:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 2) {$get_collection_time_info1 = '7:30 - 8:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 3) {$get_collection_time_info1 = '8:00 - 8:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 4) {$get_collection_time_info1 = '8:30 - 9:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 5) {$get_collection_time_info1 = '9:00 - 9:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 6) {$get_collection_time_info1 = '9:30 - 10:00';}
						   if($get_request_detail_book['Health']['sample_time1'] == 7) {$get_collection_time_info1 = '10:00 - 10:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 8) {$get_collection_time_info1 = '10:30 - 11:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 9) {$get_collection_time_info1 = '11:00 - 11:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 10) {$get_collection_time_info1 = '11:30 - 12:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 11) {$get_collection_time_info1 = '12:00 - 12:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 12) {$get_collection_time_info1 = '12:30 - 13:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 13) {$get_collection_time_info1 = '13:00 - 13:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 14) {$get_collection_time_info1 = '13:30 - 14:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 15) {$get_collection_time_info1 = '14:00 - 14:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 16) {$get_collection_time_info1 = '14:30 - 15:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 17) {$get_collection_time_info1 = '15:00 - 15:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 18) {$get_collection_time_info1 = '15:30 - 16:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 19) {$get_collection_time_info1 = '16:00 - 16:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 20) {$get_collection_time_info1 = '16:30 - 17:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 21) {$get_collection_time_info1 = '17:00 - 17:30';}
							if($get_request_detail_book['Health']['sample_time1'] == 22) {$get_collection_time_info1 = '17:30 - 18:00';}
							if($get_request_detail_book['Health']['sample_time1'] == 23) {$get_collection_time_info1 = '18:00 - 18:30';}
							
							if($get_request_detail_book['Health']['sample_time1'] == 24) {$get_collection_time_info1 = '18:30 - 17:00';}
								$number = $this->data['Health']['landline'];
								/*$message = 'Test Req. No:'.$this->data['Billing']['order_id'].' Thank you for booking your tests with nirAmaya Pathlabs on '.$get_request_detail_book['Health']['sample_date1'].' '.$get_collection_time_info1.' after applicable discounts. For assistance: call +91-9555009009 or visit www.NHcare.in';*/
								$this->Lab = ClassRegistry::init('Lab');
	
								$lab_book = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$get_request_detail_book['Health']['created_by'])));
								
								$message = 'Test Req. No:'.$this->data['Billing']['order_id'].' Thank you for booking your tests with nirAmaya Pathlabs on '.$get_request_detail_book['Health']['sample_date1'].' '.$get_collection_time_info1.' Booked By '.$lab_book['Lab']['pcc_name'].'. Call 9555009009 or visit www.nhcare.in for assistance.';
									
							}
							//$this->User = ClassRegistry::init('User');
							//$userNumber = $this->User('first',array('conditions'=>array('User.id'=>$get_request_detail_book['Health']['user_id'])));							
							//$number = $userNumber['User']['contact'];
							if($this->Utility->check_sms_enable_for_pcc($this->data['Health']['created_by'],$this->data['Health']['assigned_lab']) == 1)
							{
								$this->__sms_message($number,$message);
							}
							
							//$update_healths = $this->Health->query("UPDATE healths SET visit_pat_city='".$get_user_detail['User']['city']."' WHERE id='".$last_insert_id."'");
							$this->DocumentTypeMaster = ClassRegistry::init("DocumentTypeMaster");
							$this->UserDocument = ClassRegistry::init("UserDocument");
							
							foreach($this->data['DocumentTypeMaster'] as $key=>$val)
							{
								$this->UserDocument->create();
								$doc_type = $this->DocumentTypeMaster->find('first',array('conditions'=>array('DocumentTypeMaster.name'=>str_replace("_"," ",$key))));	
								
								$this->data['UserDocument']['user_id'] = $userDetail['User']['id'];
								$this->data['UserDocument']['request_id'] = $healthid;
								$this->data['UserDocument']['document_id'] = $doc_type['DocumentTypeMaster']['id'];
								$this->data['UserDocument']['documant_type'] = $doc_type['DocumentTypeMaster']['doc_type'];
								if($doc_type['DocumentTypeMaster']['doc_type']=='doc')
								{
									$hfile = $this->File->uploadFile($this->data['DocumentTypeMaster'][$key], PATIENT_DOC_STORE_PATH, true,array('doc','docx','xls','xlsx','pdf','PDF'));
									$this->data['UserDocument']['value'] = urlencode(SITE_URL."files/patient_doc/".$hfile['name']);
								}
								else
									$this->data['UserDocument']['value'] = $val;
								$this->UserDocument->save($this->data);
							}							
							// To get page url to track activity
				            $this->_activity_log($this->data['Health']['user_id'], $last_insert_id, $action = "New Request");
				            $getOrderId = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$last_insert_id)));
				            $referenceId = $this->data['Health']['reference'];
							$mrn = $this->data['Health']['medical_reference_number'];
							if(empty($mrn))
								$mrn = $getOrderId['Billing']['user_id'];
							if(empty($referenceId))
								$referenceId = $getOrderId['Billing']['user_id']."-".strtotime("now");
							$update_user_id = $this->Health->query("UPDATE healths SET reference='".$referenceId."',medical_reference_number='".$mrn."' WHERE id='".$last_insert_id."'");
							
							$this->Session->setFlash('Thank You for Your time, Your request has been saved successfully','flash_success');
							if($this->data['Health']['login_type'] == 'Super')
							{
								$this->redirect(array('controller'=>'samples','action'=>'view_detail',base64_encode($last_insert_id)));
							}
							if($this->data['Health']['login_type'] == 'Agent')
							{
								$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',base64_encode($last_insert_id)));
							}
							if($this->data['Health']['login_type'] == 'BM')
							{
								$this->redirect(array('controller'=>'samples','action'=>'view_detail',base64_encode($last_insert_id)));
							}
							if($this->data['Health']['login_type'] == 'PCC')
							{
								$this->redirect(array('controller'=>'samples','action'=>'view_patient_details',base64_encode($last_insert_id)));
							}
						}
					}
						
					//}
				}
			}
		}
		$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$state = $this->State->find('all',array('conditions'=>array('State.status'=>1)));
		$offers = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1),'order'=>array('Banner.banner_name ASC')));
		$tests = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'TEST'),'order'=>array('Test.test_parameter ASC')));
		$profiles = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE'),'order'=>array('Test.test_parameter ASC')));
		$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1),'order'=>array('Timelab.sequence ASC')));
		//$users = $this->User->find('all',array('conditions'=>array('User.status'=>1)));
		$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		//$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1,'Lab.show_to_world'=>1),'order'=>array('Lab.sequence'=>'asc')));
		$this->set('pcc_list',$pcc_list);
		$this->set('offers',$offers);
		//$this->set('users',$users);
		$this->set('timelabs',$timelabs);
		$this->set('city',$city);
		$this->set('state',$state);
		$this->set('tests',$tests);
		$this->set('profiles',$profiles);
		$this->RelationMaster = ClassRegistry::init('RelationMaster');
		$relation_list = $this->RelationMaster->find('list',array('fields'=>array('prefix','name')));
		$this->set('relation',$relation_list);
	}
	
	function admin_view_detail($reqId = NULL,$entry=NULL)
	{
        $test_name="";
        $profile_name="";
        $offer_name="";
        $package_name="";
        $service_name="";
        $edit_test_name="";
        $edit_profile_name="";
        $edit_offer_name="";
        $edit_package_name="";
        $edit_services_name="";
        $discount_id="";
		$dd = $this->Session->read('Admin.id');
		
		$h_array = array(14,11,12,5,8,7,6,9);
		
		$this->set('title_for_layout', 'View Sample Request');
		$req_id = base64_decode($reqId);
		
		if(!empty($this->data))
		{
			$get_req_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
            if(($this->data['Health']['sample_date'] != $get_req_detail['Health']['sample_date']) || ($this->data['Health']['sample_date1'] != $get_req_detail['Health']['sample_date1']) || ($this->data['Health']['sample_time'] != $get_req_detail['Health']['sample_time']) || ($this->data['Health']['sample_time1'] != $get_req_detail['Health']['sample_time1']))
            {
                $this->Health->updateAll(array('Health.old_date'=>"'".$get_req_detail['Health']['s_date']."'",'Health.agent_id'=>0),array('Health.id'=>$this->data['Health']['id']));
            }
			$implode = $get_req_detail['Health']['test_id'];
			$this->data['Health']['test_id'] = $implode;
			$implode_profile = $get_req_detail['Health']['profile_id'];
			$this->data['Health']['profile_id'] = $implode_profile;
			$implode_offer = $get_req_detail['Health']['offer_id'];
			$this->data['Health']['offer_id'] = $implode_offer;
			$implode_package = $get_req_detail['Health']['package_id'];
			$this->data['Health']['package_id'] = $implode_package;
			$implode_service = $get_req_detail['Health']['service_id'];
			$this->data['Health']['service_id'] = $implode_service;
			$this->data['Health']['total_amount'] = $get_req_detail['Health']['total_amount'];
			
			$explode_age = explode(' ',$this->data['Health']['age']);
			$this->data['Health']['age'] = $explode_age[0];
			$this->data['Health']['email'] = $this->data['Health']['email'];
			$this->data['Health']['netbilling'] = $get_req_detail['Health']['netbilling'];;
			if(!empty($this->data['Health']['address_home1']) && !empty($this->data['Health']['home_city']) && !empty($this->data['Health']['home_state']) && !empty($this->data['Health']['home_pincode']))
			{
				if(!empty($this->data['Health']['address_home1']) && empty($this->data['Health']['address_home2']))
				{
					$this->data['Health']['address'] = $this->data['Health']['address_home1'];
				}
				if(!empty($this->data['Health']['address_home1']) && !empty($this->data['Health']['address_home2']))
				{
					$this->data['Health']['address'] = $this->data['Health']['address_home1'].'*'.$this->data['Health']['address_home2'];
				}
				$this->data['Health']['locality'] = $this->data['Health']['home_locality'];
				$this->data['Health']['city_id'] = $this->data['Health']['home_city'];
				$this->data['Health']['state'] = $this->data['Health']['home_state'];
				$this->data['Health']['pincode'] = $this->data['Health']['home_pincode'];
				if(!empty($this->data['Health']['home_landmark']))
					$this->data['Health']['landmark'] = $this->data['Health']['home_landmark'];
				else
					$this->data['Health']['landmark'] = '0';
			}
			else
			{
				$this->data['Health']['address'] = '';
				$this->data['Health']['locality'] = '';
				$this->data['Health']['city_id'] = 0;
				$this->data['Health']['state'] = 0;
				$this->data['Health']['pincode'] = '';
				$this->data['Health']['landmark'] = '';
			}
			//For Editing Discount 03-10-13 Starts
			if(!empty($this->data['Health']['discount_code']))
			{
				$find_discount_code = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
				//CODE EDITED BY ASHISH 28-07-14 STARTS
				$get_amount_all = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$find_discount_code['Health']['id'])));
				$v = 0;
				foreach($get_amount_all as $amtallk => $amtallv)
				{
					$v = ($amtallv['RequestTest']['mrp']+$v);
				}
				$this->data['Health']['total_amount'] = $v;
				//CODE EDITED BY ASHISH 28-07-14 ENDS
				if($find_discount_code['Health']['discount_code'] != $this->data['Health']['discount_code'])
				{
					$get_disc = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$this->data['Health']['discount_code'])));
					if($get_disc['Discount']['type'] == 'Percent')
					{
						$v_1 = ($get_disc['Discount']['amount']/100);
						$v_2 = ($v_1*$this->data['Health']['total_amount']);
						$v_3 = ($this->data['Health']['total_amount']-$v_2);
						$find_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
						if($find_amt['Health']['received_amount'] == 0)
						{
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($find_amt['Health']['received_amount'] != 0)
						{
							$bal_amt = ($v_3-$find_amt['Health']['received_amount']);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."',balance_amount='".$bal_amt."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						}
						$this->data['Health']['total_amount'] = $v_3;
						$this->data['Health']['discount_id'] = $get_disc['Discount']['id'];
					}
					if($get_disc['Discount']['type'] == 'Rupees')
					{
						$v_3 = ($this->data['Health']['total_amount']-$get_disc['Discount']['amount']);
						$find_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
						if($find_amt['Health']['received_amount'] == 0)
						{
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($find_amt['Health']['received_amount'] != 0)
						{
							$bal_amt = ($v_3-$find_amt['Health']['received_amount']);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."',balance_amount='".$bal_amt."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						}
						$this->data['Health']['total_amount'] = $v_3;
						$this->data['Health']['discount_id'] = $get_disc['Discount']['id'];
					}
				}
			}
			//For Editing Discount 03-10-13 Ends
			if($this->data['Health']['discount_amount']!="")
			{
				$find_tot_amt_disc = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
				$get_amount_all = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$find_tot_amt_disc['Health']['id'])));
				$v = 0;
				foreach($get_amount_all as $amtallk => $amtallv)
				{
					$v = ($amtallv['RequestTest']['mrp']+$v);
				}
				$this->data['Health']['total_amount'] = $v;
				if(isset($this->data['Health']['discount_amount']) && $this->data['Health']['discount_amount']!="") // != $find_tot_amt_disc['Health']['discount_amount'])
				{
					if($find_tot_amt_disc['Health']['received_amount'] == 0)
					{ 
						$new_tot_amt_disc = ($this->data['Health']['total_amount'] - $this->data['Health']['discount_amount']);
						$this->data['Health']['total_amount'] = $new_tot_amt_disc;
						$update_tot_amt_disc = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt_disc."',balance_amount='".$new_tot_amt_disc."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						$update_billing = $this->Billing->query("UPDATE billings SET sub_total='".$new_tot_amt_disc."' WHERE request_id='".$this->data['Health']['id']."'");
                                                
					}
					else
					{
						$new_tot_amt_disc = ($this->data['Health']['total_amount'] - $this->data['Health']['discount_amount']);
						$new_bal_amount = ($new_tot_amt_disc - $find_tot_amt_disc['Health']['received_amount']);
						$this->data['Health']['total_amount'] = $new_tot_amt_disc;
						$this->data['Health']['balance_amount'] = $new_bal_amount;
						$update_tot_amt_disc = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt_disc."',balance_amount='".$new_bal_amount."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						$update_billing = $this->Billing->query("UPDATE billings SET sub_total='".$new_tot_amt_disc."' WHERE request_id='".$this->data['Health']['id']."'");
					}
				}
                                
			}
			//echo "<pre>"; print_r($this->data); exit;
			if($this->data['Health']['old_home_report'] == 0)
			{
				if($this->data['Health']['home_report'] == 1)
				{
					$find_tot_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					$new_tot_amt = ($find_tot_amt['Health']['total_amount']+50);
					$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
				}
			}
			if($this->data['Health']['old_home_report'] == 1)
			{
				if($this->data['Health']['home_report'] == 0)
				{
					$find_tot_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					$paytracks = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$this->data['Health']['id'])));
					if(!empty($paytracks))
					{
						$paytrack_amt = 0;
						foreach($paytracks as $key => $val)
						{
							$paytrack_amt = ($val['Paytrack']['pay_install']+$paytrack_amt);
							$paytrack_amt = $paytrack_amt;
						}
						if($paytrack_amt > $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',balance_refund='".$new_refund_amt."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($paytrack_amt == $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',balance_refund='".$new_refund_amt."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($paytrack_amt < $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
						}
					}
					else
					{
						$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
						//$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
						$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
					}
				}
				else
				{
					$this->data['Health']['total_amount'] = ($this->data['Health']['total_amount']+50);
				}
			}
            if(!empty($this->data['Health']['sample_date1']) && $_REQUEST['opt'] == 2)
			{
				$this->data['Health']['s_date'] = date('Y-m-d',strtotime($this->data['Health']['sample_date1']));
                $this->data['Health']['sample_date'] = "";
                $this->data['Health']['sample_time']="";
                $prevDate = strtotime($get_req_detail['Health']['sample_date1']);
				$currentDate = strtotime($this->data['Health']['sample_date1']);
				
				$prevTime = $get_req_detail['Health']['sample_time1'];
				$currentTime = $this->data['Health']['sample_time1'];
				
				if($get_req_detail['Health']['requ_status']=='0' || $get_req_detail['Health']['requ_status']=='4'||$get_req_detail['Health']['requ_status']=='15'||$get_req_detail['Health']['requ_status']=='2'||$get_req_detail['Health']['requ_status']=='1'||$get_req_detail['Health']['requ_status']=='3'||$get_req_detail['Health']['requ_status']=='13'||$get_req_detail['Health']['requ_status']=='19' || $get_req_detail['Health']['requ_status']=='20'||$get_req_detail['Health']['requ_status']=='16'||$get_req_detail['Health']['requ_status']=='21'||$get_req_detail['Health']['requ_status']=='10')
				{
					if($prevDate!=$currentDate || $prevTime!=$currentTime){
						$this->_activity_log($get_req_detail['Health']['user_id'], $this->data['Health']['id'], $action = "Order Rescheduled from ".$get_req_detail['Health']['s_date']." to ".$this->data['Health']['s_date']."");
						
						if(!in_array($get_req_detail['Health']['requ_status'],$h_array))
						{
							if($this->data['Health']['reschedule']==1)
							{	$this->Health->query("UPDATE healths SET requ_status='13' WHERE id='".$get_req_detail['Health']['id']."'");
							//	echo "reschedule";
							}
							if($this->data['Health']['reschedule']==2)
							{
								$this->Health->query("UPDATE healths SET requ_status='3' WHERE id='".$get_req_detail['Health']['id']."'");
							//	echo "follow up";
							}
							
							if($this->Utility->check_push_notification_for_pcc($get_req_detail['Health']['created_by'],$get_req_detail['Health']['assigned_lab']) == 1)
							{
								$response = $this->Utility->send_notification($get_req_detail['Health']['id']);
							}
						}	
					//	die;
		            }
	            }
			}
			
			if(!empty($this->data['Health']['sample_date']) && $_REQUEST['opt'] == 1)
			{
				$this->data['Health']['s_date'] = date('Y-m-d',strtotime($this->data['Health']['sample_date']));
                                $this->data['Health']['sample_date1']="";
                                $this->data['Health']['sample_time1']="";
			}
			
			$get_db_edit_request_detaill = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
			if(!in_array($get_req_detail['Health']['requ_status'],$h_array))
			{
				$get_update_status = $this->Health->query("UPDATE healths SET requ_status='".$get_db_edit_request_detaill['Health']['requ_status']."' WHERE id='".$this->data['Health']['id']."'");
				
				if($this->Utility->check_push_notification_for_pcc($get_db_edit_request_detaill['Health']['created_by'],$get_db_edit_request_detaill['Health']['assigned_lab']) == 1)
				{
					$response = $this->Utility->send_notification($get_db_edit_request_detaill['Health']['id']);
				}
			}
			
			if($get_db_edit_request_detaill['Health']['balance_amount']==$get_db_edit_request_detaill['Health']['total_amount'])
			{
				$this->data['Health']['amount_collected']="";
                $this->data['Health']['amount_to_be_collected']=$get_db_edit_request_detaill['Health']['balance_amount'];
				$this->data['Health']['payment_type']="3";
			}
			
			if($get_db_edit_request_detaill['Health']['balance_amount'] < $get_db_edit_request_detaill['Health']['total_amount'] && $get_db_edit_request_detaill['Health']['balance_amount'] > 0)
			{
				$this->data['Health']['amount_collected']=$get_db_edit_request_detaill['Health']['received_amount'];
                $this->data['Health']['amount_to_be_collected']=$get_db_edit_request_detaill['Health']['balance_amount'];
				$this->data['Health']['payment_type']="2";
			}
			
			if($get_db_edit_request_detaill['Health']['balance_amount']==0)
			{
				$this->data['Health']['amount_collected']=$get_db_edit_request_detaill['Health']['received_amount'];
                $this->data['Health']['amount_to_be_collected']=0;
				$this->data['Health']['payment_type']="1";
			}
			
			$this->data['Health']['sample_collected_date']=$this->data['Health']['sample_collected_date']." ".$this->data['Health']['sample_collected_time'];

			if($this->Health->create($this->data))
			{
				if($this->Health->save($this->data,false))
				{
					$get_db_edit_request_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					if(!empty($get_db_edit_request_detail['Health']['test_id']))
					{
						$explode_db_save_test = explode(',',$get_db_edit_request_detail['Health']['test_id']);
						foreach($explode_db_save_test as $k_db_edit_test => $v_db_edit_test)
						{
							$get_db_save_test = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'TE','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_test)));
							if(empty($get_db_save_test))
							{
								$get_current_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_test)));
								$this->data['RequestTest']['type'] = 'TE';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_test;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_test['Test']['mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['profile_id']))
					{
						$explode_db_save_profile = explode(',',$get_db_edit_request_detail['Health']['profile_id']);
						foreach($explode_db_save_profile as $k_db_edit_profile => $v_db_edit_profile)
						{
							$get_db_save_profile = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'PR','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_profile)));
							if(empty($get_db_save_profile))
							{
								$get_current_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_profile)));
								$this->data['RequestTest']['type'] = 'PR';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_profile;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_profile['Test']['mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['offer_id']))
					{
						$explode_db_save_offer = explode(',',$get_db_edit_request_detail['Health']['offer_id']);
						foreach($explode_db_save_offer as $k_db_edit_offer => $v_db_edit_offer)
						{
							$get_db_save_offer = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'OF','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_offer)));
							if(empty($get_db_save_offer))
							{
								$get_current_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v_db_edit_offer)));
								$this->data['RequestTest']['type'] = 'OF';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_offer;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_offer['Banner']['banner_mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['package_id']))
					{
						$explode_db_save_package = explode(',',$get_db_edit_request_detail['Health']['package_id']);
						foreach($explode_db_save_package as $k_db_edit_package => $v_db_edit_package)
						{
							$get_db_save_package = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'PA','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_package)));
							if(empty($get_db_save_package))
							{
								$get_current_mrp_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v_db_edit_package)));
								$this->data['RequestTest']['type'] = 'PA';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_package;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_package['Package']['package_mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['service_id']))
					{
						$explode_db_save_service = explode(',',$get_db_edit_request_detail['Health']['service_id']);
						foreach($explode_db_save_service as $k_db_edit_service => $v_db_edit_service)
						{
							$get_db_save_service = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'SR','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_service)));
							if(empty($get_db_save_service))
							{
								$get_current_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_service)));
								$this->data['RequestTest']['type'] = 'SR';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_service;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_service['Test']['mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					
					$this->User->query("UPDATE users SET email='".$this->data['Health']['email']."',alternate_email='".$this->data['User']['alternate_email']."',alternate_contact='".$this->data['User']['alternate_contact']."' WHERE id='".$get_db_edit_request_detail['Health']['user_id']."'");
					
					if(!in_array($get_req_detail['Health']['requ_status'],$h_array))
					{
						$get_update_status = $this->Health->query("UPDATE healths SET requ_status='".$get_db_edit_request_detail['Health']['requ_status']."' WHERE id='".$get_db_edit_request_detail['Health']['id']."'");
						
						if($this->Utility->check_push_notification_for_pcc($get_db_edit_request_detail['Health']['created_by'],$get_db_edit_request_detail['Health']['assigned_lab']) == 1)
						{
							$response = $this->Utility->send_notification($get_db_edit_request_detail['Health']['id']);
						}
					}
					// To get page url to track activity
					if(!empty($get_db_edit_request_detail['Health']['user_id']))
					{
						
						// To get page url to track activity
						$this->_activity_log($get_db_edit_request_detail['Health']['user_id'], $this->data['Health']['id'], $action = "Edit Request");
						
					}
					$this->Session->setFlash('Sample request updated successfully.','flash_success');
					$this->redirect(array('controller'=>'samples','action'=>'view_detail',$reqId));
				}
			}
		}
		else
		{
			$testcount = 0;
			$servicecount = 0;
			$sample_id = array(); 
			if(!empty($req_id))
			{
				$request_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
				if(!empty($request_details))
				{
					/*partial report test reporting status*/
					//Configure::write('debug',2);
					$partial_indi_test_reporting_status = $this->Utility->get_test_completed_status($request_details['Health']['id']);
					$this->set('partial_indi_test_reporting_status',$partial_indi_test_reporting_status);
					
					/*booked by and service by edit option in request edit by admin*/
		//					if($this->Session->read('Admin.userType') == 'A')
		//					{
						$pcc_list = $this->Lab->find('list',array('conditions'=>array('Lab.status'=>1),'fields'=>array('Lab.id','Lab.pcc_name')));
						$this->set('pcc_list',$pcc_list);
		//					}
					$bp_net = $this->Utility->getBPNet($request_details['Health']['id']); $this->set('bp_net',$bp_net);
					$init_tot_amt = 0;
					$get_total_test_amt = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'])));
					foreach($get_total_test_amt as $tot_amt_key => $tot_amt_val)
					{
						$init_tot_amt = ($tot_amt_val['RequestTest']['mrp']+$init_tot_amt);
					}
					$request_det['Health']['total_test_amt'] = $init_tot_amt;
					$request_det['Health']['mrn_no'] = $request_details['Health']['medical_reference_number'];
					$request_det['Health']['is_urgent'] = $request_details['Health']['is_urgent'];
					//Code Edited By Ashish Starts
					if($request_details['Health']['requ_status'] == 8)
					{
						$request_det['Health']['cancel_reason'] = $request_details['Health']['cancelled_reason'];
					}
					//Code Edited By Ashish Ends
					$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request_details['Health']['id'])));
					$request_det['Health']['order_num'] = $find_order_num['Billing']['order_id'];
					if($request_details['Health']['gender'] == 1)
					{
						$gender = 'Male';
					}
					if($request_details['Health']['gender'] == 2)
					{
						$gender = 'Female';
					}
					if($request_details['Health']['discount_amount'] != 0)
					{
						$request_det['Health']['discount_amount'] = $request_details['Health']['discount_amount'];
						$request_det['Health']['discount_amount_reason'] = $request_details['Health']['discount_amount_reason'];
						//01-04014 Starts
						$discount_final_amount_1_2 = $request_details['Health']['discount_amount'];
						//01-04014 Ends
					}
					//01-04014 Starts
					else
					{
						$discount_final_amount_1_2 = 0;
					}
					//01-04014 Ends
					if(!empty($entry) && $entry == 'ref_dup')
					{
						$request_det['Health']['dup_entry'] = 'Yes';
					}
					//Patient Vital Information Fetch Value Starts
					$get_vital_detail  = $this->UserBmiBp->find('first',array('conditions'=>array('UserBmiBp.request_id'=>$request_details['Health']['id'])));
					$request_det['Health']['vital_save_id'] = $get_vital_detail['UserBmiBp']['id'];
					$request_det['Health']['weight'] = $get_vital_detail['UserBmiBp']['weight'];
					$request_det['Health']['height_opt'] = $get_vital_detail['UserBmiBp']['height_opt'];
					$request_det['Health']['height_feet'] = $get_vital_detail['UserBmiBp']['height_feet'];
					$request_det['Health']['height_inch'] = $get_vital_detail['UserBmiBp']['height_inch'];
					$request_det['Health']['height_cm'] = $get_vital_detail['UserBmiBp']['height_cm'];
					$request_det['Health']['bmi_value'] = $get_vital_detail['UserBmiBp']['bmi_value'];
					$request_det['Health']['bp_systolic'] = $get_vital_detail['UserBmiBp']['bp_systolic'];
					$request_det['Health']['bp_diastolic'] = $get_vital_detail['UserBmiBp']['bp_diastolic'];
					$request_det['Health']['bp_pulse'] = $get_vital_detail['UserBmiBp']['bp_pulse'];
					$request_det['Health']['bmi_indicator'] = $get_vital_detail['UserBmiBp']['bmi_indicator'];
					//Patient Vital Information Fetch Value Ends
					$request_det['Health']['message_status'] = $request_details['Health']['message_status'];
					$request_det['Health']['lab_message'] = $request_details['Health']['lab_message'];
					$request_det['Health']['ref_num'] = $request_details['Health']['ref_num'];
					$request_det['Health']['adj_reason'] = $request_details['Health']['adj_reason'];
					$request_det['Health']['report_type'] = $request_details['Health']['report_type'];
					$request_det['Health']['report_reason'] = $request_details['Health']['partial_reason'];
					$request_det['Health']['published'] = $request_details['Health']['published'];
					$request_det['Health']['published_reason'] = $request_details['Health']['published_reason'];
					$request_det['Health']['requ_status'] = $request_details['Health']['requ_status'];
					//edit sanjeet
					$request_det['Health']['netbilling'] = $request_details['Health']['netbilling'];
					$request_det['Health']['last_edited_date'] = $request_details['Health']['last_edited_date'];
					$get_vital_detail1  = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$request_details['Health']['last_edited'])));
					$request_det['Health']['last_edited'] = $get_vital_detail1['Admin']['name'];
					//end by sanjeet
					if($request_details['Health']['home_report'] != 0)
					{
						$request_det['Health']['home_report'] = $request_details['Health']['home_report'];
						$request_det['Health']['home_info'] = 'Rs.50 included of sending report at home.';
					}
					//For Edit details
					$package_name = "";
					$test_name="";
					$counter_seq=1;
					
					if(!empty($request_details['Health']['test_id']))
					{
						
						$explode_test = explode(',',$request_details['Health']['test_id']);
						$count_test = count($explode_test);
						$test_1 = $this->Test->find('all',array('conditions'=>array('Test.id'=>$explode_test)));
						$test_1_ids=array();
						foreach($test_1 as $key=>$value)
						{
							$testcount++;
							$test_1_ids[]=$value['Test']['id'];
							array_push($sample_id,$value['Test']['sample']);
						}
						$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$test_1_ids,'RequestTest.type'=>'TE','RequestTest.status'=>1)));
						$save_db_test_mrp_1_ids=array();
						foreach($save_db_test_mrp_1 as $key=>$value)
						{
							$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
						}
						
						
						foreach($test_1 as $key=>$value)
						{
							$test_name = $test_name.'<strong>'.$counter_seq.'-</strong> '.$value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Test']['id']].'<br>';
							$counter_seq++;
                        }
					}
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						
						$profile_1 = $this->Test->find('all',array('conditions'=>array('Test.id'=>$explode_profile)));
						$profile_1_ids=array();
						foreach($profile_1 as $key=>$value)
						{
							$testcount++;
							$profile_1_ids[]=$value['Test']['id'];
							array_push($sample_id,$value['Test']['sample']);
						}
						$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$profile_1_ids,'RequestTest.type'=>'PR','RequestTest.status'=>1)));
						
						$save_db_test_mrp_1_ids=array();
						foreach($save_db_test_mrp_1 as $key=>$value)
						{
							$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
						}
						//print_R($save_db_test_mrp_1_ids);die;
						//$counter_seq=1;
						foreach($profile_1 as $key=>$value)
						{
							$test_name = $test_name.'<strong>'.$counter_seq.'-</strong> '.$value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Test']['id']].'<br>';
							$counter_seq++;
                        }
					
					}
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						
						$banner_1 = $this->Banner->find('all',array('conditions'=>array('Banner.id'=>$explode_offers)));
						$banner_1_ids=array();
						foreach($banner_1 as $key=>$value)
						{
							$testcount++;
							$banner_1_ids[]=$value['Banner']['id'];
						}
						$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$banner_1_ids,'RequestTest.type'=>'TE','RequestTest.status'=>1)));
						$save_db_test_mrp_1_ids=array();
						foreach($save_db_test_mrp_1 as $key=>$value)
						{
							$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
						}
						
						//$counter_seq=1;
						foreach($banner_1 as $key=>$value)
						{
							$test_name = $test_name.'<strong>'.$counter_seq.'-</strong> '.$value['Banner']['banner_code'].' - '.$value['Banner']['banner_code'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Banner']['id']].'<br>';
							$counter_seq++;
                        }
					}
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						$package_1 = $this->Package->find('all',array('conditions'=>array('Package.id'=>$explode_packages)));
						$package_1_ids=array();
						foreach($package_1 as $key=>$value)
						{
							$testcount++;
							$package_1_ids[]=$value['Package']['id'];
						}
						$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$package_1_ids,'RequestTest.type'=>'PA','RequestTest.status'=>1)));
						$save_db_test_mrp_1_ids=array();
						foreach($save_db_test_mrp_1 as $key=>$value)
						{
							$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
						}
						
						//$counter_seq=1;
						foreach($package_1 as $key=>$value)
						{
							$package_name = $package_name.'<strong>'.$counter_seq.'-</strong> '.$value['Package']['package_code'].' - '.$value['Package']['package_name'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Package']['id']].'<br>';
							$counter_seq++;
                        }
					}
					if(!empty($request_details['Health']['service_id']))
					{
						$explode_service = explode(',',$request_details['Health']['service_id']);
						$count_service = count($explode_service);
						$service_1 = $this->Test->find('all',array('conditions'=>array('Test.id'=>$explode_service)));
						$service_1_ids=array();
						foreach($service_1 as $key=>$value)
						{
							$testcount++;
							$servicecount++;
							$service_1_ids[]=$value['Test']['id'];
							array_push($sample_id,$value['Test']['sample']);
						}
						$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$service_1_ids,'RequestTest.type'=>'SR','RequestTest.status'=>1)));
						$save_db_test_mrp_1_ids=array();
						foreach($save_db_test_mrp_1 as $key=>$value)
						{
							$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
						}
						//$counter_seq=1;
						foreach($service_1 as $key=>$value)
						{
							$package_name = $package_name.'<strong>'.$counter_seq.'-</strong> '.$value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Test']['id']].'<br>';
							$counter_seq++;
                        }
					}

					$sample_type = $this->Samplemaster->query("select shortname from sample_type_master where sample_id in (".implode(',',$sample_id).")");			
					$this->set('sample_type',$sample_type);

										//For Edit Details
					if(!empty($request_details['Health']['test_id']))
					{
						$explode_test = explode(',',$request_details['Health']['test_id']);
						
						$count_test = count($explode_test);
                                                $edit_test_name="";
                                                $counter_seq=1;
                                                foreach($test_1 as $key=>$value)
                                                {
                                                    $edit_test_name = $edit_test_name.$counter_seq.'- '.$value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Test']['id']].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$value['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a><br/>';
                                                    $counter_seq++;
                                                }
					}
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						if($count_profile == 1)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 2)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 3)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 4)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 5)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 6)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 7)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 8)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 9)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 10)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_10['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						if($count_offers == 1)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 2)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 3)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 4)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 5)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 6)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 7)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 8)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[7],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_8['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						if($count_packages == 1)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 2)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 3)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 4)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$edit_save_package_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 5)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[4],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$edit_save_package_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$package_5['Package']['package_name'].' - Rs.'.$edit_save_package_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_5['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					if(!empty($request_details['Health']['service_id']))
					{
						$explode_services = explode(',',$request_details['Health']['service_id']);
						$count_services = count($explode_services);
						if($count_services == 1)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 2)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 3)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 4)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 5)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 6)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 7)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 8)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 9)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$services_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[8])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[8],'RequestTest.type'=>'SR')));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$services_9['Test']['testcode'].' - '.$services_9['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 10)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$services_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[8])));
							$services_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[9])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[8],'RequestTest.type'=>'SR')));
							$edit_save_services_db_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[9],'RequestTest.type'=>'SR')));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$services_9['Test']['testcode'].' - '.$services_9['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$services_10['Test']['testcode'].' - '.$services_10['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_10['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					
					//For Edit details
					if(!empty($request_details['Health']['test_id']))
					{
						$expl_test = explode(',',$request_details['Health']['test_id']);
						$amt_test = 0;
						foreach($expl_test as $key => $val)
						{
							$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
							$amt_test = $amt_test;
						}
						$request_det['Health']['indi_test_amt'] = $amt_test;
					}
					if(empty($request_details['Health']['test_id']))
					{
						$amt_test = 0;
						$request_det['Health']['indi_test_amt'] = $amt_test;
					}
					if(!empty($request_details['Health']['profile_id']))
					{
						$expl_profile = explode(',',$request_details['Health']['profile_id']);
						$amt_profile = 0;
						foreach($expl_profile as $key => $val)
						{
							$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
							$amt_profile = $amt_profile;
						}
						$request_det['Health']['indi_profile_amt'] = $amt_profile;
					}
					if(empty($request_details['Health']['profile_id']))
					{
						$amt_profile = 0;
						$request_det['Health']['indi_profile_amt'] = $amt_profile;
					}
					if(!empty($request_details['Health']['offer_id']))
					{
						$expl_offer= explode(',',$request_details['Health']['offer_id']);
						$amt_offer = 0;
						foreach($expl_offer as $key => $val)
						{
							$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
							$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
							$amt_offer = $amt_offer;
						}
						$request_det['Health']['indi_offer_amt'] = $amt_offer;
					}
					if(empty($request_details['Health']['offer_id']))
					{
						$amt_offer = 0;
						$request_det['Health']['indi_offer_amt'] = $amt_offer;
					}
					if(!empty($request_details['Health']['package_id']))
					{
						$expl_package= explode(',',$request_details['Health']['package_id']);
						$amt_package = 0;
						foreach($expl_package as $key => $val)
						{
							$find_mrp_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
							$amt_package = ($find_mrp_package['Package']['package_mrp']+$amt_package);
							$amt_package = $amt_package;
						}
						$request_det['Health']['indi_package_amt'] = $amt_package;
					}
					if(empty($request_details['Health']['package_id']))
					{
						$amt_package = 0;
						$request_det['Health']['indi_package_amt'] = $amt_package;
					}
					if(!empty($request_details['Health']['service_id']))
					{
						$expl_service = explode(',',$request_details['Health']['service_id']);
						$amt_service = 0;
						foreach($expl_service as $key => $val)
						{
							$find_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_service = ($find_mrp_service['Test']['mrp']+$amt_service);
							$amt_service = $amt_service;
						}
						$request_det['Health']['indi_service_amt'] = $amt_service;
					}
					if(empty($request_details['Health']['service_id']))
					{
						$amt_service = 0;
						$request_det['Health']['indi_service_amt'] = $amt_service;
					}
					
					if($servicecount > 0) // $servicecount == $testcount
					{
						$this->set("service_count",1);
					}
					else
					{
						$this->set("service_count",0);
					}
					//die;
					$request_det['Health']['id'] = $request_details['Health']['id'];
                                        $request_det['Health']['created_by'] = $request_details['Health']['created_by'];
                                        $request_det['Health']['assigned_lab'] = $request_details['Health']['assigned_lab'];
					$request_det['Health']['patient_name'] = strtoupper($request_details['Health']['name']);
					$request_det['Health']['reference'] = $request_details['Health']['reference'];
					$request_det['Health']['gender'] = $gender;
					$request_det['Health']['age'] = $request_details['Health']['age'].' Years';
					$request_det['Health']['balance_refund'] = $request_details['Health']['balance_refund'];
					$request_det['Health']['refund_status'] = $request_details['Health']['refund_status'];
					if($request_details['Health']['refund_status'] == 1)
					{
						$find_refund_person = $this->Paytrack->find('first',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Refund')));
						$explode_date_refund = explode(' ',$find_refund_person['Paytrack']['receive_date']);
						$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$find_refund_person['Paytrack']['admin_id'])));
						$request_det['Health']['refund_admin_name'] = 'Rs. '.$request_details['Health']['balance_refund'].' has been refunded by '.$admin_name['Admin']['name'].' on '.date('d-m-Y',strtotime($explode_date_refund[0]));
					}
                                        //finding online payment details
                                        $this->OnlineOrder=ClassRegistry::init('OnlineOrder');
                                        $online_payment_details=$this->OnlineOrder->find('first',array('order'=>array('OnlineOrder.id'=>'DESC'),'conditions'=>array('OnlineOrder.request_id'=>$request_details['Health']['id'],'OnlineOrder.flag'=>'Y')));
                                        $this->set('online_payment_details',$online_payment_details);
					$find_receive_amounts = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Receive')));
					$c = 0;
					foreach($find_receive_amounts as $key => $val)
					{
						$admin_per_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$val['Paytrack']['admin_id'])));
						$find_receive_amounts[$c]['Paytrack']['admin_receive_name'] = $admin_per_name['Admin']['name'];
						$explode_rec_date = explode(' ',$val['Paytrack']['receive_date']);
						$find_receive_amounts[$c]['Paytrack']['admin_receive_date'] = $explode_rec_date[0];
						$c++;
					}
			//					print_R($find_receive_amounts);die;
					$request_det['Health']['receive_tracks'] = $find_receive_amounts;
					if($request_details['Health']['discount_id'] != 0)
					{
						$discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$request_details['Health']['discount_id'])));
						$request_det['Health']['discount_code'] = $discount['Discount']['discount_code'];
						$request_det['Health']['discount_info'] = $discount['Discount']['discount_description'];
						$request_det['Health']['discount_id'] = $request_details['Health']['discount_id'];
						if($discount['Discount']['type'] == 'Percent')
						{
							$request_det['Health']['discount_amt'] = $discount['Discount']['amount'].'%';
							//01-04014 Starts
							$discount_final_amount_1 = ($discount['Discount']['amount']/100);
							$discount_final_amount_1_1 = ($discount_final_amount_1*$init_tot_amt);
							//01-04014 Ends
						}
						if($discount['Discount']['type'] == 'Rupees')
						{
							$request_det['Health']['discount_amt'] = 'Rs. '.$discount['Discount']['amount'];
							//01-04014 Starts
							$discount_final_amount_1_1 = $discount['Discount']['amount'];
							//01-04014 Ends
						}
					}
					//01-04014 Starts
					else
					{
						$discount_final_amount_1_1 = 0;
					}
					//01-04014 Ends
					//01-04014 Starts
					$request_det['Health']['discount_amount_after_add'] = ($discount_final_amount_1_1+$discount_final_amount_1_2);
					$find_total_received = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'])));
                                        $rec_ins_amt = 0;
                                        $btc_pay_mode="";
					if(!empty($find_total_received))
					{
						$rec_ins_amt = 0;
						foreach($find_total_received as $rec_key => $rec_val)
						{
							if($rec_val['Paytrack']['pay_mode'] == 'btc')
							{
								$btc_pay_mode = 'Yes';
							}
							else
							{
								$btc_pay_mode = 'No';
							}
							if($rec_val['Paytrack']['pay_mode'] == 'adjust')
							$rec_ins_amt = $rec_ins_amt-$rec_val['Paytrack']['pay_install'];
							else
							$rec_ins_amt = $rec_ins_amt+$rec_val['Paytrack']['pay_install'];;
						}
						$request_det['Health']['rec_ins_amt'] = $rec_ins_amt;
					}
					else
					{
						$request_det['Health']['rec_ins_amt'] = 0;
					}
					if($rec_ins_amt > 0)
					{
						$request_det['Health']['sent_to_lab_action'] = 'Yes';
					}
					if($btc_pay_mode == 'Yes')
					{
						$request_det['Health']['sent_to_lab_action'] = 'Yes';
					}
					//01-04014 Ends
					$request_det['Health']['test_names'] = $test_name;
					$request_det['Health']['profile_names'] = $profile_name;
					$request_det['Health']['offer_names'] = $offer_name;
					$request_det['Health']['package_names'] = $package_name;
					$request_det['Health']['service_names'] = $service_name;
					$request_det['Health']['edit_test_name'] = $edit_test_name;
					$request_det['Health']['edit_profile_name'] = $edit_profile_name;
					$request_det['Health']['edit_offer_name'] = $edit_offer_name;
					$request_det['Health']['edit_package_name'] = $edit_package_name;
					$request_det['Health']['edit_service_name'] = $edit_services_name;
					$request_det['Health']['test_sel_ids'] = str_replace(',','*',$request_details['Health']['test_id']);
					$request_det['Health']['profile_sel_ids'] = str_replace(',','*',$request_details['Health']['profile_id']);
					$request_det['Health']['offer_sel_ids'] = str_replace(',','*',$request_details['Health']['offer_id']);
					$request_det['Health']['package_sel_ids'] = str_replace(',','*',$request_details['Health']['package_id']);
					$request_det['Health']['service_sel_ids'] = str_replace(',','*',$request_details['Health']['service_id']);
					$request_det['Health']['UserID'] = $request_details['Health']['user_id'];
		
					$find_user_contact_email = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
						
					$request_det['Health']['email'] = $find_user_contact_email['User']['email'];
					
					$request_det['Health']['alternate_email'] = $find_user_contact_email['User']['alternate_email'];
					$request_det['Health']['test_amt'] = $request_details['Health']['total_amount'];
					$request_det['Health']['remarks'] = $request_details['Health']['remarks'];
					$request_det['Health']['receive_amt'] = $request_details['Health']['received_amount'];
					if($request_details['Health']['received_amount'] == 0)
					{
						if($request_details['Health']['payment_type']==3)
							$request_det['Health']['balance_amt'] = $request_details['Health']['balance_amount'];
						else
							$request_det['Health']['balance_amt'] = $request_details['Health']['total_amount'];
					}
					if($request_details['Health']['received_amount'] != 0)
					{
						$request_det['Health']['balance_amt'] = $request_details['Health']['balance_amount'];
					}
					$visit_lab_1 = $request_details['Health']['city'];
					$visit_lab_2 = $request_details['Health']['sample_time'];
					$visit_lab_3 = $request_details['Health']['sample_date'];
					$home_collection_1 = $request_details['Health']['sample_time1'];
					$home_collection_2 = $request_details['Health']['sample_date1'];
					$home_collection_3 = $request_details['Health']['address'];
					$this->Timelab = ClassRegistry::init('Timelab');
					$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
					if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
					{
						$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
						$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
						$visit_time = $timelabs[$visit_lab_2];
						$request_det['Health']['visit_lab_collect_time'] = $visit_time;
						$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
					}
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
					{
						$collect_time = $timelabs[$home_collection_1];
					
						$request_det['Health']['home_collect_time'] = $collect_time;
						$request_det['Health']['home_collect_date'] = $home_collection_2;
						$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
						$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
						$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
						$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
						$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
						$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
						$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
						$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
						$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
						$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
					}
					if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
					{
						$visit_time = $timelabs[$visit_lab_2];
							
						$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
						$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
						$request_det['Health']['visit_lab_collect_time'] = $visit_time;
						$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
					}
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
					{
						$collect_time = $timelabs[$home_collection_1];
						$request_det['Health']['home_collect_time'] = $collect_time;
						$request_det['Health']['home_collect_date'] = $home_collection_2;
						$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
						$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
						$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
						$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
						$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
						$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
						$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
						$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
						$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
						$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
					}
					$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
					$request_det['Health']['contact'] = $contact['User']['contact'];
					
					$request_det['Health']['alternate_contact'] = $contact['User']['alternate_contact'];
					$request_det['Health']['remark'] = $request_details['Health']['remark'];
					$request_det['Health']['pay_status'] = $request_details['Health']['pay_status'];
					$request_det['Health']['patient_report'] = $request_details['Health']['patient_report'];
					$request_det['Health']['register_sample'] = $request_details['Health']['register_sample'];
					$request_det['Health']['sent_pathcorp_admin'] = $request_details['Health']['sent_pathcorp_admin'];
					$find_admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$request_details['Health']['sent_pathcorp_admin'])));
					$request_det['Health']['sent_pathcorp_admin_name'] = $find_admin_name['Admin']['name'];
					$vial_info = $this->Vial->find('first',array('conditions'=>array('Vial.request_id'=>$req_id)));
					$request_det['Health']['vial_id'] = $vial_info['Vial']['id'];
					$request_det['Health']['vial_created'] = $vial_info['Vial']['created'];
					$request_det['Health']['col1'] = $vial_info['Vial']['col1'];
					$request_det['Health']['col2'] = $vial_info['Vial']['col2'];
					$request_det['Health']['col3'] = $vial_info['Vial']['col3'];
					$request_det['Health']['col4'] = $vial_info['Vial']['col4'];
					$request_det['Health']['col5'] = $vial_info['Vial']['col5'];
					$request_det['Health']['col6'] = $vial_info['Vial']['col6'];
					$request_det['Health']['col7'] = $vial_info['Vial']['col7'];
					$request_det['Health']['remark1'] = $vial_info['Vial']['remark1'];
					$request_det['Health']['remark2'] = $vial_info['Vial']['remark2'];
					$request_det['Health']['remark3'] = $vial_info['Vial']['remark3'];
					$request_det['Health']['remark4'] = $vial_info['Vial']['remark4'];
					$request_det['Health']['remark5'] = $vial_info['Vial']['remark5'];
					$request_det['Health']['remark6'] = $vial_info['Vial']['remark6'];
					$request_det['Health']['remark7'] = $vial_info['Vial']['remark7'];
					$request_det['Health']['sent_pathcorp_date'] = date('d-m-Y',strtotime($vial_info['Vial']['created']));
					$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
					$this->set('timelabs',$timelabs);
					$request_det['Health']['cancelled_status'] = $request_details['Health']['cancelled_status'];
					$request_det['Health']['cancelled_reason'] = $request_details['Health']['cancelled_reason'];
					$request_det['Health']['reschduled'] = $request_details['Health']['reschduled'];
					$request_det['Health']['city_idd'] = $request_details['Health']['city_id'];
					$request_det['Health']['btc_no_payment_bill_to_company'] = $request_details['Health']['btc_no_payment_bill_to_company'];
					if(isset($request_det['Health']['discount_id']) && $request_det['Health']['discount_id'] == 12)
					{
						$request_det['Health']['test_amt'] = 0;
					}
					if(!empty($request_details['Health']['sample_collected_date']))
					{
						$dateTime = explode(" ",$request_details['Health']['sample_collected_date']);
						$request_det['Health']['sample_collected_date'] = $dateTime[0];
						$request_det['Health']['sample_collected_time'] = $dateTime[1];
					}
					else
					{
						$newTime = split('-',$collect_time);
						$request_det['Health']['sample_collected_date'] = $home_collection_2;
						$request_det['Health']['sample_collected_time'] = $newTime[1];
					}
					if(!empty($request_details['Health']['processing_lab']))
					{
						$request_det['Health']['processing_lab'] = $request_details['Health']['processing_lab'];
					}
					else
					{
						$request_det['Health']['processing_lab'] = 0;
					}
					
					$request_det['Health']['landline'] = $request_details['Health']['landline'];
					$request_det['Health']['specimen_date'] = $request_details['Health']['specimen_date'];
					$request_det['Health']['specimen_time'] = $request_details['Health']['specimen_time'];
					$request_det['Health']['specimen_by'] = $request_details['Health']['specimen_by'];
					$request_det['Health']['specimen_remarks'] = $request_details['Health']['specimen_remarks'];
					$request_det['Health']['prescription_url'] = $request_details['Health']['prescription_url'];
					$request_det['Health']['payment_type'] = $request_details['Health']['payment_type'];
					$request_det['Health']['amount_collected'] = $request_details['Health']['amount_collected'];
					$request_det['Health']['amount_to_be_collected'] = $request_details['Health']['amount_to_be_collected'];
					//$request_det['Health']['sample_collected_date'] = $request_details['Health']['sample_collected_date'];
					$this->data = $request_det;
					$this->PaymentType = ClassRegistry::init('PaymentType');
					$payment_type = $this->PaymentType->find('list',array('fields'=>array('PaymentType.id','PaymentType.type')));//
					$this->set('payment_type',$payment_type);
					//print_R($payment_type);die;
                    // To track all details of patient correspond to patient id
					//$activityLog = $this->ActivityLog->find('all', array('contain' => array('Admin'),'conditions' => array('ActivityLog.admin_id'=>$this->Session->read('Admin.id'),'ActivityLog.patient_id'=>$request_details['Health']['user_id']), 'order'=>array('ActivityLog.created'=>'DESC')));
					
					$this->paginate = array('ActivityLog' => array('limit' =>'10','contain' => array('Admin'),'conditions' => array('ActivityLog.patient_id'=>$request_details['Health']['user_id'],'ActivityLog.health_id'=>$request_details['Health']['id']), 'order'=>array('ActivityLog.created'=>'DESC')));
					$activityLog = $this->paginate('ActivityLog');
					
					$this->paginate = array('JsonData' => array('limit' =>'10','conditions' => array('JsonData.health_id'=>$request_details['Health']['id']), 'order'=>array('JsonData.date'=>'DESC')));
					$jsonlog = $this->paginate('JsonData');
					
					$this->set('jsonlog',$jsonlog);
					$this->set('activityLog',$activityLog);
					$this->set('rowcount',count($activityLog));
					if(!empty($this->params['named']['page']) && $this->params['named']['page'] != '')
					{
						$this->set('showActivity',1);
					}
					
				}
				else
				{
					$this->Session->setFlash('Invalid Request','flash_failure');
					$this->redirect(array('controller'=>'samples','action'=>'index'));
					
					
				}
			}
		}

		$this->UserDocument = ClassRegistry::init('UserDocument');
		$this->DocumentTypeMaster = ClassRegistry::init('DocumentTypeMaster');

		$user_document = $this->UserDocument->find('all',array('conditions'=>array('UserDocument.request_id'=>$this->data['Health']['id'])));
		$doc_list = array();
		if(!empty($user_document))
		{
			foreach($user_document as $val)
			{
				$documents = $this->DocumentTypeMaster->find('first',array('conditions'=>array('DocumentTypeMaster.id'=>$val['UserDocument']['document_id'])));
				
				$doc_list[$val['UserDocument']['document_id']] = array('name'=>$documents['DocumentTypeMaster']['name'],'value'=>$val['UserDocument']['value'],'type'=>$val['UserDocument']['document_type']);
			}
			$this->set('doc_list',$doc_list);
		}
		
		$healthSample = $this->Healthsample->find('all',array('conditions'=>array('Healthsample.health_id'=>$this->data['Health']['id'])));
		$newsample = array();
		foreach($healthSample as $val)
		{
			$newsample[$val['Healthsample']['sample_id']] = $val['Healthsample'];
		}
		//print_R($newsample);die;
		$or_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		$this->Pincodemaster = ClassRegistry::init("PincodeMaster");
		$pincodeMaster = $this->Pincodemaster->find('all',array('conditions'=>array('PincodeMaster.pincode'=>$or_details['Health']['pincode'])));
		$localityArray = array();
		foreach($pincodeMaster as $val)
		{
			array_push($localityArray,$val['PincodeMaster']['locality']);
		}
		$this->set('locality',$localityArray);
		
		$tests = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'TEST')));
		$profiles = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE')));
		$offers = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1)));
		$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
		$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city);
		$state = $this->State->find('all',array('conditions'=>array('State.status'=>1)));
		$this->set('timelabs',$timelabs);
		
		$this->LabMessageMaster = ClassRegistry::init('LabMessageMaster');
		$lab_mm = $this->LabMessageMaster->find('all',array('conditions'=>array('LabMessageMaster.request_id'=>$this->data['Health']['id']),'order'=>array('LabMessageMaster.id'=>'DESC')));
		$this->set('lab_mm',$lab_mm);
		//print_R($lab_mm);die;
		$this->ProcessingLabs = ClassRegistry::init("ProcessingLabs");
		$plab = $this->ProcessingLabs->find('list',array('conditions'=>array('ProcessingLabs.status'=>1),'fields'=>array('id','name')));
		
		//print_R($plab);die;
		
		$this->set('p_lab',$plab);
		
		$this->Ticket = ClassRegistry::init('Ticket');
		$ticket = $this->Ticket->find('all',array('conditions'=>array('Ticket.request_id'=>$this->data['Health']['id']),'order'=>array('Ticket.id'=>'DESC')));
		$this->set('ticket',$ticket);
		
		$priority = array("1"=>"Low","2"=>"Moderate","3"=>"High","4"=>"Critical");
		$category = array("2"=>"Report Related","3"=>"TAT Related","4"=>"Payment Related","5"=>"Special Request","6"=>"Sample Collected Related");
		$this->set('priority',$priority);
		$this->set('category',$category);
		$status = array("1"=>"New Ticket","2"=>"In Process","3"=>"Resolved","4"=>"Closed");
		$this->set('status',$status);
		$users = $this->Admin->find('list',array('conditions'=>array('Admin.userType'=>array('A','BM')),'fields'=>array('id','name')));
		$this->set('users',$users);

		$get_all_pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
                $get_all_pcc_list = $this->Lab->find('list',array('conditions'=>array('Lab.status'=>1),'fields'=>array('id','pcc_name')));
		$this->set('get_all_pcc',$get_all_pcc);
                $this->set('get_all_pcc_list',$get_all_pcc_list);
		$this->set('assigned_sample',$newsample);
		$this->set('tests',$tests);
		$this->set('profiles',$profiles);
		$this->set('offers',$offers);
		$this->set('state',$state);
		$sampleColor = array("Sodium Citrate"=>"lightblue",  "SST (Serum) Yellow"=>"yellow" ,  "Sodium Heparin"=>"green",  "EDTA Whole Blood(Purple)"=>"purple",  "Glucose - Fasting/Random"=>"darkgrey" ,  "Glucose - Post Prandial"=>"grey" ,
		  "Swab"=>"lightgrey","Urine"=>"#FFD700",  "Stool"=>"brown",  "Sputum"=>"white");
		$sampleSpecific = array("Sodium Citrate"=>"5",  "SST (Serum) Yellow"=>"34" ,  "Sodium Heparin"=>"21",  "EDTA Whole Blood(Purple)"=>"51",  "Glucose - Fasting/Random"=>"59" ,  "Glucose - Post Prandial "=>"13" ,
		  "Swab"=>"32","Urine"=>"49",  "Stool"=>"56",  "Sputum"=>"43");
		$sampleOthers = array("Pus"=>"31","Semen"=>"33","Synovial Fluid"=>"40","Stone"=>"44","Ascitic Fluid"=>"61","Any Specimen"=>"12","Body Fluids"=>"8","Bone"=>"64","Blood"=>"9","Hair"=>"65","Nail"=>"63","Tissue"=>"47","Smear"=>"54","W. Bld. Heparinized"=>"3","Slides & Blocks"=>"4","Any Specimen/Slides"=>"6","CSF"=>"7","DROP OF BLOOD "=>"10","FLUID "=>"11","NA"=>"16","NAF PLASMA (3HR) "=>"18","NAF PLASMA(0.5HR) "=>"19","NAF PLASMA(1.5HR)"=>"20","NAF PLASMA(2 HR)"=>"22","NAF PLASMA(2.5HR) "=>"23","NAF PLASMA(50GM) "=>"24","Plasma - EDTA"=>"26","OTHERS "=>"29","Culture Specimen"=>"30","SST (Serum) PP"=>"35","SST (Serum) Fasting"=>"36","SLIDES "=>"39","WHOLE BLOOD BACTEC BOTTLE "=>"50","Whole Blood HEPARIN"=>"52","Throat Swab"=>"57","Any specimen/Slides/Blocks"=>"58","URINE 24 HRS"=>"60","Na-Fluride"=>"62");
		$this->set('sample_specific',$sampleSpecific);
		$this->set('sample_color',$sampleColor);
		$this->set('sample_others',$sampleOthers);
		$user_type = $this->Session->read('Admin.userType');
		$this->set('user_type',$user_type);
		if(!empty($entry))
		{
			$this->set('vial_enter',$this->Session->read('vial_info_enter'));
			$this->set('vial_entry',$entry);
		}
		$priority = array("1"=>"Low","2"=>"Moderate","3"=>"High","4"=>"Critical");
		$category = array("2"=>"Report Related","3"=>"TAT Related","4"=>"Payment Related","5"=>"Special Request","6"=>"Sample Collected Related");
		$this->set('priority',$priority);
		$this->set('category',$category);
		//print_R($this->data);die;
	}

	function admin_update_refund()
	{
		$req_id = $_REQUEST['health_id'];
		$ref_stat = $_REQUEST['ref_stat'];
		$refund_status = $_REQUEST['refund_status'];
		$find_exceed_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if($refund_status == 1)
		{
			$this->data['Paytrack']['type'] = 'Refund';
			$this->data['Paytrack']['admin_id'] = $this->Session->read('Admin.id');
			$this->data['Paytrack']['request_id'] = $req_id;
			$this->data['Paytrack']['pay_install'] = $find_exceed_amt['Health']['balance_refund'];
			$this->data['Paytrack']['receive_date']	= date('Y-m-d H:i:s');
			if($this->Paytrack->create($this->data))
			{
				if($this->Paytrack->save($this->data,false))
				{
					$explode_date = explode(' ',$this->data['Paytrack']['receive_date']);
					$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$this->data['Paytrack']['admin_id'])));
					$update_health = $this->Health->updateAll(array('Health.refund_status'=>$refund_status),array('Health.id'=>$req_id));
					echo 'Rs. '.$find_exceed_amt['Health']['balance_refund'].' has been refunded by '.$admin_name['Admin']['name'].' on '.date('d-m-Y',strtotime($explode_date[0]));
					exit;
				}
			}
		}
	}

	function admin_edit_request($reqId=NULL)
	{
		$this->set('title_for_layout', 'Edit Sample Request');
		$request_id = base64_decode($reqId);
		if(!empty($this->data))
		{
			$this->data['Sample']['edit_date'] = date('Y-m-d H:i:s');
			if($this->Sample->create($this->data))
			{
				if($this->Sample->save($this->data,false))
				{
					$this->Session->setFlash('Sample Request updated successfully','flash_success');
					$this->redirect(array('controller'=>'samples','action'=>'index'));
				}
			}
		}
		else
		{
			$request_detail = $this->Sample->find('first',array('conditions'=>array('Sample.id'=>$request_id)));
			$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
			$tests = $this->Test->find('all',array('conditions'=>array('Test.status'=>1)));
			$this->set('city',$city);
			$this->set('tests',$tests);
			$this->data=$request_detail;
		}
	}

	function admin_update_payment()
	{
		$dd = $this->Session->read('Admin.id');
		if(!empty($this->data))
		{ 
			if($this->data['Health']['pay_mode'] == "btcnopayment")
			{
				$this->data['Health']['pay_amt'] = $this->data['Health']['receive_amt'] = $this->data['Health']['bal_amt'];
			}
			$get_request_pay_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
			$tot_amt = $this->data['Health']['total_amt'];
			$rec_amt = $this->data['Health']['receive_amt'];
			$bal_amt = $this->data['Health']['bal_amt'];
			if($this->data['Health']['pcc_amt']==0)
				$pay_amt = $this->data['Health']['pay_amt'];
			else
				$pay_amt = $this->data['Health']['pcc_amt'];
			if($get_request_pay_info['Health']['received_amount'] == 0)
			{
				if(!empty($this->data['Health']['pay_mode']) && $this->data['Health']['pay_mode'] == 'adjust')
				{
					$tot_amt = $get_request_pay_info['Health']['total_amount'];
					$adj_amt = $this->data['Health']['adj_amt'];
					$adj_reason = $this->data['Health']['adj_rsn'];
					$total_amt = ($tot_amt-$adj_amt);
					$final_receive_amt = 0;
					$final_balance_amt = 0;
					$final_refund_amt = 0;
					$pay_status = 1;
				}
				else
				{
					if($pay_amt < $get_request_pay_info['Health']['total_amount'])
					{
						$total_amt = $get_request_pay_info['Health']['total_amount'];
						$final_receive_amt = $pay_amt;
						$final_balance_amt = ($tot_amt - $pay_amt);
						$final_refund_amt = 0;
						$pay_status = 0;
					}
					if($pay_amt > $get_request_pay_info['Health']['total_amount'])
					{
						$total_amt = $get_request_pay_info['Health']['total_amount'];
						$final_receive_amt = $get_request_pay_info['Health']['total_amount'];
						$final_balance_amt = 0;
						$final_refund_amt = ($pay_amt - $get_request_pay_info['Health']['total_amount']);
						$pay_status = 1;
					}
					if($tot_amt == $pay_amt)
					{
						$total_amt = $get_request_pay_info['Health']['total_amount'];
						$final_receive_amt = $pay_amt;
						$final_balance_amt = 0;
						$final_refund_amt = 0;
						$pay_status = 1;
					}
					//01-04014 Starts
					if(!empty($this->data['Health']['pay_mode']) && $this->data['Health']['pay_mode'] == 'btc')
					{
						$btc_reason = $this->data['Health']['adj_rsn'];
						$total_amt = $get_request_pay_info['Health']['total_amount'];
						$final_receive_amt = 0;
						$final_balance_amt =  $get_request_pay_info['Health']['total_amount'];
						$final_refund_amt = 0;
						$pay_status = 1;
					}
					//01-04014 Starts
				}
			}

			if($get_request_pay_info['Health']['received_amount'] != 0)
			{
				if(!empty($this->data['Health']['pay_mode']) && $this->data['Health']['pay_mode'] == 'adjust')
				{
			//print_R($this->data);die;
					$bal_ref_amt = $get_request_pay_info['Health']['balance_refund'];
					$adj_amt = $this->data['Health']['adj_amt'];
					$adj_reason = $this->data['Health']['adj_rsn'];
					$bal_ref_amt = ($bal_ref_amt-$adj_amt);
					$final_receive_amt = $get_request_pay_info['Health']['received_amount'];
					$final_balance_amt = 0;
					$final_refund_amt = $bal_ref_amt;
					$pay_status = 1;
				}
				else
				{
					if($get_request_pay_info['Health']['balance_amount'] > $pay_amt)
					{
						$final_receive_amt = ($get_request_pay_info['Health']['received_amount'] + $pay_amt);
						$final_balance_amt = ($get_request_pay_info['Health']['balance_amount'] - $pay_amt);
						$final_refund_amt = 0;
						$pay_status = 0;
					}
					if($get_request_pay_info['Health']['balance_amount'] < $pay_amt)
					{
						$final_receive_amt = $get_request_pay_info['Health']['total_amount'];
						$final_balance_amt = 0;
						$final_refund_amt = ($pay_amt - $get_request_pay_info['Health']['balance_amount']);
						$pay_status = 1;
					}
					if($get_request_pay_info['Health']['balance_amount'] == $pay_amt)
					{
						$final_receive_amt = ($get_request_pay_info['Health']['received_amount']+$pay_amt);
						$final_balance_amt = 0;
						$final_refund_amt = 0;
						$pay_status = 1;
					}
					//01-04014 Starts
					if(!empty($this->data['Health']['pay_mode']) && $this->data['Health']['pay_mode'] == 'btc')
					{
						$btc_reason = $this->data['Health']['adj_rsn'];
						$total_amt = $get_request_pay_info['Health']['total_amount'];
						$final_receive_amt = 0;
						$final_balance_amt = $get_request_pay_info['Health']['total_amount'];
						$final_refund_amt = 0;
						$pay_status = 1;
					}
					//01-04014 Ends
				}
			}
			$this->data['Paytrack']['type'] = 'Receive';
			$this->data['Paytrack']['admin_id'] = $this->Session->read('Admin.id');
			$this->data['Paytrack']['request_id'] = $this->data['Health']['id'];
			if($this->data['Health']['pay_mode'] == 'paymenttopcc')
			{
				$this->data['Paytrack']['pay_install'] = $pay_amt;
				$this->data['Paytrack']['pay_mode'] = $this->data['Health']['pay_mode'];
				$this->data['Paytrack']['c_number'] = '';
				
				$this->data['Paytrack']['remarks'] = $this->data['Health']['btc_no_payment_remark'];
			}
			
			if($this->data['Health']['pay_mode'] == 'wallet')
			{
				$this->data['Paytrack']['pay_install'] = $pay_amt;
				$this->data['Paytrack']['pay_mode'] = $this->data['Health']['pay_mode'];
				$this->data['Paytrack']['c_number'] = $this->data['Health']['trans_id'];
				
				$this->data['Paytrack']['org_name'] = $this->data['Health']['wallet_name'];
			}
			if($this->data['Health']['pay_mode'] == 'cash')
			{
				$this->data['Paytrack']['pay_install'] = $pay_amt;
				$this->data['Paytrack']['pay_mode'] = $this->data['Health']['pay_mode'];
				$this->data['Paytrack']['c_number'] = '';
			}
			if($this->data['Health']['pay_mode'] == 'credit_card')
			{
				$this->data['Paytrack']['org_name'] = $this->data['Health']['auth_code'];
				
				$this->data['Paytrack']['pay_install'] = $pay_amt;
				$this->data['Paytrack']['pay_mode'] = $this->data['Health']['pay_mode'];
				$this->data['Paytrack']['c_number'] = $this->data['Health']['card_number'];
			}
			if($this->data['Health']['pay_mode'] == 'cheque')
			{
				$this->data['Paytrack']['org_name'] = $this->data['Health']['bank_name'];
				$this->data['Paytrack']['pay_install'] = $pay_amt;
				$this->data['Paytrack']['pay_mode'] = $this->data['Health']['pay_mode'];
				$this->data['Paytrack']['c_number'] = $this->data['Health']['cheque_number'];
			}
			if($this->data['Health']['pay_mode'] == 'adjust')
			{
				$this->data['Paytrack']['pay_mode'] = $this->data['Health']['pay_mode'];
				$this->data['Paytrack']['pay_install'] = $this->data['Health']['adj_amt'];
				$this->data['Paytrack']['c_number'] = '';
			}
			//01-04014 Starts
			if($this->data['Health']['pay_mode'] == 'btc')
			{
				$this->data['Paytrack']['pay_mode'] = $this->data['Health']['pay_mode'];
				$this->data['Paytrack']['pay_install'] = 0;
				$this->data['Paytrack']['c_number'] = '';
			}
			if($this->data['Health']['pay_mode'] == 'btcnopayment')
			{
				$this->data['Paytrack']['pay_mode'] = $this->data['Health']['pay_mode'];
				$this->data['Paytrack']['pay_install'] = $pay_amt;
				$this->data['Paytrack']['c_number'] = '';
			}
			//01-04014 Ends
			$this->data['Paytrack']['receive_date'] = date('Y-m-d H:i:s');
			//echo "<pre>"; print_r($this->data); exit;
			if($this->Paytrack->create($this->data))
			{
				if($this->Paytrack->save($this->data,false))
				{
					//$this->Utility->lis_payment_update($order_val['healths']['id'],"one");
					
					if($this->data['Health']['pay_mode'] == 'adjust')
					{
						$update_amt = $this->Health->query("UPDATE healths SET amount_collected='$final_receive_amt',amount_to_be_collected='$final_balance_amt',received_amount='$final_receive_amt',balance_amount='$final_balance_amt',balance_refund='$final_refund_amt',pay_status='$pay_status',adj_reason='$adj_reason' WHERE id='".$this->data['Health']['id']."'");
						//$update_amt = $this->Health->updateAll(array('Health.received_amount'=>$final_receive_amt,'Health.balance_amount'=>$final_balance_amt,'Health.balance_refund'=>$final_refund_amt,'Health.pay_status'=>$pay_status),array('Health.id'=>));
						$this->Session->setFlash('Payment status updated successfully till full payment received you cannot upload patient report.','flash_success');
					}
					else
					{
						//01-04014 Starts
						if($this->data['Health']['pay_mode'] == 'btc')
						{
							$update_amt = $this->Health->query("UPDATE healths SET amount_collected='$final_receive_amt',amount_to_be_collected='$final_balance_amt',received_amount='$final_receive_amt',balance_amount='$final_balance_amt',balance_refund='$final_refund_amt',pay_status='$pay_status',btc_reason='$adj_reason' ,last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."',payment_type='4' WHERE id='".$this->data['Health']['id']."'");
							$this->Session->setFlash('Payment status updated successfully till full payment received patient cannot download their report.','flash_success');
						}
						elseif($this->data['Health']['pay_mode'] == 'btcnopayment')
						{
							$update_amt = $this->Health->query("UPDATE healths SET amount_collected='$final_receive_amt',amount_to_be_collected='$final_balance_amt',received_amount='$final_receive_amt',balance_amount='$final_balance_amt',btc_no_payment_remark='".$this->data['Health']['btc_no_payment_remark']."'".",pay_status='$pay_status',btc_no_payment_bill_to_company='".$this->data['Health']['btc_no_payment_bill_to_company']."'"." ,last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."',payment_type='4' WHERE id='".$this->data['Health']['id']."'");
							$this->Session->setFlash('Payment status updated successfully till full payment received patient cannot download their report.','flash_success');
						}
						else
						{
							//01-04014 Ends
							/*echo $final_receive_amt."<br>";
							echo $final_balance_amt."<br>";
							echo $final_refund_amt."<br>";
							echo $pay_status."<br>";*/
							//echo $payment_mode."<br>";die;
							$update_amt = $this->Health->query("UPDATE healths SET amount_collected='$final_receive_amt',amount_to_be_collected='$final_balance_amt',received_amount='$final_receive_amt',balance_amount='$final_balance_amt',balance_refund='$final_refund_amt',pay_status='$pay_status' ,last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
							//$update_amt = $this->Health->updateAll(array('Health.received_amount'=>$final_receive_amt,'Health.balance_amount'=>$final_balance_amt,'Health.balance_refund'=>$final_refund_amt,'Health.pay_status'=>$pay_status),array('Health.id'=>));
							$this->Session->setFlash('Payment status updated successfully till full payment received you cannot upload patient report.','flash_success');
						}
					}
					
					// To get page url to track activity
					if(!empty($get_request_pay_info['Health']['user_id']))
					{
						
						// To get page url to track activity
						$this->_activity_log($get_request_pay_info['Health']['user_id'], $this->data['Health']['id'], $action = "Payment Update");
					}
					if($this->data['Health']['action_url'] == 'admin_view_patient_details')
					{
						$this->redirect(array('controller'=>'samples','action'=>'admin_view_patient_details',base64_encode($this->data['Health']['id'])));
					}
					else
					{
						$this->redirect(array('controller'=>'samples','action'=>'view_detail',base64_encode($this->data['Health']['id'])));
					}
				}
			}
			else
			{
				$this->Session->setFlash('Error occured during Payment Status Update.','flash_failure');
				$this->redirect(array('controller'=>'samples','action'=>'view_detail',base64_encode($this->data['Health']['id'])));
			}
		}
	}

	function admin_calculate_balance()
	{
		$get_health_id = $_REQUEST['health_id'];
		$rec_val = $_REQUEST['rec_val'];
		$find_total_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$get_health_id)));
		$bal_amt = ($find_total_amt['Health']['total_amount'] - $rec_val);
		$this->data['Health']['id'] = $get_health_id;
		$this->data['Health']['received_amount'] = $rec_val;
		$this->data['Health']['balance_amount'] = $bal_amt;
		if($this->Health->create($this->data))
		{
			if($this->Health->save($this->data,false))
			{
				echo $bal_amt;
				exit;
			}
		}
	}

	function admin_pay_status_show()
	{
		$request_id = $_REQUEST['id'];
		$find_pay_status = $this->Health->find('first',array('conditions'=>array('Health.id'=>$request_id)));
		echo $find_pay_status['Health']['total_amount'].','.$find_pay_status['Health']['received_amount'].','.$find_pay_status['Health']['balance_amount'].','.base64_encode($request_id).','.$find_pay_status['Health']['balance_refund'];
		exit;
	}

	function admin_test_report()
	{
		$req_info = $this->Health->query('SELECT *  FROM `healths` WHERE `created_by` = 153 and `id` > 160449 ORDER BY `healths`.`book_date` DESC');		
		foreach($req_info as $key=>$val){
			if($val['healths']['report_type'] == 'full')
			{
		/*				print_R($val['healths']['id']);
				echo "<br>";*/
				//$call_health_api = $this->Utility->trigger_callhealth_results_test($val['healths']['id']);
				$call_health_api = $this->Utility->call_health_result($val['healths']['id'],'153');
			}
		}
		die;
	}

	function admin_upload_report()
	{
		$dd = $this->Session->read('Admin.id');
		if(!empty($this->data))
		{
			if($this->data['Health']['report_type'] == 'partial')
			{
		//print_R($this->data);die;
				$req_stat = 7;
				$report_type = $this->data['Health']['report_type'];
				$report_reason = $this->data['Health']['report_reason'];
			}
			if($this->data['Health']['report_type'] == 'full')
			{
				$req_stat = 6;
				$report_type = $this->data['Health']['report_type'];
				$report_reason = '';
			}
			if(!empty($this->data['Health']['patient_report']['name']))
			{
				$hfile = $this->File->uploadFile($this->data['Health']['patient_report'], PATIENT_REPORT_STORE_PATH, true,array('PDF','pdf'));
				//print_R($hfile);die;
				$update_query = $this->Health->query("UPDATE healths SET patient_report='".$hfile['name']."',requ_status='".$req_stat."',report_type='".$report_type."',partial_reason='".$report_reason."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['id']."'");
				$this->Session->setFlash('Patient report uploaded successfully.','flash_success');
				$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
				if($this->Utility->check_push_notification_for_pcc($req_info['Health']['created_by'],$req_info['Health']['assigned_lab']) == 1)
				{
					$response = $this->Utility->send_notification($req_info['Health']['id']);
				}
				$lab_info = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['assigned_lab'])));
				$number = $req_info['Health']['landline'];
				if($req_info['Health']['gender'] == 1)
				{
					$title = 'Mr.';
				}
				if($req_info['Health']['gender'] == 2)
				{
					$title = 'Ms.';
				}
				$get_req_number = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$req_info['Health']['id'])));
				//$message = 'Dear '.$title.' '.$req_info['Health']['name'].' your test report for Test Req. No: ('.$get_req_number['Billing']['order_id'].') has been published. Kindly view your report at www.niramayahealthcare.com (User Name: Reg. Ph. No: & Password: Test Req. No.) OR collect the report from '.$lab_info['Lab']['pcc_name'].' '.$lab_info['Lab']['pcc_address'];
				/*$message = 'Dear '.$title.' '.$req_info['Health']['name'].' your test report for Test Req. No: ('.$get_req_number['Billing']['order_id'].') has been published.  You can check your reports online on  www.NHcare.in  under view reports User Name: Registered Ph. No. & Password: Test Request no. For assistance: Call NirAmaya Pathlabs +91-9555009009';*/
				$lab_book = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['created_by'])));
				
					$message = 'Dear '.$title.' '.strtoupper($req_info['Health']['name']).' your test report for Order Booked By - '.$lab_book['Lab']['pcc_name'].' is now available online. Visit www.NHcare.in (User Name: Regd Ph. No: & Password: Test Req. No.) or call 9555009009';
					
				
				if($this->Utility->check_report_sms_enable_for_pcc($req_info['Health']['created_by'],$req_info['Health']['assigned_lab']) == 1)
				{
					$this->__sms_message($number,$message);
				}
				
				$this->_activity_log($req_info['Health']['user_id'], $this->data['Health']['id'], $action = "Upload Report");
                                if($this->data['Health']['report_type'] == 'full')
                                {
                                    //send report to labstreet
                                    $this->integrateApiCall('report',$this->data['Health']['id'],$this->data['Health']['report_type']);
                                }
				/*test reporting status start here*/
				$this->RequestTest = ClassRegistry::init('RequestTest');
				foreach($this->data['RequestTest'] as $kkk=>$vvv)
				{
					$row_ids = explode("_",$kkk);
					$this->RequestTest->updateAll(array('RequestTest.reporting_status'=>$vvv),array('RequestTest.id'=>$row_ids[2]));
					
				}
				/*email address of lab to send email*/
				$lab_info_created = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['created_by'])));
				$test_status = $this->Utility->get_test_completed_status($this->data['Health']['id']);
				
				/*start of sending email*/
				
				$email_stage = 'partial';
				$mrn='';
				if(isset($req_info['Health']['medical_reference_number']))
				    $mrn = $req_info['Health']['medical_reference_number'];
				
				$dec_rep_name = PATIENT_REPORT_STORE_PATH.$hfile['name'];
                
		//                App::import('Vendor', '/fpdf/fpdf');
		//				App::import('Vendor', '/fpdf/fpdi');
                $pdf = new FPDI();
                $pdf->addPage();
                $pagecount = $pdf->setSourceFile($dec_rep_name);
				
				$lab_info_booked = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['created_by'])));
				
				$header_image='';
                if($lab_info_booked['Lab']['custom_header_status']=='1')
					$header_image = '/files/header/'.$lab_info_booked['Lab']['custom_header'];
				else
					$header_image = '/fpdf/nirAmaya_Report_Header.jpg';
				
                for ($i=1; $i <= $pagecount; $i++) {
                        $tplidx = $pdf->ImportPage($i);
                        $pdf->useTemplate($tplidx,0,0,0);
                        $pdf->Image('/home2/niramovh/public_html/app/webroot'.$header_image,0,0,$pdf->w,30);
                        //$pdf->Image('/home/wwwdemoi/public_html/NH/app/webroot/fpdf/footer.jpg',10,273,196,6.5);
                        if($i != $pagecount)
                        {
                                $pdf->addPage();
                        }
                }
                
				$pdf->Output(PATIENT_REPORT_STORE_PATH."main_report.pdf", "F");
		//			print_R(PATIENT_REPORT_STORE_PATH."main_report.pdf");
				$mail = new PHPMailer(); // create a new object
				$mail->IsSMTP(); // enable SMTP
				$mail->SMTPDebug = 1; // debugging: 1 = errors and messages, 2 = messages only
				$mail->SMTPAuth = true; // authentication enabled
				$mail->SMTPSecure = 'ssl'; // secure transfer enabled REQUIRED for Gmail
				$mail->Host = "smtp.gmail.com";
				$mail->Port = 465; // or 587
				$mail->IsHTML(true);
				$mail->setFrom('lab.reports@niramayahealthcare.com', 'NirAmaya PathLabs');
				$mail->addAddress($lab_info_booked['Lab']['pcc_email'], $lab_info_booked['Lab']['pcc_name']);
				$mail->Username = 'lab.reports@niramayapathlabs.com';
				$mail->Password = 'Lab@Reports';
				if($this->data['Health']['report_type'] == 'full')
				{
					$mail->Subject = "Complete Report of ".strtoupper($req_info['Health']['name']).' MRN-'.$mrn;
					$call_health_api = $this->Utility->trigger_callhealth_results($this->data['Health']['id']);
				}
				else
				{
					$mail->Subject = "Partial Report of ".strtoupper($req_info['Health']['name']).' MRN-'.$mrn;
				}
				
							
				$mail->addAttachment(PATIENT_REPORT_STORE_PATH ."main_report.pdf",'report.pdf');
				$mail->Body = "<table width='600' border='0' cellspacing='0' cellpadding='0' align='left'>
									<tr>
										<td>
											Dear ".$lab_info_created['Lab']['pcc_name']."
										</td>
									</tr>
									<tr>
										<td>
											&nbsp;
										</td>
									</tr>
									<tr>
										<td>
											Bill Date: ".date('d M Y',strtotime($req_info['Health']['s_date'])).' T'.date('H:i:s',strtotime($req_info['Health']['book_date']))."
										</td>
									</tr>
									<tr>
										<td>
											Bill Number: ";
											$mail->Body .= 'NPL'.!empty($req_info['Health']['ref_num'])?$req_info['Health']['ref_num'] : $get_req_number['Billing']['order_id'];
											$mail->Body .="
										</td>
									</tr>
									<tr>
										<td>
											&nbsp;
										</td>
									</tr>
									<tr>
									<td>
										Completed Tests:
										<ul style='list-style:none; margin:0px; padding:0px;'>";
										 	if($this->data['Health']['compeleted_test']!='')
										 	{
										 		$completed_test = explode(',', $this->data['Health']['compeleted_test']);
										 		foreach($completed_test as $key=>$value)
												{
													$mail->Body .= "<li style='margin:0px;'>*".$value."</li>";
												}
										 	}
										 	else{
												$pending_test_count = 0;
												foreach($test_status as $key=>$value)
												{
													if($value['reporting_status'] == 1)
													{
														$mail->Body .= "<li style='margin:0px;'>*".$value['test_name']."</li>";
													}
													else
													{
														$pending_test_count++;
													}
												}
											}
										$mail->Body .="
										</ul>
									</td>
								</tr>
								<tr>
									<td>
										&nbsp;
									</td>
								</tr>
								<tr>
									<td>";
										$mail->Body .= "Pending Tests: <br/>";
										
										if($this->data['Health']['pending_test']!='')
									 	{
									 		$pending_test = explode(',', $this->data['Health']['pending_test']);
									 		foreach($pending_test as $key=>$value)
											{
												$mail->Body .= "<li style='margin:0px;'>*".$value."</li>";
											}
									 	}
									 	else{
									 		$mail->Body .= "<ul style='list-style:none; margin:0px; padding:0px;'>";
									 		if($pending_test_count == 0){
											$mail->Body .= "*No Pending Tests.";
											} else {
												foreach($test_status as $key=>$value)
												{
													if($value['reporting_status'] == 0)
													{
														$mail->Body .= "<li style='margin:0px;'>*".$value['test_name']."</li>";
													}
												}
											}
											$mail->Body .= "</ul>";
										}
									$mail->Body .= "</td>
								</tr>
								<tr>
									<td>
										&nbsp;
									</td>
								</tr>
								
								<tr>
									<td>
										Thank you for choosing NirAmaya PathLabs. 
										<br/>
										<br/>
										"; 
										if(!empty($req_info['Health']['partial_reason']) && $email_stage =='partial'){
											$mail->Body .= "Note:- ".$req_info['Health']['partial_reason'];
										}
										
										$mail->Body .= "<br/>
										Please do not reply to this message. Replies to this message are routed to an unmonitored mailbox.
										<br/>
										kindly write back to helpline@niramayapathlabs.com or You may also call us at +91-7042191851
										<br/><br/>
										Best Regards,
										<br/>
										Lab Director
										<br/>
										Niramaya Pathlabs
									</td>
								</tr>
							</table>
								";
				/*$mail->SMTPAuth = true;
				$mail->SMTPSecure = 'tls';
				$mail->Port = 587;*/
				$mail->isHTML(true);
				/*$mail->AltBody = "Email Test\r\nThis email was sent through the 
					Amazon SES SMTP interface using the PHPMailer class.";
				*/
				
				$this->_activity_log($req_info['Health']['user_id'], $req_info['Health']['id'], $mail);
				
				if($req_info['Health']['created_by'] != '146' || $req_info['Health']['created_by'] != '153')
				{
					if(!$mail->send()) {
						$this->_activity_log($req_info['Health']['user_id'], $req_info['Health']['id'], 'report mail not sent');
						echo "Email not sent. " , $mail->ErrorInfo , PHP_EOL;
					} else {
						$this->_activity_log($req_info['Health']['user_id'], $req_info['Health']['id'], 'report mail sent');
						echo "Email sent!" , PHP_EOL;
					}
				}
				
				$get_user_detail = $this->User->find('first',array('conditions'=>array('User.id'=>$req_info['Health']['user_id'])));		
				
				if($lab_info_booked['Lab']['send_report_mail_patient']=='1' && $get_user_detail['User']['email'] != '')
				{
					//$mail->isSMTP();
					$mail->IsSMTP(); // enable SMTP
					$mail->SMTPDebug = 1; // debugging: 1 = errors and messages, 2 = messages only
					$mail->SMTPAuth = true; // authentication enabled
					$mail->SMTPSecure = 'ssl'; // secure transfer enabled REQUIRED for Gmail
					$mail->Host = "smtp.gmail.com";
					$mail->Port = 465; // or 587
					$mail->IsHTML(true);
					$mail->setFrom('lab.reports@niramayapathlabs.com', 'NirAmaya PathLabs');
					$mail->Username = 'lab.reports@niramayapathlabs.com';
					$mail->Password = 'Lab@Reports';
					
					$mail->addAddress($req_info['Health']['email'], strtoupper($req_info['Health']['name']));
					if($this->data['Health']['report_type'] == 'full')
					{
						$mail->Subject = "Complete Report of ".strtoupper($req_info['Health']['name']).' MRN-'.$mrn;
					}
					else
					{
						$mail->Subject = "Partial Report of ".strtoupper($req_info['Health']['name']).' MRN-'.$mrn;
					}
					$mail->addAttachment(PATIENT_REPORT_STORE_PATH ."main_report.pdf",'report.pdf');
					$mail->Body = "<table width='600' border='0' cellspacing='0' cellpadding='0' align='left'>
										<tr>
											<td>
												Dear ".$title." ".strtoupper($req_info['Health']['name'])."
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;
											</td>
										</tr>
										<tr>
											<td>
												Bill Date: ".date('d M Y',strtotime($req_info['Health']['s_date'])).' T'.date('H:i:s',strtotime($req_info['Health']['book_date']))."
											</td>
										</tr>
										<tr>
											<td>
												Bill Number: ";
												$mail->Body .= 'NPL'.!empty($req_info['Health']['ref_num'])?$req_info['Health']['ref_num'] : $get_req_number['Billing']['order_id'];
												$mail->Body .="
											</td>
										</tr>
										<tr>
											<td>
												&nbsp;
											</td>
										</tr>
										<tr>
										<td>
											Completed Tests:
											<ul style='list-style:none; margin:0px; padding:0px;'>";
												if($this->data['Health']['compeleted_test']!='')
												{
													$completed_test = explode(',', $this->data['Health']['compeleted_test']);
													foreach($completed_test as $key=>$value)
													{
														$mail->Body .= "<li style='margin:0px;'>*".$value."</li>";
													}
												}
												else{
													$pending_test_count = 0;
													foreach($test_status as $key=>$value)
													{
														if($value['reporting_status'] == 1)
														{
															$mail->Body .= "<li style='margin:0px;'>*".$value['test_name']."</li>";
														}
														else
														{
															$pending_test_count++;
														}
													}
												}
											$mail->Body .="
											</ul>
										</td>
									</tr>
									<tr>
										<td>
											&nbsp;
										</td>
									</tr>
									<tr>
										<td>";
											$mail->Body .= "Pending Tests: <br/>";
											
											if($this->data['Health']['pending_test']!='')
											{
												$pending_test = explode(',', $this->data['Health']['pending_test']);
												foreach($pending_test as $key=>$value)
												{
													$mail->Body .= "<li style='margin:0px;'>*".$value."</li>";
												}
											}
											else{
												$mail->Body .= "<ul style='list-style:none; margin:0px; padding:0px;'>";
												if($pending_test_count == 0){
												$mail->Body .= "*No Pending Tests.";
												} else {
													foreach($test_status as $key=>$value)
													{
														if($value['reporting_status'] == 0)
														{
															$mail->Body .= "<li style='margin:0px;'>*".$value['test_name']."</li>";
														}
													}
												}
												$mail->Body .= "</ul>";
											}
										$mail->Body .= "</td>
									</tr>
									<tr>
										<td>
											&nbsp;
										</td>
									</tr>
									
									<tr>
										<td>
											Thank you for choosing NirAmaya PathLabs. 
											<br/>
											<br/>
											"; 
											if(!empty($req_info['Health']['partial_reason']) && $email_stage =='partial'){
												$mail->Body .= "Note:- ".$req_info['Health']['partial_reason'];
											}
											
											$mail->Body .= "<br/>
											Please do not reply to this message. Replies to this message are routed to an unmonitored mailbox.
											<br/>
											kindly write back to helpline@niramayapathlabs.com or You may also call us at +91-7042191851
											<br/><br/>
											Best Regards,
											<br/>
											Lab Director
											<br/>
											Niramaya Pathlabs
										</td>
									</tr>
								</table>
									";
					/*$mail->SMTPAuth = true;
					$mail->SMTPSecure = 'tls';
					$mail->Port = 587;*/
					$mail->isHTML(true);
					/*$mail->AltBody = "Email Test\r\nThis email was sent through the 
						Amazon SES SMTP interface using the PHPMailer class.";
					*/
					if(!$mail->send()) {
						$this->_activity_log($req_info['Health']['user_id'], $req_info['Health']['id'], 'report mail not sent');
						echo "Email not sent. " , $mail->ErrorInfo , PHP_EOL;
					} else {
						$this->_activity_log($req_info['Health']['user_id'], $req_info['Health']['id'], $call_health_api.'------- patient report mail sent');	
						echo "Email sent!" , PHP_EOL;
					}
				}
				
				/*end of sending mail*/
                                            
				if(!empty($this->data['Health']['login_agent']) && $this->data['Health']['login_agent'] == 'Super')
				{
					$this->redirect(array('controller'=>'samples','action'=>'view_detail',base64_encode($this->data['Health']['id'])));
				}
				else
				{
					$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',base64_encode($this->data['Health']['id'])));
				}
			}
			/*else
			{
			$update_query = $this->Health->query("UPDATE healths SET published='".$this->data['Health']['published']."',published_reason='".$this->data['Health']['published_reason']."' WHERE id='".$this->data['Health']['id']."'");
			$this->Session->setFlash('Patient information uploaded successfully.','flash_success');
			if(!empty($this->data['Health']['login_agent']) && $this->data['Health']['login_agent'] == 'Super')
			{
			$this->redirect(array('controller'=>'samples','action'=>'view_detail',base64_encode($this->data['Health']['id'])));
			}
			else
			{
			$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',base64_encode($this->data['Health']['id'])));
			}
			}*/
		}
	}

	function update_mode($data, $mode){
		switch($mode){
			case 'activate':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Health->id = $data[$ctr];
						$this->Health->saveField('status', '1');
					}
				}
				// set message
				$this->Session->setFlash('Sample(s) have been activated','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'index'));
				break;
			case 'deactivate':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Health->id = $data[$ctr];
						$this->Health->saveField('status', '0');
					}
				}
				// set message
				$this->Session->setFlash('Sample(s) have been deactivated','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'index'));
				break;
			case 'delete':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Health->delete($data[$ctr]);
					}
				}
				// set message
				$this->Session->setFlash('Sample(s) have been deleted','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'index'));
				break;
				break;
		}
	}

	function admin_assign_lab()
	{
		if($_REQUEST['lab'] != 'Home')
		{
			$lab_value = $_REQUEST['lab'];
		}
		else
		{
			$lab_value = 'Home';
		}
		$id = $_REQUEST['id'];
		$update = $this->Health->query("UPDATE healths SET assigned_lab='$lab_value' WHERE id='".$id."'");
		$assigned_lab_val = $this->Health->find('first',array('conditions'=>array('Health.id'=>$id)));
		if(!empty($assigned_lab_val['Health']['assigned_lab']))
		{
			if($lab_value != 'Home')
			{
				$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$lab_value)));
				
				if(in_array($lab_value,array('121','122')))
				{
					$this->Utility->dropletapi($id,$pcc_name['Lab']['pcc_name'],"");
				}
				else 
				{
					echo $pcc_name['Lab']['pcc_name'].','.$id;
				}
				exit;
			}
			else
			{
				echo $lab_value.','.$id;
				exit;
			}
		}
		else
		{
			echo "error_not_updated";
			exit;
		}
	}

	function admin_filter_page_req($form=NULL)
	{
		//print_R($this->params);
		$labtype = $this->Session->read('Admin.labType');
		//print_R($this->Session->read('Admin'));
		if(isset($this->params['named']['form_name']) && $this->params['named']['form_name'] == 'first')
		{
			if(isset($this->params['named']['from_date']) && $this->params['named']['from_date']!='')
			{
				$this->data['Filter']['req_from_date'] = $this->params['named']['from_date'];
				$options['from_date'] = $this->params['named']['from_date'];
			}
			if(isset($this->params['named']['to_date']) && $this->params['named']['to_date']!='')
			{
				$this->data['Filter']['req_to_date'] = $this->params['named']['to_date'];
				$options['to_date'] = $this->params['named']['to_date'];
			}
			if(isset($this->params['named']['city']) && $this->params['named']['city']!='')
			{
				$this->data['Filter']['req_city'] = $this->params['named']['city'];
				$options['city'] = $this->params['named']['city'];
			}
			if(isset($this->params['named']['lab']) && $this->params['named']['lab']!='')
			{
				$this->data['Filter']['req_lab'] = $this->params['named']['lab'];
				$options['lab'] = $this->params['named']['lab'];
			}
			if(isset($this->params['named']['agent']) && $this->params['named']['agent']!='')
			{
				$this->data['Filter']['req_agent'] = $this->params['named']['agent'];
				$options['agent'] = $this->params['named']['agent'];
			}
			if(isset($this->params['named']['report']) && $this->params['named']['report']!='')
			{
				$this->data['Filter']['req_report'] = $this->params['named']['report'];
				$options['report'] = $this->params['named']['report'];
			}
			if(isset($this->params['named']['req_status']) && $this->params['named']['req_status']!='')
			{
				$this->data['Filter']['req_status'] = $this->params['named']['req_status'];
				$options['req_status'] = $this->params['named']['req_status'];
			}
			if(isset($this->params['named']['pay_status']) && $this->params['named']['pay_status']!='')
			{
				$this->data['Filter']['pay_status'] = $this->params['named']['pay_status'];
				$options['pay_status'] = $this->params['named']['pay_status'];
			}
			if(isset($this->params['named']['form_name']) && $this->params['named']['form_name']!='')
			{
				$form = $this->params['named']['form_name'];
				$options['form_name'] = $this->params['named']['form_name'];
			}
		}
		if(isset($this->params['named']['form_name']) && $this->params['named']['form_name'] == 'second')
		{
			if(isset($this->params['named']['name']) && $this->params['named']['name']!='')
			{
				$this->data['Filter']['req_name'] = $this->params['named']['name'];
				$options['name'] = $this->params['named']['name'];
			}
			if(isset($this->params['named']['phone']) && $this->params['named']['phone']!='')
			{
				$this->data['Filter']['req_phone'] = $this->params['named']['phone'];
				$options['phone'] = $this->params['named']['phone'];
			}
			if(isset($this->params['named']['reference']) && $this->params['named']['reference']!='')
			{
				$this->data['Filter']['reference'] = $this->params['named']['reference'];
				$options['reference'] = $this->params['named']['reference'];
			}
			if(isset($this->params['named']['form_name']) && $this->params['named']['form_name']!='')
			{
				$form = $this->params['named']['form_name'];
				$options['form_name'] = $this->params['named']['form_name'];
			}
		}
		//print_R($options);
		if($form == 'first')
		{
 			if(!empty($this->data))
			{
				$from_date = $this->data['Filter']['req_from_date'];
				$to_date = $this->data['Filter']['req_to_date'];
				$city = $this->data['Filter']['req_city'];
				$lab = $this->data['Filter']['req_lab'];
				$agent = $this->data['Filter']['req_agent'];
				$report = $this->data['Filter']['req_report'];
				$req_status = $this->data['Filter']['req_status'];
				$pay_stat = $this->data['Filter']['pay_status'];
				if(isset($from_date) && $from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($from_date));
					$options['from_date'] = date('d-m-Y',strtotime($from_date));
				}
				if(isset($to_date) && $to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($to_date));
					$options['to_date'] = date('d-m-Y',strtotime($to_date));
				}
				if(isset($city) && $city != '')
				{
					$conditions['Health.visit_pat_city'] = $city;
					$options['city'] = $city;
				}
				if(isset($lab) && $lab != '')
				{
					$conditions['Health.assigned_lab'] = $lab;
					$options['lab'] = $lab;
				}
				if(isset($agent) && $agent != '')
				{
					$conditions['Health.agent_id'] = $agent;
					$options['agent'] = $agent;
				}
				if(isset($report) && $report != '')
				{
					if($report == 1)
					{
						$conditions['Health.patient_report <>'] = '';
						$conditions['Health.requ_status'] = 6;
					}
					if($report == 0)
					{
						$conditions['Health.patient_report'] = '';
					}
					if($report == 2)
					{
						$conditions['Health.requ_status'] = 7;
					}
					$options['report'] = $report;
				}
				if(isset($req_status) && $req_status != '')
				{
					if($req_status == 11)
					{
						$conditions['Health.requ_status'] = 11;
					}
					if($req_status == 12)
					{
						$conditions['Health.requ_status'] = 12;
					}
					if($req_status == 13)
					{
						$conditions['Health.requ_status'] = 13;
					}
					if($req_status == 10)
					{
						$conditions['Health.requ_status'] = 10;
					}
					if($req_status == 14)
					{
						$conditions['Health.requ_status'] = 14;
					}
					if($req_status == 4)
					{
						$conditions['Health.requ_status'] = 4;
					}
					if($req_status == 5)
					{
						$conditions['Health.requ_status'] = 5;
					}
					if($req_status == 0)
					{
						$conditions['Health.requ_status <'] = 4;
					}
					//code edit by sanjeet
					if($req_status == 6)
					{
						$conditions['Health.requ_status'] = 6;
					}
					if($req_status == 9)
					{
						$conditions['Health.requ_status'] = 9;
					}
					//Code Edit By Ashish 05-06-14 Starts
					if($req_status == 8)
					{
						$conditions['Health.requ_status'] = 8;
					}
	
					if($req_status == 7)
					{
						$conditions['Health.requ_status'] = 7;
					}
					
					if($req_status == 15)
					{
						$conditions['Health.requ_status'] = 15;
					}
					
					if($req_status == 16)
					{
						$conditions['Health.requ_status'] = 16;
					}
					
					if($req_status == 1)
					{
						$conditions['Health.requ_status'] = 1;
					}
					if($req_status == 2)
					{
						$conditions['Health.requ_status'] = 2;
					}
					
					if($req_status == 3)
					{
						$conditions['Health.requ_status'] = 3;
					}
					if($req_status == 17)
					{
						$conditions['Health.requ_status'] = 17;
					}
					if($req_status == 18)
					{
						$conditions['Health.requ_status'] = 18;
					}
					if($req_status == 19)
					{
						$conditions['Health.requ_status'] = 19;
					}
					if($req_status == 20)
					{
						$conditions['Health.requ_status'] = 20;
					}
					if($req_status == 21)
					{
						$conditions['Health.requ_status'] = 21;
					}
					if($req_status == 22)
					{
						$conditions['Health.requ_status'] = 22;
					}
					if($req_status == 23)
					{
						$conditions['Health.requ_status'] = 23;
					}
					//Code Edit By Ashish 05-06-14 Ends
					$options['req_status'] = $req_status;
				}
				if(isset($pay_stat) && $pay_stat != '')
				{
					if($pay_stat == 'not_paid')
					{
						$conditions['Health.received_amount'] = 0;
						$conditions['Health.balance_amount'] = 0;
					}
					if($pay_stat == 'partial_paid')
					{
						$conditions['Health.received_amount >'] = 0;
						$conditions['Health.balance_amount >'] = 0;
					}
					$options['pay_status'] = $pay_stat;
				}
				$options['form_name'] = $form;
				//$conditions['Health.assigned_lab'] = $this->Session->read('Admin.labId');
				$conditions['Health.status'] = 1;
				$conditions['OR']=array('Health.created_by'=>$this->Session->read('Admin.labId'),'Health.assigned_lab'=>$this->Session->read('Admin.labId'));
				$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.s_date'=>'ASC'),'conditions'=>$conditions));
				$this->set('data_req_from_date',$from_date);
				$this->set('data_req_to_date',$to_date);
				$this->set('data_req_city',$city);
				$this->set('data_req_lab',$lab);
				$this->set('data_req_agent',$agent);
				$this->set('data_req_report',$agent);
				$this->set('data_req_request',$req_status);
				$this->set('data_req_pay_status',$pay_stat);
				$this->set('options',$options);
				$this->set('LabType',$this->Session->read('Admin.labType'));
				$samplerequestlist=$this->paginate('Health');
				$j = 0;
				foreach($samplerequestlist as $key => $val)
				{
					$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
					$samplerequestlist[$j]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
					$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['city_id'])));
					$samplerequestlist[$j]['Health']['city_name'] = $city_name['City']['name'];
					$test_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val['Sample']['test_id'])));
					$samplerequestlist[$j]['Health']['test_name'] = $test_name['Test']['test_parameter'];
					if($val['Health']['agent_id'] == 0)
					{
						$samplerequestlist[$j]['Health']['agent_name'] = 'No';
					}
					else
					{
						$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
						$samplerequestlist[$j]['Health']['agent_name'] = $agent_name['Agent']['name'];
					}
					$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
					//$samplerequestlist[$j]['Health']['landline'] = $contact['User']['contact'];
					$this->Timelab = ClassRegistry::init('Timelab');
					$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
					if($val['Health']['assigned_lab'] == 'Home')
					{
						$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time1']];
						$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date1']));
					}
					else
					{
						if($val['Health']['sample_date'] != 'Please select a suitable date' && $val['Health']['sample_time'] != '')
						{
							$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time']];
							$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date']));
						}
						else
						{
							$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time1']];
							$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date1']));
						}
					}
					if($val['Health']['assigned_lab'] != 'Home')
					{
						$get_add_detail = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
						$expl_add = explode('*',$get_add_detail['User']['address']);
						$samplerequestlist[$j]['Health']['address_0'] = $expl_add[0];
						$samplerequestlist[$j]['Health']['address_1'] = $expl_add[1];
						$samplerequestlist[$j]['Health']['locality_name'] = $get_add_detail['User']['locality'];
					}
					else
					{
						$expl_add = explode('*',$val['Health']['address']);
						$samplerequestlist[$j]['Health']['address_0'] = $expl_add[0];
						$samplerequestlist[$j]['Health']['address_1'] = $expl_add[1];
						$samplerequestlist[$j]['Health']['locality_name'] = $val['Health']['locality'];
					}
					$j++;
				}
			}
			else
			{
				$this->redirect('/admin/samples/home/'.base64_encode($labtype));
			}
		}
		if($form == 'second')
		{
			if(!empty($this->data))
			{
				$req_num = $this->data['Filter']['req_num'];
				$name = $this->data['Filter']['req_name'];
				$phone = $this->data['Filter']['req_phone'];
				$reference = $this->data['Filter']['reference'];
				$labnum = $this->data['Filter']['ref_num'];
				$mrn = $this->data['Filter']['mrn'];
				$barcode = $this->data['Filter']['barcode'];
				if(isset($req_num) && $req_num != '')
				{
					$order_num = $this->Billing->find('first',array('conditions'=>array('Billing.order_id'=>$this->data['Filter']['req_num'])));
                                        //$conditions['OR']=array('Health.created_by'=>$this->Session->read('Admin.labId'),'Health.assigned_lab'=>$this->Session->read('Admin.labId'));
					$this->paginate = array('Health' => array('limit' =>'20','conditions'=>array('Health.id'=>$order_num['Billing']['request_id'],'Health.status'=>1,'OR'=>array('Health.created_by'=>$this->Session->read('Admin.labId'),'Health.assigned_lab'=>$this->Session->read('Admin.labId')))));
					$samplerequestlist=$this->paginate('Health');
				}
				if(isset($labnum) && $labnum != '')
				{
					$conditions['Health.ref_num'] = $labnum;
					$options['refnum'] = $labnum;
					$options['form_name'] = $form;
					$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.s_date'=>'ASC'),'conditions'=>$conditions));
					$samplerequestlist=$this->paginate('Health');
				}
				if(isset($mrn) && $mrn != '')
				{
					$conditions['Health.medical_reference_number LIKE'] = '%'.$mrn.'%';
					$options['medical_reference_number'] = $mrn;
				}
				if((isset($name) || isset($phone) || isset($reference)) && $req_num == '')
				{
					if(isset($name) && $name != '')
					{
						$conditions['Health.name LIKE'] = '%'.$name.'%';
						$options['name'] = $name;
					}
					if(isset($phone) && $phone != '')
					{
						$conditions['Health.landline LIKE'] = '%'.$phone.'%';
						$options['phone'] = $phone;
					}
					if(isset($reference) && $reference != '')
					{
						$conditions['Health.reference'] = $reference;
						$options['reference'] = $reference;
					}
					$options['form_name'] = $form;
					$conditions['Health.status'] = 1;
                                        
					// $conditions['Health.assigned_lab'] = $this->Session->read('Admin.labId');
					$conditions['OR']=array('Health.created_by'=>$this->Session->read('Admin.labId'),'Health.assigned_lab'=>$this->Session->read('Admin.labId'));
					$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.s_date'=>'ASC'),'conditions'=>$conditions));
					if(isset($barcode) && $barcode != '')
					{
						$this->paginate = array('Health' => array('limit' =>'20','group'=>array('Health.id'),'order'=>array('Health.id'=>'DESC'),'conditions'=>array('Healthsample.barcode_id'=>$barcode),'joins' => array(
							array(
							    'alias' => 'Healthsample',
							    'table' => 'health_sample',
							    'type' => 'INNER',
							    'conditions' => '`Healthsample`.`health_id` = `Health`.`id`'
							)
						    )));
					}
					$samplerequestlist=$this->paginate('Health');
		//print_R($samplerequestlist);
				}
				$j = 0;
				foreach($samplerequestlist as $key => $val)
				{
					$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
					$samplerequestlist[$j]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
					$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['city_id'])));
					$samplerequestlist[$j]['Health']['city_name'] = $city_name['City']['name'];
					$test_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val['Sample']['test_id'])));
					$samplerequestlist[$j]['Health']['test_name'] = $test_name['Test']['test_parameter'];
					if($val['Health']['agent_id'] == 0)
					{
						$samplerequestlist[$j]['Health']['agent_name'] = 'No';
					}
					else
					{
						$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
						$samplerequestlist[$j]['Health']['agent_name'] = $agent_name['Agent']['name'];
					}
					$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
					//$samplerequestlist[$j]['Health']['landline'] = $contact['User']['contact'];
					$this->Timelab = ClassRegistry::init('Timelab');
					$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
					if($val['Health']['assigned_lab'] == 'Home')
					{
						$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time1']];						
						$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date1']));
					}
					else
					{
						if($val['Health']['sample_date'] != 'Please select a suitable date' && $val['Health']['sample_time'] != '')
						{
							$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time']];						
							$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date']));
						}
						else
						{
							$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time1']];
							$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date1']));
						}
					}
					if($val['Health']['assigned_lab'] != 'Home')
					{
						$get_add_detail = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
						$expl_add = explode('*',$get_add_detail['User']['address']);
						$samplerequestlist[$j]['Health']['address_0'] = $expl_add[0];
						$samplerequestlist[$j]['Health']['address_1'] = isset($expl_add[1])?$expl_add[1]:'';
						$samplerequestlist[$j]['Health']['locality_name'] = $get_add_detail['User']['locality'];
					}
					else
					{
						$expl_add = explode('*',$val['Health']['address']);
						$samplerequestlist[$j]['Health']['address_0'] = $expl_add[0];
						$samplerequestlist[$j]['Health']['address_1'] = $expl_add[1];
						$samplerequestlist[$j]['Health']['locality_name'] = $val['Health']['locality'];
					}
					$j++;
				}
				if($req_num != '')
				{
					$this->set('req_number',$this->data['Filter']['req_num']);
				}
				else
				{
					$this->set('data_req_name',$name);
					$this->set('data_req_phone',$phone);
					$this->set('data_req_regis',isset($restion)?$restion:'');
				}
			}
			else
			{
				$this->redirect('/admin/samples/home/'.base64_encode($labtype));
			}
		}
		$city_names = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city_names);
		$agent_list = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
		$this->set('agent_list',$agent_list);
		//print_R($samplerequestlist);
		$this->set('samplerequestlist',$samplerequestlist);
		$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		$this->set('pcc',$pcc);
		$pcc_list = $this->Lab->find('list',array('fields'=>array('id','pcc_name'),'conditions'=>array('Lab.status'=>1)));
		$this->set('pcc_list',$pcc_list);
	}

	function admin_home($type=NULL,$assign=NULL)
	{
		if(empty($type))
		{
			$userlab = $this->Session->read('userlab');
			if($usertype != 'A')
			{
				if($userlab != 'Home')
				{
					$this->redirect('/admin/samples/home/'.base64_encode($userlab));
				}
				else
				{
					$this->redirect('/admin/samples/home/'.base64_encode($userlab).'/New');
				}
			}
		}
		$this->set('title_for_layout','Manage Sample Request(s)');
		$t_date = date('Y-m-d');
		if(base64_decode($type) == 'Home')
		{
		//print_R('home');
			$this->Session->write('userlab',$this->Session->read('Admin.userValue'));
			if(!empty($assign) && $assign == 'New')
			{
				$this->paginate = array('Health' => array('limit' =>'10','order'=>array('Health.sample_date1'=>'DESC'),'conditions'=>array('Health.assigned_lab'=>'Home','Health.agent_id'=>0,'Health.status'=>1,'Health.s_date'=>$t_date)));
				$this->set('LabType',$this->Session->read('Admin.labType'));
				$this->set('AssignType',$assign);
			}
			if(!empty($assign) && $assign == 'Assign')
			{
				$this->paginate = array('Health' => array('limit' =>'10','order'=>array('Health.sample_date1'=>'DESC'),'conditions'=>array('Health.assigned_lab'=>'Home','Health.agent_id <>'=>0,'Health.print_status'=>0,'Health.status'=>1,'Health.s_date'=>$t_date)));
				$this->set('LabType',$this->Session->read('Admin.labType'));
				$this->set('AssignType',$assign);
			}
			if(!empty($assign) && $assign == 'Process')
			{
				$this->paginate = array('Health' => array('limit' =>'10','order'=>array('Health.sample_date1'=>'DESC'),'conditions'=>array('Health.assigned_lab'=>'Home','Health.agent_id <>'=>0,'Health.print_status <>'=>0,'Health.status'=>1,'Health.s_date'=>$t_date)));
				$this->set('LabType',$this->Session->read('Admin.labType'));
				$this->set('AssignType',$assign);
			}
			$this->set('req_type',$assign);
			$this->set('userLab',base64_encode('Home'));
		}
		else
		{
			$conditions=array();
			$user_type=$this->Session->read('Admin.userType');
			$user_type_array=array('A','BM','Agent','DA');
			if(in_array($user_type,$user_type_array))
			{
				$conditions=array('Health.assigned_lab'=>$this->Session->read('Admin.labId'),'Health.status'=>1);//,'Health.s_date'=>$t_date
			}
			else
			{
				$conditions=array('OR'=>array('Health.created_by'=>$this->Session->read('Admin.labId'),'Health.assigned_lab'=>$this->Session->read('Admin.labId')),'Health.status'=>1);//'Health.s_date'=>$t_date
			}
			$this->Session->write('userlab',$this->Session->read('Admin.userValue'));
			//$this->paginate = array('Health' => array('limit' =>'10','order'=>array('Health.id'=>'DESC'),'conditions'=>array('Health.assigned_lab'=>$this->Session->read('Admin.labId'),'Health.status'=>1,'Health.s_date'=>$t_date)));
			$this->paginate = array('Health' => array('limit' =>'10','order'=>array('Health.id'=>'DESC'),'conditions'=>$conditions));
			$this->set('LabType',$this->Session->read('Admin.labType'));
			$this->set('AssignType',$assign);
		}
		$samplerequestlist=$this->paginate('Health');
		/*if(!empty($this->data))
		{
		$this->paginate = array('Health' => array('limit' =>'10','conditions'=>array('Health.name LIKE'=>'%'.$this->data['Search']['name'].'%','Health.assigned_lab'=>'Home')));
		$samplerequestlist=$this->paginate('Health');
		$this->set('samplerequestlist',$samplerequestlist);
		}*/
		$j = 0;
		foreach($samplerequestlist as $key => $val)
		{
			$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
			$samplerequestlist[$j]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
			$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['visit_pat_city'])));
			$samplerequestlist[$j]['Health']['city_name'] = $city_name['City']['name'];
			$test_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val['Sample']['test_id'])));
			$samplerequestlist[$j]['Sample']['test_name'] = $test_name['Test']['test_parameter'];
			if($val['Health']['agent_id'] == 0)
			{
				$samplerequestlist[$j]['Health']['agent_name'] = 'No';
			}
			else
			{
				$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
				$samplerequestlist[$j]['Health']['agent_name'] = $agent_name['Agent']['name'];
			}
			//$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
			//$samplerequestlist[$j]['Health']['landline'] = $contact['User']['contact'];
			$samplerequestlist[$j]['Health']['lab_name'] = $this->Session->read('Admin.userValue');
			$this->Timelab = ClassRegistry::init('Timelab');
			$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
			if($val['Health']['assigned_lab'] == 'Home')
			{
				$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time1']];						
				$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date1']));
			}
			else
			{
				if($val['Health']['sample_date'] != 'Please select a suitable date' && $val['Health']['sample_time'] != '')
				{
					$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time']];
					$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date']));
				}
				else
				{
					$samplerequestlist[$j]['Health']['sample_time1'] = $timelabs[$val['Health']['sample_time1']];						
					$samplerequestlist[$j]['Health']['sample_date1'] = date('d-m-Y',strtotime($val['Health']['sample_date1']));
				}
			}
			if($val['Health']['assigned_lab'] != 'Home')
			{
				$pcc_detail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val['Health']['assigned_lab'])));
				$samplerequestlist[$j]['Health']['assigned_lab'] = $pcc_detail['Lab']['pcc_name'];
				$get_add_detail = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				$expl_add = explode('*',$get_add_detail['User']['address']);
				$samplerequestlist[$j]['Health']['address_0'] = $expl_add[0];
				$samplerequestlist[$j]['Health']['address_1'] = $expl_add[1];
				$samplerequestlist[$j]['Health']['locality_name'] = $get_add_detail['User']['locality'];
			}
			else
			{
				$expl_add = explode('*',$val['Health']['address']);
				$samplerequestlist[$j]['Health']['address_0'] = $expl_add[0];
				$samplerequestlist[$j]['Health']['address_1'] = $expl_add[1];
				$samplerequestlist[$j]['Health']['locality_name'] = $val['Health']['locality'];
			}
			$j++;
		}
		$city_names = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city_names);
		$agent_list = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
		$this->set('agent_list',$agent_list);
		$this->set('samplerequestlist',$samplerequestlist);
		$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		$pcc_list = $this->Lab->find('list',array('fields'=>array('id','pcc_name'),'conditions'=>array('Lab.status'=>1)));
		$this->set('pcc',$pcc);
		$this->set('pcc_list',$pcc_list);
	}

	function admin_add_agent()
	{
		$this->set('title_for_layout','Add Agent');
		if(!empty($this->data))
		{
			$this->data['Agent']['password'] = md5($this->data['Agent']['password']);
			$this->data['Agent']['add_date'] = date('Y-m-d H:i:s');
			//$this->data['Agent']['status'] = 1;
			if($this->Agent->create($this->data))
			{
				if($this->Agent->save($this->data,false))
				{
				
					if(!empty($this->data['AgentDoc']['display_pic']))
					{
						$hfile = $this->File->uploadFile($this->data['AgentDoc']['display_pic'], PATIENT_AGENT_STORE_PATH, true,array('jpg','jpe','jpeg','JPG','JPE','JPEG'));
						echo $hfile;
						$this->data['AgentDoc']['display_pic'] = $hfile['name'];
					}
					
					if(!empty($this->data['AgentDoc']['metric_doc']))
					{
						$edu_doc = array();
						foreach($this->data['AgentDoc']['metric_doc'] as $key => $val)
						{
							$hfile = $this->File->uploadFile($this->data['AgentDoc']['metric_doc'][$key], PATIENT_AGENT_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
							array_push($edu_doc,$hfile['name']);
						}
						$this->data['AgentDoc']['metric_doc'] = implode(',',$edu_doc);
					}
					
					if(!empty($this->data['AgentDoc']['intermediate_doc']))
					{
						$kyc_doc = array();
						foreach($this->data['AgentDoc']['intermediate_doc'] as $key => $val)
						{
							$hfile = $this->File->uploadFile($this->data['AgentDoc']['intermediate_doc'][$key], PATIENT_AGENT_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
							array_push($kyc_doc,$hfile['name']);
						}
						$this->data['AgentDoc']['intermediate_doc'] = implode(',',$kyc_doc);
					}
					
					if(!empty($this->data['AgentDoc']['experience_doc']))
					{
						$exp_doc = array();
						foreach($this->data['AgentDoc']['experience_doc'] as $key => $val)
						{
							$hfile = $this->File->uploadFile($this->data['AgentDoc']['experience_doc'][$key], PATIENT_AGENT_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
							array_push($exp_doc,$hfile['name']);
						}
						$this->data['AgentDoc']['experience_doc'] = implode(',',$exp_doc);
					}
					print_R($this->data);
					die;
					$this->data['AgentDoc']['agent_id'] = $this->Agent->getLastInsertId();
					$this->AgentDoc->create();
					$this->AgentDoc->save($this->data,false);
					
					$this->Session->setFlash('Agent have been added successfully','flash_success');
					$this->redirect(array('controller'=>'samples','action'=>'view_agent'));
				}
			}
		}
		$city_list = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city_list',$city_list);
		$pcc_list = $this->Lab->find('list',array('conditions'=>array('Lab.status'=>1),'fields'=>array('Lab.id','Lab.pcc_name')));
		$this->set('lablist',$pcc_list);
		$agent_type = array('1'=>'Agent','2'=>'Runner','3'=>'Both');
		$this->set('agent_type',$agent_type);
	}

	function admin_view_agent()
	{
		$this->set('title_for_layout','Agent List(s)');
		if(isset($this->params['named']['agentname']) && $this->params['named']['agentname']!='')
		{
			$this->data['FilterAgent']['name'] = $this->params['named']['agentname'];
			$options['agentname'] = $this->params['named']['agentname'];
		}
		if(isset($this->params['named']['agentcontact']) && $this->params['named']['agentcontact']!='')
		{
			$this->data['FilterAgent']['contact'] = $this->params['named']['agentcontact'];
			$options['agentcontact'] = $this->params['named']['agentcontact'];
		}
		if(isset($this->params['named']['agentemail']) && $this->params['named']['agentemail']!='')
		{
			$this->data['FilterAgent']['email'] = $this->params['named']['agentemail'];
			$options['agentemail'] = $this->params['named']['agentemail'];
		}
		if(isset($this->data) && !empty($this->data))
		{
			$agent_name = $this->data['FilterAgent']['name'];
			$agent_contact = $this->data['FilterAgent']['contact'];
			$agent_email = $this->data['FilterAgent']['email'];
			if(!empty($agent_name) && $agent_name != '')
			{
				$conditions['Agent.name LIKE'] = '%'.$agent_name.'%';
				$options['agentname'] = $agent_name;
			}
			if(!empty($agent_contact) && $agent_contact != '')
			{
				$conditions['Agent.contact LIKE'] = '%'.$agent_contact.'%';
				$options['agentcontact'] = $agent_contact;
			}
			if(!empty($agent_email) && $agent_email != '')
			{
				$conditions['Agent.email LIKE'] = '%'.$agent_email.'%';
				$options['agentemail'] = $agent_email;
			}
			$this->paginate = array('Agent' => array('limit' =>'20','order'=>array('Agent.id'=>'DESC'),'conditions'=>$conditions));
			$agentlist=$this->paginate('Agent');
			/*if(isset($this->data['Agent']['id']) && count($this->data['Agent']['id']) && trim($this->data['Page']['mode']) != ''){
			$this->update_mode_agent($this->data['Agent']['id'], $this->data['Page']['mode']);
			}
			else
			{
			$this->Session->setFlash('Please select atlest one Agent(s) to perform any action','flash_failure');
			}*/
		}
		else
		{
			$this->paginate = array('Agent' => array('limit' =>'20','order'=>array('Agent.id'=>'DESC')));
			$agentlist=$this->paginate('Agent');
		}
			
		$pcc_list = $this->Lab->find('list',array('conditions'=>array('Lab.status'=>1),'fields'=>array('Lab.id','Lab.pcc_name')));
		$this->set('lablist',$pcc_list);
		$agent_type = array('1'=>'Agent','2'=>'Runner','3'=>'Both');
		$this->set('agent_type',$agent_type);
		//print_R($pcc_list);die;
		$this->set('agentlist',$agentlist);
	}

	function update_mode_agent($data, $mode){
		switch($mode){
			case 'activate':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Agent->id = $data[$ctr];
						$this->Agent->saveField('status', '1');
					}
				}
				// set message
				$this->Session->setFlash('Agent(s) have been activated','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_agent'));
				break;
			case 'deactivate':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Agent->id = $data[$ctr];
						$this->Agent->saveField('status', '0');
					}
				}
				// set message
				$this->Session->setFlash('Agent(s) have been deactivated','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_agent'));
				break;
			case 'delete':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Agent->delete($data[$ctr]);
					}
				}
				// set message
				$this->Session->setFlash('Agent(s) have been deleted','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_agent'));
				break;
				break;
		}
	}

	function admin_edit_agent($id=NULL)
	{
		$this->set('title_for_layout','Edit Agent');
		$id_dec = base64_decode($id);
				
		if(!empty($this->data))
		{
			if($this->Agent->create($this->data))
			{
				if($this->Agent->save($this->data,false))
				{
					$agent_doc_detail = $this->AgentDoc->find('first',array('conditions'=>array('AgentDoc.agent_id'=>$this->data['Agent']['id'])));
					
					$this->AgentDoc->create($this->data);
					if(!empty($this->data['AgentDoc']['display_pic'][0]['name']))
					{
						$hfile = $this->File->uploadFile($this->data['AgentDoc']['display_pic'], PATIENT_AGENT_STORE_PATH, true,array('jpg','jpe','jpeg','JPG','JPE','JPEG'));
						$this->data['AgentDoc']['display_pic'] = $hfile['name'];
					}
					else
						$this->data['AgentDoc']['display_pic'] = $agent_doc_detail['AgentDoc']['display_pic'];
					
					if(!empty($this->data['AgentDoc']['metric_doc'][0]['name']))
					{
						$edu_doc = array();
						foreach($this->data['AgentDoc']['metric_doc'] as $key => $val)
						{
							$hfile = $this->File->uploadFile($this->data['AgentDoc']['metric_doc'][$key], PATIENT_AGENT_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
							array_push($edu_doc,$hfile['name']);
						}
						$this->data['AgentDoc']['metric_doc'] = implode(',',$edu_doc);
					}
					else
						$this->data['AgentDoc']['metric_doc'] = $agent_doc_detail['AgentDoc']['metric_doc'];
					
					if(!empty($this->data['AgentDoc']['intermediate_doc'][0]['name']))
					{
						$kyc_doc = array();
						foreach($this->data['AgentDoc']['intermediate_doc'] as $key => $val)
						{
							$hfile = $this->File->uploadFile($this->data['AgentDoc']['intermediate_doc'][$key], PATIENT_AGENT_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
							array_push($kyc_doc,$hfile['name']);
						}
						$this->data['AgentDoc']['intermediate_doc'] = implode(',',$kyc_doc);
					}
					else
						$this->data['AgentDoc']['intermediate_doc'] = $agent_doc_detail['AgentDoc']['intermediate_doc'];
					
					if(!empty($this->data['AgentDoc']['experience_doc'][0]['name']))
					{
						$exp_doc = array();
						foreach($this->data['AgentDoc']['experience_doc'] as $key => $val)
						{
							$hfile = $this->File->uploadFile($this->data['AgentDoc']['experience_doc'][$key], PATIENT_AGENT_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
							array_push($exp_doc,$hfile['name']);
						}
						$this->data['AgentDoc']['experience_doc'] = implode(',',$exp_doc);
					}
					else
						$this->data['AgentDoc']['experience_doc'] = $agent_doc_detail['AgentDoc']['experience_doc'];
					//print_R($this->data);
					//die;
					$this->data['AgentDoc']['id'] = $agent_doc_detail['AgentDoc']['id'];
					$this->data['AgentDoc']['agent_id'] = $this->data['Agent']['id'];
					
					$this->AgentDoc->create();
					$this->AgentDoc->save($this->data,false);
					
					$this->Session->setFlash('Agent details updated successfully','flash_success');
					$this->redirect(array('controller'=>'samples','action'=>'view_agent'));
				}
			}
		}
		else
		{
			$agent_doc_detail = $this->AgentDoc->find('first',array('conditions'=>array('AgentDoc.agent_id'=>$id_dec)));
			$agent_detail = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$id_dec)));
			$this->data = $agent_detail;
			$this->data['AgentDoc']['display_pic'] = $agent_doc_detail['AgentDoc']['display_pic'];
			$this->data['AgentDoc']['metric_doc'] = $agent_doc_detail['AgentDoc']['metric_doc'];
			$this->data['AgentDoc']['intermediate_doc'] = $agent_doc_detail['AgentDoc']['intermediate_doc'];
			$this->data['AgentDoc']['experience_doc'] = $agent_doc_detail['AgentDoc']['experience_doc'];
		}
		$agent_type = array('1'=>'Agent','2'=>'Runner','3'=>'Both');
		$this->set('agent_type',$agent_type);
		$city_list = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city_list',$city_list);
	}

	function admin_assign_agent()
	{
		$dd = $this->Session->read('Admin.id');
		$agent_value = $_REQUEST['agent_id'];
		$id = $_REQUEST['id'];
		$h_array = array(14,11,12,5,8,7,6,9);
		
		$req_info1 = $this->Health->find('first',array('conditions'=>array('Health.id'=>$id)));
		
		if(!in_array($req_info1['Health']['requ_status'],$h_array))
		{
			$update = $this->Health->query("UPDATE healths SET agent_id='$agent_value',requ_status='4' WHERE id='".$id."'");
			
			if($this->Utility->check_push_notification_for_pcc($req_info1['Health']['created_by'],$req_info1['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($id);
			}			
		}
		else
		{
			$update = $this->Health->query("UPDATE healths SET agent_id='$agent_value' WHERE id='".$id."'");
		}
		$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$id)));
		$assigned_agent_name = $this->Health->find('first',array('conditions'=>array('Health.id'=>$id)));
		if(!empty($assigned_agent_name['Health']['agent_id']))
		{
			$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$assigned_agent_name['Health']['agent_id'])));
			$this->_activity_log($dd, $id,'Order Assigned To '.$agent_name['Agent']['name']);	
			if($req_info['Health']['city_id'] != 0)
			{
				$number = $agent_name['Agent']['contact'];
				if($req_info['Health']['assigned_lab'] != 'Home')
				{
					$get_pcc_number = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['assigned_lab'])));
					$pcc_helpdesk_num = $get_pcc_number['Lab']['pcc_contact'];
				}
				else
				{
					$pcc_helpdesk_num = '+91-9555009009';
				}
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.name')));
				$collect_date = $req_info['Health']['sample_date1'];
				$collect_time = $timelabs[$req_info['Health']['sample_time1']];						
				$pat_name = strtoupper($req_info['Health']['name']);
				$age = $req_info['Health']['age'].' Yrs';
				$landline_num = $req_info['Health']['landline'];
				$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$req_info['Health']['city_id'])));
				$state_name = $this->State->find('first',array('conditions'=>array('State.id'=>$req_info['Health']['state'])));
				$address = str_replace('*',',',$req_info['Health']['address']).','.$req_info['Health']['locality'].','.$city_name['City']['name'].','.$state_name['State']['name'].','.$req_info['Health']['pincode'].','.$req_info['Health']['landmark'];
				$tests_arr = array();

				$sample_id = array(); 

				if(!empty($req_info['Health']['test_id']))
				{
					$expl_test = explode(',',$req_info['Health']['test_id']);
					foreach($expl_test as $k => $v)
					{
						$find_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v)));
						$tests_arr[] = $find_test['Test']['testcode'].' - '.$find_test['Test']['test_parameter'];
						array_push($sample_id,$find_test['Test']['sample']);
					}
				}
				if(!empty($req_info['Health']['profile_id']))
				{
					$expl_profile = explode(',',$req_info['Health']['profile_id']);
					foreach($expl_profile as $k => $v)
					{
						$find_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v)));
						$tests_arr[] = $find_profile['Test']['testcode'].' - '.$find_profile['Test']['test_parameter'];
						array_push($sample_id,$find_test['Test']['sample']);
					}
				}
				if(!empty($req_info['Health']['offer_id']))
				{
					$expl_offer = explode(',',$req_info['Health']['offer_id']);
					foreach($expl_offer as $k => $v)
					{
						$find_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v)));
						$tests_arr[] = $find_offer['Banner']['banner_code'].' - '.$find_offer['Banner']['banner_name'];
					}
				}
				if(!empty($req_info['Health']['package_id']))
				{
					$expl_package = explode(',',$req_info['Health']['package_id']);
					foreach($expl_package as $k => $v)
					{
						$find_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v)));
						$tests_arr[] = $find_package['Package']['package_code'].' - '.$find_package['Package']['package_name'];
					}
				}

				$sample_type = $this->Samplemaster->query("select shortname from sample_type_master where sample_id in (".implode(',',$sample_id).")");			
				$sample_text = "";
				if(!empty($sample_type))
				{
					$sample_array = array();
					foreach($sample_type as $val)
					{
						array_push($sample_array,$val['sample_type_master']['shortname']);
					}	
					$sample_text = "Sample Type to be collected - ".implode(',',$sample_array);
				}
				
				$tests = implode(',',$tests_arr);
				$total_amt = 'Rs.'.$req_info['Health']['total_amount'];
				$get_req_number = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$req_info['Health']['id'])));
				$message = 'Test Req. No: ('.$get_req_number['Billing']['order_id'].') has been assigned to you. Call & confirm your availability on '.$pcc_helpdesk_num.' within 1 hr. Test details: '.$collect_date.' '.$collect_time.' '.$pat_name.' '.$landline_num.' '.$age.' '.$address.' '.$pat_landmark_sms.' '.$tests.' for '.$total_amt.'. '.$sample_text;
				$this->__sms_message($number,$message);
			}
			echo $agent_name['Agent']['name'].','.$id.",".$req_info['Health']['requ_status'];
			exit;
		}
		else
		{
			echo "error_not_updated";
			exit;
		}
	}

	function admin_agent_list()
	{
		$id = $_REQUEST['id'];
		$agent_list = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
		$x['success'] = 'success';
		$x['row_id'] = $id;
		$x['agent_list'] = $agent_list;
		$m['agent_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_view_pat_details($pat_id=NULL,$assign=NULL,$lab=NULL)
	{
		$this->set('title_for_layout','View Patient Details');
		$dec_pat_id = base64_decode($pat_id);
		$request_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$dec_pat_id)));
		if(!empty($request_details))
		{
			//echo "<pre>"; print_r($request_details); exit;
			if($request_details['Health']['gender'] == 1)
			{
				$gender = 'Male';
			}
			if($request_details['Health']['gender'] == 2)
			{
				$gender = 'Female';
			}
			if(!empty($request_details['Health']['test_id']))
			{
				$explode_test = explode(',',$request_details['Health']['test_id']);
				$count_test = count($explode_test);
				if($count_test == 1)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'];
				}
				if($count_test == 2)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'];
				}
				if($count_test == 3)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'];
				}
				if($count_test == 4)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'];
				}
				if($count_test == 5)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'];
				}
				if($count_test == 6)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'];
				}
				if($count_test == 7)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'];
				}
				if($count_test == 8)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'];
				}
				if($count_test == 9)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['test_parameter'];
				}
				if($count_test == 10)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
					$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['test_parameter'].'<br>'.'<strong>10-</strong> '.$test_10['Test']['test_parameter'];
				}
				foreach($explode_test as $kk => $vv)
				{
					$request_det['Health']['test_id'][] = $vv;
				}
			}
			if(!empty($request_details['Health']['profile_id']))
			{
				$explode_profile = explode(',',$request_details['Health']['profile_id']);
				$count_profile = count($explode_profile);
				if($count_profile == 1)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'];
				}
				if($count_profile == 2)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'];
				}
				if($count_profile == 3)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'];
				}
				if($count_profile == 4)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'];
				}
				if($count_profile == 5)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'];
				}
				if($count_profile == 6)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'];
				}
				if($count_profile == 7)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'];
				}
				if($count_profile == 8)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'];
				}
				if($count_profile == 9)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['test_parameter'];
				}
				if($count_profile == 10)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
					$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['test_parameter'].'<br>'.'<strong>10-</strong> '.$profile_10['Test']['test_parameter'];
				}
				foreach($explode_profile as $kkk => $vvv)
				{
					$request_det['Health']['profile_id'][] = $vvv;
				}
			}
			if($request_details['Health']['city_id'] != 0)
			{
				$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
				$request_det['Health']['city_id'] = $city_name['City']['name'];
			}
			else
			{
				$request_det['Health']['city_id'] = 'No City';
			}
			if($request_details['Health']['opted_for_id'] != 0)
			{
				$test_front = $this->Test->find('first',array('conditions'=>array('Test.id'=>$request_details['Health']['opted_for_id'])));
				$test_name = '<strong>1-</strong> '.$test_front['Test']['test_parameter'];
			}
			$visit_lab_1 = $request_details['Health']['city'];
			$visit_lab_2 = $request_details['Health']['sample_time'];
			$visit_lab_3 = $request_details['Health']['sample_date'];
			$home_collection_1 = $request_details['Health']['sample_time1'];
			$home_collection_2 = $request_details['Health']['sample_date1'];
			$home_collection_3 = $request_details['Health']['address'];
			$request_det['Health']['id'] = $request_details['Health']['id'];
			$request_det['Health']['patient_name'] = strtoupper($request_details['Health']['name']);
			$request_det['Health']['gender'] = $gender;
			$request_det['Health']['age'] = $request_details['Health']['age'].' Years';
			$request_det['Health']['contact'] = $request_details['Health']['landline'];
			$request_det['Health']['email'] = $request_details['Health']['email'];
			$request_det['Health']['address'] = $request_details['Health']['address1'];
			$request_det['Health']['test_names'] = $test_name;
			$request_det['Health']['profile_names'] = $profile_name;
			$request_det['Health']['remarks'] = $request_details['Health']['remarks'];
			$this->Timelab = ClassRegistry::init('Timelab');
			$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
			if(($visit_lab_1 != '' && $visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == '' && $home_collection_3 == ''))
			{
				$request_det['Health']['visit_lab_location'] = $visit_lab_1;
				$visit_time = $timelabs[$visit_lab_2];						
				$request_det['Health']['visit_lab_collect_time'] = $visit_time;
				$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
			}
			if(($home_collection_1 != '' && $home_collection_2 != '' && $home_collection_3 != '') && ($visit_lab_1 == '' && $visit_lab_2 == '' && $visit_lab_3 == ''))
			{
				$collect_time = $timelabs[$home_collection_1];	
				$request_det['Health']['home_collect_time'] = $collect_time;
				$request_det['Health']['home_collect_date'] = $home_collection_2;
				$request_det['Health']['home_collect_address'] = $home_collection_3;
			}
			if(($visit_lab_1 != '' && $visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date' && $home_collection_3 == 'Please enter your residential address'))
			{
				$request_det['Health']['visit_lab_location'] = $visit_lab_1;
				$visit_time = $timelabs[$visit_lab_2];	
				$request_det['Health']['visit_lab_collect_time'] = $visit_time;
				$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
			}
			if(($home_collection_1 != '' && $home_collection_2 != '' && $home_collection_3 != '') && ($visit_lab_1 == '' && $visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
			{
				$collect_time = $timelabs[$home_collection_1];	
				$request_det['Health']['home_collect_time'] = $collect_time;
				$request_det['Health']['home_collect_date'] = $home_collection_2;
				$request_det['Health']['home_collect_address'] = $home_collection_3;
			}
			$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
			$request_det['Health']['contact'] = $contact['User']['contact'];
			$request_det['Health']['remark'] = $request_details['Health']['remark'];
			$request_det['Health']['pay_status'] = $request_details['Health']['pay_status'];
			$request_det['Health']['patient_report'] = $request_details['Health']['patient_report'];
			$request_det['Health']['opted_id'] = $request_details['Health']['opted_for_id'];
			$this->data = $request_det;
		}
		else
		{
			$this->Session->setFlash('Invalid Request','flash_failure');
			$this->redirect(array('controller'=>'samples','action'=>'home'));
		}
		$this->set('assign',$assign);
		$this->set('labtype',$lab);
	}

	function admin_filter_page()
	{
		$this->Session->delete('agent_list');
		/*if(isset($this->params['named']['agent']) && $this->params['named']['agent']!='')
		{
		$this->data['Filter']['agent_id'] = $this->params['named']['agent'];
		$options['agent'] = $this->params['named']['agent'];
		}
		if(isset($this->params['named']['city']) && $this->params['named']['city']!='')
		{
		$this->data['Filter']['city_id'] = $this->params['named']['city'];
		$options['city'] = $this->params['named']['city'];
		}
		if(isset($this->params['named']['from']) && $this->params['named']['from']!='')
		{
		$this->data['Filter']['from_date'] = $this->params['named']['from'];
		$options['from'] = $this->params['named']['from'];
		}
		if(isset($this->params['named']['to']) && $this->params['named']['to']!='')
		{
		$this->data['Filter']['to_date'] = $this->params['named']['to'];
		$options['to'] = $this->params['named']['from'];
		}*/
		if(!empty($this->data))
		{
			//echo "<pre>"; print_r($this->data); exit;
			$agent = $this->data['Filter']['agent_id'];
			$city = $this->data['Filter']['city_id'];
			$from_date = $this->data['Filter']['from_date'];
			$to_date = $this->data['Filter']['to_date'];
			$conditions['Health.assigned_lab'] = 'Home';
			if(!empty($agent) && isset($agent))
			{
				$conditions['Health.agent_id'] = $agent;
				//$options['agent'] = $agent;
			}
			if(!empty($city) && isset($city))
			{
				$conditions['Health.city_id'] = $city;
				//$options['city'] = $city;
			}
			if(($from_date != 'From Date') && isset($from_date))
			{
				$conditions['Health.sample_date1 >='] = $from_date;
				//$options['from'] = $from_date;
			}
			if(($to_date != 'To Date') && isset($to_date))
			{
				$conditions['Health.sample_date1 <='] = $to_date;
				//$options['to'] = $to_date;
			}
			//$this->paginate = array('Health' => array('limit' =>'10','order'=>array('Health.sample_date1'=>'DESC'),'conditions'=>$conditions));
			$samplerequestlist = $this->Health->find('all',array('conditions'=>$conditions,'order'=>array('Health.sample_date1'=>'DESC')));
			$this->set('agent_id',$agent);
			$this->set('city_id',$city);
			$this->set('from_date',$from_date);
			$this->set('to_date',$to_date);
			//$this->set('options',$options);
		}
		else
		{
			$this->redirect('/admin/samples/home');
		}
		//$samplerequestlist=$this->paginate('Health');
		$j = 0;
		foreach($samplerequestlist as $key => $val)
		{
			$_SESSION['agent_list'][] = $val['Health']['id'];
			$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['city_id'])));
			$samplerequestlist[$j]['Health']['city_name'] = $city_name['City']['name'];
			$test_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val['Sample']['test_id'])));
			$samplerequestlist[$j]['Sample']['test_name'] = $test_name['Test']['test_parameter'];
			if($val['Health']['agent_id'] == 0)
			{
				$samplerequestlist[$j]['Health']['agent_name'] = 'No';
			}
			else
			{
				$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$val['Health']['agent_id'])));
				$samplerequestlist[$j]['Health']['agent_name'] = $agent_name['Agent']['name'];
			}
			$j++;
		}
		$city_names = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city_names);
		$agent_list = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
		$this->set('agent_list',$agent_list);
		$this->set('samplerequestlist',$samplerequestlist);
	}

	function admin_send_email_agent($agent_id = NULL)
	{
		$k = 0;
		$agent_list = array();
		foreach($_SESSION['agent_list'] as $key => $val)
		{
			$health = $this->Health->find('first',array('conditions'=>array('Health.id'=>$val)));
			$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$health['Health']['agent_id'])));
			if($health['Health']['gender'] == 1)
			{
				$gender = 'Male';
			}
			if($health['Health']['gender'] == 2)
			{
				$gender = 'Female';
			}
			$home_collection_1 = $health['Health']['sample_time1'];
			$home_collection_2 = $health['Health']['sample_date1'];
			$home_collection_3 = $health['Health']['address'];
			$this->Timelab = ClassRegistry::init('Timelab');
			$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
			if(($home_collection_1 != '' && $home_collection_2 != '' && $home_collection_3 != ''))
			{
				$collect_time = $timelabs[$home_collection_1];						
				$agent_list[$k]['agent_summary']['s_collectiontime'] = $collect_time;
				$agent_list[$k]['agent_summary']['s_collectiondate'] = $home_collection_2;
				$agent_list[$k]['agent_summary']['s_collectionadd'] = $home_collection_3;
			}
			$agent_list[$k]['agent_summary']['s_name'] = strtoupper($health['Health']['name']);
			$agent_list[$k]['agent_summary']['s_gender'] = $gender;
			$agent_list[$k]['agent_summary']['s_age'] = $health['Health']['age'];
			$agent_list[$k]['agent_summary']['agent_name'] = $agent_name['Agent']['name'];
			$update_print_status = $this->Health->query("UPDATE healths SET print_status='1' WHERE id='".$val."'");
			$k++;
		}
		$m = 0;
		foreach($_SESSION['agent_list'] as $key => $val)
		{
			$request_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$val)));
			if($request_details['Health']['gender'] == 1)
			{
				$gender = 'Male';
			}
			if($request_details['Health']['gender'] == 2)
			{
				$gender = 'Female';
			}
			if(!empty($request_details['Health']['test_id']))
			{
				$explode_test = explode(',',$request_details['Health']['test_id']);
				$count_test = count($explode_test);
				if($count_test == 1)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'];
				}
				if($count_test == 2)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'];
				}
				if($count_test == 3)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'];
				}
				if($count_test == 4)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'];
				}
				if($count_test == 5)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'];
				}
				if($count_test == 6)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'];
				}
				if($count_test == 7)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'];
				}
				if($count_test == 8)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'];
				}
				if($count_test == 9)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['test_parameter'];
				}
				if($count_test == 10)
				{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
					$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['test_parameter'].'<br>'.'<strong>10-</strong> '.$test_10['Test']['test_parameter'];
				}
			}
			if(!empty($request_details['Health']['profile_id']))
			{
				$explode_profile = explode(',',$request_details['Health']['profile_id']);
				$count_profile = count($explode_profile);
				if($count_profile == 1)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'];
				}
				if($count_profile == 2)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'];
				}
				if($count_profile == 3)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'];
				}
				if($count_profile == 4)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'];
				}
				if($count_profile == 5)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'];
				}
				if($count_profile == 6)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'];
				}
				if($count_profile == 7)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'];
				}
				if($count_profile == 8)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'];
				}
				if($count_profile == 9)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['test_parameter'];
				}
				if($count_profile == 10)
				{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
					$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['test_parameter'].'<br>'.'<strong>10-</strong> '.$profile_10['Test']['test_parameter'];
				}
			}
			if($request_details['Health']['city_id'] != 0)
			{
				$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
				$request_det[$m]['Health']['city_id'] = $city_name['City']['name'];
			}
			else
			{
				$request_det[$m]['Health']['city_id'] = 'No City';
			}
			if($request_details['Health']['opted_for_id'] != 0)
			{
				$test_front = $this->Test->find('first',array('conditions'=>array('Test.id'=>$request_details['Health']['opted_for_id'])));
				$test_name = '<strong>1-</strong> '.$test_front['Test']['test_parameter'];
			}
			$visit_lab_1 = $request_details['Health']['city'];
			$visit_lab_2 = $request_details['Health']['sample_time'];
			$visit_lab_3 = $request_details['Health']['sample_date'];
			$home_collection_1 = $request_details['Health']['sample_time1'];
			$home_collection_2 = $request_details['Health']['sample_date1'];
			$home_collection_3 = $request_details['Health']['address'];
			$request_det[$m]['Health']['id'] = $request_details['Health']['id'];
			$request_det[$m]['Health']['patient_name'] = strtoupper($request_details['Health']['name']);
			$request_det[$m]['Health']['gender'] = $gender;
			$request_det[$m]['Health']['age'] = $request_details['Health']['age'];
			$request_det[$m]['Health']['contact'] = $request_details['Health']['landline'];
			$request_det[$m]['Health']['email'] = $request_details['Health']['email'];
			$request_det[$m]['Health']['address'] = $request_details['Health']['address1'];
			$request_det[$m]['Health']['test_names'] = $test_name;
			$request_det[$m]['Health']['profile_names'] = $profile_name;
			$request_det[$m]['Health']['remarks'] = $request_details['Health']['remarks'];
			$this->Timelab = ClassRegistry::init('Timelab');
			$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
			if(($visit_lab_1 != '' && $visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == '' && $home_collection_3 == ''))
			{
				$visit_time = $timelabs[$visit_lab_2];						
				$request_det[$m]['Health']['visit_lab_location'] = $visit_lab_1;
				$request_det[$m]['Health']['visit_lab_collect_time'] = $visit_time;
				$request_det[$m]['Health']['visit_lab_collect_date'] = $visit_lab_3;
			}
			if(($home_collection_1 != '' && $home_collection_2 != '' && $home_collection_3 != '') && ($visit_lab_1 == '' && $visit_lab_2 == '' && $visit_lab_3 == ''))
			{
				$collect_time = $timelabs[$home_collection_1];						
				$request_det[$m]['Health']['home_collect_time'] = $collect_time;
				$request_det[$m]['Health']['home_collect_date'] = $home_collection_2;
				$request_det[$m]['Health']['home_collect_address'] = $home_collection_3;
			}
			if(($visit_lab_1 != '' && $visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date' && $home_collection_3 == 'Please enter your residential address'))
			{
				$request_det[$m]['Health']['visit_lab_location'] = $visit_lab_1;
				$visit_time = $timelabs[$visit_lab_2];						
				$request_det[$m]['Health']['visit_lab_collect_time'] = $visit_time;
				$request_det[$m]['Health']['visit_lab_collect_date'] = $visit_lab_3;
			}
			if(($home_collection_1 != '' && $home_collection_2 != '' && $home_collection_3 != '') && ($visit_lab_1 == '' && $visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
			{
				$collect_time = $timelabs[$home_collection_1];						
				$request_det[$m]['Health']['home_collect_time'] = $collect_time;
				$request_det[$m]['Health']['home_collect_date'] = $home_collection_2;
				$request_det[$m]['Health']['home_collect_address'] = $home_collection_3;
			}
			$request_det[$m]['Health']['remark'] = $request_details['Health']['remark'];
			$request_det[$m]['Health']['pay_status'] = $request_details['Health']['pay_status'];
			$request_det[$m]['Health']['patient_report'] = $request_details['Health']['patient_report'];
			$request_det[$m]['Health']['opted_id'] = $request_details['Health']['opted_for_id'];
			$m++;
		}
		$agent_detail = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$agent_id)));
		$this->set('agent_list' , $agent_list );
		$this->set('request_det' , $request_det );
		$this->Email->template = 'collection_request';
		$this->Email->from = '';
		$this->Email->fromName = 'Home Collection Admin';
		$this->Email->subject = 'Home Collection Requests';
		$this->Email->to = $agent_detail['Agent']['email'];
		//Send as 'html', 'text' or 'both' (default is 'text')
		$this->Email->sendAs = 'html'; // because we like to send pretty mail
		$this->Email->delivery = 'mail';
		if($this->Email->send())
		{
			foreach($_SESSION['agent_list'] as $key => $val)
			{
				$update_request_status = $this->Health->query("UPDATE healths SET print_status='1' WHERE id='".$val."'");
			}
			$this->Session->setFlash('Email send successfully to agent','flash_failure');
			$this->redirect('/admin/samples/home/SG9tZQ==/Assign');
		}
	}

	function admin_print_list()
	{
		$this->layout = false;
		if(empty($_SESSION['agent_list']))
		{
			$this->redirect('/admin/samples/home/SG9tZQ==/Assign');
		}
		else
		{
			$k = 0;
			$agent_list = array();
			foreach($_SESSION['agent_list'] as $key => $val)
			{
				$health = $this->Health->find('first',array('conditions'=>array('Health.id'=>$val)));
				$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$health['Health']['agent_id'])));
				if($health['Health']['gender'] == 1)
				{
					$gender = 'Male';
				}
				if($health['Health']['gender'] == 2)
				{
					$gender = 'Female';
				}
				$home_collection_1 = $health['Health']['sample_time1'];
				$home_collection_2 = $health['Health']['sample_date1'];
				$home_collection_3 = $health['Health']['address'];
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
				if(($home_collection_1 != '' && $home_collection_2 != '' && $home_collection_3 != ''))
				{
					$collect_time = $timelabs[$home_collection_1];						
					$agent_list[$k]['agent_summary']['s_collectiontime'] = $collect_time;
					$agent_list[$k]['agent_summary']['s_collectiondate'] = $home_collection_2;
					$agent_list[$k]['agent_summary']['s_collectionadd'] = $home_collection_3;
				}
				$agent_list[$k]['agent_summary']['s_name'] = strtoupper($health['Health']['name']);
				$agent_list[$k]['agent_summary']['s_gender'] = $gender;
				$agent_list[$k]['agent_summary']['s_age'] = $health['Health']['age'];
				$agent_list[$k]['agent_summary']['agent_name'] = $agent_name['Agent']['name'];
				$update_print_status = $this->Health->query("UPDATE healths SET print_status='1' WHERE id='".$val."'");
				$k++;
			}
			$m = 0;
			foreach($_SESSION['agent_list'] as $key => $val)
			{
				$request_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$val)));
				if($request_details['Health']['gender'] == 1)
				{
					$gender = 'Male';
				}
				if($request_details['Health']['gender'] == 2)
				{
					$gender = 'Female';
				}
				if(!empty($request_details['Health']['test_id']))
				{
					$explode_test = explode(',',$request_details['Health']['test_id']);
					$count_test = count($explode_test);
					if($count_test == 1)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'];
					}
					if($count_test == 2)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'];
					}
					if($count_test == 3)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'];
					}
					if($count_test == 4)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
						$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'];
					}
					if($count_test == 5)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
						$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
						$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'];
					}
					if($count_test == 6)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
						$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
						$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
						$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'];
					}
					if($count_test == 7)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
						$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
						$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
						$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
						$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'];
					}
					if($count_test == 8)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
						$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
						$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
						$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
						$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
						$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'];
					}
					if($count_test == 9)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
						$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
						$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
						$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
						$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
						$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
						$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['test_parameter'];
					}
					if($count_test == 10)
					{
						$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
						$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
						$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
						$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
						$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
						$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
						$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
						$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
						$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
						$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
						$test_name = '<strong>1-</strong> '.$test_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['test_parameter'].'<br>'.'<strong>10-</strong> '.$test_10['Test']['test_parameter'];
					}
				}
				if(!empty($request_details['Health']['profile_id']))
				{
					$explode_profile = explode(',',$request_details['Health']['profile_id']);
					$count_profile = count($explode_profile);
					if($count_profile == 1)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'];
					}
					if($count_profile == 2)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'];
					}
					if($count_profile == 3)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'];
					}
					if($count_profile == 4)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
						$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'];
					}
					if($count_profile == 5)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
						$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
						$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'];
					}
					if($count_profile == 6)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
						$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
						$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
						$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'];
					}
					if($count_profile == 7)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
						$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
						$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
						$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
						$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'];
					}
					if($count_profile == 8)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
						$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
						$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
						$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
						$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
						$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'];
					}
					if($count_profile == 9)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
						$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
						$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
						$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
						$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
						$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
						$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['test_parameter'];
					}
					if($count_profile == 10)
					{
						$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
						$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
						$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
						$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
						$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
						$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
						$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
						$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
						$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
						$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
						$profile_name = '<strong>1-</strong> '.$profile_1['Test']['test_parameter'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['test_parameter'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['test_parameter'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['test_parameter'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['test_parameter'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['test_parameter'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['test_parameter'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['test_parameter'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['test_parameter'].'<br>'.'<strong>10-</strong> '.$profile_10['Test']['test_parameter'];
					}
				}
				if($request_details['Health']['city_id'] != 0)
				{
					$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
					$request_det[$m]['Health']['city_id'] = $city_name['City']['name'];
				}
				else
				{
					$request_det[$m]['Health']['city_id'] = 'No City';
				}
				if($request_details['Health']['opted_for_id'] != 0)
				{
					$test_front = $this->Test->find('first',array('conditions'=>array('Test.id'=>$request_details['Health']['opted_for_id'])));
					$test_name = '<strong>1-</strong> '.$test_front['Test']['test_parameter'];
				}
				$visit_lab_1 = $request_details['Health']['city'];
				$visit_lab_2 = $request_details['Health']['sample_time'];
				$visit_lab_3 = $request_details['Health']['sample_date'];
				$home_collection_1 = $request_details['Health']['sample_time1'];
				$home_collection_2 = $request_details['Health']['sample_date1'];
				$home_collection_3 = $request_details['Health']['address'];
				$request_det[$m]['Health']['id'] = $request_details['Health']['id'];
				$request_det[$m]['Health']['patient_name'] = strtoupper($request_details['Health']['name']);
				$request_det[$m]['Health']['gender'] = $gender;
				$request_det[$m]['Health']['age'] = $request_details['Health']['age'];
				$request_det[$m]['Health']['contact'] = $request_details['Health']['landline'];
				$request_det[$m]['Health']['email'] = $request_details['Health']['email'];
				$request_det[$m]['Health']['address'] = $request_details['Health']['address1'];
				$request_det[$m]['Health']['test_names'] = $test_name;
				$request_det[$m]['Health']['profile_names'] = $profile_name;
				$request_det[$m]['Health']['remarks'] = $request_details['Health']['remarks'];
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
				if(($visit_lab_1 != '' && $visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == '' && $home_collection_3 == ''))
				{
					$visit_time = $timelabs[$visit_lab_2];	
					$request_det[$m]['Health']['visit_lab_location'] = $visit_lab_1;
					$request_det[$m]['Health']['visit_lab_collect_time'] = $visit_time;
					$request_det[$m]['Health']['visit_lab_collect_date'] = $visit_lab_3;
				}
				if(($home_collection_1 != '' && $home_collection_2 != '' && $home_collection_3 != '') && ($visit_lab_1 == '' && $visit_lab_2 == '' && $visit_lab_3 == ''))
				{
					$collect_time = $timelabs[$home_collection_1];	
					$request_det[$m]['Health']['home_collect_time'] = $collect_time;
					$request_det[$m]['Health']['home_collect_date'] = $home_collection_2;
					$request_det[$m]['Health']['home_collect_address'] = $home_collection_3;
				}
				if(($visit_lab_1 != '' && $visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date' && $home_collection_3 == 'Please enter your residential address'))
				{
					$visit_time = $timelabs[$visit_lab_2];	
					$request_det[$m]['Health']['visit_lab_location'] = $visit_lab_1;
					
					$request_det[$m]['Health']['visit_lab_collect_time'] = $visit_time;
					$request_det[$m]['Health']['visit_lab_collect_date'] = $visit_lab_3;
				}
				if(($home_collection_1 != '' && $home_collection_2 != '' && $home_collection_3 != '') && ($visit_lab_1 == '' && $visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
				{
					$collect_time = $timelabs[$home_collection_1];	
					$request_det[$m]['Health']['home_collect_time'] = $collect_time;
					$request_det[$m]['Health']['home_collect_date'] = $home_collection_2;
					$request_det[$m]['Health']['home_collect_address'] = $home_collection_3;
				}
				$request_det[$m]['Health']['remark'] = $request_details['Health']['remark'];
				$request_det[$m]['Health']['pay_status'] = $request_details['Health']['pay_status'];
				$request_det[$m]['Health']['patient_report'] = $request_details['Health']['patient_report'];
				$request_det[$m]['Health']['opted_id'] = $request_details['Health']['opted_for_id'];
				$m++;
			}
		}
		//echo "<pre>"; print_r($agent_list); exit;
		$this->set('agent_list',$agent_list);
		$this->set('request_det',$request_det);
		$this->Session->delete('agent_list');
	}

	function admin_request_status($req_id = NULL)
	{
		$dec_req_id = base64_decode($req_id);
		$health = $this->Health->find('first',array('conditions'=>array('Health.id'=>$dec_req_id)));
		if(!empty($this->data))
		{
			//echo "<pre>"; print_r($this->data); exit;
			if(!empty($this->data['Health']['patient_report']['name']))
			{
				$hfile = $this->File->uploadFile($this->data['Health']['patient_report'], PATIENT_REPORT_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
				$report_name = $hfile['name'];
			}
			if(!empty($this->data['Health']['patient_report_new']['name']))
			{
				$hfile = $this->File->uploadFile($this->data['Health']['patient_report_new'], PATIENT_REPORT_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
				$report_name = $hfile['name'];
				$this->File->deleteFile(PATIENT_REPORT_STORE_PATH.$this->data['Health']['old_report']);
			}
			if(!empty($this->data['Health']['old_time']))
			{
				$old_time = $this->data['Health']['old_time'];
				$reschduled_time = $this->data['Health']['sample_time1'];
			}
			else
			{
				$old_time = '';
			}
			if(!empty($this->data['Health']['old_date']))
			{
				$old_date = date('Y-m-d',strtotime($this->data['Health']['old_date']));
				$reschduled_date = date('d-m-Y',strtotime($this->data['Health']['sample_date1']));
			}
			else
			{
				$old_date = '0000-00-00';
			}
			if(!empty($this->data['Health']['cancelled_reason_new']))
			{
				$cancelled_reason = $this->data['Health']['cancelled_reason_new'];
			}
			else
			{
				$cancelled_reason = $this->data['Health']['cancelled_reason'];
			}
			if(!empty($this->data['Health']['published_reason_new']))
			{
				$published_reason = $this->data['Health']['published_reason_new'];
			}
			else
			{
				$published_reason = $this->data['Health']['published_reason'];
			}
			$trf_status = $this->data['Health']['trf_status'];
			$sent_pathcorp = $this->data['Health']['sent_pathcorp'];
			$receive_pathcorp = $this->data['Health']['receive_pathcorp'];
			$reschduled = $this->data['Health']['reschduled'];
			$cancelled_status = $this->data['Health']['cancelled_status'];
			$published = $this->data['Health']['published'];
			if(!empty($this->data['Health']['old_time']) && !empty($this->data['Health']['old_date']) && !empty($report_name))
			{
				$update_query = $this->Health->query("UPDATE healths SET patient_report='$report_name',trf_status='$trf_status',sent_pathcorp='$sent_pathcorp',receive_pathcorp='$receive_pathcorp',reschduled='$reschduled',sample_time1='$reschduled_time',sample_date1='$reschduled_date',old_date='$old_date',old_time='$old_time',cancelled_status='$cancelled_status',cancelled_reason='$cancelled_reason',published='$published',published_reason='$published_reason' WHERE id='".$dec_req_id."'");
				$update_print_status = $this->Health->query("UPDATE healths SET print_status='2' WHERE id='".$dec_req_id."'");
			}
			if(empty($this->data['Health']['old_time']) && empty($this->data['Health']['old_date']) && !empty($report_name))
			{
				$update_query = $this->Health->query("UPDATE healths SET patient_report='$report_name',trf_status='$trf_status',sent_pathcorp='$sent_pathcorp',receive_pathcorp='$receive_pathcorp',reschduled='$reschduled',cancelled_status='$cancelled_status',cancelled_reason='$cancelled_reason',published='$published',published_reason='$published_reason' WHERE id='".$dec_req_id."'");
				$update_print_status = $this->Health->query("UPDATE healths SET print_status='2' WHERE id='".$dec_req_id."'");
			}
			if(!empty($this->data['Health']['old_time']) && !empty($this->data['Health']['old_date']) && empty($report_name))
			{
				$update_query = $this->Health->query("UPDATE healths SET trf_status='$trf_status',sent_pathcorp='$sent_pathcorp',receive_pathcorp='$receive_pathcorp',reschduled='$reschduled',cancelled_status='$cancelled_status',cancelled_reason='$cancelled_reason',published='$published',published_reason='$published_reason' WHERE id='".$dec_req_id."'");
				$update_print_status = $this->Health->query("UPDATE healths SET print_status='2' WHERE id='".$dec_req_id."'");
			}
			if(empty($this->data['Health']['old_time']) && empty($this->data['Health']['old_date']) && empty($report_name))
			{
				$update_query = $this->Health->query("UPDATE healths SET trf_status='$trf_status',sent_pathcorp='$sent_pathcorp',receive_pathcorp='$receive_pathcorp',reschduled='$reschduled',cancelled_status='$cancelled_status',cancelled_reason='$cancelled_reason',published='$published',published_reason='$published_reason' WHERE id='".$dec_req_id."'");
				$update_print_status = $this->Health->query("UPDATE healths SET print_status='2' WHERE id='".$dec_req_id."'");
			}
			$this->Session->setFlash('Patient report uploaded successfully.','flash_success');
			$this->redirect('/admin/samples/request_status/'.$req_id);
		}
		$this->set('pat_name',strtoupper($health['Health']['name']));
		$this->set('pat_collecttime',$health['Health']['sample_time1']);
		$this->set('pat_collectdate',$health['Health']['sample_date1']);
		if(empty($health['Health']['patient_report']))
		{
			$this->set('report_status','not_uploaded');
		}
		if(!empty($health['Health']['patient_report']))
		{
			$this->set('report_name',$health['Health']['patient_report']);
			$this->set('report_status','uploaded');
		}
		$this->set('pat_trf_status',$health['Health']['trf_status']);
		$this->set('pat_sent_pathcorp',$health['Health']['sent_pathcorp']);
		$this->set('pat_receive_pathcorp',$health['Health']['receive_pathcorp']);
		$this->set('pat_reschduled',$health['Health']['reschduled']);
		$this->set('pat_cancelled_status',$health['Health']['cancelled_status']);
		$this->set('pat_cancelled_reason',$health['Health']['cancelled_reason']);
		$this->set('pat_published',$health['Health']['published']);
		$this->set('pat_published_reason',$health['Health']['published_reason']);
		$this->set('pat_sample_date1',$health['Health']['sample_date1']);
		$this->set('pat_sample_time1',$health['Health']['sample_time1']);
		$this->set('pat_old_date',$health['Health']['old_date']);
		$this->set('pat_old_time',$health['Health']['old_time']);
		$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
		$this->set('timelabs',$timelabs);
		$this->set('req_id',$req_id);
	}

	function admin_add_test_list()
	{
		$req_id = $_REQUEST['req_id'];
		$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$req_id)));
		echo $test_detail['Test']['id'].'*'.$test_detail['Test']['testcode'].'*'.$test_detail['Test']['test_parameter'].'*'.$test_detail['Test']['mrp'];
		exit;
	}

	function admin_add_profile_list()
	{
		$req_id = $_REQUEST['req_id'];
		$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$req_id)));
		echo $test_detail['Test']['id'].'*'.$test_detail['Test']['testcode'].'*'.$test_detail['Test']['test_parameter'].'*'.$test_detail['Test']['mrp'];
		exit;
	}

	function admin_add_offer_list()
	{
		$req_id = $_REQUEST['req_id'];
		$test_detail = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$req_id)));
		echo $test_detail['Banner']['id'].'*'.$test_detail['Banner']['banner_code'].'*'.$test_detail['Banner']['banner_name'].'*'.$test_detail['Banner']['banner_mrp'];
		exit;
	}

	function admin_add_package_list()
	{
		$req_id = $_REQUEST['req_id'];
		$test_detail = $this->Package->find('first',array('conditions'=>array('Package.id'=>$req_id)));
		echo $test_detail['Package']['id'].'*'.$test_detail['Package']['package_name'].'*'.$test_detail['Package']['package_mrp'];
		exit;
	}

	function admin_add_service_list()
	{
		$req_id = $_REQUEST['req_id'];
		$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$req_id)));
		echo $test_detail['Test']['id'].'*'.$test_detail['Test']['testcode'].'*'.$test_detail['Test']['test_parameter'].'*'.$test_detail['Test']['mrp'];
		exit;
	}

	function admin_search_user()
	{
        $this->layout="";
        $conditions=array();
        $admin_u_type = $this->Session->read('Admin.userType'); 
		if(($admin_u_type != 'A') && ($admin_u_type != 'BM') && ($admin_u_type != 'Agent'))
        { 
            $conditions['User.created_by']=$this->Session->read('Admin.labId');
        }
        $request_val = $_REQUEST['req_val'];
		if(!empty($request_val))
		{
            $conditions['or'][] = array('User.name LIKE' => '%'.$request_val.'%');
            $conditions['or'][] = array('User.contact LIKE'=>'%'.$request_val.'%');
            $conditions['or'][] = array('User.email LIKE'=>'%'.$request_val.'%');
            //$conditions['User.parent_child'] = 'parent';
			$find_user = $this->User->find('first',array('conditions'=>$conditions));
			if(!empty($find_user))
			{
				if($find_user['User']['parent_child']=='parent')
				{
					$x['user_list'] = $find_user;
					$x['success'] = 'success';
					$x['p_type'] = $find_user['User']['parent_child'];
					//print_R(json_encode($x));die;
				}
				if($find_user['User']['parent_child']=='child')
				{
					$parent_data = $this->User->find('first',array('conditions'=>array('User.id'=>$find_user['User']['parent_id'])));
					$x['user_list'] = $parent_data;
					$x['parent_id'] = $parent_data['User']['id'];
					$x['p_type'] = $find_user['User']['parent_child'];
					$x['success'] = 'success';
					$conditions['or'][] = array('User.id' => $find_user['User']['parent_id']);
		            $conditions['or'][] = array('User.parent_id '=>$find_user['User']['parent_id']);
					$user_type = $this->User->find('first',array('conditions'=>array('User.id'=>$find_user['User']['parent_id'])));
					
					if($user_type['User']['type']=='corporate')
					{
						$x['success'] = 'success';
						$m['p_user_type'] = $user_type['User']['type'];
					}
					elseif($user_type['User']['type']=='individual')
					{
						$subuser_data = $this->User->find('all',array('conditions'=>$conditions));
						$x['subuser_list'] = $subuser_data;
						$x['success'] = 'success';
						$m['p_user_type'] = $user_type['User']['type'];
					}
				}				
				
			}
			else
			{
                $find_user = $this->Billing->find('first',array('conditions'=>array('Billing.order_id'=>$request_val)));
                if(!empty($find_user))
                {
                    $find_user = $this->User->find('all',array('conditions'=>array('User.id'=>$find_user['Billing']['user_id'])));
                    if(!empty($find_user))
                    {
                        $x['user_list'] = $find_user;
                        $x['success'] = 'success';
                    }
                    else
                    {
                        $x['success'] = 'notsuccess';
                    }
                }
                else
                {
                    $x['success'] = 'notsuccess';
                }
            }
        }
        else
        {
                $x['success'] = 'notsuccessnull';
                
        }
        $m['user_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_check_phone()
	{
		$this->User = ClassRegistry::init('User');
		$user_data = $this->User->find('first',array('conditions'=>array('User.contact'=>$_REQUEST['contact'])));
		if($user_data)
			$x['success'] = 'Failure';
		else
			$x['success'] = 'Success';
		echo json_encode($x);
		die;
	}

	function admin_get_corporate_user_detail()
	{
		$name = $_REQUEST['name'];
		$parent_id = $_REQUEST['user_id'];
		$user_type = $this->User->find('all',array('conditions'=>array('User.parent_id'=>$parent_id,'User.name LIKE'=>'%'.$name.'%')));
		//print_R(json_encode($user_type));die;
		$content ='<option value="0">Select Sub User</option>';
		$content .='<option value="new_sub_patient">Add New Sub Patient</option>';
		foreach($user_type as $val)
		{
			$gender = "M";
			if($val['User']['gender']==2)
				$gender = "F";
			
			$content .= "<option value='".$val['User']['id']."'>".$val['User']['name']." ".$gender."/".$val['User']['age']."</option>";
		}
		print_R($content);
		$this->render(false);
	}

	function admin_search_subuser()
	{
        $this->layout="";
        $conditions=array();
        $admin_u_type = $this->Session->read('Admin.userType'); 
		if(($admin_u_type != 'A') && ($admin_u_type != 'BM') && ($admin_u_type != 'Agent'))
        { 
            $conditions['User.created_by']=$this->Session->read('Admin.labId');
        }
        $request_val = $_REQUEST['req_val'];
		if(!empty($request_val))
		{
            $conditions['or'][] = array('User.id' => $request_val);
            $conditions['or'][] = array('User.parent_id '=>$request_val);
			$user_type = $this->User->find('first',array('conditions'=>array('User.id'=>$request_val)));
			//print_R(json_encode($user_type));die;
			if($user_type['User']['type']=='corporate')
			{
				$x['success'] = 'success';
				$m['p_user_type'] = $user_type['User']['type'];
				$m['user_info'] = $x;	
			}
			elseif($user_type['User']['type']=='individual')
			{
				$find_user = $this->User->find('all',array('conditions'=>$conditions));
				$x['user_list'] = $find_user;
				$x['success'] = 'success';
				$m['p_user_type'] = $user_type['User']['type'];
				$m['user_info'] = $x;
			}
			else
			{
                $x['success'] = 'notsuccess';
                $m['user_info'] = $x;
            }
        }
        else
        {
                $x['success'] = 'notsuccessnull';
                $m['user_info'] = $x;
        }
		echo json_encode($m);
		exit;
	}
	
	function admin_get_user_detail()
	{
		$user_id = $_REQUEST['user_id'];
		$user_detail = $this->User->find('first',array('conditions'=>array('User.id'=>$user_id)));
		$explode_address = explode('*',$user_detail['User']['address']);
		if($explode_address[0] != '')
		{
			$x['add_line1'] = $explode_address[0];
		}
		if($explode_address[1] != '')
		{
			$x['add_line2'] = $explode_address[1];
		}
		$x['success'] = 'success';
		$x['user_data'] = $user_detail;
		$m['user_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_test()
	{
		$find_all_test = $this->Test->find('all',array('conditions'=>array('Test.status'=>1)));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_profile()
	{
		$find_all_test = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE')));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_offer()
	{
		$find_all_test = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1)));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_package()
	{
		$find_all_test = $this->Package->find('all',array('conditions'=>array('Package.status'=>1)));
		//echo "<pre>"; print_r($find_all_test); exit;
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_service()
	{
		$find_all_test = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'SERVICE')));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_test_cnf()
	{
		$curr_test = $_REQUEST['curr_test'];
		$req_id = $_REQUEST['req_id'];
		$home_report = $_REQUEST['home_report'];
		$disc_code = $_REQUEST['disc_code'];
		$get_all_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($curr_test))
		{
			$new_test = str_replace('*',',',$curr_test);
			$expl_test = explode(',',$new_test);
			$amt_test = 0;
			foreach($expl_test as $key => $val)
			{
				$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
				$amt_test = $amt_test;
				$find_entry = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'TE','RequestTest.health_id'=>$req_id,'RequestTest.test_id'=>$val,'RequestTest.test_book_date'=>$get_all_detail['Health']['book_date'])));
				if(empty($find_entry))
				{
					$this->data['RequestTest']['type'] = 'TE';
					$this->data['RequestTest']['health_id'] = $req_id;
					$this->data['RequestTest']['test_id'] = $find_mrp_test['Test']['id'];
					$this->data['RequestTest']['mrp'] = $find_mrp_test['Test']['mrp'];
					$this->data['RequestTest']['test_book_date'] = $get_all_detail['Health']['book_date'];
					$this->data['RequestTest']['status'] = 1;
					if($this->RequestTest->create($this->data))
					{
						$this->RequestTest->save($this->data);
					}
				}
			}
		}
		if(!empty($get_all_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_all_detail['Health']['profile_id']);
			$amt_profile = 0;
			foreach($expl_profile as $key => $val)
			{
				$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
				$amt_profile = $amt_profile;
			}
		}
		if(!empty($get_all_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_all_detail['Health']['offer_id']);
			$amt_offer = 0;
			foreach($expl_offer as $key => $val)
			{
				$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
				$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
				$amt_offer = $amt_offer;
			}
		}
		if(!empty($get_all_detail['Health']['package_id']))
		{
			$expl_package = explode(',',$get_all_detail['Health']['package_id']);
			$amt_pack = 0;
			foreach($expl_package as $key => $val)
			{
				$find_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
				$amt_pack = ($find_mrp['Package']['package_mrp']+$amt_pack);
				$amt_pack = $amt_pack;
			}
		}
		if(!empty($get_all_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_all_detail['Health']['service_id']);
			$amt_service = 0;
			foreach($expl_service as $key => $val)
			{
				$find_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_service = ($find_mrp_service['Test']['mrp']+$amt_service);
				$amt_service = $amt_service;
			}
		}
		if(!empty($curr_test) && !empty($req_id))
		{
			$new_update_tot_amt = ($amt_test+$amt_profile+$amt_offer+$amt_pack+$amt_service);
			$get_detail_request_current = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			if($get_detail_request_current['Health']['received_amount'] == 0)
			{
				$update_cur_row = $this->Health->query("UPDATE healths SET test_id='$new_test',total_amount='$new_update_tot_amt',balance_amount='$new_update_tot_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET test_id='$new_test',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if($get_detail_request_current['Health']['received_amount'] != 0)
			{
				$bal_amount = ($new_update_tot_amt - $get_detail_request_current['Health']['received_amount']);
				$update_cur_row = $this->Health->query("UPDATE healths SET test_id='$new_test',total_amount='$new_update_tot_amt',balance_amount='$bal_amount' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET test_id='$new_test',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if(!empty($disc_code))
			{
				$get_disc_info = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
				if($get_disc_info['Discount']['type'] == 'Percent')
				{
					$v_1 = ($get_disc_info['Discount']['amount']/100);
					$v_2 = ($new_update_tot_amt*$v_1);
					$v_3 = ($new_update_tot_amt-$v_2);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($v_3+50);
					}
					else
					{
						$new_update_tot_amt = $v_3;
					}
				}
				if($get_disc_info['Discount']['type'] == 'Rupees')
				{
					$new_update_tot_amt = ($new_update_tot_amt-$get_disc_info['Discount']['amount']);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($new_update_tot_amt+50);
					}
					else
					{
						$new_update_tot_amt = $new_update_tot_amt;
					}
				}
				if($get_all_detail['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_all_detail['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_all_detail['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET test_id='$new_test',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET test_id='$new_test' WHERE request_id='".$req_id."'");
			}
			if(!empty($get_all_detail['Health']['discount_amount']))
			{
				$get_update_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
				$new_update_tot_amt = ($new_update_tot_amt - $get_update_info['Health']['discount_amount']);
				if($get_update_info['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_update_info['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_update_info['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET test_id='$new_test',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET test_id='$new_test' WHERE request_id='".$req_id."'");
			}
		}
		$find_all_test = $this->Test->find('all',array('conditions'=>array('Test.status'=>1)));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_profile_cnf()
	{
		$curr_profile = $_REQUEST['curr_profile'];
		$req_id = $_REQUEST['req_id'];
		$home_report = $_REQUEST['home_report'];
		$disc_code = $_REQUEST['disc_code'];
		$get_all_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($curr_profile))
		{
			$new_profile = str_replace('*',',',$curr_profile);
			$expl_profile = explode(',',$new_profile);
			$amt_profile = 0;
			foreach($expl_profile as $key => $val)
			{
				$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
				$amt_profile = $amt_profile;
				$find_entry = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'PR','RequestTest.health_id'=>$req_id,'RequestTest.test_id'=>$val,'RequestTest.test_book_date'=>$get_all_detail['Health']['book_date'])));
				if(empty($find_entry))
				{
					$this->data['RequestTest']['type'] = 'PR';
					$this->data['RequestTest']['health_id'] = $req_id;
					$this->data['RequestTest']['test_id'] = $find_mrp_profile['Test']['id'];
					$this->data['RequestTest']['mrp'] = $find_mrp_profile['Test']['mrp'];
					$this->data['RequestTest']['test_book_date'] = $get_all_detail['Health']['book_date'];
					$this->data['RequestTest']['status'] = 1;
					if($this->RequestTest->create($this->data))
					{
						$this->RequestTest->save($this->data);
					}
				}
			}
		}
		if(!empty($get_all_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_all_detail['Health']['test_id']);
			$amt_test = 0;
			foreach($expl_test as $key => $val)
			{
				$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
				$amt_test = $amt_test;
			}
		}
		if(!empty($get_all_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_all_detail['Health']['offer_id']);
			$amt_offer = 0;
			foreach($expl_offer as $key => $val)
			{
				$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
				$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
				$amt_offer = $amt_offer;
			}
		}
		if(!empty($get_all_detail['Health']['package_id']))
		{
			$expl_package = explode(',',$get_all_detail['Health']['package_id']);
			$amt_pack = 0;
			foreach($expl_package as $key => $val)
			{
				$find_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
				$amt_pack = ($find_mrp['Package']['package_mrp']+$amt_pack);
				$amt_pack = $amt_pack;
			}
		}
		if(!empty($get_all_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_all_detail['Health']['service_id']);
			$amt_service = 0;
			foreach($expl_service as $key => $val)
			{
				$find_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_service = ($find_mrp_service['Test']['mrp']+$amt_service);
				$amt_service = $amt_service;
			}
		}
		if(!empty($curr_profile) && !empty($req_id))
		{
			$new_update_tot_amt = ($amt_test+$amt_profile+$amt_offer+$amt_pack+$amt_service);
			$get_detail_request_current = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			if($get_detail_request_current['Health']['received_amount'] == 0)
			{
				$update_cur_row = $this->Health->query("UPDATE healths SET profile_id='$new_profile',total_amount='$new_update_tot_amt',balance_amount='$new_update_tot_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET profile_id='$new_profile',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if($get_detail_request_current['Health']['received_amount'] != 0)
			{
				$bal_amount = ($new_update_tot_amt - $get_detail_request_current['Health']['received_amount']);
				$update_cur_row = $this->Health->query("UPDATE healths SET profile_id='$new_profile',total_amount='$new_update_tot_amt',balance_amount='$bal_amount' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET profile_id='$new_profile',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if(!empty($disc_code))
			{
				$get_disc_info = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
				if($get_disc_info['Discount']['type'] == 'Percent')
				{
					$v_1 = ($get_disc_info['Discount']['amount']/100);
					$v_2 = ($new_update_tot_amt*$v_1);
					$v_3 = ($new_update_tot_amt-$v_2);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($v_3+50);
					}
					else
					{
						$new_update_tot_amt = $v_3;
					}
				}
				if($get_disc_info['Discount']['type'] == 'Rupees')
				{
					$new_update_tot_amt = ($new_update_tot_amt-$get_disc_info['Discount']['amount']);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($new_update_tot_amt+50);
					}
					else
					{
						$new_update_tot_amt = $new_update_tot_amt;
					}
				}
				if($get_all_detail['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_all_detail['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_all_detail['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET profile_id='$new_profile',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET profile_id='$new_profile' WHERE request_id='".$req_id."'");
			}
			if(!empty($get_all_detail['Health']['discount_amount']))
			{
				$get_update_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
				$new_update_tot_amt = ($new_update_tot_amt - $get_update_info['Health']['discount_amount']);
				if($get_update_info['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_update_info['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_update_info['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET profile_id='$new_profile',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET profile_id='$new_profile' WHERE request_id='".$req_id."'");
			}
		}
		$find_all_test = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE')));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_offer_cnf()
	{
		$curr_offer = $_REQUEST['curr_offer'];
		$req_id = $_REQUEST['req_id'];
		$home_report = $_REQUEST['home_report'];
		$disc_code = $_REQUEST['disc_code'];
		//echo "<pre>"; print_r($_REQUEST); exit;
		$get_all_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($curr_offer))
		{
			$new_offer = str_replace('*',',',$curr_offer);
			$expl_offer = explode(',',$new_offer);
			$amt_offer = 0;
			foreach($expl_offer as $key => $val)
			{
				$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
				$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
				$amt_offer = $amt_offer;
				$find_entry = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'OF','RequestTest.health_id'=>$req_id,'RequestTest.test_id'=>$val,'RequestTest.test_book_date'=>$get_all_detail['Health']['book_date'])));
				if(empty($find_entry))
				{
					$this->data['RequestTest']['type'] = 'OF';
					$this->data['RequestTest']['health_id'] = $req_id;
					$this->data['RequestTest']['test_id'] = $find_mrp_offer['Banner']['id'];
					$this->data['RequestTest']['mrp'] = $find_mrp_offer['Banner']['banner_mrp'];
					$this->data['RequestTest']['test_book_date'] = $get_all_detail['Health']['book_date'];
					$this->data['RequestTest']['status'] = 1;
					if($this->RequestTest->create($this->data))
					{
						$this->RequestTest->save($this->data);
					}
				}
			}
		}
		if(!empty($get_all_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_all_detail['Health']['test_id']);
			$amt_test = 0;
			foreach($expl_test as $key => $val)
			{
				$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
				$amt_test = $amt_test;
			}
		}
		if(!empty($get_all_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_all_detail['Health']['profile_id']);
			$amt_profile = 0;
			foreach($expl_profile as $key => $val)
			{
				$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
				$amt_profile = $amt_profile;
			}
		}
		if(!empty($get_all_detail['Health']['package_id']))
		{
			$expl_package = explode(',',$get_all_detail['Health']['package_id']);
			$amt_pack = 0;
			foreach($expl_package as $key => $val)
			{
				$find_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
				$amt_pack = ($find_mrp['Package']['package_mrp']+$amt_pack);
				$amt_pack = $amt_pack;
			}
		}
		if(!empty($get_all_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_all_detail['Health']['service_id']);
			$amt_service = 0;
			foreach($expl_service as $key => $val)
			{
				$find_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_service = ($find_mrp_service['Test']['mrp']+$amt_service);
				$amt_service = $amt_service;
			}
		}
		if(!empty($curr_offer) && !empty($req_id))
		{
			$new_update_tot_amt = ($amt_test+$amt_profile+$amt_offer+$amt_pack+$amt_service);
			$get_detail_request_current = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			if($get_detail_request_current['Health']['received_amount'] == 0)
			{
				$update_cur_row = $this->Health->query("UPDATE healths SET offer_id='$new_offer',total_amount='$new_update_tot_amt',balance_amount='$new_update_tot_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET offer_id='$new_offer',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if($get_detail_request_current['Health']['received_amount'] != 0)
			{
				$bal_amount = ($new_update_tot_amt - $get_detail_request_current['Health']['received_amount']);
				$update_cur_row = $this->Health->query("UPDATE healths SET offer_id='$new_offer',total_amount='$new_update_tot_amt',balance_amount='$bal_amount' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET offer_id='$new_offer',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if(!empty($disc_code))
			{
				$get_disc_info = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
				if($get_disc_info['Discount']['type'] == 'Percent')
				{
					$v_1 = ($get_disc_info['Discount']['amount']/100);
					$v_2 = ($new_update_tot_amt*$v_1);
					$v_3 = ($new_update_tot_amt-$v_2);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($v_3+50);
					}
					else
					{
						$new_update_tot_amt = $v_3;
					}
				}
				if($get_disc_info['Discount']['type'] == 'Rupees')
				{
					$new_update_tot_amt = ($new_update_tot_amt-$get_disc_info['Discount']['amount']);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($new_update_tot_amt+50);
					}
					else
					{
						$new_update_tot_amt = $new_update_tot_amt;
					}
				}
				if($get_all_detail['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_all_detail['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_all_detail['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET offer_id='$new_offer',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET offer_id='$new_offer' WHERE request_id='".$req_id."'");
			}
			if(!empty($get_all_detail['Health']['discount_amount']))
			{
				$get_update_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
				$new_update_tot_amt = ($new_update_tot_amt - $get_update_info['Health']['discount_amount']);
				if($get_update_info['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_update_info['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_update_info['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET offer_id='$new_offer',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET offer_id='$new_offer' WHERE request_id='".$req_id."'");
			}
		}
		$find_all_test = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1)));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_package_cnf()
	{
		$curr_pack = $_REQUEST['curr_pack'];
		$req_id = $_REQUEST['req_id'];
		$home_report = $_REQUEST['home_report'];
		$disc_code = $_REQUEST['disc_code'];
		$get_all_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($curr_pack))
		{
			$new_pack = str_replace('*',',',$curr_pack);
			$expl_pack = explode(',',$new_pack);
			$amt_pack = 0;
			foreach($expl_pack as $key => $val)
			{
				$find_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
				$amt_pack = ($find_mrp['Package']['package_mrp']+$amt_pack);
				$amt_pack = $amt_pack;
				$find_entry = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'PA','RequestTest.health_id'=>$req_id,'RequestTest.test_id'=>$val,'RequestTest.test_book_date'=>$get_all_detail['Health']['book_date'])));
				if(empty($find_entry))
				{
					$this->data['RequestTest']['type'] = 'PA';
					$this->data['RequestTest']['health_id'] = $req_id;
					$this->data['RequestTest']['test_id'] = $find_mrp['Package']['id'];
					$this->data['RequestTest']['mrp'] = $find_mrp['Package']['package_mrp'];
					$this->data['RequestTest']['test_book_date'] = $get_all_detail['Health']['book_date'];
					$this->data['RequestTest']['status'] = 1;
					if($this->RequestTest->create($this->data))
					{
						$this->RequestTest->save($this->data);
					}
				}
			}
		}
		if(!empty($get_all_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_all_detail['Health']['test_id']);
			$amt_test = 0;
			foreach($expl_test as $key => $val)
			{
				$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
				$amt_test = $amt_test;
			}
		}
		if(!empty($get_all_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_all_detail['Health']['profile_id']);
			$amt_profile = 0;
			foreach($expl_profile as $key => $val)
			{
				$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
				$amt_profile = $amt_profile;
			}
		}
		if(!empty($get_all_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_all_detail['Health']['offer_id']);
			$amt_offer = 0;
			foreach($expl_offer as $key => $val)
			{
				$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
				$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
				$amt_offer = $amt_offer;
			}
		}
		if(!empty($get_all_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_all_detail['Health']['service_id']);
			$amt_service = 0;
			foreach($expl_service as $key => $val)
			{
				$find_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_service = ($find_mrp_service['Test']['mrp']+$amt_service);
				$amt_service = $amt_service;
			}
		}
		if(!empty($curr_pack) && !empty($req_id))
		{
			$new_update_tot_amt = ($amt_test+$amt_profile+$amt_offer+$amt_pack+$amt_service);
			$get_detail_request_current = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			if($get_detail_request_current['Health']['received_amount'] == 0)
			{
				$update_cur_row = $this->Health->query("UPDATE healths SET package_id='$new_pack',total_amount='$new_update_tot_amt',balance_amount='$new_update_tot_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET package_id='$new_pack',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if($get_detail_request_current['Health']['received_amount'] != 0)
			{
				$bal_amount = ($new_update_tot_amt - $get_detail_request_current['Health']['received_amount']);
				$update_cur_row = $this->Health->query("UPDATE healths SET package_id='$new_pack',total_amount='$new_update_tot_amt',balance_amount='$bal_amount' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET package_id='$new_pack',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if(!empty($disc_code))
			{
				$get_disc_info = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
				if($get_disc_info['Discount']['type'] == 'Percent')
				{
					$v_1 = ($get_disc_info['Discount']['amount']/100);
					$v_2 = ($new_update_tot_amt*$v_1);
					$v_3 = ($new_update_tot_amt-$v_2);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($v_3+50);
					}
					else
					{
						$new_update_tot_amt = $v_3;
					}
				}
				if($get_disc_info['Discount']['type'] == 'Rupees')
				{
					$new_update_tot_amt = ($new_update_tot_amt-$get_disc_info['Discount']['amount']);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($new_update_tot_amt+50);
					}
					else
					{
						$new_update_tot_amt = $new_update_tot_amt;
					}
				}
				if($get_all_detail['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_all_detail['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_all_detail['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET package_id='$new_pack',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET package_id='$new_pack' WHERE request_id='".$req_id."'");
			}
			if(!empty($get_all_detail['Health']['discount_amount']))
			{
				$get_update_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
				$new_update_tot_amt = ($new_update_tot_amt - $get_update_info['Health']['discount_amount']);
				if($get_update_info['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_update_info['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_update_info['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET package_id='$new_pack',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET package_id='$new_pack' WHERE request_id='".$req_id."'");
			}
		}
		$find_all_test = $this->Package->find('all',array('conditions'=>array('Package.status'=>1)));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_service_cnf()
	{
		$curr_service = $_REQUEST['curr_service'];
		$req_id = $_REQUEST['req_id'];
		$home_report = $_REQUEST['home_report'];
		$disc_code = $_REQUEST['disc_code'];
		$get_all_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($curr_service))
		{
			$new_service = str_replace('*',',',$curr_service);
			$expl_service = explode(',',$new_service);
			$amt_service = 0;
			foreach($expl_service as $key => $val)
			{
				$find_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_service = ($find_mrp_service['Test']['mrp']+$amt_service);
				$amt_service = $amt_service;
				$find_entry = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'SR','RequestTest.health_id'=>$req_id,'RequestTest.test_id'=>$val,'RequestTest.test_book_date'=>$get_all_detail['Health']['book_date'])));
				if(empty($find_entry))
				{
					$this->data['RequestTest']['type'] = 'SR';
					$this->data['RequestTest']['health_id'] = $req_id;
					$this->data['RequestTest']['test_id'] = $find_mrp_service['Test']['id'];
					$this->data['RequestTest']['mrp'] = $find_mrp_service['Test']['mrp'];
					$this->data['RequestTest']['test_book_date'] = $get_all_detail['Health']['book_date'];
					$this->data['RequestTest']['status'] = 1;
					if($this->RequestTest->create($this->data))
					{
						$this->RequestTest->save($this->data);
					}
				}
			}
		}
		if(!empty($get_all_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_all_detail['Health']['test_id']);
			$amt_test = 0;
			foreach($expl_test as $key => $val)
			{
				$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
				$amt_test = $amt_test;
			}
		}
		if(!empty($get_all_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_all_detail['Health']['profile_id']);
			$amt_profile = 0;
			foreach($expl_profile as $key => $val)
			{
				$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
				$amt_profile = $amt_profile;
			}
		}
		if(!empty($get_all_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_all_detail['Health']['offer_id']);
			$amt_offer = 0;
			foreach($expl_offer as $key => $val)
			{
				$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
				$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
				$amt_offer = $amt_offer;
			}
		}
		if(!empty($get_all_detail['Health']['package_id']))
		{
			$expl_package = explode(',',$get_all_detail['Health']['package_id']);
			$amt_pack = 0;
			foreach($expl_package as $key => $val)
			{
				$find_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
				$amt_pack = ($find_mrp['Package']['package_mrp']+$amt_pack);
				$amt_pack = $amt_pack;
			}
		}
		if(!empty($curr_service) && !empty($req_id))
		{
			$new_update_tot_amt = ($amt_test+$amt_profile+$amt_offer+$amt_pack+$amt_service);
			$get_detail_request_current = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			if($get_detail_request_current['Health']['received_amount'] == 0)
			{
				$update_cur_row = $this->Health->query("UPDATE healths SET service_id='$new_service',total_amount='$new_update_tot_amt',balance_amount='$new_update_tot_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET service_id='$new_service' WHERE request_id='".$req_id."'");
			}
			if($get_detail_request_current['Health']['received_amount'] != 0)
			{
				$bal_amount = ($new_update_tot_amt - $get_detail_request_current['Health']['received_amount']);
				$update_cur_row = $this->Health->query("UPDATE healths SET service_id='$new_service',total_amount='$new_update_tot_amt',balance_amount='$bal_amount' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET service_id='$new_service',sub_total='$new_update_tot_amt' WHERE request_id='".$req_id."'");
			}
			if(!empty($disc_code))
			{
				$get_disc_info = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
				if($get_disc_info['Discount']['type'] == 'Percent')
				{
					$v_1 = ($get_disc_info['Discount']['amount']/100);
					$v_2 = ($new_update_tot_amt*$v_1);
					$v_3 = ($new_update_tot_amt-$v_2);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($v_3+50);
					}
					else
					{
						$new_update_tot_amt = $v_3;
					}
				}
				if($get_disc_info['Discount']['type'] == 'Rupees')
				{
					$new_update_tot_amt = ($new_update_tot_amt-$get_disc_info['Discount']['amount']);
					if($home_report == 'Yes')
					{
						$new_update_tot_amt = ($new_update_tot_amt+50);
					}
					else
					{
						$new_update_tot_amt = $new_update_tot_amt;
					}
				}
				if($get_all_detail['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_all_detail['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_all_detail['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET service_id='$new_service',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET service_id='$new_service' WHERE request_id='".$req_id."'");
			}
			if(!empty($get_all_detail['Health']['discount_amount']))
			{
				$get_update_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
				$new_update_tot_amt = ($new_update_tot_amt - $get_update_info['Health']['discount_amount']);
				if($get_update_info['Health']['received_amount'] == 0)
				{
					$new_update_balance_amt = $new_update_tot_amt;
				}
				if($get_update_info['Health']['received_amount'] != 0)
				{
					$new_update_balance_amt = ($new_update_tot_amt-$get_update_info['Health']['received_amount']);
				}
				$update_row = $this->Health->query("UPDATE healths SET service_id='$new_service',total_amount='$new_update_tot_amt',balance_amount='$new_update_balance_amt' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET service_id='$new_service' WHERE request_id='".$req_id."'");
			}
			if($get_all_detail['Health']['received_amount'] == 0)
			{
				$new_update_balance_amt = $new_update_tot_amt;
			}
		}
		$find_all_test = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'SERVICE')));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_test_detail()
	{
		$req = $_REQUEST['req'];
		$get_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req)));
		if(!empty($get_details['Health']['test_id']))
		{
			$expl_test = explode(',',$get_details['Health']['test_id']);
			$amt = 0;
			foreach($expl_test as $key => $val)
			{
				$find_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt = ($find_mrp['Test']['mrp']+$amt);
				$amt = $amt;
			}
		}
		$find_all_test = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'TEST')));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$x['selected_test'] = $get_details['Health']['test_id'];
		$x['selected_test_amt'] = $amt;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_profile_detail()
	{
		$req = $_REQUEST['req'];
		$get_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req)));
		if(!empty($get_details['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_details['Health']['profile_id']);
			$amt = 0;
			foreach($expl_profile as $key => $val)
			{
				$find_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt = ($find_mrp['Test']['mrp']+$amt);
				$amt = $amt;
			}
		}
		$find_all_test = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE')));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$x['selected_test'] = $get_details['Health']['profile_id'];
		$x['selected_test_amt'] = $amt;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_offer_detail()
	{
		$req = $_REQUEST['req'];
		$get_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req)));
		if(!empty($get_details['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_details['Health']['offer_id']);
			$amt = 0;
			foreach($expl_offer as $key => $val)
			{
				$find_mrp = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
				$amt = ($find_mrp['Banner']['banner_mrp']+$amt);
				$amt = $amt;
			}
		}
		$find_all_test = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1)));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$x['selected_test'] = $get_details['Health']['offer_id'];
		$x['selected_test_amt'] = $amt;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_get_all_package_detail()
	{
		$req = $_REQUEST['req'];
		$get_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req)));
		if(!empty($get_details['Health']['package_id']))
		{
			$expl_package = explode(',',$get_details['Health']['package_id']);
			$amt = 0;
			foreach($expl_package as $key => $val)
			{
				$find_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
				$amt = ($find_mrp['Package']['package_mrp']+$amt);
				$amt = $amt;
			}
		}
		$find_all_test = $this->Package->find('all',array('conditions'=>array('Package.status'=>1)));
		$x['success'] = 'success';
		$x['test_data'] = $find_all_test;
		$x['selected_test'] = $get_details['Health']['package_id'];
		$x['selected_test_amt'] = $amt;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_search_test_value()
	{
            $this->layout="blank";
		$search_val = $_REQUEST['testval'];
		$sel_tests = $_REQUEST['sel_test'];
		if(!empty($sel_tests))
		{
			$expl_test = array_filter(explode(',',$sel_tests));
			//prd($expl_test);
			$amt = 0;
			$selected_id = array();
			foreach($expl_test as $key => $val)
			{
				$get_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
				$amt = ($get_mrp['Test']['mrp']+$amt);
				$amt = $amt;
				$selected_id[] = $val;
			}
			$exist_id = implode(",",$selected_id);
		}
		if(empty($sel_tests))
		{
			$amt = 0;
		}
		if(!empty($search_val))
		{
			if(isset($exist_id) && !empty($exist_id))
			{
				$find_tests = $this->Test->find('all',array('conditions'=>array('Test.test_parameter LIKE'=>'%'.$search_val.'%','Test.status'=>1 , 'Test.id NOT IN ('.$exist_id.')')));
				$condition = " Test.id NOT IN (".$exist_id.")";
			}else
			{
				$find_tests = $this->Test->find('all',array('conditions'=>array('Test.test_parameter LIKE'=>'%'.$search_val.'%','Test.status'=>1)));
			}
			if(!empty($find_tests))
			{
				$x['success'] = 'success';
				$x['search_test'] = $find_tests;
				$x['selected_tests_req'] = $sel_tests;
				$x['selected_amt'] = $amt;
				$m['test_info'] = $x;
			}
			else
			{
				if($exist_id !='')
				{
					$find_tests = $this->Test->find('all',array('conditions'=>array('Test.testcode LIKE'=>'%'.$search_val.'%','Test.status'=>1 , 'Test.id NOT IN ('.$exist_id.')')));
					$condition = " Test.id NOT IN (".$exist_id.")";
				}else
				{
					$find_tests = $this->Test->find('all',array('conditions'=>array('Test.testcode LIKE'=>'%'.$search_val.'%','Test.status'=>1)));
				}
				if(!empty($find_tests))
				{
					$x['success'] = 'success';
					$x['search_test'] = $find_tests;
					$x['selected_tests_req'] = $sel_tests;
					$x['selected_amt'] = $amt;
					$m['test_info'] = $x;
				}
				else
				{
					$x['selected_amt'] = $amt;
					$x['selected_tests_req'] = $sel_tests;
					$x['success'] = 'notsuccess';
					$m['test_info'] = $x;
				}
			}
		}
		else
		{
			$x['selected_amt'] = $amt;
			$x['success'] = 'notsuccess';
			$x['selected_tests_req'] = $sel_tests;
			$m['test_info'] = $x;
		}
		echo json_encode($m);
		exit;
	}

	function admin_search_profile_value()
	{
		$search_val = $_REQUEST['testval'];
		$sel_tests = $_REQUEST['sel_test'];
		if(!empty($sel_tests))
		{
			$expl_test = explode(',',$sel_tests);
			$amt = 0;
			$selected_id = array();
			foreach($expl_test as $key => $val)
			{
				$get_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val,'Test.status'=>1)));
				$amt = ($get_mrp['Test']['mrp']+$amt);
				$amt = $amt;
				$selected_id[] = $val;
			}
			$exist_pr_id = implode(",",$selected_id);
		}
		if(empty($sel_tests))
		{
			$amt = 0;
		}
		if(!empty($search_val))
		{
			if(isset($exist_pr_id) && !empty($exist_pr_id))
			{
				$find_tests = $this->Test->find('all',array('conditions'=>array('Test.test_parameter LIKE'=>'%'.$search_val.'%','Test.type'=>'PROFILE', 'Test.id NOT IN ('.$exist_pr_id.')','Test.status'=>1)));
			}else
			{
				$find_tests = $this->Test->find('all',array('conditions'=>array('Test.test_parameter LIKE'=>'%'.$search_val.'%','Test.type'=>'PROFILE','Test.status'=>1)));
			}
			if(!empty($find_tests))
			{
				$x['success'] = 'success';
				$x['search_test'] = $find_tests;
				$x['selected_tests_req'] = $sel_tests;
				$x['selected_amt'] = $amt;
				$m['test_info'] = $x;
			}
			else
			{
				if($exist_pr_id !='')
				{
					$find_tests = $this->Test->find('all',array('conditions'=>array('Test.testcode LIKE'=>'%'.$search_val.'%','Test.type'=>'PROFILE', 'Test.id NOT IN ('.$exist_pr_id.')','Test.status'=>1)));
				}else
				{
					$find_tests = $this->Test->find('all',array('conditions'=>array('Test.testcode LIKE'=>'%'.$search_val.'%','Test.type'=>'PROFILE','Test.status'=>1)));
				}
				if(!empty($find_tests))
				{
					$x['success'] = 'success';
					$x['search_test'] = $find_tests;
					$x['selected_tests_req'] = $sel_tests;
					$x['selected_amt'] = $amt;
					$m['test_info'] = $x;
				}
				else
				{
					$x['selected_amt'] = $amt;
					$x['success'] = 'notsuccess';
					$x['selected_tests_req'] = $sel_tests;
					$m['test_info'] = $x;
				}
			}
		}
		else
		{
			$x['selected_amt'] = $amt;
			$x['success'] = 'notsuccess';
			$x['selected_tests_req'] = $sel_tests;
			$m['test_info'] = $x;
		}
		echo json_encode($m);
		exit;
	}

	function admin_search_offer_value()
	{
		$search_val = $_REQUEST['testval'];
		$sel_tests = $_REQUEST['sel_test'];
		if(!empty($sel_tests))
		{
			$expl_test = explode(',',$sel_tests);
			$amt = 0;
			$selected_id = array();
			foreach($expl_test as $key => $val)
			{
				$get_mrp = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
				$amt = ($get_mrp['Banner']['banner_mrp']+$amt);
				$amt = $amt;
				$selected_id[] = $val;
			}
			$exist_of_id = implode(",",$selected_id);
		}
		if(empty($sel_tests))
		{
			$amt = 0;
		}
		if(!empty($search_val))
		{
			if(isset($exist_of_id) && !empty($exist_of_id))
			{
				$find_tests = $this->Banner->find('all',array('conditions'=>array('Banner.banner_name LIKE'=>'%'.$search_val.'%', 'Banner.id NOT IN ('.$exist_of_id.')')));
			}else
			{
				$find_tests = $this->Banner->find('all',array('conditions'=>array('Banner.banner_name LIKE'=>'%'.$search_val.'%')));
			}
			if(!empty($find_tests))
			{
				$x['success'] = 'success';
				$x['search_test'] = $find_tests;
				$x['selected_tests_req'] = $sel_tests;
				$x['selected_amt'] = $amt;
				$m['test_info'] = $x;
			}
			else
			{
				if($exist_of_id !='')
				{
					$find_tests = $this->Banner->find('all',array('conditions'=>array('Banner.banner_code LIKE'=>'%'.$search_val.'%', 'Banner.id NOT IN ('.$exist_of_id.')')));
				}else
				{
					$find_tests = $this->Banner->find('all',array('conditions'=>array('Banner.banner_code LIKE'=>'%'.$search_val.'%')));
				}
				if(!empty($find_tests))
				{
					$x['success'] = 'success';
					$x['search_test'] = $find_tests;
					$x['selected_tests_req'] = $sel_tests;
					$x['selected_amt'] = $amt;
					$m['test_info'] = $x;
				}
				else
				{
					$x['selected_amt'] = $amt;
					$x['success'] = 'notsuccess';
					$x['selected_tests_req'] = $sel_tests;
					$m['test_info'] = $x;
				}
			}
		}
		else
		{
			$x['selected_amt'] = $amt;
			$x['success'] = 'notsuccess';
			$x['selected_tests_req'] = $sel_tests;
			$m['test_info'] = $x;
		}
		echo json_encode($m);
		exit;
	}

	function admin_search_package_value()
	{
		$search_val = $_REQUEST['testval'];
		$sel_tests = $_REQUEST['sel_test'];
		if(!empty($sel_tests))
		{
			$expl_test = explode(',',$sel_tests);
			$amt = 0;
			$selected_id = array();
			foreach($expl_test as $key => $val)
			{
				$get_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
				$amt = ($get_mrp['Package']['package_mrp']+$amt);
				$amt = $amt;
				$selected_id[] = $val;
			}
			$exist_pac_id = implode(",",$selected_id);
		}
		if(empty($sel_tests))
		{
			$amt = 0;
		}
		if(!empty($search_val))
		{
			if(isset($exist_pac_id) && !empty($exist_pac_id))
			{
				$find_tests = $this->Package->find('all',array('conditions'=>array('Package.status'=>1,'Package.package_name LIKE'=>'%'.$search_val.'%','Package.id NOT IN ('.$exist_pac_id.')')));
			}else {
				$find_tests = $this->Package->find('all',array('conditions'=>array('Package.status'=>1,'Package.package_name LIKE'=>'%'.$search_val.'%')));
				
			}
			if(!empty($find_tests))
			{
				$x['success'] = 'success';
				$x['search_test'] = $find_tests;
				$x['selected_tests_req'] = $sel_tests;
				$x['selected_amt'] = $amt;
				$m['test_info'] = $x;
			}
			else
			{
				if(isset($exist_pac_id) && !empty($exist_pac_id))
				{
					$find_tests = $this->Package->find('all',array('conditions'=>array('Package.status'=>1,'Package.package_code LIKE'=>'%'.$search_val.'%','Package.id NOT IN ('.$exist_pac_id.')')));
				}else {
					$find_tests = $this->Package->find('all',array('conditions'=>array('Package.status'=>1,'Package.package_code LIKE'=>'%'.$search_val.'%')));
				}
				if(!empty($find_tests))
				{
					$x['success'] = 'success';
					$x['search_test'] = $find_tests;
					$x['selected_tests_req'] = $sel_tests;
					$x['selected_amt'] = $amt;
					$m['test_info'] = $x;
				}
				else
				{
					$x['selected_amt'] = $amt;
					$x['success'] = 'notsuccess';
					$x['selected_tests_req'] = $sel_tests;
					$m['test_info'] = $x;
				}
			}
		}
		else
		{
			$x['selected_amt'] = $amt;
			$x['success'] = 'notsuccess';
			$x['selected_tests_req'] = $sel_tests;
			$m['test_info'] = $x;
		}
		echo json_encode($m);
		exit;
	}

	function admin_search_service_value()
	{
		$search_val = $_REQUEST['testval'];
		$sel_tests = $_REQUEST['sel_test'];
		if(!empty($sel_tests))
		{
			$expl_test = explode(',',$sel_tests);
			$amt = 0;
			$selected_id = array();
			foreach($expl_test as $key => $val)
			{
				$get_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val,'Test.status'=>1)));
				$amt = ($get_mrp['Test']['mrp']+$amt);
				$amt = $amt;
				$selected_id[] = $val;
			}
			$exist_ser_id = implode(",",$selected_id);
		}
		if(empty($sel_tests))
		{
			$amt = 0;
		}
		if(!empty($search_val))
		{
			if(isset($exist_ser_id) && !empty($exist_ser_id))
			{
				$find_tests = $this->Test->find('all',array('conditions'=>array('Test.test_parameter LIKE'=>'%'.$search_val.'%','Test.type'=>'SERVICE','Test.status'=>1, 'Test.id NOT IN ('.$exist_ser_id.')')));
			}else
			{
				$find_tests = $this->Test->find('all',array('conditions'=>array('Test.test_parameter LIKE'=>'%'.$search_val.'%','Test.type'=>'SERVICE','Test.status'=>1)));
			}
			if(!empty($find_tests))
			{
				$x['success'] = 'success';
				$x['search_test'] = $find_tests;
				$x['selected_tests_req'] = $sel_tests;
				$x['selected_amt'] = $amt;
				$m['test_info'] = $x;
			}
			else
			{
				if(isset($exist_ser_id) && !empty($exist_ser_id))
				{
					$find_tests = $this->Test->find('all',array('conditions'=>array('Test.testcode LIKE'=>'%'.$search_val.'%','Test.type'=>'SERVICE', 'Test.id NOT IN ('.$exist_ser_id.')')));
				}else
				{
					$find_tests = $this->Test->find('all',array('conditions'=>array('Test.testcode LIKE'=>'%'.$search_val.'%','Test.type'=>'SERVICE')));
				}
				if(!empty($find_tests))
				{
					$x['success'] = 'success';
					$x['search_test'] = $find_tests;
					$x['selected_tests_req'] = $sel_tests;
					$x['selected_amt'] = $amt;
					$m['test_info'] = $x;
				}
				else
				{
					$x['selected_amt'] = $amt;
					$x['success'] = 'notsuccess';
					$x['selected_tests_req'] = $sel_tests;
					$m['test_info'] = $x;
				}
			}
		}
		else
		{
			$x['selected_amt'] = $amt;
			$x['success'] = 'notsuccess';
			$x['selected_tests_req'] = $sel_tests;
			$m['test_info'] = $x;
		}
		echo json_encode($m);
		exit;
	}

	function admin_agent_view_list($form=NULL)
	{
		$this->set('title_for_layout','Booked Request(s)');
		if($this->params['named']['form_name'] == 'first')
		{
			if(isset($this->params['named']['from_date']) && $this->params['named']['from_date']!='')
			{
				$this->data['Filter']['req_from_date'] = $this->params['named']['from_date'];
				$options['from_date'] = $this->params['named']['from_date'];
			}
			if(isset($this->params['named']['to_date']) && $this->params['named']['to_date']!='')
			{
				$this->data['Filter']['req_to_date'] = $this->params['named']['to_date'];
				$options['to_date'] = $this->params['named']['to_date'];
			}
			if(isset($this->params['named']['city']) && $this->params['named']['city']!='')
			{
				$this->data['Filter']['req_city'] = $this->params['named']['city'];
				$options['city'] = $this->params['named']['city'];
			}
			if(isset($this->params['named']['lab']) && $this->params['named']['lab']!='')
			{
				$this->data['Filter']['req_lab'] = $this->params['named']['lab'];
				$options['lab'] = $this->params['named']['lab'];
			}
			if(isset($this->params['named']['agent']) && $this->params['named']['agent']!='')
			{
				$this->data['Filter']['req_agent'] = $this->params['named']['agent'];
				$options['agent'] = $this->params['named']['agent'];
			}
			if(isset($this->params['named']['report']) && $this->params['named']['report']!='')
			{
				$this->data['Filter']['req_report'] = $this->params['named']['report'];
				$options['report'] = $this->params['named']['report'];
			}
			if(isset($this->params['named']['req_status']) && $this->params['named']['req_status']!='')
			{
				$this->data['Filter']['req_status'] = $this->params['named']['req_status'];
				$options['req_status'] = $this->params['named']['req_status'];
			}
			if(isset($this->params['named']['pay_status']) && $this->params['named']['pay_status']!='')
			{
				$this->data['Filter']['pay_status'] = $this->params['named']['pay_status'];
				$options['pay_status'] = $this->params['named']['pay_status'];
			}
			if(isset($this->params['named']['form_name']) && $this->params['named']['form_name']!='')
			{
				$form = $this->params['named']['form_name'];
				$options['form_name'] = $this->params['named']['form_name'];
			}
		}
		if($this->params['named']['form_name'] == 'second')
		{
			if(isset($this->params['named']['name']) && $this->params['named']['name']!='')
			{
				$this->data['Filter']['req_name'] = $this->params['named']['name'];
				$options['name'] = $this->params['named']['name'];
			}
			if(isset($this->params['named']['phone']) && $this->params['named']['phone']!='')
			{
				$this->data['Filter']['req_phone'] = $this->params['named']['phone'];
				$options['phone'] = $this->params['named']['phone'];
			}
			if(isset($this->params['named']['refnum']) && $this->params['named']['refnum']!='')
			{
				$this->data['Filter']['ref_num'] = $this->params['named']['refnum'];
				$options['refnum'] = $this->params['named']['refnum'];
			}
			if(isset($this->params['named']['form_name']) && $this->params['named']['form_name']!='')
			{
				$form = $this->params['named']['form_name'];
				$options['form_name'] = $this->params['named']['form_name'];
			}
		}
		if(!isset($this->params['named']['from_date']) && !isset($this->params['named']['to_date']) && !isset($this->params['named']['city']) && !isset($this->params['named']['lab']) && !isset($this->params['named']['agent']) && !isset($this->params['named']['report']) && !isset($this->params['named']['req_status']))
		{
			$t_date = date('Y-m-d');
			$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.id'=>'DESC'),'conditions'=>array('Health.status'=>1,'Health.s_date'=>$t_date)));
			$samplerequestlist=$this->paginate('Health');
			$k = 0;
			foreach($samplerequestlist as $key => $val)
			{
				$visit_lab_2 = $val['Health']['sample_time'];
				$visit_lab_3 = $val['Health']['sample_date'];
				$home_collection_1 = $val['Health']['sample_time1'];
				$home_collection_2 = $val['Health']['sample_date1'];
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));

				if(!empty($visit_lab_3))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
				}
				if(!empty($visit_lab_2))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];			
				}

				if(!empty($home_collection_2))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;	
				}

				if(!empty($home_collection_1))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}

				/*if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];	
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
				}
				if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];	
				}
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}*/
				//$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				//$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
				$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['visit_pat_city'])));
				$samplerequestlist[$k]['Health']['city_name'] = $city_name['City']['name'];
				$billing_status = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
				$samplerequestlist[$k]['Health']['bill_amount'] = $billing_status['Billing']['sub_total'];
				$user_email = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				$samplerequestlist[$k]['Health']['email'] = $user_email['User']['email'];
				$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
				$samplerequestlist[$k]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
				$lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val['Health']['assigned_lab'])));
				$samplerequestlist[$k]['Health']['lab_name'] = $lab_name['Lab']['pcc_name'];
				$k++;
			}
		}
		if($form == 'first')
		{
			if(!empty($this->data))
			{
				$from_date = $this->data['Filter']['req_from_date'];
				$to_date = $this->data['Filter']['req_to_date'];
				$city = $this->data['Filter']['req_city'];
				$lab = $this->data['Filter']['req_lab'];
				$agent = $this->data['Filter']['req_agent'];
				$report = $this->data['Filter']['req_report'];
				$req_status = $this->data['Filter']['req_status'];
				$pay_stat = $this->data['Filter']['pay_status'];
				if(isset($from_date) && $from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($from_date));
					$options['from_date'] = date('d-m-Y',strtotime($from_date));
				}
				if(isset($to_date) && $to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($to_date));
					$options['to_date'] = date('d-m-Y',strtotime($to_date));
				}
				if(isset($city) && $city != '')
				{
					$conditions['Health.visit_pat_city'] = $city;
					$options['city'] = $city;
				}
				if(isset($lab) && $lab != '')
				{
					$conditions['Health.assigned_lab'] = $lab;
					$options['lab'] = $lab;
				}
				if(isset($agent) && $agent != '')
				{
					$conditions['Health.agent_id'] = $agent;
					$options['agent'] = $agent;
				}
				if(isset($report) && $report != '')
				{
					if($report == 1)
					{
						$conditions['Health.patient_report <>'] = '';
						$conditions['Health.requ_status'] = 6;
					}
					if($report == 0)
					{
						$conditions['Health.patient_report'] = '';
					}
					if($report == 2)
					{
						$conditions['Health.requ_status'] = 7;
					}
					$options['report'] = $report;
				}
				if(isset($req_status) && $req_status != '')
				{
					if($req_status == 11)
					{
						$conditions['Health.requ_status'] = 11;
					}
					if($req_status == 12)
					{
						$conditions['Health.requ_status'] = 12;
					}
					if($req_status == 13)
					{
						$conditions['Health.requ_status'] = 13;
					}
					if($req_status == 10)
					{
						$conditions['Health.requ_status'] = 10;
					}
					if($req_status == 14)
					{
						$conditions['Health.requ_status'] = 14;
					}
					if($req_status == 4)
					{
						$conditions['Health.requ_status'] = 4;
					}
					if($req_status == 5)
					{
						$conditions['Health.requ_status'] = 5;
					}
					if($req_status == 0)
					{
						$conditions['Health.requ_status <'] = 4;
					}
					//code edit by sanjeet
					if($req_status == 6)
					{
						$conditions['Health.requ_status'] = 6;
					}
					if($req_status == 9)
					{
						$conditions['Health.requ_status'] = 9;
					}
					//Code Edit By Ashish 05-06-14 Starts
					if($req_status == 8)
					{
						$conditions['Health.requ_status'] = 8;
					}
	
					if($req_status == 7)
					{
						$conditions['Health.requ_status'] = 7;
					}
					
					if($req_status == 15)
					{
						$conditions['Health.requ_status'] = 15;
					}
					
					if($req_status == 16)
					{
						$conditions['Health.requ_status'] = 16;
					}
					
					if($req_status == 1)
					{
						$conditions['Health.requ_status'] = 1;
					}
					if($req_status == 2)
					{
						$conditions['Health.requ_status'] = 2;
					}
					
					if($req_status == 3)
					{
						$conditions['Health.requ_status'] = 3;
					}
					if($req_status == 17)
					{
						$conditions['Health.requ_status'] = 17;
					}
					if($req_status == 18)
					{
						$conditions['Health.requ_status'] = 18;
					}
					if($req_status == 19)
					{
						$conditions['Health.requ_status'] = 19;
					}
					if($req_status == 20)
					{
						$conditions['Health.requ_status'] = 20;
					}
					if($req_status == 21)
					{
						$conditions['Health.requ_status'] = 21;
					}
					if($req_status == 22)
					{
						$conditions['Health.requ_status'] = 22;
					}
					if($req_status == 23)
					{
						$conditions['Health.requ_status'] = 23;
					}
					//Code Edit By Ashish 05-06-14 Ends
					$options['req_status'] = $req_status;
				}
				if(isset($pay_stat) && $pay_stat != '')
				{
					if($pay_stat == 'not_paid')
					{
						$conditions['Health.received_amount'] = 0;
						$conditions['Health.balance_amount'] = 0;
					}
					if($pay_stat == 'partial_paid')
					{
						$conditions['Health.received_amount >'] = 0;
						$conditions['Health.balance_amount >'] = 0;
					}
					$options['pay_status'] = $pay_stat;
				}
				$options['form_name'] = $form;
				$conditions['Health.status'] = 1;
				$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.s_date'=>'ASC'),'conditions'=>$conditions));
				$samplerequestlist=$this->paginate('Health');
				$k = 0;
				foreach($samplerequestlist as $key => $val)
				{
					$visit_lab_2 = $val['Health']['sample_time'];
					$visit_lab_3 = $val['Health']['sample_date'];
					$home_collection_1 = $val['Health']['sample_time1'];
					$home_collection_2 = $val['Health']['sample_date1'];
					$this->Timelab = ClassRegistry::init('Timelab');
					$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));

					if(!empty($visit_lab_3))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
						
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
					}
					if(!empty($visit_lab_2))
					{
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];			
					}

					if(!empty($home_collection_2))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;	
					}

					if(!empty($home_collection_1))
					{
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
					}

					/*if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
					}
					if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
					}
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];					
					}
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
					{
						$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
						$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
						$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];					
					}*/
					//$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
					//$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
					$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['visit_pat_city'])));
					$samplerequestlist[$k]['Health']['city_name'] = $city_name['City']['name'];
					$billing_status = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
					$samplerequestlist[$k]['Health']['bill_amount'] = $billing_status['Billing']['sub_total'];
					$user_email = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
					$samplerequestlist[$k]['Health']['email'] = $user_email['User']['email'];
					$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
					$samplerequestlist[$k]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
					$lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val['Health']['assigned_lab'])));
					$samplerequestlist[$k]['Health']['lab_name'] = $lab_name['Lab']['pcc_name'];
					$k++;
				}
				$this->set('samplerequestlist',$samplerequestlist);
				$this->set('data_req_from_date',$from_date);
				$this->set('data_req_to_date',$to_date);
				$this->set('data_req_city',$city);
				$this->set('data_req_lab',$lab);
				$this->set('data_req_agent',$agent);
				$this->set('data_req_report',$agent);
				$this->set('data_req_request',$req_status);
				$this->set('data_req_pay_status',$pay_stat);
				$this->set('options',$options);
			}
			$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
			$this->set('city',$city);
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$agent_list = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
			$this->set('agent_list',$agent_list);
			$this->set('pcc',$pcc);
		}
		if($form == 'second')
		{
			$req_num = $this->data['Filter']['req_num'];
			$name = $this->data['Filter']['req_name'];
			$phone = $this->data['Filter']['req_phone'];
			$labnum = $this->data['Filter']['ref_num'];
			if(isset($req_num) && $req_num != '')
			{
				$order_num = $this->Billing->find('first',array('conditions'=>array('Billing.order_id'=>$this->data['Filter']['req_num'])));
				$this->paginate = array('Health' => array('limit' =>'20','conditions'=>array('Health.id'=>$order_num['Billing']['request_id'],'Health.status'=>1)));
				$samplerequestlist=$this->paginate('Health');
			}
			if(isset($labnum) && $labnum != '')
			{
				$conditions['Health.ref_num'] = $labnum;
				$options['refnum'] = $labnum;
				$options['form_name'] = $form;
				$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.s_date'=>'ASC'),'conditions'=>$conditions));
				$samplerequestlist=$this->paginate('Health');
			}
			if((isset($name) || isset($phone)) && $req_num == '')
			{
				if(isset($name) && $name != '')
				{
					$conditions['Health.name LIKE'] = '%'.$name.'%';
					$options['name'] = $name;
				}
				if(isset($phone) && $phone != '')
				{
					$conditions['Health.landline LIKE'] = '%'.$phone.'%';
					$options['phone'] = $phone;
				}
				$options['form_name'] = $form;
				$conditions['Health.status'] = 1;
				$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.s_date'=>'ASC'),'conditions'=>$conditions));
				$samplerequestlist=$this->paginate('Health');
			}
			$k = 0;
			foreach($samplerequestlist as $key => $val)
			{
				$visit_lab_2 = $val['Health']['sample_time'];
				$visit_lab_3 = $val['Health']['sample_date'];
				$home_collection_1 = $val['Health']['sample_time1'];
				$home_collection_2 = $val['Health']['sample_date1'];
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));

				if(!empty($visit_lab_3))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
				}
				if(!empty($visit_lab_2))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];			
				}

				if(!empty($home_collection_2))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;	
				}

				if(!empty($home_collection_1))
				{
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}

				/*if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];
				}
				if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];
				}
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
				{
					$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
					$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
					$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
				}*/
				//$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				//$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
				$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['visit_pat_city'])));
				$samplerequestlist[$k]['Health']['city_name'] = $city_name['City']['name'];
				$billing_status = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
				$samplerequestlist[$k]['Health']['bill_amount'] = $billing_status['Billing']['sub_total'];
				$user_email = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
				$samplerequestlist[$k]['Health']['email'] = $user_email['User']['email'];
				$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
				$samplerequestlist[$k]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
				$lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val['Health']['assigned_lab'])));
				$samplerequestlist[$k]['Health']['lab_name'] = $lab_name['Lab']['pcc_name'];
				$k++;
			}
			$this->set('samplerequestlist',$samplerequestlist);
			if($req_num != '')
			{
				$this->set('req_number',$this->data['Filter']['req_num']);
			}
			else
			{
				$this->set('data_req_name',$name);
				$this->set('data_req_phone',$phone);
				$this->set('data_req_regis',$restion);
			}
			$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
			$this->set('city',$city);
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$agent_list = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
			$this->set('agent_list',$agent_list);
			$this->set('pcc',$pcc);
			$this->set('samplerequestlist',$samplerequestlist);
		}
		$j = 0;
		foreach($samplerequestlist as $key => $val)
		{
			$test_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val['Sample']['test_id'])));
			$samplerequestlist[$j]['Sample']['test_name'] = $test_name['Test']['test_parameter'];
			$j++;
		}
		$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city);
		$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		$agent_list = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
		$this->set('agent_list',$agent_list);
		$this->set('pcc',$pcc);
		$this->set('samplerequestlist',$samplerequestlist);
	}

	function admin_view_detail_agent($reqId = NULL)
	{
		$category = array("2"=>"Report Related","3"=>"TAT Related","4"=>"Payment Related","5"=>"Special Request","6"=>"Sample Collected Related");
		$this->set('category',$category);
		$this->set('title_for_layout', 'View Sample Request');
		$req_id = base64_decode($reqId);
		if(!empty($this->data))
		{
			$get_req_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
			$implode = $get_req_detail['Health']['test_id'];
			$this->data['Health']['test_id'] = $implode;
			$implode_profile = $get_req_detail['Health']['profile_id'];
			$this->data['Health']['profile_id'] = $implode_profile;
			$implode_offer = $get_req_detail['Health']['offer_id'];
			$this->data['Health']['offer_id'] = $implode_offer;
			$implode_package = $get_req_detail['Health']['package_id'];
			$this->data['Health']['package_id'] = $implode_package;
			$implode_service = $get_req_detail['Health']['service_id'];
			$this->data['Health']['service_id'] = $implode_service;
			$this->data['Health']['total_amount'] = $get_req_detail['Health']['total_amount'];
			//For Editing Discount 03-10-13 Starts
			/*$amt_t = 0;
			if(!empty($this->data['Health']['test_id']))
			{
			$expl_tst = explode(',',$this->data['Health']['test_id']);
			foreach($expl_tst as $k => $v)
			{
			$amt_tst = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v)));
			$amt_t = ($amt_tst['Test']['mrp']+$amt_t);
			$amt_t = $amt_t;
			}
			}
			if(!empty($this->data['Health']['profile_id']))
			{
			$expl_prf = explode(',',$this->data['Health']['profile_id']);
			foreach($expl_prf as $k => $v)
			{
			$amt_prf = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v)));
			$amt_t = ($amt_prf['Test']['mrp']+$amt_t);
			$amt_t = $amt_t;
			}
			}
			if(!empty($this->data['Health']['offer_id']))
			{
			$expl_ofr = explode(',',$this->data['Health']['offer_id']);
			foreach($expl_ofr as $k => $v)
			{
			$amt_ofr = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v)));
			$amt_t = ($amt_ofr['Banner']['banner_mrp']+$amt_t);
			$amt_t = $amt_t;
			}
			}
			if(!empty($this->data['Health']['package_id']))
			{
			$expl_pkg = explode(',',$this->data['Health']['package_id']);
			foreach($expl_pkg as $k => $v)
			{
			$amt_pkg = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v)));
			$amt_t = ($amt_pkg['Package']['package_mrp']+$amt_t);
			$amt_t = $amt_t;
			}
			}
			$this->data['Health']['total_amount'] = $amt_t;*/
			//For Editing Discount 03-10-13 Ends
			$explode_age = explode(' ',$this->data['Health']['age']);
			$this->data['Health']['age'] = $explode_age[0];
			if(!empty($this->data['Health']['address_home1']) && !empty($this->data['Health']['home_locality']) && !empty($this->data['Health']['home_city']) && !empty($this->data['Health']['home_state']) && !empty($this->data['Health']['home_pincode']) && !empty($this->data['Health']['home_landmark']))
			{
				if(!empty($this->data['Health']['address_home1']) && empty($this->data['Health']['address_home2']))
				{
					$this->data['Health']['address'] = $this->data['Health']['address_home1'];
				}
				if(!empty($this->data['Health']['address_home1']) && !empty($this->data['Health']['address_home2']))
				{
					$this->data['Health']['address'] = $this->data['Health']['address_home1'].'*'.$this->data['Health']['address_home2'];
				}
				$this->data['Health']['locality'] = $this->data['Health']['home_locality'];
				$this->data['Health']['city_id'] = $this->data['Health']['home_city'];
				$this->data['Health']['state'] = $this->data['Health']['home_state'];
				$this->data['Health']['pincode'] = $this->data['Health']['home_pincode'];
				$this->data['Health']['landmark'] = $this->data['Health']['home_landmark'];
			}
			else
			{
				$this->data['Health']['address'] = '';
				$this->data['Health']['locality'] = '';
				$this->data['Health']['city_id'] = 0;
				$this->data['Health']['state'] = 0;
				$this->data['Health']['pincode'] = '';
				$this->data['Health']['landmark'] = '';
			}
			//For Editing Discount 28-07-14 Starts
			if(!empty($this->data['Health']['discount_code']))
			{
				$find_discount_code = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
				$get_amount_all = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$find_discount_code['Health']['id'])));
				$v = 0;
				foreach($get_amount_all as $amtallk => $amtallv)
				{
					$v = ($amtallv['RequestTest']['mrp']+$v);
				}
				$this->data['Health']['total_amount'] = $v;
				if($find_discount_code['Health']['discount_code'] != $this->data['Health']['discount_code'])
				{
					$get_disc = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$this->data['Health']['discount_code'])));
					if($get_disc['Discount']['type'] == 'Percent')
					{
						$v_1 = ($get_disc['Discount']['amount']/100);
						$v_2 = ($v_1*$this->data['Health']['total_amount']);
						$v_3 = ($this->data['Health']['total_amount']-$v_2);
						$find_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
						if($find_amt['Health']['received_amount'] == 0)
						{
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($find_amt['Health']['received_amount'] != 0)
						{
							$bal_amt = ($v_3-$find_amt['Health']['received_amount']);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."',balance_amount='".$bal_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
						$this->data['Health']['total_amount'] = $v_3;
						$this->data['Health']['discount_id'] = $get_disc['Discount']['id'];
					}
					if($get_disc['Discount']['type'] == 'Rupees')
					{
						$v_3 = ($this->data['Health']['total_amount']-$get_disc['Discount']['amount']);
						$find_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
						if($find_amt['Health']['received_amount'] == 0)
						{
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($find_amt['Health']['received_amount'] != 0)
						{
							$bal_amt = ($v_3-$find_amt['Health']['received_amount']);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."',balance_amount='".$bal_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
						$this->data['Health']['total_amount'] = $v_3;
						$this->data['Health']['discount_id'] = $get_disc['Discount']['id'];
					}
				}
			}
			if(!empty($this->data['Health']['discount_amount']))
			{
				$find_tot_amt_disc = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
				$get_amount_all = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$find_tot_amt_disc['Health']['id'])));
				$v = 0;
				foreach($get_amount_all as $amtallk => $amtallv)
				{
					$v = ($amtallv['RequestTest']['mrp']+$v);
				}
				$this->data['Health']['total_amount'] = $v;
				if($find_tot_amt_disc['Health']['discount_amount'] != $this->data['Health']['discount_amount'])
				{
					if($find_tot_amt_disc['Health']['received_amount'] == 0)
					{
						$new_tot_amt_disc = ($this->data['Health']['total_amount'] - $this->data['Health']['discount_amount']);
						$this->data['Health']['total_amount'] = $new_tot_amt_disc;
						$update_tot_amt_disc = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt_disc."' WHERE id='".$this->data['Health']['id']."'");
						$update_billing = $this->Billing->query("UPDATE billings SET sub_total='".$new_tot_amt_disc."' WHERE request_id='".$this->data['Health']['id']."'");
					}
					else
					{
						$new_tot_amt_disc = ($this->data['Health']['total_amount'] - $this->data['Health']['discount_amount']);
						$new_bal_amount = ($new_tot_amt_disc - $find_tot_amt_disc['Health']['received_amount']);
						$this->data['Health']['total_amount'] = $new_tot_amt_disc;
						$this->data['Health']['balance_amount'] = $new_bal_amount;
						$update_tot_amt_disc = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt_disc."',balance_amount='".$new_bal_amount."' WHERE id='".$this->data['Health']['id']."'");
						$update_billing = $this->Billing->query("UPDATE billings SET sub_total='".$new_tot_amt_disc."' WHERE request_id='".$this->data['Health']['id']."'");
					}
				}
			}
			//FOR EDITING DISCOUNT CODE 28-07-14 ENDS
			if($this->data['Health']['old_home_report'] == 0)
			{
				if($this->data['Health']['home_report'] == 1)
				{
					$find_tot_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					$new_tot_amt = ($find_tot_amt['Health']['total_amount']+50);
					$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."' WHERE id='".$this->data['Health']['id']."'");
				}
			}
			if($this->data['Health']['old_home_report'] == 1)
			{
				if($this->data['Health']['home_report'] == 0)
				{
					$find_tot_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					$paytracks = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$this->data['Health']['id'])));
					if(!empty($paytracks))
					{
						$paytrack_amt = 0;
						foreach($paytracks as $key => $val)
						{
							$paytrack_amt = ($val['Paytrack']['pay_install']+$paytrack_amt);
							$paytrack_amt = $paytrack_amt;
						}
						if($paytrack_amt > $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',balance_refund='".$new_refund_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($paytrack_amt == $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',balance_refund='".$new_refund_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($paytrack_amt < $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
					}
					else
					{
						$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
						//$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
						$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."' WHERE id='".$this->data['Health']['id']."'");
					}
				}
				else
				{
					$this->data['Health']['total_amount'] = ($this->data['Health']['total_amount']+50);
				}
			}
			$get_db_edit_request_detaill = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
			$get_update_status = $this->Health->query("UPDATE healths SET requ_status='".$get_db_edit_request_detaill['Health']['requ_status']."' WHERE id='".$this->data['Health']['id']."'");
			
			if($this->Utility->check_push_notification_for_pcc($get_db_edit_request_detaill['Health']['created_by'],$get_db_edit_request_detaill['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($get_db_edit_request_detaill['Health']['id']);
			}
			if($this->Health->create($this->data))
			{
				if($this->Health->save($this->data,false))
				{
					$get_db_edit_request_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					if(!empty($get_db_edit_request_detail['Health']['test_id']))
					{
						$explode_db_save_test = explode(',',$get_db_edit_request_detail['Health']['test_id']);
						foreach($explode_db_save_test as $k_db_edit_test => $v_db_edit_test)
						{
							$get_db_save_test = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'TE','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_test)));
							if(empty($get_db_save_test))
							{
								$get_current_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_test)));
								$this->data['RequestTest']['type'] = 'TE';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_test;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_test['Test']['mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['profile_id']))
					{
						$explode_db_save_profile = explode(',',$get_db_edit_request_detail['Health']['profile_id']);
						foreach($explode_db_save_profile as $k_db_edit_profile => $v_db_edit_profile)
						{
							$get_db_save_profile = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'PR','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_profile)));
							if(empty($get_db_save_profile))
							{
								$get_current_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_profile)));
								$this->data['RequestTest']['type'] = 'PR';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_profile;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_profile['Test']['mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['offer_id']))
					{
						$explode_db_save_offer = explode(',',$get_db_edit_request_detail['Health']['offer_id']);
						foreach($explode_db_save_offer as $k_db_edit_offer => $v_db_edit_offer)
						{
							$get_db_save_offer = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'OF','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_offer)));
							if(empty($get_db_save_offer))
							{
								$get_current_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v_db_edit_offer)));
								$this->data['RequestTest']['type'] = 'OF';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_offer;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_offer['Banner']['banner_mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['package_id']))
					{
						$explode_db_save_package = explode(',',$get_db_edit_request_detail['Health']['package_id']);
						foreach($explode_db_save_package as $k_db_edit_package => $v_db_edit_package)
						{
							$get_db_save_package = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'PA','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_package)));
							if(empty($get_db_save_package))
							{
								$get_current_mrp_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v_db_edit_package)));
								$this->data['RequestTest']['type'] = 'PA';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_package;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_package['Package']['package_mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['service_id']))
					{
						$explode_db_save_service = explode(',',$get_db_edit_request_detail['Health']['service_id']);
						foreach($explode_db_save_service as $k_db_edit_service => $v_db_edit_service)
						{
							$get_db_save_service = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'SR','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_service)));
							if(empty($get_db_save_service))
							{
								$get_current_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_service)));
								$this->data['RequestTest']['type'] = 'SR';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_service;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_service['Test']['mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					$get_update_status = $this->Health->query("UPDATE healths SET requ_status='".$get_db_edit_request_detail['Health']['requ_status']."' WHERE id='".$get_db_edit_request_detail['Health']['id']."'");
					
					if($this->Utility->check_push_notification_for_pcc($get_db_edit_request_detail['Health']['created_by'],$get_db_edit_request_detail['Health']['assigned_lab']) == 1)
					{
						$response = $this->Utility->send_notification($get_db_edit_request_detail['Health']['id']);
					}
					$this->Session->setFlash('Sample request updated successfully.','flash_success');
					$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',$reqId));
				}
			}
		}
		else
		{
			if(!empty($req_id))
			{
				$request_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
				if(!empty($request_details))
				{
					$init_tot_amt = 0;
					$get_total_test_amt = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'])));
					foreach($get_total_test_amt as $tot_amt_key => $tot_amt_val)
					{
						$init_tot_amt = ($tot_amt_val['RequestTest']['mrp']+$init_tot_amt);
					}
					$request_det['Health']['total_test_amt'] = $init_tot_amt;
					//Code Edited By Ashish Starts
					if($request_details['Health']['requ_status'] == 8)
					{
						$request_det['Health']['cancel_reason'] = $request_details['Health']['cancelled_reason'];
					}
					//Code Edited By Ashish Ends
					$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request_details['Health']['id'])));
					$request_det['Health']['order_num'] = $find_order_num['Billing']['order_id'];
					if($request_details['Health']['gender'] == 1)
					{
						$gender = 'Male';
					}
					if($request_details['Health']['gender'] == 2)
					{
						$gender = 'Female';
					}
					if($request_details['Health']['discount_id'] != 0)
					{
						$discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$request_details['Health']['discount_id'])));
						$request_det['Health']['discount_code'] = $discount['Discount']['discount_code'];
						$request_det['Health']['discount_info'] = $discount['Discount']['discount_description'];
						$request_det['Health']['discount_id'] = $request_details['Health']['discount_id'];
						if($discount['Discount']['type'] == 'Percent')
						{
							$request_det['Health']['discount_amt'] = $discount['Discount']['amount'].'%';
							//01-04014 Starts
							$discount_final_amount_1 = ($discount['Discount']['amount']/100);
							$discount_final_amount_1_1 = ($discount_final_amount_1*$init_tot_amt);
							//01-04014 Ends
						}
						if($discount['Discount']['type'] == 'Rupees')
						{
							$request_det['Health']['discount_amt'] = 'Rs. '.$discount['Discount']['amount'];
							//01-04014 Starts
							$discount_final_amount_1_1 = $discount['Discount']['amount'];
							//01-04014 Ends
						}
					}
					//01-04014 Starts
					else
					{
						$discount_final_amount_1_1 = 0;
					}
					//01-04014 Ends
					if($request_details['Health']['discount_amount'] != 0)
					{
						$request_det['Health']['discount_amount'] = $request_details['Health']['discount_amount'];
						$request_det['Health']['discount_amount_reason'] = $request_details['Health']['discount_amount_reason'];
						//01-04014 Starts
						$discount_final_amount_1_2 = $request_details['Health']['discount_amount'];
						//01-04014 Ends
					}
					//01-04014 Starts
					else
					{
						$discount_final_amount_1_2 = 0;
					}
					// edit by sanjeet
					if(!empty($entry) && $entry == 'ref_dup')
					{
						$request_det['Health']['dup_entry'] = 'Yes';
					}
					//Patient Vital Information Fetch Value Starts
					$get_vital_detail  = $this->UserBmiBp->find('first',array('conditions'=>array('UserBmiBp.request_id'=>$request_details['Health']['id'])));
					$request_det['Health']['vital_save_id'] = $get_vital_detail['UserBmiBp']['id'];
					$request_det['Health']['weight'] = $get_vital_detail['UserBmiBp']['weight'];
					$request_det['Health']['height_opt'] = $get_vital_detail['UserBmiBp']['height_opt'];
					$request_det['Health']['height_feet'] = $get_vital_detail['UserBmiBp']['height_feet'];
					$request_det['Health']['height_inch'] = $get_vital_detail['UserBmiBp']['height_inch'];
					$request_det['Health']['height_cm'] = $get_vital_detail['UserBmiBp']['height_cm'];
					$request_det['Health']['bmi_value'] = $get_vital_detail['UserBmiBp']['bmi_value'];
					$request_det['Health']['bp_systolic'] = $get_vital_detail['UserBmiBp']['bp_systolic'];
					$request_det['Health']['bp_diastolic'] = $get_vital_detail['UserBmiBp']['bp_diastolic'];
					$request_det['Health']['bp_pulse'] = $get_vital_detail['UserBmiBp']['bp_pulse'];
					$request_det['Health']['bmi_indicator'] = $get_vital_detail['UserBmiBp']['bmi_indicator'];
					//Patient Vital Information Fetch Value Ends
					$request_det['Health']['message_status'] = $request_details['Health']['message_status'];
					$request_det['Health']['lab_message'] = $request_details['Health']['lab_message'];
					$request_det['Health']['ref_num'] = $request_details['Health']['ref_num'];
					$request_det['Health']['adj_reason'] = $request_details['Health']['adj_reason'];
					$request_det['Health']['report_type'] = $request_details['Health']['report_type'];
					$request_det['Health']['report_reason'] = $request_details['Health']['partial_reason'];
					$request_det['Health']['published'] = $request_details['Health']['published'];
					$request_det['Health']['published_reason'] = $request_details['Health']['published_reason'];
					$request_det['Health']['requ_status'] = $request_details['Health']['requ_status'];
					//edit sanjeet
					$request_det['Health']['last_edited_date'] = $request_details['Health']['last_edited_date'];
					$get_vital_detail1  = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$request_details['Health']['last_edited'])));
					$request_det['Health']['last_edited'] = $get_vital_detail1['Admin']['name'];
					//end by sanjeet
					//end by sanjeet
					$request_det['Health']['discount_amount_after_add'] = ($discount_final_amount_1_1+$discount_final_amount_1_2);
					$find_total_received = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'])));
					if(!empty($find_total_received))
					{
						$rec_ins_amt = 0;
						foreach($find_total_received as $rec_key => $rec_val)
						{
							if($rec_val['Paytrack']['pay_mode'] == 'btc')
							{
								$btc_pay_mode = 'Yes';
							}
							else
							{
								$btc_pay_mode = 'No';
							}
							$rec_ins_amt = ($rec_val['Paytrack']['pay_install']+$rec_ins_amt);
						}
						$request_det['Health']['rec_ins_amt'] = $rec_ins_amt;
					}
					else
					{
						$request_det['Health']['rec_ins_amt'] = 0;
					}
					if($rec_ins_amt > 0)
					{
						$request_det['Health']['sent_to_lab_action'] = 'Yes';
					}
					if($btc_pay_mode == 'Yes')
					{
						$request_det['Health']['sent_to_lab_action'] = 'Yes';
					}
					//01-04014 Ends
					if($request_details['Health']['home_report'] != 0)
					{
						$request_det['Health']['home_report'] = $request_details['Health']['home_report'];
						$request_det['Health']['home_info'] = 'Rs.50 included of sending report at home.';
					}
					if($request_details['Health']['cancelled_status'] == 0)
					{
						$request_det['Health']['cancelled_status'] = 0;
					}
					if($request_details['Health']['cancelled_status'] == 1)
					{
						$request_det['Health']['cancelled_status'] = 1;
						$request_det['Health']['cancelled_reason'] = $request_details['Health']['cancelled_reason'];
					}
					$request_det['Health']['requ_status'] = $request_details['Health']['requ_status'];
					/*if(!empty($request_details['Health']['test_id']))
					{
					$explode_test = explode(',',$request_details['Health']['test_id']);
					$count_test = count($explode_test);
					if($count_test == 1)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'];
					}
					if($count_test == 2)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'];
					}
					if($count_test == 3)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'];
					}
					if($count_test == 4)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'];
					}
					if($count_test == 5)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'];
					}
					if($count_test == 6)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'];
					}
					if($count_test == 7)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'];
					}
					if($count_test == 8)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].' - '.$test_5['Test']['testcode'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'];
					}
					if($count_test == 9)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$test_9['Test']['mrp'];
					}
					if($count_test == 10)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
					$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
					$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$test_9['Test']['mrp'].'<br>'.'<strong>10-</strong> '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$test_10['Test']['mrp'];
					}
					}
					if(!empty($request_details['Health']['profile_id']))
					{
					$explode_profile = explode(',',$request_details['Health']['profile_id']);
					$count_profile = count($explode_profile);
					if($count_profile == 1)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'];
					}
					if($count_profile == 2)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'];
					}
					if($count_profile == 3)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'];
					}
					if($count_profile == 4)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'];
					}
					if($count_profile == 5)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'];
					}
					if($count_profile == 6)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'];
					}
					if($count_profile == 7)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'];
					}
					if($count_profile == 8)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'];
					}
					if($count_profile == 9)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$profile_9['Test']['mrp'];
					}
					if($count_profile == 10)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
					$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
					$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$profile_9['Test']['mrp'].'<br>'.'<strong>10-</strong> '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$profile_10['Test']['mrp'];
					}
					}
					if(!empty($request_details['Health']['offer_id']))
					{
					$explode_offers = explode(',',$request_details['Health']['offer_id']);
					$count_offers= count($explode_offers);
					if($count_offers == 1)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'];
					}
					if($count_offers == 2)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'];
					}
					if($count_offers == 3)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'];
					}
					if($count_offers == 4)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'];
					}
					if($count_offers == 5)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
					$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'];
					}
					if($count_offers == 6)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
					$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
					$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'];
					}
					if($count_offers == 7)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
					$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
					$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
					$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'];
					}
					if($count_offers == 8)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
					$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
					$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
					$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
					$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$offer_7['Banner']['banner_mrp'].'<br>'.'<strong>8-</strong> '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$offer_8['Banner']['banner_mrp'];
					}
					}
					if(!empty($request_details['Health']['package_id']))
					{
					$explode_packages = explode(',',$request_details['Health']['package_id']);
					$count_packages = count($explode_packages);
					if($count_packages == 1)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'];
					}
					if($count_packages == 2)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
					$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'];
					}
					if($count_packages == 3)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
					$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
					$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'];
					}
					if($count_packages == 4)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
					$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
					$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
					$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$package_4['Package']['package_mrp'];
					}
					if($count_packages == 5)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
					$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
					$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
					$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
					$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$package_4['Package']['package_mrp'].'<br>'.'<strong>5-</strong> '.$package_5['Package']['package_name'].' - Rs.'.$package_5['Package']['package_mrp'];
					}
					}
					//For Edit Details
					if(!empty($request_details['Health']['test_id']))
					{
					$explode_test = explode(',',$request_details['Health']['test_id']);
					$count_test = count($explode_test);
					if($count_test == 1)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 2)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 3)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 4)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 5)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 6)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 7)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 8)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 9)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
					$edit_test_name= '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$test_9['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_test == 10)
					{
					$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
					$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
					$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
					$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
					$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
					$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
					$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
					$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
					$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
					$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
					$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$test_9['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$test_10['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					}
					if(!empty($request_details['Health']['profile_id']))
					{
					$explode_profile = explode(',',$request_details['Health']['profile_id']);
					$count_profile = count($explode_profile);
					if($count_profile == 1)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 2)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 3)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 4)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 5)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 6)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 7)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 8)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 9)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$profile_9['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_profile == 10)
					{
					$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
					$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
					$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
					$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
					$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
					$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
					$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
					$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
					$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
					$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
					$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$profile_9['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$profile_10['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					}
					if(!empty($request_details['Health']['offer_id']))
					{
					$explode_offers = explode(',',$request_details['Health']['offer_id']);
					$count_offers= count($explode_offers);
					if($count_offers == 1)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_offers == 2)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_offers == 3)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_offers == 4)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_offers == 5)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
					$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_offers == 6)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
					$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
					$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_offers == 7)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
					$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
					$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
					$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$offer_7['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_offers == 8)
					{
					$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
					$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
					$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
					$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
					$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
					$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
					$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
					$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
					$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$offer_7['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$offer_8['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_8['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					}
					if(!empty($request_details['Health']['package_id']))
					{
					$explode_packages = explode(',',$request_details['Health']['package_id']);
					$count_packages = count($explode_packages);
					if($count_packages == 1)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_packages == 2)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
					$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_packages == 3)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
					$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
					$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_packages == 4)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
					$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
					$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
					$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$package_4['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					if($count_packages == 5)
					{
					$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
					$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
					$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
					$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
					$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
					$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$package_4['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$package_5['Package']['package_name'].' - Rs.'.$package_5['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_5['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
					}
					}
					//For Edit details*/
					if(!empty($request_details['Health']['test_id']))
					{
						$explode_test = explode(',',$request_details['Health']['test_id']);
						$count_test = count($explode_test);
						if($count_test == 1)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'];
						}
						if($count_test == 2)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'];
						}
						if($count_test == 3)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'];
						}
						if($count_test == 4)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'];
						}
						if($count_test == 5)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'];
						}
						if($count_test == 6)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_idd'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'];
						}
						if($count_test == 7)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'];
						}
						if($count_test == 8)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'];
						}
						if($count_test == 9)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_9['RequestTest']['mrp'];
						}
						if($count_test == 10)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[9],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_9['RequestTest']['mrp'].'<br>'.'<strong>10-</strong> '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_10['RequestTest']['mrp'];
						}
					}
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						if($count_profile == 1)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'];
						}
						if($count_profile == 2)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'];
						}
						if($count_profile == 3)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'];
						}
						if($count_profile == 4)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'];
						}
						if($count_profile == 5)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'];
						}
						if($count_profile == 6)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'];
						}
						if($count_profile == 7)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'];
						}
						if($count_profile == 8)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'];
						}
						if($count_profile == 9)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[8],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_9['RequestTest']['mrp'];
						}
						if($count_profile == 10)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[8],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[9],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_9['RequestTest']['mrp'].'<br>'.'<strong>10-</strong> '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_10['RequestTest']['mrp'];
						}
					}
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						if($count_offers == 1)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'];
						}
						if($count_offers == 2)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'];
						}
						if($count_offers == 3)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'];
						}
						if($count_offers == 4)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'];
						}
						if($count_offers == 5)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'];
						}
						if($count_offers == 6)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'];
						}
						if($count_offers == 7)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_7['RequestTest']['mrp'];
						}
						if($count_offers == 8)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[7],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_8['RequestTest']['mrp'];
						}
					}
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						if($count_packages == 1)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'];
						}
						if($count_packages == 2)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'];
						}
						if($count_packages == 3)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'];
						}
						if($count_packages == 4)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$save_db_package_mrp_4['RequestTest']['mrp'];
						}
						if($count_packages == 5)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[4],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$save_db_package_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$package_5['Package']['package_name'].' - Rs.'.$save_db_package_mrp_5['RequestTest']['mrp'];
						}
					}
					if(!empty($request_details['Health']['service_id']))
					{
						$explode_service = explode(',',$request_details['Health']['service_id']);
						$count_service = count($explode_service);
						if($count_service == 1)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'];
						}
						if($count_service == 2)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'];
						}
						if($count_service == 3)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'];
						}
						if($count_service == 4)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'];
						}
						if($count_service == 5)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'];
						}
						if($count_service == 6)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'];
						}
						if($count_service == 7)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$service_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[6])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$service_7['Test']['testcode'].' - '.$service_7['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_7['RequestTest']['mrp'];
						}
						if($count_service == 8)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$service_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[6])));
							$service_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[7])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$service_7['Test']['testcode'].' - '.$service_7['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$service_8['Test']['testcode'].' - '.$service_8['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_8['RequestTest']['mrp'];
						}
						if($count_service == 9)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$service_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[6])));
							$service_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[7])));
							$service_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[8])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[8],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$service_7['Test']['testcode'].' - '.$service_7['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$service_8['Test']['testcode'].' - '.$service_8['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$service_9['Test']['testcode'].' - '.$service_9['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_9['RequestTest']['mrp'];
						}
						if($count_service == 10)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$service_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[6])));
							$service_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[7])));
							$service_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[8])));
							$service_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[9])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[8],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[9],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$service_7['Test']['testcode'].' - '.$service_7['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$service_8['Test']['testcode'].' - '.$service_8['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$service_9['Test']['testcode'].' - '.$service_9['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_9['RequestTest']['mrp'].'<br>'.'<strong>10-</strong> '.$service_10['Test']['testcode'].' - '.$service_10['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_10['RequestTest']['mrp'];
						}
					}
					//For Edit Details
					if(!empty($request_details['Health']['test_id']))
					{
						$explode_test = explode(',',$request_details['Health']['test_id']);
						$count_test = count($explode_test);
						if($count_test == 1)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 2)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 3)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 4)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 5)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 6)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 7)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 8)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 9)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 10)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE')));
							$edit_save_test_db_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[9],'RequestTest.type'=>'TE')));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_10['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						if($count_profile == 1)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 2)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 3)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 4)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 5)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 6)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 7)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 8)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 9)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 10)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_10['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						if($count_offers == 1)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 2)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 3)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 4)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 5)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 6)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 7)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 8)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[7],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_8['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						if($count_packages == 1)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 2)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 3)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 4)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$edit_save_package_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 5)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[4],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$edit_save_package_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$package_5['Package']['package_name'].' - Rs.'.$edit_save_package_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_5['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					if(!empty($request_details['Health']['service_id']))
					{
						$explode_services = explode(',',$request_details['Health']['service_id']);
						$count_services = count($explode_services);
						if($count_services == 1)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 2)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 3)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 4)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 5)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 6)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 7)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 8)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 9)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$services_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[8])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[8],'RequestTest.type'=>'SR')));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$services_9['Test']['testcode'].' - '.$services_9['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 10)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$services_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[8])));
							$services_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[9])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[8],'RequestTest.type'=>'SR')));
							$edit_save_services_db_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[9],'RequestTest.type'=>'SR')));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$services_9['Test']['testcode'].' - '.$services_9['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$services_10['Test']['testcode'].' - '.$services_10['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_10['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					//For Edit details
					if(!empty($request_details['Health']['test_id']))
					{
						$expl_test = explode(',',$request_details['Health']['test_id']);
						$amt_test = 0;
						foreach($expl_test as $key => $val)
						{
							$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
							$amt_test = $amt_test;
						}
						$request_det['Health']['indi_test_amt'] = $amt_test;
					}
					if(empty($request_details['Health']['test_id']))
					{
						$amt_test = 0;
						$request_det['Health']['indi_test_amt'] = $amt_test;
					}
					if(!empty($request_details['Health']['profile_id']))
					{
						$expl_profile = explode(',',$request_details['Health']['profile_id']);
						$amt_profile = 0;
						foreach($expl_profile as $key => $val)
						{
							$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
							$amt_profile = $amt_profile;
						}
						$request_det['Health']['indi_profile_amt'] = $amt_profile;
					}
					if(empty($request_details['Health']['profile_id']))
					{
						$amt_profile = 0;
						$request_det['Health']['indi_profile_amt'] = $amt_profile;
					}
					if(!empty($request_details['Health']['offer_id']))
					{
						$expl_offer= explode(',',$request_details['Health']['offer_id']);
						$amt_offer = 0;
						foreach($expl_offer as $key => $val)
						{
							$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
							$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
							$amt_offer = $amt_offer;
						}
						$request_det['Health']['indi_offer_amt'] = $amt_offer;
					}
					if(empty($request_details['Health']['offer_id']))
					{
						$amt_offer = 0;
						$request_det['Health']['indi_offer_amt'] = $amt_offer;
					}
					if(!empty($request_details['Health']['package_id']))
					{
						$expl_package= explode(',',$request_details['Health']['package_id']);
						$amt_package = 0;
						foreach($expl_package as $key => $val)
						{
							$find_mrp_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
							$amt_package = ($find_mrp_package['Package']['package_mrp']+$amt_package);
							$amt_package = $amt_package;
						}
						$request_det['Health']['indi_package_amt'] = $amt_package;
					}
					if(empty($request_details['Health']['package_id']))
					{
						$amt_package = 0;
						$request_det['Health']['indi_package_amt'] = $amt_package;
					}
					if(!empty($request_details['Health']['service_id']))
					{
						$expl_srv= explode(',',$request_details['Health']['service_id']);
						$amt_srv = 0;
						foreach($expl_srv as $key => $val)
						{
							$find_mrp_srv = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_srv = ($find_mrp_srv['Test']['mrp']+$amt_srv);
							$amt_srv = $amt_srv;
						}
						$request_det['Health']['indi_service_amt'] = $amt_srv;
					}
					if(empty($request_details['Health']['service_id']))
					{
						$amt_srv = 0;
						$request_det['Health']['indi_service_amt'] = $amt_srv;
					}
					$request_det['Health']['id'] = $request_details['Health']['id'];
					$request_det['Health']['patient_name'] = strtoupper($request_details['Health']['name']);
					$request_det['Health']['gender'] = $gender;
					$request_det['Health']['age'] = $request_details['Health']['age'].' Years';
					$request_det['Health']['balance_refund'] = $request_details['Health']['balance_refund'];
					$request_det['Health']['refund_status'] = $request_details['Health']['refund_status'];
					//11-09-13 Starts
					$request_det['Health']['register_sample'] = $request_details['Health']['register_sample'];
					$request_det['Health']['sent_pathcorp_admin'] = $request_details['Health']['sent_pathcorp_admin'];
					$find_admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$request_details['Health']['sent_pathcorp_admin'])));
					$request_det['Health']['sent_pathcorp_admin_name'] = $find_admin_name['Admin']['name'];
					$vial_info = $this->Vial->find('first',array('conditions'=>array('Vial.request_id'=>$req_id)));
					$request_det['Health']['vial_id'] = $vial_info['Vial']['id'];
					$request_det['Health']['vial_created'] = $vial_info['Vial']['created'];
					$request_det['Health']['col1'] = $vial_info['Vial']['col1'];
					$request_det['Health']['col2'] = $vial_info['Vial']['col2'];
					$request_det['Health']['col3'] = $vial_info['Vial']['col3'];
					$request_det['Health']['col4'] = $vial_info['Vial']['col4'];
					$request_det['Health']['col5'] = $vial_info['Vial']['col5'];
					$request_det['Health']['col6'] = $vial_info['Vial']['col6'];
					$request_det['Health']['col7'] = $vial_info['Vial']['col7'];
					$request_det['Health']['remark1'] = $vial_info['Vial']['remark1'];
					$request_det['Health']['remark2'] = $vial_info['Vial']['remark2'];
					$request_det['Health']['remark3'] = $vial_info['Vial']['remark3'];
					$request_det['Health']['remark4'] = $vial_info['Vial']['remark4'];
					$request_det['Health']['remark5'] = $vial_info['Vial']['remark5'];
					$request_det['Health']['remark6'] = $vial_info['Vial']['remark6'];
					$request_det['Health']['remark7'] = $vial_info['Vial']['remark7'];
					$request_det['Health']['sent_pathcorp_date'] = date('d-m-Y',strtotime($vial_info['Vial']['created']));
					//11-09-13 Ends
					//12-09-13 Starts
					$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
					$this->set('timelabs',$timelabs);
					$request_det['Health']['cancelled_status'] = $request_details['Health']['cancelled_status'];
					$request_det['Health']['cancelled_reason'] = $request_details['Health']['cancelled_reason'];
					$request_det['Health']['reschduled'] = $request_details['Health']['reschduled'];
					$request_det['Health']['city_idd'] = $request_details['Health']['city_id'];
					//12-09-13 Ends
					if($request_details['Health']['refund_status'] == 1)
					{
						$find_refund_person = $this->Paytrack->find('first',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Refund')));
						$explode_date_refund = explode(' ',$find_refund_person['Paytrack']['receive_date']);
						$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$find_refund_person['Paytrack']['admin_id'])));
						$request_det['Health']['refund_admin_name'] = 'Rs. '.$request_details['Health']['balance_refund'].' has been refunded by '.$admin_name['Admin']['name'].' on '.date('d-m-Y',strtotime($explode_date_refund[0]));
					}
					if($request_details['Health']['received_amount'] != 0)
					{
						$find_receive_amounts = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Receive')));
						$c = 0;
						foreach($find_receive_amounts as $key => $val)
						{
							$admin_per_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$val['Paytrack']['admin_id'])));
							$find_receive_amounts[$c]['Paytrack']['admin_receive_name'] = $admin_per_name['Admin']['name'];
							$explode_rec_date = explode(' ',$val['Paytrack']['receive_date']);
							$find_receive_amounts[$c]['Paytrack']['admin_receive_date'] = $explode_rec_date[0];
							$c++;
						}
						$request_det['Health']['receive_tracks'] = $find_receive_amounts;
					}
					$request_det['Health']['test_names'] = $test_name;
					$request_det['Health']['profile_names'] = $profile_name;
					$request_det['Health']['offer_names'] = $offer_name;
					$request_det['Health']['package_names'] = $package_name;
					$request_det['Health']['service_names'] = $service_name;
					$request_det['Health']['edit_test_name'] = $edit_test_name;
					$request_det['Health']['edit_profile_name'] = $edit_profile_name;
					$request_det['Health']['edit_offer_name'] = $edit_offer_name;
					$request_det['Health']['edit_package_name'] = $edit_package_name;
					$request_det['Health']['edit_service_name'] = $edit_services_name;
					$request_det['Health']['test_sel_ids'] = str_replace(',','*',$request_details['Health']['test_id']);
					$request_det['Health']['profile_sel_ids'] = str_replace(',','*',$request_details['Health']['profile_id']);
					$request_det['Health']['offer_sel_ids'] = str_replace(',','*',$request_details['Health']['offer_id']);
					$request_det['Health']['package_sel_ids'] = str_replace(',','*',$request_details['Health']['package_id']);
					$request_det['Health']['service_sel_ids'] = str_replace(',','*',$request_details['Health']['service_id']);
					$request_det['Health']['UserID'] = $request_details['Health']['user_id'];
					$find_user_contact_email = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
					$request_det['Health']['email'] = $find_user_contact_email['User']['email'];
					$request_det['Health']['test_amt'] = $request_details['Health']['total_amount'];
					$request_det['Health']['remarks'] = $request_details['Health']['remarks'];
					$request_det['Health']['receive_amt'] = $request_details['Health']['received_amount'];
					if($request_details['Health']['received_amount'] == 0)
					{
						$request_det['Health']['balance_amt'] = $request_details['Health']['total_amount'];
					}
					if($request_details['Health']['received_amount'] != 0)
					{
						$request_det['Health']['balance_amt'] = $request_details['Health']['balance_amount'];
					}
					$visit_lab_1 = $request_details['Health']['city'];
					$visit_lab_2 = $request_details['Health']['sample_time'];
					$visit_lab_3 = $request_details['Health']['sample_date'];
					$home_collection_1 = $request_details['Health']['sample_time1'];
					$home_collection_2 = $request_details['Health']['sample_date1'];
					$home_collection_3 = $request_details['Health']['address'];
					$this->Timelab = ClassRegistry::init('Timelab');
					$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
					if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
					{
						$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
						$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
						$visit_time = $timelabs[$visit_lab_2];						
						$request_det['Health']['visit_lab_collect_time'] = $visit_time;
						$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
					}
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
					{
						$collect_time = $timelabs[$home_collection_1];						
						$request_det['Health']['home_collect_time'] = $collect_time;
						$request_det['Health']['home_collect_date'] = $home_collection_2;
						$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
						$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
						$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
						$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
						$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
						$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
						$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
						$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
						$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
						$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
					}
					if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
					{
						$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
						$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
						$visit_time = $timelabs[$visit_lab_2];						
						$request_det['Health']['visit_lab_collect_time'] = $visit_time;
						$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
					}
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
					{
						$collect_time = $timelabs[$home_collection_1];				
						
						$request_det['Health']['home_collect_time'] = $collect_time;
						$request_det['Health']['home_collect_date'] = $home_collection_2;
						$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
						$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
						$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
						$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
						$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
						$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
						$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
						$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
						$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
						$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
					}
					$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
					$request_det['Health']['contact'] = $contact['User']['contact'];
					$request_det['Health']['remark'] = $request_details['Health']['remark'];
					$request_det['Health']['pay_status'] = $request_details['Health']['pay_status'];
					$request_det['Health']['patient_report'] = $request_details['Health']['patient_report'];
					
					if($request_det['Health']['discount_id'] == 12)
					{
						$request_det['Health']['test_amt'] = 0;
					}
					$this->data = $request_det;
				}
				else
				{
					$this->Session->setFlash('Invalid Request','flash_failure');
					$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',base64_encode($request_details['Health']['id'])));
				}
			}
		}
		$tests = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'TEST')));
		$profiles = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE')));
		$offers = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1)));
		$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
		$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city);
		$state = $this->State->find('all',array('conditions'=>array('State.status'=>1)));
		$this->set('timelabs',$timelabs);
		$this->set('tests',$tests);
		$this->set('profiles',$profiles);
		$this->set('offers',$offers);
		$this->set('state',$state);
	}

	function admin_delete_single_test()
	{
		$req_id = $_REQUEST['req_id'];
		$test_id = $_REQUEST['test_id'];
		$disc_code = $_REQUEST['discount'];
		$all_test = $_REQUEST['all_test'];
		$home_report = $_REQUEST['home_report'];
		$get_request_curr_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($get_request_curr_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_request_curr_detail['Health']['test_id']);
			$test_amt = 0;
			$test_vals = array();
			$new_val = array();
			$k = 0;
			foreach($expl_test as $test_key => $test_val)
			{
				if($test_val != $test_id)
				{
					$get_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
					$test_amt = ($get_mrp_test['Test']['mrp']+$test_amt);
					$test_vals[$k]['name'] = $get_mrp_test['Test']['test_parameter'].' - Rs.'.$get_mrp_test['Test']['mrp'];
					$test_vals[$k]['test_id'] = $test_val;
					$new_val[] = $test_val;
					$k++;
				}
			}
		}
		if(!empty($get_request_curr_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_request_curr_detail['Health']['profile_id']);
			$profile_amt = 0;
			foreach($expl_profile as $profile_key => $profile_val)
			{
				$get_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
				$profile_amt = ($get_mrp_profile['Test']['mrp']+$profile_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_request_curr_detail['Health']['offer_id']);
			$offer_amt = 0;
			foreach($expl_offer as $offer_key => $offer_val)
			{
				$get_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
				$offer_amt = ($get_mrp_offer['Banner']['banner_mrp']+$offer_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['package_id']))
		{
			$expl_pack = explode(',',$get_request_curr_detail['Health']['package_id']);
			$pack_amt = 0;
			foreach($expl_pack as $pack_key => $pack_val)
			{
				$get_mrp_pack = $this->Package->find('first',array('conditions'=>array('Package.id'=>$pack_val)));
				$pack_amt = ($get_mrp_pack['Package']['package_mrp']+$pack_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_request_curr_detail['Health']['service_id']);
			$service_amt = 0;
			foreach($expl_service as $service_key => $service_val)
			{
				$get_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$service_val)));
				$service_amt = ($get_mrp_service['Test']['mrp']+$service_amt);
			}
		}
		$total_amount_current = ($test_amt+$profile_amt+$offer_amt+$pack_amt+$service_amt);
		$amt_3='';
		
		if(!empty($disc_code))
		{
			$find_disc = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
			if($find_disc['Discount']['type'] == 'Percent')
			{
				$amt_1 = ($find_disc['Discount']['amount']/100);
				$amt_2 = ($total_amount_current*$amt_1);
				$amt_3 = ($total_amount_current-$amt_2);
			}
			if($find_disc['Discount']['type'] == 'Rupees')
			{
				$amt_3 = ($total_amount_current-$find_disc['Discount']['amount']);
			}
		}
		else
		{
			$amt_3 = $total_amount_current;
		}
		if(!empty($get_request_curr_detail['Health']['discount_amount']))
		{
			$amt_4 = ($total_amount_current-$get_request_curr_detail['Health']['discount_amount']);
		}
		else
		{
			$amt_4 = $amt_3;
		}
		$updated_tot_amount = $amt_4;
		if($get_request_curr_detail['Health']['received_amount'] == 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = 0;
			$final_balance_amount = $updated_tot_amount;
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($get_request_curr_detail['Health']['received_amount'] != 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = $get_request_curr_detail['Health']['received_amount'];
			$final_balance_amount = ($updated_tot_amount-$final_receive_amount);
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($home_report == 'Yes')
		{
			$get_updated_for_home_report = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			$report_yes_amt = ($get_updated_for_home_report['Health']['total_amount']+50);
			if($get_updated_for_home_report['Health']['received_amount'] == 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = 0;
				$final_balance_amount = $report_yes_amt;
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
			if($get_updated_for_home_report['Health']['received_amount'] != 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = $get_updated_for_home_report['Health']['received_amount'];
				$final_balance_amount = ($report_yes_amt-$final_receive_amount);
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
		}
		/*if($home_report == 'No')
		{
		$get_updated_for_home_report = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		$report_no_amt = ($get_updated_for_home_report['Health']['total_amount']-50);
		if($get_updated_for_home_report['Health']['received_amount'] == 0)
		{
		$final_total_amount = $report_no_amt;
		$final_receive_amount = 0;
		$final_balance_amount = $report_no_amt;
		$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='0' WHERE id='".$req_id."'");
		$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($get_updated_for_home_report['Health']['received_amount'] != 0)
		{
		$final_total_amount = $report_no_amt;
		$final_receive_amount = $get_updated_for_home_report['Health']['received_amount'];
		$final_balance_amount = ($report_no_amt-$final_receive_amount);
		$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='0' WHERE id='".$req_id."'");
		$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		}
		*/
		$implode_test_val = implode(',',$new_val);
		$update_row = $this->Health->query("UPDATE healths SET test_id='".$implode_test_val."' WHERE id='".$req_id."'");
		$update_billing_row = $this->Billing->query("UPDATE billings SET test_id='".$implode_test_val."' WHERE request_id='".$req_id."'");
		$delete_request_id = $this->RequestTest->query("DELETE FROM request_test WHERE health_id='".$req_id."' AND test_id='".$test_id."' AND type='TE'");
		$find_tot_amt_new = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		$x['success'] = 'success';
		$x['total_amt'] = $find_tot_amt_new['Health']['total_amount'];
		$x['new_tests'] = $test_vals;
		$x['implode_test'] = $implode_test_val;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}

	function admin_delete_single_profile()
	{
		$req_id = $_REQUEST['req_id'];
		$test_id = $_REQUEST['test_id'];
		$disc_code = $_REQUEST['discount'];
		$all_test = $_REQUEST['all_test'];
		$home_report = $_REQUEST['home_report'];
		$get_request_curr_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($get_request_curr_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_request_curr_detail['Health']['test_id']);
			$test_amt = 0;
			foreach($expl_test as $test_key => $test_val)
			{
				$get_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
				$test_amt = ($get_mrp_test['Test']['mrp']+$test_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_request_curr_detail['Health']['profile_id']);
			$profile_amt = 0;
			$test_vals = array();
			$new_val = array();
			$k = 0;
			foreach($expl_profile as $profile_key => $profile_val)
			{
				if($profile_val != $test_id)
				{
					$get_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
					$profile_amt = ($get_mrp_profile['Test']['mrp']+$profile_amt);
					$test_vals[$k]['name'] = $get_mrp_profile['Test']['test_parameter'].' - Rs.'.$get_mrp_profile['Test']['mrp'];
					$test_vals[$k]['test_id'] = $profile_val;
					$new_val[] = $profile_val;
					$k++;
				}
			}
		}
		if(!empty($get_request_curr_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_request_curr_detail['Health']['offer_id']);
			$offer_amt = 0;
			foreach($expl_offer as $offer_key => $offer_val)
			{
				$get_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
				$offer_amt = ($get_mrp_offer['Banner']['banner_mrp']+$offer_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['package_id']))
		{
			$expl_pack = explode(',',$get_request_curr_detail['Health']['package_id']);
			$pack_amt = 0;
			foreach($expl_pack as $pack_key => $pack_val)
			{
				$get_mrp_pack = $this->Package->find('first',array('conditions'=>array('Package.id'=>$pack_val)));
				$pack_amt = ($get_mrp_pack['Package']['package_mrp']+$pack_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_request_curr_detail['Health']['service_id']);
			$service_amt = 0;
			foreach($expl_service as $service_key => $service_val)
			{
				$get_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$service_val)));
				$service_amt = ($get_mrp_service['Test']['mrp']+$service_amt);
			}
		}
		$total_amount_current = ($test_amt+$profile_amt+$offer_amt+$pack_amt+$service_amt);
		if(!empty($disc_code))
		{
			$find_disc = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
			if($find_disc['Discount']['type'] == 'Percent')
			{
				$amt_1 = ($find_disc['Discount']['amount']/100);
				$amt_2 = ($total_amount_current*$amt_1);
				$amt_3 = ($total_amount_current-$amt_2);
			}
			if($find_disc['Discount']['type'] == 'Rupees')
			{
				$amt_3 = ($total_amount_current-$find_disc['Discount']['amount']);
			}
		}
		else
		{
			$amt_3 = 0;
		}
		if(!empty($get_request_curr_detail['Health']['discount_amount']))
		{
			$amt_4 = ($total_amount_current-$get_request_curr_detail['Health']['discount_amount']);
		}
		else
		{
			$amt_4 = 0;
		}
		$updated_tot_amount = ($amt_3+$amt_4);
		if($get_request_curr_detail['Health']['received_amount'] == 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = 0;
			$final_balance_amount = $updated_tot_amount;
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($get_request_curr_detail['Health']['received_amount'] != 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = $get_request_curr_detail['Health']['received_amount'];
			$final_balance_amount = ($updated_tot_amount-$final_receive_amount);
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($home_report == 'Yes')
		{
			$get_updated_for_home_report = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			$report_yes_amt = ($get_updated_for_home_report['Health']['total_amount']+50);
			if($get_updated_for_home_report['Health']['received_amount'] == 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = 0;
				$final_balance_amount = $report_yes_amt;
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
			if($get_updated_for_home_report['Health']['received_amount'] != 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = $get_updated_for_home_report['Health']['received_amount'];
				$final_balance_amount = ($report_yes_amt-$final_receive_amount);
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
		}
		$implode_test_val = implode(',',$new_val);
		$update_row = $this->Health->query("UPDATE healths SET profile_id='".$implode_test_val."' WHERE id='".$req_id."'");
		$update_billing_row = $this->Billing->query("UPDATE billings SET profile_id='".$implode_test_val."' WHERE request_id='".$req_id."'");
		$delete_request_id = $this->RequestTest->query("DELETE FROM request_test WHERE health_id='".$req_id."' AND test_id='".$test_id."' AND type='PR'");
		$find_tot_amt_new = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		$x['success'] = 'success';
		$x['total_amt'] = $find_tot_amt_new['Health']['total_amount'];
		$x['new_tests'] = $test_vals;
		$x['implode_test'] = $implode_test_val;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	function admin_delete_single_offer()
	{
		$req_id = $_REQUEST['req_id'];
		$test_id = $_REQUEST['test_id'];
		$disc_code = $_REQUEST['discount'];
		$all_test = $_REQUEST['all_test'];
		$home_report = $_REQUEST['home_report'];
		$get_request_curr_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($get_request_curr_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_request_curr_detail['Health']['test_id']);
			$test_amt = 0;
			foreach($expl_test as $test_key => $test_val)
			{
				$get_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
				$test_amt = ($get_mrp_test['Test']['mrp']+$test_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_request_curr_detail['Health']['profile_id']);
			$profile_amt = 0;
			foreach($expl_profile as $profile_key => $profile_val)
			{
				$get_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
				$profile_amt = ($get_mrp_profile['Test']['mrp']+$profile_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_request_curr_detail['Health']['offer_id']);
			$offer_amt = 0;
			$test_vals = array();
			$new_val = array();
			$k = 0;
			foreach($expl_offer as $offer_key => $offer_val)
			{
				if($offer_val != $test_id)
				{
					$get_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
					$offer_amt = ($get_mrp_offer['Banner']['banner_mrp']+$offer_amt);
					$test_vals[$k]['name'] = $get_mrp_offer['Banner']['banner_name'].' - Rs.'.$get_mrp_offer['Banner']['banner_mrp'];
					$test_vals[$k]['test_id'] = $offer_val;
					$new_val[] = $offer_val;
					$k++;
				}
			}
		}
		if(!empty($get_request_curr_detail['Health']['package_id']))
		{
			$expl_pack = explode(',',$get_request_curr_detail['Health']['package_id']);
			$pack_amt = 0;
			foreach($expl_pack as $pack_key => $pack_val)
			{
				$get_mrp_pack = $this->Package->find('first',array('conditions'=>array('Package.id'=>$pack_val)));
				$pack_amt = ($get_mrp_pack['Package']['package_mrp']+$pack_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_request_curr_detail['Health']['service_id']);
			$service_amt = 0;
			foreach($expl_service as $service_key => $service_val)
			{
				$get_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$service_val)));
				$service_amt = ($get_mrp_service['Test']['mrp']+$service_amt);
			}
		}
		$total_amount_current = ($test_amt+$profile_amt+$offer_amt+$pack_amt+$service_amt);
		$amt_3=0;
		if(!empty($disc_code))
		{
			$find_disc = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
			if($find_disc['Discount']['type'] == 'Percent')
			{
				$amt_1 = ($find_disc['Discount']['amount']/100);
				$amt_2 = ($total_amount_current*$amt_1);
				$amt_3 = ($total_amount_current-$amt_2);
			}
			if($find_disc['Discount']['type'] == 'Rupees')
			{
				$amt_3 = ($total_amount_current-$find_disc['Discount']['amount']);
			}
		}
		else
		{
			$amt_3 = $total_amount_current;
		}
		if(!empty($get_request_curr_detail['Health']['discount_amount']))
		{
			$amt_3 = ($amt_3-$get_request_curr_detail['Health']['discount_amount']);
		}
		$updated_tot_amount = ($amt_3);
		if($get_request_curr_detail['Health']['received_amount'] == 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = 0;
			$final_balance_amount = $updated_tot_amount;
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($get_request_curr_detail['Health']['received_amount'] != 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = $get_request_curr_detail['Health']['received_amount'];
			$final_balance_amount = ($updated_tot_amount-$final_receive_amount);
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($home_report == 'Yes')
		{
			$get_updated_for_home_report = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			$report_yes_amt = ($get_updated_for_home_report['Health']['total_amount']+50);
			if($get_updated_for_home_report['Health']['received_amount'] == 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = 0;
				$final_balance_amount = $report_yes_amt;
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
			if($get_updated_for_home_report['Health']['received_amount'] != 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = $get_updated_for_home_report['Health']['received_amount'];
				$final_balance_amount = ($report_yes_amt-$final_receive_amount);
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
		}
		$implode_test_val = implode(',',$new_val);
		$update_row = $this->Health->query("UPDATE healths SET offer_id='".$implode_test_val."' WHERE id='".$req_id."'");
		$update_billing_row = $this->Billing->query("UPDATE billings SET offer_id='".$implode_test_val."' WHERE request_id='".$req_id."'");
		$delete_request_id = $this->RequestTest->query("DELETE FROM request_test WHERE health_id='".$req_id."' AND test_id='".$test_id."' AND type='OF'");
		$find_tot_amt_new = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		$x['success'] = 'success';
		$x['total_amt'] = $find_tot_amt_new['Health']['total_amount'];
		$x['new_tests'] = $test_vals;
		$x['implode_test'] = $implode_test_val;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	function admin_delete_single_package()
	{
		$req_id = $_REQUEST['req_id'];
		$test_id = $_REQUEST['test_id'];
		$disc_code = $_REQUEST['discount'];
		$all_test = $_REQUEST['all_test'];
		$home_report = $_REQUEST['home_report'];
		$disc_amt = $_REQUEST['disc_amt'];
		$get_request_curr_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($get_request_curr_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_request_curr_detail['Health']['test_id']);
			$test_amt = 0;
			foreach($expl_test as $test_key => $test_val)
			{
				$get_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
				$test_amt = ($get_mrp_test['Test']['mrp']+$test_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_request_curr_detail['Health']['profile_id']);
			$profile_amt = 0;
			foreach($expl_profile as $profile_key => $profile_val)
			{
				$get_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
				$profile_amt = ($get_mrp_profile['Test']['mrp']+$profile_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_request_curr_detail['Health']['offer_id']);
			$offer_amt = 0;
			foreach($expl_offer as $offer_key => $offer_val)
			{
				$get_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
				$offer_amt = ($get_mrp_offer['Banner']['banner_mrp']+$offer_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['package_id']))
		{
			$expl_pack = explode(',',$get_request_curr_detail['Health']['package_id']);
			$pack_amt = 0;
			$test_vals = array();
			$new_val = array();
			$k = 0;
			foreach($expl_pack as $pack_key => $pack_val)
			{
				if($pack_val != $test_id)
				{
					$get_mrp_pack = $this->Package->find('first',array('conditions'=>array('Package.id'=>$pack_val)));
					$pack_amt = ($get_mrp_pack['Package']['package_mrp']+$pack_amt);
					$test_vals[$k]['name'] = $get_mrp_pack['Package']['package_name'].' - Rs.'.$get_mrp_service['Package']['package_mrp'];
					$test_vals[$k]['test_id'] = $pack_val;
					$new_val[] = $pack_val;
					$k++;
				}
			}
		}
		if(!empty($get_request_curr_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_request_curr_detail['Health']['service_id']);
			$service_amt = 0;
			foreach($expl_service as $service_key => $service_val)
			{
				$get_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$service_val)));
				$service_amt = ($get_mrp_service['Test']['mrp']+$service_amt);
			}
		}
		$total_amount_current = ($test_amt+$profile_amt+$offer_amt+$pack_amt+$service_amt);
		if(!empty($disc_code))
		{
			$find_disc = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
			if($find_disc['Discount']['type'] == 'Percent')
			{
				$amt_1 = ($find_disc['Discount']['amount']/100);
				$amt_2 = ($total_amount_current*$amt_1);
				$amt_3 = ($total_amount_current-$amt_2);
			}
			if($find_disc['Discount']['type'] == 'Rupees')
			{
				$amt_3 = ($total_amount_current-$find_disc['Discount']['amount']);
			}
		}
		else
		{
			$amt_3 = 0;
		}
		if(!empty($get_request_curr_detail['Health']['discount_amount']))
		{
			$amt_4 = ($total_amount_current-$get_request_curr_detail['Health']['discount_amount']);
		}
		else
		{
			$amt_4 = 0;
		}
		$updated_tot_amount = ($amt_3+$amt_4);
		if($get_request_curr_detail['Health']['received_amount'] == 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = 0;
			$final_balance_amount = $updated_tot_amount;
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($get_request_curr_detail['Health']['received_amount'] != 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = $get_request_curr_detail['Health']['received_amount'];
			$final_balance_amount = ($updated_tot_amount-$final_receive_amount);
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($home_report == 'Yes')
		{
			$get_updated_for_home_report = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			$report_yes_amt = ($get_updated_for_home_report['Health']['total_amount']+50);
			if($get_updated_for_home_report['Health']['received_amount'] == 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = 0;
				$final_balance_amount = $report_yes_amt;
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
			if($get_updated_for_home_report['Health']['received_amount'] != 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = $get_updated_for_home_report['Health']['received_amount'];
				$final_balance_amount = ($report_yes_amt-$final_receive_amount);
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
		}
		$implode_test_val = implode(',',$new_val);
		$update_row = $this->Health->query("UPDATE healths SET package_id='".$implode_test_val."' WHERE id='".$req_id."'");
		$update_billing_row = $this->Billing->query("UPDATE billings SET package_id='".$implode_test_val."' WHERE request_id='".$req_id."'");
		$delete_request_id = $this->RequestTest->query("DELETE FROM request_test WHERE health_id='".$req_id."' AND test_id='".$test_id."' AND type='PA'");
		$find_tot_amt_new = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		$x['success'] = 'success';
		$x['total_amt'] = $find_tot_amt_new['Health']['total_amount'];
		$x['new_tests'] = $test_vals;
		$x['implode_test'] = $implode_test_val;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	function admin_delete_single_service()
	{
		$req_id = $_REQUEST['req_id'];
		$service_id = $_REQUEST['service_id'];
		$disc_code = $_REQUEST['discount'];
		$all_test = $_REQUEST['all_test'];
		$home_report = $_REQUEST['home_report'];
		$get_request_curr_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($get_request_curr_detail['Health']['test_id']))
		{
			$expl_test = explode(',',$get_request_curr_detail['Health']['test_id']);
			$test_amt = 0;
			foreach($expl_test as $test_key => $test_val)
			{
				$get_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
				$test_amt = ($get_mrp_test['Test']['mrp']+$test_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['profile_id']))
		{
			$expl_profile = explode(',',$get_request_curr_detail['Health']['profile_id']);
			$profile_amt = 0;
			foreach($expl_profile as $profile_key => $profile_val)
			{
				$get_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
				$profile_amt = ($get_mrp_profile['Test']['mrp']+$profile_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['offer_id']))
		{
			$expl_offer = explode(',',$get_request_curr_detail['Health']['offer_id']);
			$offer_amt = 0;
			foreach($expl_offer as $offer_key => $offer_val)
			{
				$get_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
				$offer_amt = ($get_mrp_offer['Banner']['banner_mrp']+$offer_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['package_id']))
		{
			$expl_pack = explode(',',$get_request_curr_detail['Health']['package_id']);
			$pack_amt = 0;
			foreach($expl_pack as $pack_key => $pack_val)
			{
				$get_mrp_pack = $this->Package->find('first',array('conditions'=>array('Package.id'=>$pack_val)));
				$pack_amt = ($get_mrp_pack['Package']['package_mrp']+$pack_amt);
			}
		}
		if(!empty($get_request_curr_detail['Health']['service_id']))
		{
			$expl_service = explode(',',$get_request_curr_detail['Health']['service_id']);
			$service_amt = 0;
			$test_vals = array();
			$new_val = array();
			$k = 0;
			foreach($expl_service as $service_key => $service_val)
			{
				if($service_val != $service_id)
				{
					$get_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$service_val)));
					$service_amt = ($get_mrp_service['Test']['mrp']+$service_amt);
					$test_vals[$k]['name'] = $get_mrp_service['Test']['test_parameter'].' - Rs.'.$get_mrp_service['Test']['mrp'];
					$test_vals[$k]['test_id'] = $service_val;
					$new_val[] = $service_val;
					$k++;
				}
			}
		}
		//echo "<pre>"; print_r($test_vals); exit;
		$total_amount_current = ($test_amt+$profile_amt+$offer_amt+$pack_amt+$service_amt);
		if($get_request_curr_detail['Health']['discount_id'] != 0)
		{
			$find_disc = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$disc_code)));
			if($find_disc['Discount']['type'] == 'Percent')
			{
				$amt_1 = ($find_disc['Discount']['amount']/100);
				$amt_2 = ($total_amount_current*$amt_1);
				$amt_3 = ($total_amount_current-$amt_2);
			}
			if($find_disc['Discount']['type'] == 'Rupees')
			{
				$amt_3 = ($total_amount_current-$find_disc['Discount']['amount']);
			}
		}
		else
		{
			$amt_3 = 0;
		}
		if(!empty($get_request_curr_detail['Health']['discount_amount']))
		{
			$amt_4 = ($total_amount_current-$get_request_curr_detail['Health']['discount_amount']);
		}
		else
		{
			$amt_4 = 0;
		}
		$updated_tot_amount = ($amt_3+$amt_4);
		if($get_request_curr_detail['Health']['received_amount'] == 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = 0;
			$final_balance_amount = $updated_tot_amount;
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($get_request_curr_detail['Health']['received_amount'] != 0)
		{
			$final_total_amount = $updated_tot_amount;
			$final_receive_amount = $get_request_curr_detail['Health']['received_amount'];
			$final_balance_amount = ($updated_tot_amount-$final_receive_amount);
			$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."' WHERE id='".$req_id."'");
			$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
		}
		if($home_report == 'Yes')
		{
			$get_updated_for_home_report = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			$report_yes_amt = ($get_updated_for_home_report['Health']['total_amount']+50);
			if($get_updated_for_home_report['Health']['received_amount'] == 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = 0;
				$final_balance_amount = $report_yes_amt;
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
			if($get_updated_for_home_report['Health']['received_amount'] != 0)
			{
				$final_total_amount = $report_yes_amt;
				$final_receive_amount = $get_updated_for_home_report['Health']['received_amount'];
				$final_balance_amount = ($report_yes_amt-$final_receive_amount);
				$update_health_row = $this->Health->query("UPDATE healths SET total_amount='".$final_total_amount."',received_amount='".$final_receive_amount."',balance_amount='".$final_balance_amount."',home_report='1' WHERE id='".$req_id."'");
				$update_billing_row = $this->Billing->query("UPDATE billings SET sub_total='".$final_total_amount."' WHERE request_id='".$req_id."'");
			}
		}
		$implode_test_val = implode(',',$new_val);
		$update_row = $this->Health->query("UPDATE healths SET service_id='".$implode_test_val."' WHERE id='".$req_id."'");
		$update_billing_row = $this->Billing->query("UPDATE billings SET service_id='".$implode_test_val."' WHERE request_id='".$req_id."'");
		$delete_request_id = $this->RequestTest->query("DELETE FROM request_test WHERE health_id='".$req_id."' AND test_id='".$service_id."' AND type='SR'");
		$find_tot_amt_new = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		$x['success'] = 'success';
		$x['total_amt'] = $find_tot_amt_new['Health']['total_amount'];
		$x['new_tests'] = $test_vals;
		$x['implode_test'] = $implode_test_val;
		$m['test_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	function admin_get_pcc()
	{
		$request_id = $_REQUEST['id'];
		$pin = $this->Health->find('first',array('conditions'=>array('Health.id'=>$request_id)));
		$pcc_id = $this->LabPincodeServicibility->find('all',array('conditions'=>array('LabPincodeServicibility.pincode'=>$pin['Health']['pincode'])));
		$pcc_list = $this->Lab->find('list',array('conditions'=>array('Lab.status'=>1),'fields'=>array('Lab.id','Lab.pcc_name')));
		$lablist =array();
		array_push($lablist,(int)$pin['Health']['created_by']);
		foreach($pcc_id as $val)
		{
			array_push($lablist,(int)$val['LabPincodeServicibility']['lab_id']);
		}
		
		$lab_list = array_unique($lablist);
		$pcc_list = array();
		foreach($lab_list as $val)
		{
			$ser_pcc = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val)));
			array_push($pcc_list,$ser_pcc);
		}
		//$samplerequestlist[$k]['Health']['lab_list'] = $lablist;
		
		//$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1,'Lab.show_to_world'=>1),'order'=>array('Lab.sequence'=>'asc')));
		//$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.id IN'=>$lab_list)));
		if(!empty($pcc_list))
		{
			$x['success'] = 'success';
			$x['pcc_list'] = $pcc_list;
		}
		else
		{
			$x['success'] = 'notsuccess';
		}
		$m['pcc_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	function admin_add_pcc()
	{
		$this->ServicedByApi = ClassRegistry::init('ServicedByApi');
		$serviceapi = $this->ServicedByApi->find('list',array('fields'=>array('ServicedByApi.id','ServicedByApi.name')));
		$this->set('serviceapi',$serviceapi);
		$this->RateList = ClassRegistry::init('Ratelist');
		$rate = $this->RateList->find('list',array('fields'=>array('Ratelist.id','Ratelist.name')));
		
		$pcc_list = $this->Lab->find('list',array('conditions'=>array('Lab.status'=>1),'fields'=>array('Lab.id','Lab.pcc_name')));
		$this->set('lablist',$pcc_list);
		$this->set('rate',$rate);
		
		$this->set('title_for_layout','Niramayahealthcare Admin | Add PCC Panel');
		if(!empty($this->data))
		{
            if($this->data['Lab']['show_to_world'] == 0)
                $this->data['Lab']['show_to_world']=2;
            else
                $this->data['Lab']['show_to_world']=1;
            //$this->data['Lab']['pcc_lab_name'] = $this->data['Lab']['pcc_lab_value'];
			if($this->Lab->create($this->data))
			{
				$find_duplicate_two = $this->Lab->find('first',array('conditions'=>array('Lab.pcc_lab_value'=>$this->data['Lab']['pcc_lab_value'])));
				if(empty($find_duplicate_two))
				{
					$this->data['Lab']['status'] = 1;
					if($this->Lab->save($this->data,false))
					{
						$last_pcc_id = $this->Lab->getLastInsertId();
						if($this->data['Lab']['client_type']=='B')
						{
							$this->Lab->query("update labs set parent_pcc_id='".$this->data['Lab']['parent_pcc_id']."' where id='".$last_pcc_id."'");
						}
						else
						{
							$this->Lab->query("update labs set parent_pcc_id='".$last_pcc_id."' where id='".$last_pcc_id."'");
						}
						$this->Session->setFlash('PCC added successfully','flash_success');
						$this->redirect(array('controller'=>'samples','action'=>'view_pcc'));
					}
				}
				else
				{
					$this->Session->setFlash('Please enter another Lab Value','flash_failure');
				}
			}
		}
	}

	function admin_view_pcc()
	{
		$this->set('title_for_layout','Niramayahealthcare Admin | View PCC List(s)');
		if(isset($this->params['named']['pccname']) && $this->params['named']['pccname']!='')
		{
			$this->data['FilterPcc']['name'] = $this->params['named']['pccname'];
			$options['pccname'] = $this->params['named']['pccname'];
		}
		if(isset($this->params['named']['pcccontact']) && $this->params['named']['pcccontact']!='')
		{
			$this->data['FilterPcc']['contact'] = $this->params['named']['pcccontact'];
			$options['pcccontact'] = $this->params['named']['pcccontact'];
		}
		if(isset($this->params['named']['pccemail']) && $this->params['named']['pccemail']!='')
		{
			$this->data['FilterPcc']['email'] = $this->params['named']['pccemail'];
			$options['pccemail'] = $this->params['named']['pccemail'];
		}
		if(isset($this->data) && !empty($this->data))
		{
			$pcc_name = $this->data['FilterPcc']['name'];
			$pcc_contact = $this->data['FilterPcc']['contact'];
			$pcc_email = $this->data['FilterPcc']['email'];
			if(!empty($pcc_name) && $pcc_name != '')
			{
				$conditions['Lab.pcc_name LIKE'] = '%'.$pcc_name.'%';
				$options['pccname'] = $pcc_name;
			}
			if(!empty($pcc_contact) && $pcc_contact != '')
			{
				$conditions['Lab.pcc_contact LIKE'] = '%'.$pcc_contact.'%';
				$options['pcccontact'] = $pcc_contac;
			}
			if(!empty($pcc_email) && $pcc_email != '')
			{
				$conditions['Lab.pcc_email LIKE'] = '%'.$pcc_email.'%';
				$options['pccemail'] = $pcc_email;
			}
			$this->paginate = array('Lab' => array('limit' =>'10','order'=>array('Lab.created DESC'),'conditions'=>$conditions));
			$lablist=$this->paginate('Lab');
			/*if(isset($this->data['Lab']['id']) && count($this->data['Lab']['id']) && trim($this->data['Page']['mode']) != ''){
			$this->update_labmode($this->data['Lab']['id'], $this->data['Page']['mode']);
			}
			else
			{
			// set message
			$this->Session->setFlash('Please select atlest one PCC to perform any action','flash_failure');
			}*/
		}
		else
		{
			$this->paginate = array('Lab' => array('limit' =>'10','order'=>array('Lab.created DESC')));
			$lablist=$this->paginate('Lab');
		}
		$this->set('lablist',$lablist);
		$this->RateList = ClassRegistry::init('Ratelist');
		$rate = $this->RateList->find('list',array('fields'=>array('Ratelist.id','Ratelist.name')));
		$this->set('rate',$rate);
		//print_R($rate);die;
	}

	function admin_edit_pcc($id=NULL)
	{
		$this->ServicedByApi = ClassRegistry::init('ServicedByApi');
		$serviceapi = $this->ServicedByApi->find('list',array('fields'=>array('ServicedByApi.id','ServicedByApi.name')));
		$this->set('serviceapi',$serviceapi);
		
		$this->set('title_for_layout','Niramayahealthcare Admin | Edit PCC');
		$pcc_id = base64_decode($id);
		$pcc_list = $this->Lab->find('list',array('conditions'=>array('Lab.status'=>1),'fields'=>array('Lab.id','Lab.pcc_name')));
		$this->set('lablist',$pcc_list);
		$header_status = '0';
		
		if($this->data['Lab']['custom_header_status']!=0)
			$header_status='1';
		if(!empty($this->data))
		{
			$hfile = $this->File->uploadFile($this->data['Lab']['custom_header'], CUSTOM_REPORT_HEADER_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG'));
			$pccData = $this->Lab->find('first',array('conditions'=>array('id'=>$pcc_id)));
			$filename = $pccData['Lab']['custom_header'];
			$header_status_data = $pccData['Lab']['custom_header_status'];
			foreach($pccData['Lab'] as $key=>$val)
			{
				$pccData['Lab'][$key] = $this->data['Lab'][$key];
			}
			if(!empty($this->data['Lab']['custom_header']['name']))
			{
				$pccData['Lab']['custom_header'] = $hfile['name'];
				$pccData['Lab']['custom_header_status'] = $header_status;
			}
			else
			{
				$pccData['Lab']['custom_header'] = $filename;
				$pccData['Lab']['custom_header_status'] = $header_status_data;
			}
			
			if($this->Lab->create($pccData))
			{
				if($this->data['Lab']['show_to_world'] == 0)
					$this->data['Lab']['show_to_world']=2;
				else
					$this->data['Lab']['show_to_world']=1;
				
				if($this->Lab->save($pccData))
				{
					if($this->data['Lab']['client_type']=='B')
					{
						$this->Lab->query("update labs set parent_pcc_id='".$this->data['Lab']['parent_pcc_id']."' where id='".$pcc_id."'");
					}
					else
					{
						$this->Lab->query("update labs set parent_pcc_id='".$pcc_id."' where id='".$pcc_id."'");
					}
					$this->auth['Api']['pcc_id'] = $pcc_id;
					$this->auth['Api']['authorization'] = $this->data['Api']['authorization'];
					$this->auth['Api']['created_on'] = date('Y-m-d H:i:s');
					$this->auth['Api']['created_by'] = '1';
					$this->auth['Api']['status_id'] = '1';
					$find_auth_detail = $this->Api->find('first',array('conditions'=>array('Api.pcc_id'=>$pcc_id)));
					
					if($find_auth_detail)
						$this->Api->delete($find_auth_detail['Api']['id']);	
					$this->Api->save($this->auth);
					$this->Session->setFlash('PCC updated successfully','flash_success');
					$this->redirect(array('controller'=>'samples','action'=>'view_pcc'));
				}
			}
		}
		else
		{
			$find_pcc_detail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$pcc_id)));
			$this->data = $find_pcc_detail;
			if($this->data['Lab']['show_to_world'] == 0 || $this->data['Lab']['show_to_world'] == 2)
				$this->data['Lab']['show_to_world']=0;
			else
				$this->data['Lab']['show_to_world']=1;
			$find_auth_detail = $this->Api->find('first',array('conditions'=>array('Api.pcc_id'=>$pcc_id)));
			if($find_auth_detail)
			{
				$this->data['Api']['authorization'] = $find_auth_detail['Api']['authorization'];	
			}
		}
	}

	function update_labmode($data, $mode){
		switch($mode){
			case 'activate':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Lab->id = $data[$ctr];
						$this->Lab->saveField('status', '1');
					}
				}
				// set message
				$this->Session->setFlash('PCC(s) have been activated','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_pcc'));
				break;
			case 'deactivate':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Lab->id = $data[$ctr];
						$this->Lab->saveField('status', '0');
					}
				}
				// set message
				$this->Session->setFlash('PCC(s) have been deactivated','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_pcc'));
				break;
			case 'delete':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Lab->delete($data[$ctr]);
					}
				}
				// set message
				$this->Session->setFlash('PCC(s) have been deleted','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_pcc'));
				break;
				break;
		}
	}

	function admin_view_patient_details($reqId = NULL,$entry = NULL)
	{
		$this->set('title_for_layout', 'View Sample Request');
		$req_id = base64_decode($reqId);
		if(!empty($this->data))
		{
			$get_req_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
			$implode = $get_req_detail['Health']['test_id'];
			$this->data['Health']['test_id'] = $implode;
			$implode_profile = $get_req_detail['Health']['profile_id'];
			$this->data['Health']['profile_id'] = $implode_profile;
			$implode_offer = $get_req_detail['Health']['offer_id'];
			$this->data['Health']['offer_id'] = $implode_offer;
			$implode_package = $get_req_detail['Health']['package_id'];
			$this->data['Health']['package_id'] = $implode_package;
			$implode_service = $get_req_detail['Health']['service_id'];
			$this->data['Health']['service_id'] = $implode_service;
			$this->data['Health']['total_amount'] = $get_req_detail['Health']['total_amount'];
			//For Editing Discount 03-10-13 Starts
			/*$amt_t = 0;
			if(!empty($this->data['Health']['test_id']))
			{
			$expl_tst = explode(',',$this->data['Health']['test_id']);
			foreach($expl_tst as $k => $v)
			{
			$amt_tst = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v)));
			$amt_t = ($amt_tst['Test']['mrp']+$amt_t);
			$amt_t = $amt_t;
			}
			}
			if(!empty($this->data['Health']['profile_id']))
			{
			$expl_prf = explode(',',$this->data['Health']['profile_id']);
			foreach($expl_prf as $k => $v)
			{
			$amt_prf = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v)));
			$amt_t = ($amt_prf['Test']['mrp']+$amt_t);
			$amt_t = $amt_t;
			}
			}
			if(!empty($this->data['Health']['offer_id']))
			{
			$expl_ofr = explode(',',$this->data['Health']['offer_id']);
			foreach($expl_ofr as $k => $v)
			{
			$amt_ofr = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v)));
			$amt_t = ($amt_ofr['Banner']['banner_mrp']+$amt_t);
			$amt_t = $amt_t;
			}
			}
			if(!empty($this->data['Health']['package_id']))
			{
			$expl_pkg = explode(',',$this->data['Health']['package_id']);
			foreach($expl_pkg as $k => $v)
			{
			$amt_pkg = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v)));
			$amt_t = ($amt_pkg['Package']['package_mrp']+$amt_t);
			$amt_t = $amt_t;
			}
			}
			$this->data['Health']['total_amount'] = $amt_t;*/
			//For Editing Discount 03-10-13 Ends
			$explode_age = explode(' ',$this->data['Health']['age']);
			$this->data['Health']['age'] = $explode_age[0];
			if(!empty($this->data['Health']['address_home1']) && !empty($this->data['Health']['home_locality']) && !empty($this->data['Health']['home_city']) && !empty($this->data['Health']['home_state']) && !empty($this->data['Health']['home_pincode']) && !empty($this->data['Health']['home_landmark']))
			{
				if(!empty($this->data['Health']['address_home1']) && empty($this->data['Health']['address_home2']))
				{
					$this->data['Health']['address'] = $this->data['Health']['address_home1'];
				}
				if(!empty($this->data['Health']['address_home1']) && !empty($this->data['Health']['address_home2']))
				{
					$this->data['Health']['address'] = $this->data['Health']['address_home1'].'*'.$this->data['Health']['address_home2'];
				}
				$this->data['Health']['locality'] = $this->data['Health']['home_locality'];
				$this->data['Health']['city_id'] = $this->data['Health']['home_city'];
				$this->data['Health']['state'] = $this->data['Health']['home_state'];
				$this->data['Health']['pincode'] = $this->data['Health']['home_pincode'];
				$this->data['Health']['landmark'] = $this->data['Health']['home_landmark'];
			}
			else
			{
				$this->data['Health']['address'] = '';
				$this->data['Health']['locality'] = '';
				$this->data['Health']['city_id'] = 0;
				$this->data['Health']['state'] = 0;
				$this->data['Health']['pincode'] = '';
				$this->data['Health']['landmark'] = '';
			}
			//For Editing Discount 03-10-13 Starts
			if(!empty($this->data['Health']['discount_code']))
			{
				$find_discount_code = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
				//CODE EDITED BY ASHISH 28-07-14 STARTS
				$get_amount_all = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$find_discount_code['Health']['id'])));
				$v = 0;
				foreach($get_amount_all as $amtallk => $amtallv)
				{
					$v = ($amtallv['RequestTest']['mrp']+$v);
				}
				$this->data['Health']['total_amount'] = $v;
				//CODE EDITED BY ASHISH 28-07-14 ENDS
				if($find_discount_code['Health']['discount_code'] != $this->data['Health']['discount_code'])
				{
					$get_disc = $this->Discount->find('first',array('conditions'=>array('Discount.discount_code'=>$this->data['Health']['discount_code'])));
					if($get_disc['Discount']['type'] == 'Percent')
					{
						$v_1 = ($get_disc['Discount']['amount']/100);
						$v_2 = ($v_1*$this->data['Health']['total_amount']);
						$v_3 = ($this->data['Health']['total_amount']-$v_2);
						$find_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
						if($find_amt['Health']['received_amount'] == 0)
						{
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($find_amt['Health']['received_amount'] != 0)
						{
							$bal_amt = ($v_3-$find_amt['Health']['received_amount']);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."',balance_amount='".$bal_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
						$this->data['Health']['total_amount'] = $v_3;
						$this->data['Health']['discount_id'] = $get_disc['Discount']['id'];
					}
					if($get_disc['Discount']['type'] == 'Rupees')
					{
						$v_3 = ($this->data['Health']['total_amount']-$get_disc['Discount']['amount']);
						$find_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
						if($find_amt['Health']['received_amount'] == 0)
						{
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($find_amt['Health']['received_amount'] != 0)
						{
							$bal_amt = ($v_3-$find_amt['Health']['received_amount']);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$v_3."',balance_amount='".$bal_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
						$this->data['Health']['total_amount'] = $v_3;
						$this->data['Health']['discount_id'] = $get_disc['Discount']['id'];
					}
				}
			}
			//For Editing Discount 03-10-13 Ends
			if(!empty($this->data['Health']['discount_amount']))
			{
				$find_tot_amt_disc = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
				$get_amount_all = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$find_tot_amt_disc['Health']['id'])));
				$v = 0;
				foreach($get_amount_all as $amtallk => $amtallv)
				{
					$v = ($amtallv['RequestTest']['mrp']+$v);
				}
				$this->data['Health']['total_amount'] = $v;
				if($find_tot_amt_disc['Health']['discount_amount'] != $this->data['Health']['discount_amount'])
				{
					if($find_tot_amt_disc['Health']['received_amount'] == 0)
					{
						$new_tot_amt_disc = ($this->data['Health']['total_amount'] - $this->data['Health']['discount_amount']);
						$this->data['Health']['total_amount'] = $new_tot_amt_disc;
						$update_tot_amt_disc = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt_disc."' WHERE id='".$this->data['Health']['id']."'");
						$update_billing = $this->Billing->query("UPDATE billings SET sub_total='".$new_tot_amt_disc."' WHERE request_id='".$this->data['Health']['id']."'");
					}
					else
					{
						$new_tot_amt_disc = ($this->data['Health']['total_amount'] - $this->data['Health']['discount_amount']);
						$new_bal_amount = ($new_tot_amt_disc - $find_tot_amt_disc['Health']['received_amount']);
						$this->data['Health']['total_amount'] = $new_tot_amt_disc;
						$this->data['Health']['balance_amount'] = $new_bal_amount;
						$update_tot_amt_disc = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt_disc."',balance_amount='".$new_bal_amount."' WHERE id='".$this->data['Health']['id']."'");
						$update_billing = $this->Billing->query("UPDATE billings SET sub_total='".$new_tot_amt_disc."' WHERE request_id='".$this->data['Health']['id']."'");
					}
				}
			}
			if($this->data['Health']['old_home_report'] == 0)
			{
				if($this->data['Health']['home_report'] == 1)
				{
					$find_tot_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					$new_tot_amt = ($find_tot_amt['Health']['total_amount']+50);
					$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."' WHERE id='".$this->data['Health']['id']."'");
				}
			}
			if($this->data['Health']['old_home_report'] == 1)
			{
				if($this->data['Health']['home_report'] == 0)
				{
					$find_tot_amt = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					$paytracks = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$this->data['Health']['id'])));
					if(!empty($paytracks))
					{
						$paytrack_amt = 0;
						foreach($paytracks as $key => $val)
						{
							$paytrack_amt = ($val['Paytrack']['pay_install']+$paytrack_amt);
							$paytrack_amt = $paytrack_amt;
						}
						if($paytrack_amt > $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',balance_refund='".$new_refund_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($paytrack_amt == $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."',balance_refund='".$new_refund_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
						if($paytrack_amt < $find_tot_amt['Health']['total_amount'])
						{
							$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
							$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."' WHERE id='".$this->data['Health']['id']."'");
						}
					}
					else
					{
						$new_tot_amt = ($find_tot_amt['Health']['total_amount']-50);
						//$new_refund_amt = ($find_tot_amt['Health']['balance_refund']+50);
						$update_tot_amt = $this->Health->query("UPDATE healths SET total_amount='".$new_tot_amt."' WHERE id='".$this->data['Health']['id']."'");
					}
				}
				else
				{
					$this->data['Health']['total_amount'] = ($this->data['Health']['total_amount']+50);
				}
			}
			if(!empty($this->data['Health']['sample_date']))
			{
				$this->data['Health']['s_date'] = date('Y-m-d',strtotime($this->data['Health']['sample_date']));
			}
			if(!empty($this->data['Health']['sample_date1']))
			{
				$this->data['Health']['s_date'] = date('Y-m-d',strtotime($this->data['Health']['sample_date1']));
			}
			$get_db_edit_request_detaill = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
			$get_update_status = $this->Health->query("UPDATE healths SET requ_status='".$get_db_edit_request_detaill['Health']['requ_status']."' WHERE id='".$this->data['Health']['id']."'");
			
			if($this->Utility->check_push_notification_for_pcc($get_db_edit_request_detaill['Health']['created_by'],$get_db_edit_request_detaill['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($get_db_edit_request_detaill['Health']['id']);
			}
			if($this->Health->create($this->data))
			{
				if($this->Health->save($this->data,false))
				{
					$get_db_edit_request_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));
					$get_all_old_test = $this->RequestTest->query("UPDATE request_test SET status='0' WHERE health_id='".$this->data['Health']['id']."'");
					if(!empty($get_db_edit_request_detail['Health']['test_id']))
					{
						$explode_db_save_test = explode(',',$get_db_edit_request_detail['Health']['test_id']);
						foreach($explode_db_save_test as $k_db_edit_test => $v_db_edit_test)
						{
							$get_current_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_test)));
							$this->data['RequestTest']['type'] = 'TE';
							$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
							$this->data['RequestTest']['test_id'] = $v_db_edit_test;
							$this->data['RequestTest']['mrp'] = $get_current_mrp_test['Test']['mrp'];
							$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
							$this->data['RequestTest']['update_test_date'] = date('Y-m-d H:i:s');
							$this->data['RequestTest']['status'] = 1;
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['profile_id']))
					{
						$explode_db_save_profile = explode(',',$get_db_edit_request_detail['Health']['profile_id']);
						foreach($explode_db_save_profile as $k_db_edit_profile => $v_db_edit_profile)
						{
							$get_current_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_profile)));
							$this->data['RequestTest']['type'] = 'PR';
							$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
							$this->data['RequestTest']['test_id'] = $v_db_edit_profile;
							$this->data['RequestTest']['mrp'] = $get_current_mrp_profile['Test']['mrp'];
							$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
							$this->data['RequestTest']['update_test_date'] = date('Y-m-d H:i:s');
							$this->data['RequestTest']['status'] = 1;
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['offer_id']))
					{
						$explode_db_save_offer = explode(',',$get_db_edit_request_detail['Health']['offer_id']);
						foreach($explode_db_save_offer as $k_db_edit_offer => $v_db_edit_offer)
						{
							$get_current_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v_db_edit_offer)));
							$this->data['RequestTest']['type'] = 'OF';
							$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
							$this->data['RequestTest']['test_id'] = $v_db_edit_offer;
							$this->data['RequestTest']['mrp'] = $get_current_mrp_offer['Banner']['banner_mrp'];
							$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
							$this->data['RequestTest']['update_test_date'] = date('Y-m-d H:i:s');
							$this->data['RequestTest']['status'] = 1;
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['package_id']))
					{
						$explode_db_save_package = explode(',',$get_db_edit_request_detail['Health']['package_id']);
						foreach($explode_db_save_package as $k_db_edit_package => $v_db_edit_package)
						{
							$get_current_mrp_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v_db_edit_package)));
							$this->data['RequestTest']['type'] = 'PA';
							$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
							$this->data['RequestTest']['test_id'] = $v_db_edit_package;
							$this->data['RequestTest']['mrp'] = $get_current_mrp_package['Package']['package_mrp'];
							$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
							$this->data['RequestTest']['update_test_date'] = date('Y-m-d H:i:s');
							$this->data['RequestTest']['status'] = 1;
						}
					}
					if(!empty($get_db_edit_request_detail['Health']['service_id']))
					{
						$explode_db_save_service = explode(',',$get_db_edit_request_detail['Health']['service_id']);
						foreach($explode_db_save_service as $k_db_edit_service => $v_db_edit_service)
						{
							$get_db_save_service = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'SR','RequestTest.health_id'=>$this->data['Health']['id'],'RequestTest.test_id'=>$v_db_edit_service)));
							if(empty($get_db_save_service))
							{
								$get_current_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_db_edit_service)));
								$this->data['RequestTest']['type'] = 'SR';
								$this->data['RequestTest']['health_id'] = $this->data['Health']['id'];
								$this->data['RequestTest']['test_id'] = $v_db_edit_service;
								$this->data['RequestTest']['mrp'] = $get_current_mrp_service['Test']['mrp'];
								$this->data['RequestTest']['test_book_date'] = $get_db_edit_request_detail['Health']['book_date'];
								$this->data['RequestTest']['status'] = 1;
								if($this->RequestTest->create($this->data))
								{
									$this->RequestTest->save($this->data);
								}
							}
						}
					}
					$get_update_status = $this->Health->query("UPDATE healths SET requ_status='".$get_db_edit_request_detail['Health']['requ_status']."' WHERE id='".$get_db_edit_request_detail['Health']['id']."'");
					
					if($this->Utility->check_push_notification_for_pcc($get_db_edit_request_detail['Health']['created_by'],$get_db_edit_request_detail['Health']['assigned_lab']) == 1)
					{
						$response = $this->Utility->send_notification($get_db_edit_request_detail['Health']['id']);
					}
					$this->Session->setFlash('Sample request updated successfully.','flash_success');
					$this->redirect(array('controller'=>'samples','action'=>'view_patient_details',$reqId));
				}
			}
		}
		else
		{
			if(!empty($req_id))
			{
				$request_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
				if(!empty($request_details))
				{
					$init_tot_amt = 0;
					$get_total_test_amt = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'])));
					foreach($get_total_test_amt as $tot_amt_key => $tot_amt_val)
					{
						$init_tot_amt = ($tot_amt_val['RequestTest']['mrp']+$init_tot_amt);
					}
					$request_det['Health']['total_test_amt'] = $init_tot_amt;
					//Code Edited By Ashish Starts
					if($request_details['Health']['requ_status'] == 8)
					{
						$request_det['Health']['cancel_reason'] = $request_details['Health']['cancelled_reason'];
					}
					//Code Edited By Ashish Ends
					if(!empty($entry) && $entry == 'ref_dup')
					{
						$request_det['Health']['dup_entry'] = 'Yes';
					}
					$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request_details['Health']['id'])));
					$request_det['Health']['order_num'] = $find_order_num['Billing']['order_id'];
					$request_det['Health']['adj_reason'] = $request_details['Health']['adj_reason'];
					if($request_details['Health']['gender'] == 1)
					{
						$gender = 'Male';
					}
					if($request_details['Health']['gender'] == 2)
					{
						$gender = 'Female';
					}
					
					if($request_details['Health']['discount_id'] != 0)
					{
						$discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$request_details['Health']['discount_id'])));
						$request_det['Health']['discount_code'] = $discount['Discount']['discount_code'];
						$request_det['Health']['discount_info'] = $discount['Discount']['discount_description'];
						$request_det['Health']['discount_id'] = $request_details['Health']['discount_id'];
						if($discount['Discount']['type'] == 'Percent')
						{
							$request_det['Health']['discount_amt'] = $discount['Discount']['amount'].'%';
							//01-04014 Starts
							$discount_final_amount_1 = ($discount['Discount']['amount']/100);
							$discount_final_amount_1_1 = ($discount_final_amount_1*$init_tot_amt);
							//01-04014 Ends
						}
						if($discount['Discount']['type'] == 'Rupees')
						{
							$request_det['Health']['discount_amt'] = 'Rs. '.$discount['Discount']['amount'];
							//01-04014 Starts
							$discount_final_amount_1_1 = $discount['Discount']['amount'];
							//01-04014 Ends
						}
					}
					//01-04014 Starts
					else
					{
						$discount_final_amount_1_1 = 0;
					}
					//01-04014 Ends
					if($request_details['Health']['discount_amount'] != 0)
					{
						$request_det['Health']['discount_amount'] = $request_details['Health']['discount_amount'];
						$request_det['Health']['discount_amount_reason'] = $request_details['Health']['discount_amount_reason'];
						//01-04014 Starts
						$discount_final_amount_1_2 = $request_details['Health']['discount_amount'];
						//01-04014 Ends
					}
					//01-04014 Starts
					else
					{
						$discount_final_amount_1_2 = 0;
					}
					
					
				//	edit sanjeet
					if(!empty($entry) && $entry == 'ref_dup')
					{
						$request_det['Health']['dup_entry'] = 'Yes';
					}
		//Patient Vital Information Fetch Value Starts
					$get_vital_detail  = $this->UserBmiBp->find('first',array('conditions'=>array('UserBmiBp.request_id'=>$request_details['Health']['id'])));
					$request_det['Health']['vital_save_id'] = $get_vital_detail['UserBmiBp']['id'];
					$request_det['Health']['weight'] = $get_vital_detail['UserBmiBp']['weight'];
					$request_det['Health']['height_opt'] = $get_vital_detail['UserBmiBp']['height_opt'];
					$request_det['Health']['height_feet'] = $get_vital_detail['UserBmiBp']['height_feet'];
					$request_det['Health']['height_inch'] = $get_vital_detail['UserBmiBp']['height_inch'];
					$request_det['Health']['height_cm'] = $get_vital_detail['UserBmiBp']['height_cm'];
					$request_det['Health']['bmi_value'] = $get_vital_detail['UserBmiBp']['bmi_value'];
					$request_det['Health']['bp_systolic'] = $get_vital_detail['UserBmiBp']['bp_systolic'];
					$request_det['Health']['bp_diastolic'] = $get_vital_detail['UserBmiBp']['bp_diastolic'];
					$request_det['Health']['bp_pulse'] = $get_vital_detail['UserBmiBp']['bp_pulse'];
					$request_det['Health']['bmi_indicator'] = $get_vital_detail['UserBmiBp']['bmi_indicator'];
					//Patient Vital Information Fetch Value Ends
					
					
					$request_det['Health']['message_status'] = $request_details['Health']['message_status'];
					$request_det['Health']['lab_message'] = $request_details['Health']['lab_message'];
					$request_det['Health']['ref_num'] = $request_details['Health']['ref_num'];
					$request_det['Health']['adj_reason'] = $request_details['Health']['adj_reason'];
					$request_det['Health']['report_type'] = $request_details['Health']['report_type'];
					$request_det['Health']['report_reason'] = $request_details['Health']['partial_reason'];
					
					$request_det['Health']['published'] = $request_details['Health']['published'];
					$request_det['Health']['published_reason'] = $request_details['Health']['published_reason'];
					$request_det['Health']['requ_status'] = $request_details['Health']['requ_status'];
					//edit sanjeet
					
					$request_det['Health']['last_edited_date'] = $request_details['Health']['last_edited_date'];
					$get_vital_detail1  = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$request_details['Health']['last_edited'])));
					$request_det['Health']['last_edited'] = $get_vital_detail1['Admin']['name'];
					//end by sanjeet
					
					
					
					//end by sanjeet
					
					
					
					
					$request_det['Health']['discount_amount_after_add'] = ($discount_final_amount_1_1+$discount_final_amount_1_2);
					
					$find_total_received = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'])));
					if(!empty($find_total_received))
					{
						$rec_ins_amt = 0;
						foreach($find_total_received as $rec_key => $rec_val)
						{
							if($rec_val['Paytrack']['pay_mode'] == 'btc')
							{
								$btc_pay_mode = 'Yes';
							}
							else
							{
								$btc_pay_mode = 'No';
							}
							$rec_ins_amt = ($rec_val['Paytrack']['pay_install']+$rec_ins_amt);
						}
						$request_det['Health']['rec_ins_amt'] = $rec_ins_amt;
					}
					else
					{
						$request_det['Health']['rec_ins_amt'] = 0;
					}
					
					if($rec_ins_amt > 0)
					{
						$request_det['Health']['sent_to_lab_action'] = 'Yes';
					}
					if($btc_pay_mode == 'Yes')
					{
						$request_det['Health']['sent_to_lab_action'] = 'Yes';
					}
					
					
					//01-04014 Ends
					if($request_details['Health']['home_report'] != 0)
					{
						$request_det['Health']['home_report'] = $request_details['Health']['home_report'];
						$request_det['Health']['home_info'] = 'Rs.50 included of sending report at home.';
					}
					$request_det['Health']['requ_status'] = $request_details['Health']['requ_status'];
					$request_det['Health']['ref_num'] = $request_details['Health']['ref_num'];
					/*if(!empty($request_details['Health']['test_id']))
					{
						$explode_test = explode(',',$request_details['Health']['test_id']);
						$count_test = count($explode_test);
						if($count_test == 1)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'];
						}
						if($count_test == 2)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'];
						}
						if($count_test == 3)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'];
						}
						if($count_test == 4)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'];
						}
						if($count_test == 5)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'];
						}
						if($count_test == 6)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'];
						}
						if($count_test == 7)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'];
						}
						if($count_test == 8)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['test_parameter'].' - '.$test_5['Test']['testcode'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'];
						}
						if($count_test == 9)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$test_9['Test']['mrp'];
						}
						if($count_test == 10)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$test_9['Test']['mrp'].'<br>'.'<strong>10-</strong> '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$test_10['Test']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						if($count_profile == 1)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'];
						}
						if($count_profile == 2)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'];
						}
						if($count_profile == 3)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'];
						}
						if($count_profile == 4)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'];
						}
						if($count_profile == 5)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'];
						}
						if($count_profile == 6)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'];
						}
						if($count_profile == 7)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'];
						}
						if($count_profile == 8)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'];
						}
						if($count_profile == 9)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$profile_9['Test']['mrp'];
						}
						if($count_profile == 10)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$profile_9['Test']['mrp'].'<br>'.'<strong>10-</strong> '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$profile_10['Test']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						if($count_offers == 1)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'];
						}
						if($count_offers == 2)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'];
						}
						if($count_offers == 3)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'];
						}
						if($count_offers == 4)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'];
						}
						if($count_offers == 5)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'];
						}
						if($count_offers == 6)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'];
						}
						if($count_offers == 7)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'];
						}
						if($count_offers == 8)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$offer_7['Banner']['banner_mrp'].'<br>'.'<strong>8-</strong> '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$offer_8['Banner']['banner_mrp'];
						}
					}
					
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						if($count_packages == 1)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'];
						}
						if($count_packages == 2)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'];
						}
						if($count_packages == 3)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'];
						}
						if($count_packages == 4)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$package_4['Package']['package_mrp'];
						}
						if($count_packages == 5)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$package_4['Package']['package_mrp'].'<br>'.'<strong>5-</strong> '.$package_5['Package']['package_name'].' - Rs.'.$package_5['Package']['package_mrp'];
						}
					}
					
					
					//For Edit Details
					if(!empty($request_details['Health']['test_id']))
					{
						$explode_test = explode(',',$request_details['Health']['test_id']);
						$count_test = count($explode_test);
						if($count_test == 1)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 2)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 3)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 4)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 5)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 6)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 7)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 8)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 9)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$edit_test_name= '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$test_9['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 10)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$test_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$test_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$test_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$test_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$test_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$test_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$test_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$test_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$test_9['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$test_10['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						if($count_profile == 1)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 2)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 3)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 4)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 5)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 6)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 7)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 8)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 9)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$profile_9['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 10)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$profile_1['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$profile_2['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$profile_3['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$profile_4['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$profile_5['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$profile_6['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$profile_7['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$profile_8['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$profile_9['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$profile_10['Test']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						if($count_offers == 1)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 2)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 3)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 4)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 5)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 6)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 7)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$offer_7['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 8)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$offer_1['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$offer_2['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$offer_3['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$offer_4['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$offer_5['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$offer_6['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$offer_7['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$offer_8['Banner']['banner_mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_8['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						if($count_packages == 1)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 2)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 3)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 4)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$package_4['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 5)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$package_1['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$package_2['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$package_3['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$package_4['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$package_5['Package']['package_name'].' - Rs.'.$package_5['Package']['package_mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_5['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					//For Edit details*/
					
					if(!empty($request_details['Health']['test_id']))
					{
						$explode_test = explode(',',$request_details['Health']['test_id']);
						$count_test = count($explode_test);
						if($count_test == 1)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'];
						}
						if($count_test == 2)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'];
						}
						if($count_test == 3)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'];
						}
						if($count_test == 4)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'];
						}
						if($count_test == 5)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'];
						}
						if($count_test == 6)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_idd'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'];
						}
						if($count_test == 7)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'];
						}
						if($count_test == 8)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'];
						}
						if($count_test == 9)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_9['RequestTest']['mrp'];
						}
						if($count_test == 10)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$save_db_test_mrp_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[9],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_9['RequestTest']['mrp'].'<br>'.'<strong>10-</strong> '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_10['RequestTest']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						if($count_profile == 1)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'];
						}
						if($count_profile == 2)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'];
						}
						if($count_profile == 3)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'];
						}
						if($count_profile == 4)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'];
						}
						if($count_profile == 5)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'];
						}
						if($count_profile == 6)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'];
						}
						if($count_profile == 7)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'];
						}
						if($count_profile == 8)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'];
						}
						if($count_profile == 9)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[8],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_9['RequestTest']['mrp'];
						}
						if($count_profile == 10)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[8],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$save_db_profile_mrp_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[9],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_9['RequestTest']['mrp'].'<br>'.'<strong>10-</strong> '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_10['RequestTest']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						if($count_offers == 1)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'];
						}
						if($count_offers == 2)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'];
						}
						if($count_offers == 3)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'];
						}
						if($count_offers == 4)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'];
						}
						if($count_offers == 5)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'];
						}
						if($count_offers == 6)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'];
						}
						if($count_offers == 7)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_7['RequestTest']['mrp'];
						}
						if($count_offers == 8)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$save_db_offer_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[7],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_8['RequestTest']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						if($count_packages == 1)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'];
						}
						if($count_packages == 2)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'];
						}
						if($count_packages == 3)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'];
						}
						if($count_packages == 4)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$save_db_package_mrp_4['RequestTest']['mrp'];
						}
						if($count_packages == 5)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$save_db_package_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[4],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$save_db_package_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$package_5['Package']['package_name'].' - Rs.'.$save_db_package_mrp_5['RequestTest']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['service_id']))
					{
						$explode_service = explode(',',$request_details['Health']['service_id']);
						$count_service = count($explode_service);
						if($count_service == 1)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'];
						}
						if($count_service == 2)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'];
						}
						if($count_service == 3)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'];
						}
						if($count_service == 4)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'];
						}
						if($count_service == 5)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'];
						}
						if($count_service == 6)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'];
						}
						if($count_service == 7)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$service_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[6])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$service_7['Test']['testcode'].' - '.$service_7['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_7['RequestTest']['mrp'];
						}
						if($count_service == 8)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$service_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[6])));
							$service_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[7])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$service_7['Test']['testcode'].' - '.$service_7['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$service_8['Test']['testcode'].' - '.$service_8['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_8['RequestTest']['mrp'];
						}
						if($count_service == 9)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$service_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[6])));
							$service_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[7])));
							$service_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[8])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[8],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$service_7['Test']['testcode'].' - '.$service_7['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$service_8['Test']['testcode'].' - '.$service_8['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$service_9['Test']['testcode'].' - '.$service_9['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_9['RequestTest']['mrp'];
						}
						if($count_service == 10)
						{
							$service_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[0])));
							$service_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[1])));
							$service_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[2])));
							$service_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[3])));
							$service_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[4])));
							$service_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[5])));
							$service_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[6])));
							$service_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[7])));
							$service_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[8])));
							$service_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_service[9])));
							$save_db_service_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[8],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$save_db_service_mrp_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_service[9],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$service_name = '<strong>1-</strong> '.$service_1['Test']['testcode'].' - '.$service_1['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$service_2['Test']['testcode'].' - '.$service_2['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$service_3['Test']['testcode'].' - '.$service_3['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$service_4['Test']['testcode'].' - '.$service_4['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$service_5['Test']['testcode'].' - '.$service_5['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$service_6['Test']['testcode'].' - '.$service_6['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$service_7['Test']['testcode'].' - '.$service_7['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$service_8['Test']['testcode'].' - '.$service_8['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$service_9['Test']['testcode'].' - '.$service_9['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_9['RequestTest']['mrp'].'<br>'.'<strong>10-</strong> '.$service_10['Test']['testcode'].' - '.$service_10['Test']['test_parameter'].' - Rs.'.$save_db_service_mrp_10['RequestTest']['mrp'];
						}
					}
					
					
					//For Edit Details
					if(!empty($request_details['Health']['test_id']))
					{
						$explode_test = explode(',',$request_details['Health']['test_id']);
						$count_test = count($explode_test);
						if($count_test == 1)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 2)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 3)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 4)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 5)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 6)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 7)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 8)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 9)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_test == 10)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
							$edit_save_test_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE','RequestTest.status'=>1)));
							$edit_save_test_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE')));
							$edit_save_test_db_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[9],'RequestTest.type'=>'TE')));
							$edit_test_name = '1- '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$edit_save_test_db_10['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_test('.$req_id.','.$test_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						if($count_profile == 1)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 2)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 3)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 4)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 5)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 6)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 7)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 8)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 9)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_profile == 10)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
							$edit_save_profile_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_save_profile_db_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR','RequestTest.status'=>1)));
							$edit_profile_name = '1- '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$edit_save_profile_db_10['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_profile('.$req_id.','.$profile_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						if($count_offers == 1)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 2)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 3)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 4)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 5)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 6)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 7)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_offers == 8)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
							$edit_save_offer_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_save_offer_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[7],'RequestTest.type'=>'OF','RequestTest.status'=>1)));
							$edit_offer_name = '1- '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_1['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_2['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_3['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_4['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_5['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_6['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_7['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$edit_save_offer_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_offer('.$req_id.','.$offer_8['Banner']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						if($count_packages == 1)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 2)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 3)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 4)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$edit_save_package_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_packages == 5)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
							$edit_save_package_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_save_package_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[4],'RequestTest.type'=>'PA','RequestTest.status'=>1)));
							$edit_package_name = '1- '.$package_1['Package']['package_name'].' - Rs.'.$edit_save_package_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_1['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$package_2['Package']['package_name'].' - Rs.'.$edit_save_package_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_2['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$package_3['Package']['package_name'].' - Rs.'.$edit_save_package_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_3['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$package_4['Package']['package_name'].' - Rs.'.$edit_save_package_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_4['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$package_5['Package']['package_name'].' - Rs.'.$edit_save_package_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_package('.$req_id.','.$package_5['Package']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					if(!empty($request_details['Health']['service_id']))
					{
						$explode_services = explode(',',$request_details['Health']['service_id']);
						$count_services = count($explode_services);
						if($count_services == 1)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 2)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 3)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 4)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 5)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 6)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 7)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 8)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 9)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$services_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[8])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[8],'RequestTest.type'=>'SR')));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$services_9['Test']['testcode'].' - '.$services_9['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
						if($count_services == 10)
						{
							$services_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[0])));
							$services_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[1])));
							$services_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[2])));
							$services_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[3])));
							$services_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[4])));
							$services_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[5])));
							$services_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[6])));
							$services_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[7])));
							$services_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[8])));
							$services_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_services[9])));
							$edit_save_services_db_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[0],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[1],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[2],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[3],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[4],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[5],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[6],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[7],'RequestTest.type'=>'SR','RequestTest.status'=>1)));
							$edit_save_services_db_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[8],'RequestTest.type'=>'SR')));
							$edit_save_services_db_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_services[9],'RequestTest.type'=>'SR')));
							$edit_services_name = '1- '.$services_1['Test']['testcode'].' - '.$services_1['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_1['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_1['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'2- '.$services_2['Test']['testcode'].' - '.$services_2['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_2['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_2['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'3- '.$services_3['Test']['testcode'].' - '.$services_3['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_3['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_3['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'4- '.$services_4['Test']['testcode'].' - '.$services_4['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_4['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_4['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'5- '.$services_5['Test']['testcode'].' - '.$services_5['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_5['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_5['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'6- '.$services_6['Test']['testcode'].' - '.$services_6['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_6['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_6['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'7- '.$services_7['Test']['testcode'].' - '.$services_7['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_7['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_7['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'8- '.$services_8['Test']['testcode'].' - '.$services_8['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_8['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_8['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'9- '.$services_9['Test']['testcode'].' - '.$services_9['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_9['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_9['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>'.'<br><br>'.'10- '.$services_10['Test']['testcode'].' - '.$services_10['Test']['test_parameter'].' - Rs.'.$edit_save_services_db_10['RequestTest']['mrp'].' <a href="javascript:void(0);" onclick="delete_single_service('.$req_id.','.$services_10['Test']['id'].')" style="font-weight:bold; color:#FF0000; text-decoration:none;">[X]</a>';
						}
					}
					//For Edit details
					
					
					
					if(!empty($request_details['Health']['test_id']))
					{
						$expl_test = explode(',',$request_details['Health']['test_id']);
						$amt_test = 0;
						foreach($expl_test as $key => $val)
						{
							$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
							$amt_test = $amt_test;
						}
						$request_det['Health']['indi_test_amt'] = $amt_test;
					}
					if(empty($request_details['Health']['test_id']))
					{
						$amt_test = 0;
						$request_det['Health']['indi_test_amt'] = $amt_test;
					}
					
					if(!empty($request_details['Health']['profile_id']))
					{
						$expl_profile = explode(',',$request_details['Health']['profile_id']);
						$amt_profile = 0;
						foreach($expl_profile as $key => $val)
						{
							$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
							$amt_profile = $amt_profile;
						}
						$request_det['Health']['indi_profile_amt'] = $amt_profile;
					}
					if(empty($request_details['Health']['profile_id']))
					{
						$amt_profile = 0;
						$request_det['Health']['indi_profile_amt'] = $amt_profile;
					}
					
					if(!empty($request_details['Health']['offer_id']))
					{
						$expl_offer= explode(',',$request_details['Health']['offer_id']);
						$amt_offer = 0;
						foreach($expl_offer as $key => $val)
						{
							$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
							$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
							$amt_offer = $amt_offer;
						}
						$request_det['Health']['indi_offer_amt'] = $amt_offer;
					}
					if(empty($request_details['Health']['offer_id']))
					{
						$amt_offer = 0;
						$request_det['Health']['indi_offer_amt'] = $amt_offer;
					}
					
					if(!empty($request_details['Health']['package_id']))
					{
						$expl_package= explode(',',$request_details['Health']['package_id']);
						$amt_package = 0;
						foreach($expl_package as $key => $val)
						{
							$find_mrp_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
							$amt_package = ($find_mrp_package['Package']['package_mrp']+$amt_package);
							$amt_package = $amt_package;
						}
						$request_det['Health']['indi_package_amt'] = $amt_package;
					}
					if(empty($request_details['Health']['package_id']))
					{
						$amt_package = 0;
						$request_det['Health']['indi_package_amt'] = $amt_package;
					}
					if(!empty($request_details['Health']['service_id']))
					{
						$expl_service= explode(',',$request_details['Health']['service_id']);
						$amt_service = 0;
						foreach($expl_service as $key => $val)
						{
							$find_mrp_service = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
							$amt_service = ($find_mrp_service['Test']['mrp']+$amt_service);
							$amt_service = $amt_service;
						}
						$request_det['Health']['indi_service_amt'] = $amt_service;
					}
					if(empty($request_details['Health']['package_id']))
					{
						$amt_package = 0;
						$request_det['Health']['indi_package_amt'] = $amt_package;
					}
					$request_det['Health']['id'] = $request_details['Health']['id'];
					$request_det['Health']['patient_name'] = strtoupper($request_details['Health']['name']);
					$request_det['Health']['gender'] = $gender;
					$request_det['Health']['age'] = $request_details['Health']['age'].' Years';
					$request_det['Health']['balance_refund'] = $request_details['Health']['balance_refund'];
					$request_det['Health']['refund_status'] = $request_details['Health']['refund_status'];
					//11-09-13 Starts
					
					//12-09-13 Starts
					$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
					$this->set('timelabs',$timelabs);
					$request_det['Health']['cancelled_status'] = $request_details['Health']['cancelled_status'];
					$request_det['Health']['cancelled_reason'] = $request_details['Health']['cancelled_reason'];
					$request_det['Health']['reschduled'] = $request_details['Health']['reschduled'];
					$request_det['Health']['city_idd'] = $request_details['Health']['city_id'];
					
					
					//12-09-13 Ends
					$request_det['Health']['register_sample'] = $request_details['Health']['register_sample'];
					$request_det['Health']['sent_pathcorp_admin'] = $request_details['Health']['sent_pathcorp_admin'];
					$find_admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$request_details['Health']['sent_pathcorp_admin'])));
					$request_det['Health']['sent_pathcorp_admin_name'] = $find_admin_name['Admin']['name'];
					
					
					$vial_info = $this->Vial->find('first',array('conditions'=>array('Vial.request_id'=>$req_id)));
					$request_det['Health']['vial_id'] = $vial_info['Vial']['id'];
					$request_det['Health']['vial_created'] = $vial_info['Vial']['created'];
					$request_det['Health']['col1'] = $vial_info['Vial']['col1'];
					$request_det['Health']['col2'] = $vial_info['Vial']['col2'];
					$request_det['Health']['col3'] = $vial_info['Vial']['col3'];
					$request_det['Health']['col4'] = $vial_info['Vial']['col4'];
					$request_det['Health']['col5'] = $vial_info['Vial']['col5'];
					$request_det['Health']['col6'] = $vial_info['Vial']['col6'];
					$request_det['Health']['col7'] = $vial_info['Vial']['col7'];
					$request_det['Health']['remark1'] = $vial_info['Vial']['remark1'];
					$request_det['Health']['remark2'] = $vial_info['Vial']['remark2'];
					$request_det['Health']['remark3'] = $vial_info['Vial']['remark3'];
					$request_det['Health']['remark4'] = $vial_info['Vial']['remark4'];
					$request_det['Health']['remark5'] = $vial_info['Vial']['remark5'];
					$request_det['Health']['remark6'] = $vial_info['Vial']['remark6'];
					$request_det['Health']['remark7'] = $vial_info['Vial']['remark7'];
					$request_det['Health']['sent_pathcorp_date'] = date('d-m-Y',strtotime($vial_info['Vial']['created']));
					
					//11-09-13 Ends
					if($request_details['Health']['refund_status'] == 1)
					{
						$find_refund_person = $this->Paytrack->find('first',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Refund')));
						$explode_date_refund = explode(' ',$find_refund_person['Paytrack']['receive_date']);
						$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$find_refund_person['Paytrack']['admin_id'])));
						$request_det['Health']['refund_admin_name'] = 'Rs. '.$request_details['Health']['balance_refund'].' has been refunded by '.$admin_name['Admin']['name'].' on '.date('d-m-Y',strtotime($explode_date_refund[0]));
					}	
					
					/*if($request_details['Health']['received_amount'] != 0)
					{
						$find_receive_amounts = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Receive')));
						$c = 0;
						foreach($find_receive_amounts as $key => $val)
						{
							$admin_per_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$val['Paytrack']['admin_id'])));
							$find_receive_amounts[$c]['Paytrack']['admin_receive_name'] = $admin_per_name['Admin']['name'];
							
							$explode_rec_date = explode(' ',$val['Paytrack']['receive_date']);
							$find_receive_amounts[$c]['Paytrack']['admin_receive_date'] = $explode_rec_date[0];
							
							$c++;
						}
						$request_det['Health']['receive_tracks'] = $find_receive_amounts;
					}*/
					//echo "sadasdas<pre>"; print_r($find_receive_amounts); exit;
					$find_receive_amounts = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Receive')));
					$c = 0;
					foreach($find_receive_amounts as $key => $val)
					{
						$admin_per_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$val['Paytrack']['admin_id'])));
						$find_receive_amounts[$c]['Paytrack']['admin_receive_name'] = $admin_per_name['Admin']['name'];
						
						$explode_rec_date = explode(' ',$val['Paytrack']['receive_date']);
						$find_receive_amounts[$c]['Paytrack']['admin_receive_date'] = $explode_rec_date[0];
						
						$c++;
					}
					$request_det['Health']['receive_tracks'] = $find_receive_amounts;
					
					$request_det['Health']['test_names'] = $test_name;
					$request_det['Health']['profile_names'] = $profile_name;
					$request_det['Health']['offer_names'] = $offer_name;
					$request_det['Health']['package_names'] = $package_name;
					$request_det['Health']['service_names'] = $service_name;
					
					$request_det['Health']['edit_test_name'] = $edit_test_name;
					$request_det['Health']['edit_profile_name'] = $edit_profile_name;
					$request_det['Health']['edit_offer_name'] = $edit_offer_name;
					$request_det['Health']['edit_package_name'] = $edit_package_name;
					$request_det['Health']['edit_service_name'] = $edit_services_name;
					
					
					$request_det['Health']['test_sel_ids'] = str_replace(',','*',$request_details['Health']['test_id']);
					$request_det['Health']['profile_sel_ids'] = str_replace(',','*',$request_details['Health']['profile_id']);
					$request_det['Health']['offer_sel_ids'] = str_replace(',','*',$request_details['Health']['offer_id']);
					$request_det['Health']['package_sel_ids'] = str_replace(',','*',$request_details['Health']['package_id']);
					$request_det['Health']['service_sel_ids'] = str_replace(',','*',$request_details['Health']['service_id']);
					$request_det['Health']['UserID'] = $request_details['Health']['user_id'];
					$find_user_contact_email = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
					$request_det['Health']['email'] = $find_user_contact_email['User']['email'];
					$request_det['Health']['test_amt'] = $request_details['Health']['total_amount'];
					$request_det['Health']['remarks'] = $request_details['Health']['remarks'];
					$request_det['Health']['receive_amt'] = $request_details['Health']['received_amount'];
					if($request_details['Health']['received_amount'] == 0)
					{
						$request_det['Health']['balance_amt'] = $request_details['Health']['total_amount'];
					}
					if($request_details['Health']['received_amount'] != 0)
					{
						$request_det['Health']['balance_amt'] = $request_details['Health']['balance_amount'];
					}
					
					
					$visit_lab_1 = $request_details['Health']['city']; 
					$visit_lab_2 = $request_details['Health']['sample_time'];
					$visit_lab_3 = $request_details['Health']['sample_date'];
					
					$home_collection_1 = $request_details['Health']['sample_time1'];
					$home_collection_2 = $request_details['Health']['sample_date1'];
					$home_collection_3 = $request_details['Health']['address'];
					$this->Timelab = ClassRegistry::init('Timelab');
					$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
					if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
					{
						$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
						$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
						$visit_time = $timelabs[$visit_lab_2];						
						$request_det['Health']['visit_lab_collect_time'] = $visit_time;
						$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
						
					}
					
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
					{
						$collect_time = $timelabs[$home_collection_1];						
						
						$request_det['Health']['home_collect_time'] = $collect_time;
						$request_det['Health']['home_collect_date'] = $home_collection_2;
						$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
						$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
						$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
						$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
						$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
						$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
						$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
						$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
						$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
						$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
					}
					
					if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
					{
						$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
						$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
						$visit_time = $timelabs[$visit_lab_2];						
						$request_det['Health']['visit_lab_collect_time'] = $visit_time;
						$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
					}
					
					
					if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
					{
						$collect_time = $timelabs[$home_collection_1];						
						$request_det['Health']['home_collect_time'] = $collect_time;
						$request_det['Health']['home_collect_date'] = $home_collection_2;
						$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
						$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
						$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
						$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
						$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
						$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
						$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
						$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
						$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
						$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
					}
					$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
					$request_det['Health']['contact'] = $contact['User']['contact'];
					$request_det['Health']['remark'] = $request_details['Health']['remark'];
					$request_det['Health']['pay_status'] = $request_details['Health']['pay_status'];
					$request_det['Health']['patient_report'] = $request_details['Health']['patient_report'];
					if($request_det['Health']['discount_id'] == 12)
					{
						$request_det['Health']['test_amt'] = 0;
					}
					
					
					$this->data = $request_det;
				}
				else
				{
					$this->Session->setFlash('Invalid Request','flash_failure');
					$this->redirect(array('controller'=>'samples','action'=>'view_patient_details',base64_encode($request_details['Health']['id'])));
				}
			}
		}
		$tests = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'TEST')));
		$profiles = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE')));
		$offers = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1)));
		$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
		$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city);
		$state = $this->State->find('all',array('conditions'=>array('State.status'=>1)));
		$this->set('timelabs',$timelabs);
		$get_all_pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		$this->set('get_all_pcc',$get_all_pcc);
		$this->set('tests',$tests);
		$this->set('profiles',$profiles);
		$this->set('offers',$offers);
		$this->set('state',$state);
		if(!empty($entry))
		{
			$this->set('vial_enter',$this->Session->read('vial_info_enter'));
			$this->set('vial_entry',$entry);
		}
	}
	
	function admin_process_request($request_id = NULL)
	{
		$this->Session->delete('vial_info_enter');
		if(!empty($request_id))
		{
			$dec_request = base64_decode($request_id);
			if(!empty($this->data))
			{
				if(!empty($this->data['Vial']['id']))
				{
					$find_1 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col1'],'Vial.col2'=>$this->data['Health']['col1'],'Vial.col3'=>$this->data['Health']['col1'],'Vial.col4'=>$this->data['Health']['col1'],'Vial.col5'=>$this->data['Health']['col1'],'Vial.col6'=>$this->data['Health']['col1'],'Vial.col7'=>$this->data['Health']['col1']),'Vial.id <>'=>$this->data['Vial']['id'])));
				}
				else
				{
					$find_1 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col1'],'Vial.col2'=>$this->data['Health']['col1'],'Vial.col3'=>$this->data['Health']['col1'],'Vial.col4'=>$this->data['Health']['col1'],'Vial.col5'=>$this->data['Health']['col1'],'Vial.col6'=>$this->data['Health']['col1'],'Vial.col7'=>$this->data['Health']['col1']))));
				}
				if(empty($find_1))
				{
					if(!empty($this->data['Vial']['id']))
					{
						$find_2 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col2'],'Vial.col2'=>$this->data['Health']['col2'],'Vial.col3'=>$this->data['Health']['col2'],'Vial.col4'=>$this->data['Health']['col2'],'Vial.col5'=>$this->data['Health']['col2'],'Vial.col6'=>$this->data['Health']['col2'],'Vial.col7'=>$this->data['Health']['col2']),'Vial.id <>'=>$this->data['Vial']['id'])));
					}
					else
					{
						$find_2 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col2'],'Vial.col2'=>$this->data['Health']['col2'],'Vial.col3'=>$this->data['Health']['col2'],'Vial.col4'=>$this->data['Health']['col2'],'Vial.col5'=>$this->data['Health']['col2'],'Vial.col6'=>$this->data['Health']['col2'],'Vial.col7'=>$this->data['Health']['col2']))));
					}
					if(empty($find_2))
					{
						if(!empty($this->data['Vial']['id']))
						{
							$find_3 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col3'],'Vial.col2'=>$this->data['Health']['col3'],'Vial.col3'=>$this->data['Health']['col3'],'Vial.col4'=>$this->data['Health']['col3'],'Vial.col5'=>$this->data['Health']['col3'],'Vial.col6'=>$this->data['Health']['col3'],'Vial.col7'=>$this->data['Health']['col3']),'Vial.id <>'=>$this->data['Vial']['id'])));
						}
						else
						{
							$find_3 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col3'],'Vial.col2'=>$this->data['Health']['col3'],'Vial.col3'=>$this->data['Health']['col3'],'Vial.col4'=>$this->data['Health']['col3'],'Vial.col5'=>$this->data['Health']['col3'],'Vial.col6'=>$this->data['Health']['col3'],'Vial.col7'=>$this->data['Health']['col3']))));
						}
						if(empty($find_3))
						{
							if(!empty($this->data['Vial']['id']))
							{
								$find_4 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col4'],'Vial.col2'=>$this->data['Health']['col4'],'Vial.col3'=>$this->data['Health']['col4'],'Vial.col4'=>$this->data['Health']['col4'],'Vial.col5'=>$this->data['Health']['col4'],'Vial.col6'=>$this->data['Health']['col4'],'Vial.col7'=>$this->data['Health']['col4']),'Vial.id <>'=>$this->data['Vial']['id'])));
							}
							else
							{
								$find_4 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col4'],'Vial.col2'=>$this->data['Health']['col4'],'Vial.col3'=>$this->data['Health']['col4'],'Vial.col4'=>$this->data['Health']['col4'],'Vial.col5'=>$this->data['Health']['col4'],'Vial.col6'=>$this->data['Health']['col4'],'Vial.col7'=>$this->data['Health']['col4']))));
							}
							if(empty($find_4))
							{
								if(!empty($this->data['Vial']['id']))
								{
									$find_5 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col5'],'Vial.col2'=>$this->data['Health']['col5'],'Vial.col3'=>$this->data['Health']['col5'],'Vial.col4'=>$this->data['Health']['col5'],'Vial.col5'=>$this->data['Health']['col5'],'Vial.col6'=>$this->data['Health']['col5'],'Vial.col7'=>$this->data['Health']['col5']),'Vial.id <>'=>$this->data['Vial']['id'])));
								}
								else
								{
									$find_5 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col5'],'Vial.col2'=>$this->data['Health']['col5'],'Vial.col3'=>$this->data['Health']['col5'],'Vial.col4'=>$this->data['Health']['col5'],'Vial.col5'=>$this->data['Health']['col5'],'Vial.col6'=>$this->data['Health']['col5'],'Vial.col7'=>$this->data['Health']['col5']))));
								}
								if(empty($find_5))
								{
									if(!empty($this->data['Vial']['id']))
									{
										$find_6 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col6'],'Vial.col2'=>$this->data['Health']['col6'],'Vial.col3'=>$this->data['Health']['col6'],'Vial.col4'=>$this->data['Health']['col6'],'Vial.col5'=>$this->data['Health']['col6'],'Vial.col6'=>$this->data['Health']['col6'],'Vial.col7'=>$this->data['Health']['col6']),'Vial.id <>'=>$this->data['Vial']['id'])));
									}
									else
									{
										$find_6 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col6'],'Vial.col2'=>$this->data['Health']['col6'],'Vial.col3'=>$this->data['Health']['col6'],'Vial.col4'=>$this->data['Health']['col6'],'Vial.col5'=>$this->data['Health']['col6'],'Vial.col6'=>$this->data['Health']['col6'],'Vial.col7'=>$this->data['Health']['col6']))));
									}
									if(empty($find_6))
									{
										if(!empty($this->data['Vial']['id']))
										{
											$find_7 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col7'],'Vial.col2'=>$this->data['Health']['col7'],'Vial.col3'=>$this->data['Health']['col7'],'Vial.col4'=>$this->data['Health']['col7'],'Vial.col5'=>$this->data['Health']['col7'],'Vial.col6'=>$this->data['Health']['col7'],'Vial.col7'=>$this->data['Health']['col7']),'Vial.id <>'=>$this->data['Vial']['id'])));
										}
										else
										{
											$find_7 = $this->Vial->find('first',array('conditions'=>array('OR'=>array('Vial.col1'=>$this->data['Health']['col7'],'Vial.col2'=>$this->data['Health']['col7'],'Vial.col3'=>$this->data['Health']['col7'],'Vial.col4'=>$this->data['Health']['col7'],'Vial.col5'=>$this->data['Health']['col7'],'Vial.col6'=>$this->data['Health']['col7'],'Vial.col7'=>$this->data['Health']['col7']))));
										}
										if(empty($find_7))
										{
											$this->data['Vial']['request_id'] = $dec_request;
											if(!empty($this->data['Health']['col1']))
											{
												$this->data['Vial']['col1'] = $this->data['Health']['col1'];
											}
											else
											{
												$this->data['Vial']['col1'] = 'no';
											}
											if(!empty($this->data['Health']['col2']))
											{
												$this->data['Vial']['col2'] = $this->data['Health']['col2'];
											}
											else
											{
												$this->data['Vial']['col2'] = 'no';
											}
											if(!empty($this->data['Health']['col3']))
											{
												$this->data['Vial']['col3'] = $this->data['Health']['col3'];
											}
											else
											{
												$this->data['Vial']['col3'] = 'no';
											}
											if(!empty($this->data['Health']['col4']))
											{
												$this->data['Vial']['col4'] = $this->data['Health']['col4'];
											}
											else
											{
												$this->data['Vial']['col4'] = 'no';
											}
											if(!empty($this->data['Health']['col5']))
											{
												$this->data['Vial']['col5'] = $this->data['Health']['col5'];
											}
											else
											{
												$this->data['Vial']['col5'] = 'no';
											}
											if(!empty($this->data['Health']['col6']))
											{
												$this->data['Vial']['col6'] = $this->data['Health']['col6'];
											}
											else
											{
												$this->data['Vial']['col6'] = 'no';
											}
											if(!empty($this->data['Health']['col7']))
											{
												$this->data['Vial']['col7'] = $this->data['Health']['col7'];
											}
											else
											{
												$this->data['Vial']['col7'] = 'no';
											}
											$this->data['Vial']['remark1'] = $this->data['Health']['remark1'];
											$this->data['Vial']['remark2'] = $this->data['Health']['remark2'];
											$this->data['Vial']['remark3'] = $this->data['Health']['remark3'];
											$this->data['Vial']['remark4'] = $this->data['Health']['remark4'];
											$this->data['Vial']['remark5'] = $this->data['Health']['remark5'];
											$this->data['Vial']['remark6'] = $this->data['Health']['remark6'];
											$this->data['Vial']['remark7'] = $this->data['Health']['remark7'];
											$this->data['Vial']['created'] = date('Y-m-d H:i:s');
											if($this->Vial->create($this->data))
											{
												if($this->Vial->save($this->data,false))
												{
													$admin_id = $this->Session->read('Admin.id');
													$req_stat = 4;
													$update_health_request = $this->Health->query("UPDATE healths SET register_sample='".$this->data['Health']['register_sample']."',requ_status='".$req_stat."' WHERE id='".$dec_request."'");
													$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$dec_request)));
													if($this->Utility->check_push_notification_for_pcc($req_info['Health']['created_by'],$req_info['Health']['assigned_lab']) == 1)
													{
														$response = $this->Utility->send_notification($req_info['Health']['id']);
													}
			
													$number = $req_info['Health']['landline'];
													if($req_info['Health']['gender'] == 1)
													{
														$title = 'Mr.';
													}
													if($req_info['Health']['gender'] == 2)
													{
														$title = 'Ms.';
													}
													$message = 'Dear '.$title.' '.strtoupper($req_info['Health']['name']).' your test Samples has been collected and submitted for testing, your test reports will be published between 6:30 PM to 8:30PM (Mon to Sat) & Sunday tests are reported Next day. Kindly call +91-9555009009 or visit www.niramayahealthcare.com for your test request status updates in "My Account"';
													//$this->__sms_message($number,$message);
													//echo $this->data['Vial']['login_action']; exit;
													if(!empty($this->data['Vial']['login_action']) && $this->data['Vial']['login_action'] == 'Super')
													{
														$this->redirect('/admin/samples/view_detail/'.$request_id);
													}
													else
													{
														$this->redirect('/admin/samples/view_patient_details/'.$request_id);
													}
												}
											}
										}
										else
										{
											if(!empty($this->data['Vial']['login_action']) && $this->data['Vial']['login_action'] == 'Super')
											{
												$this->Session->write('vial_info_enter',$this->data);
												$this->redirect('/admin/samples/view_detail/'.$request_id.'/Duplicate7');
											}
											else
											{
												$this->Session->write('vial_info_enter',$this->data);
												$this->redirect('/admin/samples/view_patient_details/'.$request_id.'/Duplicate7');
											}
										}
									}
									else
									{
										if(!empty($this->data['Vial']['login_action']) && $this->data['Vial']['login_action'] == 'Super')
										{
											$this->Session->write('vial_info_enter',$this->data);
											$this->redirect('/admin/samples/view_detail/'.$request_id.'/Duplicate6');
										}
										else
										{
											$this->Session->write('vial_info_enter',$this->data);
											$this->redirect('/admin/samples/view_patient_details/'.$request_id.'/Duplicate6');
										}
									}
								}
								else
								{
									if(!empty($this->data['Vial']['login_action']) && $this->data['Vial']['login_action'] == 'Super')
									{
										$this->Session->write('vial_info_enter',$this->data);
										$this->redirect('/admin/samples/view_detail/'.$request_id.'/Duplicate5');
									}
									else
									{
										$this->Session->write('vial_info_enter',$this->data);
										$this->redirect('/admin/samples/view_patient_details/'.$request_id.'/Duplicate5');
									}
								}
							}
							else
							{
								if(!empty($this->data['Vial']['login_action']) && $this->data['Vial']['login_action'] == 'Super')
								{
									$this->Session->write('vial_info_enter',$this->data);
									$this->redirect('/admin/samples/view_detail/'.$request_id.'/Duplicate4');
								}
								else
								{
									$this->Session->write('vial_info_enter',$this->data);
									$this->redirect('/admin/samples/view_patient_details/'.$request_id.'/Duplicate4');
								}
							}
						}
						else
						{
							if(!empty($this->data['Vial']['login_action']) && $this->data['Vial']['login_action'] == 'Super')
							{
								$this->Session->write('vial_info_enter',$this->data);
								$this->redirect('/admin/samples/view_detail/'.$request_id.'/Duplicate3');
							}
							else
							{
								$this->Session->write('vial_info_enter',$this->data);
								$this->redirect('/admin/samples/view_patient_details/'.$request_id.'/Duplicate3');
							}
						}
					}
					else
					{
						if(!empty($this->data['Vial']['login_action']) && $this->data['Vial']['login_action'] == 'Super')
						{
							$this->Session->write('vial_info_enter',$this->data);
							$this->redirect('/admin/samples/view_detail/'.$request_id.'/Duplicate2');
						}
						else
						{
							$this->Session->write('vial_info_enter',$this->data);
							$this->redirect('/admin/samples/view_patient_details/'.$request_id.'/Duplicate2');
						}
					}
				}
				else
				{
					if(!empty($this->data['Vial']['login_action']) && $this->data['Vial']['login_action'] == 'Super')
					{
						$this->Session->write('vial_info_enter',$this->data);
						$this->redirect('/admin/samples/view_detail/'.$request_id.'/Duplicate1');
					}
					else
					{
						$this->Session->write('vial_info_enter',$this->data);
						$this->redirect('/admin/samples/view_patient_details/'.$request_id.'/Duplicate1');
					}
				}
			}
		}
	}
	
	//Code Edited By Ashish Starts
	function admin_request_reschdule($request_id = NULL)
	{
		$dd = $this->Session->read('Admin.id');
		if(!empty($this->data))
		{ 
			$dec_request_id = base64_decode($request_id);
			
			if(!empty($this->data['Health']['new_request_date']) && !empty($this->data['Health']['new_request_time']))
			{
				$find_request_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$dec_request_id)));
				if($find_request_detail['Health']['city_id'] == 0)
				{
					$old_date = date('Y-m-d',strtotime($find_request_detail['Health']['sample_date']));
					$old_time = $find_request_detail['Health']['sample_time'];
					$update_request = $this->Health->query("UPDATE healths SET reschduled='".$this->data['Health']['reschduled']."',old_date='".$old_date."',old_time='".$old_time."',sample_date='".$this->data['Health']['new_request_date']."',sample_time='".$this->data['Health']['new_request_time']."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$dec_request_id."'");
				}
				elseif($find_request_detail['Health']['city_id'] != 0)
				{
					$old_date = date('Y-m-d',strtotime($find_request_detail['Health']['sample_date1']));
					$old_time = $find_request_detail['Health']['sample_time1'];
					$update_request = $this->Health->query("UPDATE healths SET reschduled='".$this->data['Health']['reschduled']."',old_date='".$old_date."',old_time='".$old_time."',sample_date1='".$this->data['Health']['new_request_date']."',sample_time1='".$this->data['Health']['new_request_time']."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$dec_request_id."'");
				}
			}
			if(empty($this->data['Health']['new_request_date']) && empty($this->data['Health']['new_request_time']))
			{
				//$update_request = $this->Health->query("UPDATE healths SET reschduled='".$this->data['Health']['reschduled']."' ,last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$dec_request_id."'");
			}
			if((isset($this->data['Health']['cancelled_reason']) && !empty($this->data['Health']['cancelled_reason'])) || (isset($this->data['Health']['cancelled_status']) && !empty($this->data['Health']['cancelled_status'])))
			{
                                if($this->data['Health']['cancelled_reason'] == 'custom')
                                        $this->data['Health']['cancelled_reason'] = $this->data['Health']['cancelled_reason_custom'];
				$this->data['Health']['id']=$dec_request_id;
				$this->data['Health']['requ_status']=8;
				$this->data['Health']['last_edited']=$dd;
                                $this->data['Health']['cancelled_by'] = $dd;
				$this->data['Health']['last_edited_date']=date('Y-m-d H:i:s');
				$this->Health=ClassRegistry::init('Health');
				$this->Health->save($this->data);
				
			}
			
			
			$user_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$dec_request_id)));
			
			if($this->Utility->check_push_notification_for_pcc($user_detail['Health']['created_by'],$user_detail['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($user_detail['Health']['id']);
			}
		
			// To get page url to track activity
			if($this->data['Health']['cancelled_status'] == '1')
			{
				
				// To get page url to track activity
				$this->_activity_log($user_detail['Health']['user_id'], $dec_request_id, $action="Cancelled Request");
			}
			if(!empty($this->data['Health']['login_action']) && $this->data['Health']['login_action'] == 'Super')
			{
				$this->redirect('/admin/samples/view_detail/'.$request_id);
			}
			else
			{
				$this->redirect('/admin/samples/view_patient_details/'.$request_id);
			}
		}
	}

	//Code Edited By Ashish Ends
	function admin_add_user()
	{
		$this->set('title_for_layout','Create New USer');
		if(!empty($this->data))
		{
			if($this->Admin->create($this->data))
			{
				$this->data['Admin']['password'] = md5($this->data['Admin']['password']);
				$this->data['Admin']['role'] = 1;
				$this->data['Admin']['status'] = 1;
				$this->data['Admin']['created'] = date('Y-m-d H:i:s');
				$this->data['Admin']['modified'] = '0000-00-00 00:00:00';
				if($this->Admin->save($this->data,false))
				{
					$this->Session->setFlash('User added successfully','flash_success');
					$this->redirect('/admin/samples/view_user');
				}
			}
		}
		$get_pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		$this->set('get_pcc_list',$get_pcc_list);
	}
	
	function admin_view_user()
	{
		if(isset($this->params['named']['name']) && $this->params['named']['name']!='')
		{
			$this->data['Search']['name'] = $this->params['named']['name'];
			$options['name'] = $this->params['named']['name'];
		}
	
		$this->set('title_for_layout','Manage User(s)');
		$conditions = array();
		if(isset($this->data) && !empty($this->data))
		{
			$name = $this->data['Search']['name'];
			
			if(isset($this->data['Search']['name']) && $this->data['Search']['name']!='')
			{
				$conditions['Admin.name LIKE'] = '%'.$name.'%';
				$options['name'] = $name;
				
				if(isset($this->data['Admin']['id']) && count($this->data['Admin']['id']) && trim($this->data['Page']['mode']) != ''){
					$this->update_adminusermode($this->data['Admin']['id'], $this->data['Page']['mode']);
				}
			}
			else{
				if(isset($this->data['Admin']['id']) && count($this->data['Admin']['id']) && trim($this->data['Page']['mode']) != ''){
					$this->update_adminusermode($this->data['Admin']['id'], $this->data['Page']['mode']);
				} 
				else 
				{
					$this->Session->setFlash('Please select atlest one Banner(s) to perform any action','flash_failure');
				}
			}
		}	
		
		$this->paginate = array('Admin' => array('limit' =>'20','order'=>array('Admin.id'=>'DESC'),'conditions'=>$conditions));
		$userlist=$this->paginate('Admin');
		$this->set('userlist',$userlist);
	}
	
	function admin_edit_user($user_id = NULL)
	{
		$this->set('title_for_layout','Edit User(s)');
		$dec_user_id = base64_decode($user_id);
		if(!empty($this->data))
		{
			if($this->Admin->create($this->data))
			{
                                
				//$this->data['Admin']['password'] = md5($this->data['Admin']['password']);
                                if(isset($this->data['Admin']['password1']) && !empty($this->data['Admin']['password1']))
                                {
                                    $this->data['Admin']['password'] = md5($this->data['Admin']['password1']);
                                }
				$this->data['Admin']['modified'] = date('Y-m-d H:i:s');
				if($this->Admin->save($this->data,false))
				{
					$this->Session->setFlash('User updated successfully','flash_success');
					$this->redirect('/admin/samples/view_user');
				}
			}
		}
		else
		{
			$find_user_detail = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$dec_user_id)));
			$this->data = $find_user_detail;
		}
		$get_pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		$this->set('get_pcc_list',$get_pcc_list);
	}
	
	function update_adminusermode($data, $mode){
		switch($mode){
			case 'activate':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Admin->id = $data[$ctr];
						$this->Admin->saveField('status', '1');
						$this->Admin->saveField('userType', 'BM');
					}
				}
				// set message
				$this->Session->setFlash('User(s) have been activated','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_user'));
				break;
				case 'deactivate':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Admin->id = $data[$ctr];
						$this->Admin->saveField('status', '0');
						$this->Admin->saveField('userType', 'D');
					}
				}
				// set message
				$this->Session->setFlash('User(s) have been deactivated','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_user'));
				break;
				case 'delete':
				$countRecords = count($data);
				for($ctr=0;$ctr<$countRecords;$ctr++){
					if($data[$ctr]){
						$this->Admin->delete($data[$ctr]);
					}
				}
				// set message
				$this->Session->setFlash('User(s) have been deleted','flash_success');
				$this->redirect(array('controller'=>'samples','action'=>'view_user'));
				break;
			break;
		}
	}

	function admin_confirm_agent()
	{
		$id= $_REQUEST['id'];
		$req_stat = 19;
		$update_agent_confirm = $this->Health->query("UPDATE healths SET agent_confirm='1',requ_status='".$req_stat."' WHERE id='".$id."'");
		$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$id)));
		
		if($this->Utility->check_push_notification_for_pcc($req_info['Health']['created_by'],$req_info['Health']['assigned_lab']) == 1)
		{
			$response = $this->Utility->send_notification($req_info['Health']['id']);
		}
		$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$req_info['Health']['agent_id'])));
		//if($req_info['Health']['assigned_lab'] == 'Home')
		if(1)
		{
			if($req_info['Health']['city_id'] != 0 || $req_info['Health']['city'] != 0)
			{
				$number = $agent_name['Agent']['contact'];
				$pcc_helpdesk_num = '+91-9555009009';
				$collect_date = $req_info['Health']['sample_date1'];
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
				$collect_time = $timelabs[$req_info['Health']['sample_time1']];						
				$pat_name = strtoupper($req_info['Health']['name']);
				$pat_landmark_sms = $req_info['Health']['landmark'];
				$age = $req_info['Health']['age'].' Yrs';
				$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$req_info['Health']['city_id'])));
				$state_name = $this->State->find('first',array('conditions'=>array('State.id'=>$req_info['Health']['state'])));
				$address = str_replace('*',',',$req_info['Health']['address']).','.$req_info['Health']['locality'].','.$city_name['City']['name'].','.$state_name['State']['name'].','.$req_info['Health']['pincode'].','.$req_info['Health']['landmark'];
				$tests_arr = array();
				if(!empty($req_info['Health']['test_id']))
				{
					$expl_test = explode(',',$req_info['Health']['test_id']);
					foreach($expl_test as $k => $v)
					{
						$find_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v)));
						$tests_arr[] = $find_test['Test']['testcode'].' - '.$find_test['Test']['test_parameter'];
					}
				}
				if(!empty($req_info['Health']['profile_id']))
				{
					$expl_profile = explode(',',$req_info['Health']['profile_id']);
					foreach($expl_profile as $k => $v)
					{
						$find_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v)));
						$tests_arr[] = $find_profile['Test']['testcode'].' - '.$find_profile['Test']['test_parameter'];
					}
				}
				if(!empty($req_info['Health']['offer_id']))
				{
					$expl_offer = explode(',',$req_info['Health']['offer_id']);
					foreach($expl_offer as $k => $v)
					{
						$find_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v)));
						$tests_arr[] = $find_offer['Banner']['banner_code'].' - '.$find_offer['Banner']['banner_name'];
					}
				}
				if(!empty($req_info['Health']['package_id']))
				{
					$expl_package = explode(',',$req_info['Health']['package_id']);
					foreach($expl_package as $k => $v)
					{
						$find_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v)));
						$tests_arr[] = $find_package['Package']['package_code'].' - '.$find_package['Package']['package_name'];
					}
				}
				$tests = implode(',',$tests_arr);
				$total_amt = 'Rs.'.$req_info['Health']['total_amount'];
				$dis_amt = 'Rs.'.$req_info['Health']['discount_amount'];
				$net_amt = 'Rs.'.($req_info['Health']['total_amount']);
				
				$lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['assigned_lab'])));
				$booked_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['created_by'])));
				if(!isset($booked_lab_name['Lab']['id']) || empty($booked_lab_name['Lab']['id']))
					$booked_lab_name = 'NPL';
				else
					$booked_lab_name = $booked_lab_name['Lab']['pcc_name'];
				$get_request_number = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$req_info['Health']['id'])));
				$bal_due = 'Rs.'.($req_info['Health']['total_amount'] - $req_info['Health']['received_amount']);
				$number2 = $req_info['Health']['landline'];
				$gender = $req_info['Health']['gender'] == 1 ? 'Male' : 'Female'; 
				//$message = 'Thank you for confirming the collection for Test Req. No: ('.$get_request_number['Billing']['order_id'].') Make sure the samples are collected in timely manner & submitted at '.$lab_name['Lab']['pcc_name'].' center';
				
				
				$message = $agent_name['Agent']['name'].' the '.$get_request_number['Billing']['order_id'].' Booked by '.$booked_lab_name.' to be collected on '.$collect_date.' '.$collect_time.' from '.$pat_name.' '.$gender.' '.$age. ' '.$number2.' for '.$tests.' Total Test Amount '.$total_amt.' Net Payable '.$net_amt.' Bal Due '. $bal_due.' Address '.$address.' '. $pat_landmark_sms ; 
				//die($message);
				if($this->Utility->check_agent_sms_enable_for_pcc($req_info['Health']['created_by'],$req_info['Health']['assigned_lab']) == 1)
				{
					$this->__sms_message($number,$message);
				}
				
				if($req_info['Health']['gender'] == 1)
				{
					$title = 'Mr.';
				}
				if($req_info['Health']['gender'] == 2)
				{
					$title = 'Ms.';
				}
				/*$message2 = 'Dear '.$title.' '.$pat_name.' as per Test Req. No: ('.$get_request_number['Billing']['order_id'].') Booked by '.$booked_lab_name.' '.$agent_name['Agent']['name'].' '.$agent_name['Agent']['contact'].' has been assigned for sample collection on '.$collect_date.' '.$collect_time;*/
				$message2 = 'Dear '.$title.' '.$pat_name.' as per Test Req. No: ('.$get_request_number['Billing']['order_id'].') \n Booked by '.$booked_lab_name.'\n Phlebo '.$agent_name['Agent']['name'].' ('.$agent_name['Agent']['contact'].') has been assigned for Home Sample Collection  on '.$collect_date.' '.$collect_time;
				$this->__sms_message($number2,$message2);
			}
		}
		$x['success'] = 'success';
		$m['agent_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	function admin_get_sample_data()
    {
		$htmlData='';
		$health = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_REQUEST['id'])));
		$sampleMaster = $this->Samplemaster->find('all');
		$sample_list=array();
		foreach($sampleMaster as $val)
		{
			$sample_list[$val['Samplemaster']['sample_id']] = $val['Samplemaster']['type'];
		}
		$sample_health = $this->Healthsample->find('all',array('conditions'=>array('Healthsample.health_id'=>$_REQUEST['id'])));
		$is_urgent = 'Regular';
		if($health['Health']['is_urgent']=='true')
			$is_urgent = 'Urgent';
		$gender = 'Female';
		if($health['Health']['gender']=='1')
			$gender = 'Male';
		$html = '<label>Reference : '.$health['Health']['reference'].'</label> ';
		$html .= '<label>MRN No. : '.$health['Health']['medical_reference_number'].'</label> ';
		$html .= '<label>Name : '.strtoupper($health['Health']['name']).'</label> ';
		$html .= '<label>Gender : '.$gender.'</label> ';
		$html .= '<label>Age : '.$health['Health']['age'].' Yrs</label> ';
		$html .= '<label>Priority : '.$is_urgent.'</label> ';
		$html .= '<label>Sample Collected Date And Time : '.$health['Health']['sample_collected_date'].'</label> ';
		$html .= '<label>Sample Details : </label>';
		$html .= '<table border="0" width="50%">';
		$html .= '<tr style="background:lightgrey;"><td width="30%">Sample Type</td><td width="15%">Barcode</td><td width="15%">Recieved Barcode</td><td width="15%">Recieved</td><td width="15%">Rejected</td><td width="15%">SNR</td><td width="15%">Sample Status</td><td width="15%">Sample Remark</td><td width="15%">Sample Recieved DateTime</td></tr>';
		$count = 0;
		$rejectlist=0;
            	foreach($sample_health as $key=>$val)
            	{
					$count++;	
					$html .= '<tr>';
					$html .= '<td width="30%">'.$sample_list[$val['Healthsample']['sample_id']].'</td>';
					$html .= '<td width="15%">'.$val['Healthsample']['barcode_id'].' <input id="samplestatus'.$val['Healthsample']['sample_id'].'" type="hidden" name="samplestatus['.$val['Healthsample']['sample_id'].']" value="" ></td>';
					$html .= '<td width="15%">'.$val['Healthsample']['assigned_barcode_id'].'</td>';
					$html .= '<td width="15%"><input class="sampleSelect_'.$val['Healthsample']['sample_id'].' success radio" type="radio" id="recieved_'.$val['Healthsample']['sample_id'].'" onclick="sampleSelect('.$val['Healthsample']	['sample_id'].',this)"';
					$samplestatus = '';
					if($val['Healthsample']['sample_status'] == '1'){
						$html .= ' checked';
						$samplestatus = 'Recieved';
					}
					$html.='></td>';
						$html .= '<td width="15%"><input class="sampleSelect_'.$val['Healthsample']['sample_id'].' radio" type="radio" id="rejected_'.$val['Healthsample']['sample_id'].'" onclick="sampleSelect('.$val['Healthsample']['sample_id'].',this)"';
					if($val['Healthsample']['sample_status'] == '2'){
						$html .= ' checked';
						$samplestatus = 'Repeat';
						$rejectlist++;
					}
					$html.='></td>';
					$html .= '<td width="15%"><input class="sampleSelect_'.$val['Healthsample']['sample_id'].' radio" type="radio" id="snr_'.$val['Healthsample']['sample_id'].'" onclick="sampleSelect('.$val['Healthsample']['sample_id'].',this)"';
					if($val['Healthsample']['sample_status'] == '3'){
						$html .= ' checked';
						$samplestatus = 'Pending';
					}
					$html.='></td>';
					
					$html .= '<td width="15%"><input type="text" id="sample_Status" readonly name="sample_Status" value="'.$samplestatus.'" ></td>';
					$html .= '<td width="15%"><input type="text" id="sample_Status" readonly name="sample_Status" value="'.$val['Healthsample']['sample_remark'].'" ></td>';
					if($val['Healthsample']['sample_recieved_datetime']!='0000-00-00 00:00:00'){
						$html .= '<td width="15%"><input type="text" id="sample_Status" readonly name="sample_Status" value="'.date('m/d/Y h:i:s',strtotime($val['Healthsample']['sample_recieved_datetime'])).'" ></td>';
					}
					else
						$html .= '<td width="15%"><input type="text" id="sample_Status" readonly name="sample_Status" value="" ></td>';
					$html .= '</tr>';
					
            	}
		$remark = '';
		if($health['Health']['remarks']!='')
			$remark = $health['Health']['remarks'];
		$order_sample_status = '';
		if($health['Health']['order_sample_status']!='')
			$order_sample_status=$health['Health']['order_sample_status'];
	
		$html .= '<tr><td>Status</td><td colspan="4"><input type="text" readonly id="sample_Status" name="sample_Status" value="'.$order_sample_status.'" ></td></tr>';
		$html .= '<tr><td>Remarks</td><td colspan="4"><textarea style="width:90%;" rows="5" id="sampleRemarks" name="sampleRemarks">'.$remark.'</textarea><div id="errorsample" style="word-wrap: break-word;"></div></td></tr>';
		$html .= '<tr></tr><tr><input type="hidden" id="sample_count" value="'.$count.'"></tr>';
		$html .= '</table>';
		
		$html .= '<label style="margin-top:20px;">Tests Booked Information</label>';
		$html .= '<table border="1" width="50%" >';
		$test_request = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$_REQUEST['id'])));
		$html .= '<tr><td colspan="2"><lable>Test Code</label></td><td colspan="3"><lable>Test Name</label></td></tr>';
		foreach($test_request as $test)
		{
			if($test['RequestTest']['type']=='PA')
			{
				$testName = $this->Package->find('first',array('conditions'=>array('Package.id'=>$test['RequestTest']['test_id'])));
				$html.= "<tr><td colspan='2'>".$testName['Package']['package_code']."</td><td colspan='3'>".$testName['Package']['package_name']."</td></tr>";
			}
			else if($test['RequestTest']['type']=='OF')
			{
				$testName = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$test['RequestTest']['test_id'])));
				$html.=  "<tr><td colspan='2'>".$testName['Banner']['banner_code'].'</td><td colspan="3">'.$testName['Banner']['banner_name']."</td></tr>";
			}
			else
			{
				$testName = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test['RequestTest']['test_id'])));
				$html.=  "<tr><td colspan='2'>".$testName['Test']['testcode'].'</td><td colspan="3">'.$testName['Test']['test_parameter']."</td></tr>";
			}
		}
            	$html .= '</table>';
		if($health['Health']['created_by'] == '153' || $health['Health']['created_by'] == '146') 
		{
            		$html .= '<input style="margin-top:40px;display:inline;float:left;" class="btn" id="sample_review_btn" type="button" value="Send Acknowledgement" onclick="verifySampleData();"> <div id="result_sample"></div>';
            		/*$html .= '<input style="margin-top:40px;margin-left:30px;float:left;" class="btn" id="edit_sample" type="button" value="Edit Sample List" onclick="edit_sample_list();"> <div id="result_sample"></div>';*/
        }
		else if($rejectlist==$count ){
            		$html .= '<input style="margin-top:40px;float:left;" class="btn" id="rejectSample" type="button" value="Send Rejected List" onclick="setrejected('.$_REQUEST['id'].');"> <div id="result_sample"></div>'; }
        else
			$html .= '<div style="color:green;font-size:large;margin-top: 20px;">This Order Is already Sent to Lab.</div><div id="loader"> </div>';
		$html.='<div id="rejectsamplenotice" style="word-wrap: break-word;"></div>';
		print_R($html);die;
        }

    function admin_set_rejected()
    {
    	//print_R($_POST);die;
    	$this->Health = ClassRegistry::init("Health");
    	$healthdata = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_POST['id'])));
    	$health['Health']['id'] = $healthdata['Health']['id'];
    	$health['Health']['requ_status']=11;
    	if($this->Health->save($health))
		{
    		print_R('Success');
			
			if($this->Utility->check_push_notification_for_pcc($healthdata['Health']['created_by'],$healthdata['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($healthdata['Health']['id']);
			}
		}
    	else
    		print_R('Failed');die;
    }

    function admin_sent_lab($from_api = null) 
    {
        if(isset($from_api) && !empty($from_api) && !empty($from_api['Health']['ref_num']))
        {
			
            $this->data['Health']['request_id'] = $from_api['Health']['request_id'];
            $this->data['Health']['sent_pathcorp'] = 1;
            $this->data['Health']['login_action'] = $from_api['Health']['login_action'];
            $this->data['Health']['ref_num'] = $from_api['Health']['ref_num'];
        }
        $dd = $this->Session->read('Admin.id');
        if(!empty($this->data))
        {
            if($this->data['Health']['sent_pathcorp'] == 1)
            {
                $ref_num = $this->data['Health']['ref_num'];
                $find_unique = $this->Health->find('first',array('conditions'=>array('Health.ref_num'=>$ref_num)));
                $user = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['request_id'])));
                // To get page url to track activity
                $this->_activity_log($user['Health']['user_id'] , $this->data['Health']['request_id'], $action = "Sent To Lab");
                //labstreet API call
                $this->integrateApiCall('SentToLab',$this->data['Health']['request_id']);
                if(empty($find_unique))
                {
                    $id = $this->Session->read('Admin.id');
                    $req_stat = 5;
                }
                else
                {
                    if(!empty($this->data['Health']['login_action']) && $this->data['Health']['login_action'] == 'Super')
                    {
                        $this->redirect('/admin/samples/view_detail/'.base64_encode($this->data['Health']['request_id']).'/ref_dup');
                    }
                    else
                    {
                        $this->redirect('/admin/samples/view_patient_details/'.base64_encode($this->data['Health']['request_id']).'/ref_dup');
                    }
                }
            }
            else
            {
                $ref_num = '';
                $id = 0;
                $req_stat = 4;
            }
            $update_query = $this->Health->query("UPDATE healths SET ref_num='".$ref_num."',sent_pathcorp='".$this->data['Health']['sent_pathcorp']."',sent_pathcorp_admin='".$id."',requ_status='".$req_stat."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$this->data['Health']['request_id']."'");
			$find_pat_number = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['request_id'])));
			if($this->Utility->check_push_notification_for_pcc($find_pat_number['Health']['created_by'],$find_pat_number['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($find_pat_number['Health']['id']);
			}
			
            $get_request_number = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$this->data['Health']['request_id'])));
            if($find_pat_number['Health']['gender'] == 1)
            {
                $title = 'Mr.';
            }
            if($find_pat_number['Health']['gender'] == 2)
            {
                $title = 'Ms.';
            }
            $number = $find_pat_number['Health']['landline'];
            $bal_amt = ($find_pat_number['Health']['total_amount']-$find_pat_number['Health']['received_amount']);
            //$message = 'Your test Samples for Test Req. No: ('.$get_request_number['Billing']['order_id'].') has been collected & Processed for testing, for more details call +91-9555009009 or visit www.niramayahealthcare.com ';
            //$message = 'Your Test Req. No: ('.$get_request_number['Billing']['order_id'].') is in process Total Net Payable amount is '.$find_pat_number['Health']['total_amount'].' Payment received is '.$find_pat_number['Health']['received_amount'].' & Balance Due is '.$bal_amt.' more details call +91-9555009009 or visit www.NHcare.in';
			$this->Lab = ClassRegistry::init('Lab');
			
			$lab_book = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$find_pat_number['Health']['created_by'])));
			
            $message = "Samples for You're tests under Req. No:".$get_request_number['Billing']['order_id'].' for Booked By '.$lab_book['Lab']['pcc_name'].' has been collected & sent to lab for testing. We have received Rs.'.$find_pat_number['Health']['received_amount'].',  Rs.'.$bal_amt.' is due. You will receive SMS confirmation as soon as the reports get published as per schedule. Kindly pay the Balance due to view the reports. to check you test status or pay online, Kindly ignore if paid. For assistance: Call NirAmaya Pathlabs +91-9555009009 or visit www.NHcare.in';
            if($this->Utility->check_sms_enable_for_pcc($find_pat_number['Health']['created_by'],$find_pat_number['Health']['assigned_lab']) == 1)
            {
                $this->__sms_message($number,$message);
            }
            // To get page url to track activity
            //$this->_activity_log($find_pat_number['Health']['user_id'] , $this->data['Health']['request_id'], $action = "Sent To Lab");
            if(!empty($this->data['Health']['login_action']) && $this->data['Health']['login_action'] == 'Super')
            {
                $this->redirect('/admin/samples/view_detail/'.base64_encode($this->data['Health']['request_id']));
            }
            else
            {
                $this->redirect('/admin/samples/view_patient_details/'.base64_encode($this->data['Health']['request_id']));
            }
        }
    }

	function admin_save_stl_data()
	{
		//print_R($_POST);die;
		$sample_health = $this->Healthsample->find('all',array('conditions'=>array('Healthsample.health_id'=>$_POST['data']['Health']['request_id'])));
		if(count($sample_health)>0)
		{
			$health_table = ClassRegistry::init("Health");
			$health = $health_table->find('first',array('conditions'=>array('Health.id'=>$_POST['data']['Health']['request_id'])));
			$health['Health']['is_urgent'] = $_POST['data']['Health']['is_urgent'];
			$check = $health_table->save($health);
			if(!$check)
			{	print_R("Error");die; }
			foreach($sample_health as $val)
			{
				$delete = $this->Healthsample->delete($val['Healthsample']['id']);
			}
		}
		$this->Health = ClassRegistry::init("Health");
		$test = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_POST['data']['Health']['request_id'])));
		$test['Health']['sample_collected_date'] = trim($_POST['data']['Health']['sample_collected_date'])." ".trim($_POST['data']['Health']['sample_collected_time']);
		$test['Health']['requ_status']='10';
		if($this->Health->save($test))
		{
			foreach($_POST['sample_barcode'] as $key=>$val)
			{
				$this->Healthsample = ClassRegistry::init("Healthsample");
				$this->dataHealth['Healthsample']['health_id'] = $_POST['data']['Health']['request_id'];
				$this->dataHealth['Healthsample']['sample_id'] = $key;
				$this->dataHealth['Healthsample']['barcode_id'] = $val;
				$this->Healthsample->create();
	        	$health_sample = $this->Healthsample->save($this->dataHealth);
			}
			if($this->Utility->check_push_notification_for_pcc($test['Health']['created_by'],$test['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($test['Health']['id']);
			}
			$stl = $this->reg_in_lis($test['Health']['id']);
			if($stl=='success')
				$response["stl"] = "Success";
			else
				$response["stl"] = "Failure";
			$response["sc"] = "Success";
			print_R(json_encode($response));
		}
		else
		{
			$response["sc"] = "Failure";
			print_R(json_encode($response));
		}
		die;
	}

	function admin_sent_lab_api()
	{
	    $patient_id = '';
		$this->User = ClassRegistry::init("User");
		$this->Healthsample = ClassRegistry::init("Healthsample");
		$this->Health = ClassRegistry::init("Health");
		
		$test = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['request_id'])));
		
		$health_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['request_id'])));
	    $sample_health = $this->Healthsample->find('all',array('conditions'=>array('Healthsample.health_id'=>$this->data['Health']['request_id'])));
	    
		$failedSampleArray = array();
		foreach($sample_health as $key=>$val)
	    {
			$this->samplemaster = ClassRegistry::init("Samplemaster");
			$samplename = $this->samplemaster->find('first',array('conditions'=>array('Samplemaster.id'=>$val['Healthsample']['sample_id'])));
			if($val['Healthsample']['sample_status']=='2')
				array_push($failedSampleArray,array('name'=>$samplename['Samplemaster']['type'],'id'=>$val['Healthsample']['barcode_id']));	
		}
		$reference = $health_detail['Health']['reference'];
		$sampledata["ch_order_num"] = $reference;
		$sampledata["patient_id"] = $health_detail['Health']['medical_reference_number'];
		$sampledata["order_status"] = $health_detail['Health']['order_sample_status'];
		$sampledata["remarks"] = $health_detail['Health']['remarks'];
		if($health_detail['Health']['order_sample_status']=='Success' || $health_detail['Health']['order_sample_status']=='Partial')
		{
			$sampledata["associate_bill_num"] = $health_detail['Health']['ref_num'];
			$sampledata["samples_received"] = date('d-m-Y\TH:i:s');//date('d-m-Y\TH:i:s', strtotime($health_detail['Health']['sample_collected_date']));
		}
		//if($health_detail['Health']['order_sample_status']=='Partial')
			$sampledata["failed_tests"] = $failedSampleArray;
		$acknowledgement='';
		if($health_detail['Health']['created_by'] == '146' || $health_detail['Health']['created_by'] == '153')
		{
			$curl = curl_init();
			if($health_detail['Health']['created_by'] == '146')
			{
				curl_setopt_array($curl, array(
				  	CURLOPT_URL => "https://hies-uat.callhealth.com/orders/v1/ack",
				  	CURLOPT_RETURNTRANSFER => true,
				  	CURLOPT_ENCODING => "",
					CURLOPT_MAXREDIRS => 10,
					CURLOPT_TIMEOUT => 30,
					CURLOPT_SSL_VERIFYHOST=>false,
					CURLOPT_SSL_VERIFYPEER=>false,
					CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
					CURLOPT_CUSTOMREQUEST => "POST",
					CURLOPT_POSTFIELDS => json_encode($sampledata),
					CURLOPT_HTTPHEADER => array(
				    "cache-control: no-cache",
				    "content-type: application/json",
				    "token:Ni39Ek4L4sm2F58aiv58349A"
				  ),
				));
			}
			else
			{
				curl_setopt_array($curl, array(
				  	CURLOPT_URL => "https://hies.callhealth.com/orders/v1/ack",
				  	CURLOPT_RETURNTRANSFER => true,
				  	CURLOPT_ENCODING => "",
					CURLOPT_MAXREDIRS => 10,
					CURLOPT_TIMEOUT => 30,
					CURLOPT_SSL_VERIFYHOST=>false,
					CURLOPT_SSL_VERIFYPEER=>false,
					CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
					CURLOPT_CUSTOMREQUEST => "POST",
					CURLOPT_POSTFIELDS => json_encode($sampledata),
					CURLOPT_HTTPHEADER => array(
				    "cache-control: no-cache",
				    "content-type: application/json",
				    "token:NI45Rj8S1rp3V69ifo5823EA"
				  ),
				));
			}
			
			$response = curl_exec($curl);
			$err = curl_error($curl);
			curl_close($curl);
			if ($err) {
				$this->Session->setFlash($acknowledgement->msg);
				$this->redirect('/admin/samples/view_detail/'.base64_encode($this->data['Health']['request_id']));
				$this->_activity_log($health_detail['Health']['user_id'], $this->data['Health']['request_id'], 'Error Occured during acknowledgement Callhealth');
			} else {
				if($health_detail['Health']['order_sample_status']!='Rejected')
				{
					$this->Session->setFlash('<p style="font-size:large"">Order Successfully Sent to Lab</p>');
					$this->_activity_log($health_detail['Health']['user_id'], $this->data['Health']['request_id'], 'callhealth order placed successfully');
				}
				else
				{
					$this->Session->setFlash('<p style="font-size:large"">Rejected Sample List has been sent back to the Lab.</p>');
					$this->_activity_log($health_detail['Health']['user_id'], $this->data['Health']['request_id'], 'callhealth order rejected');
				}
			}
		}
		$this->redirect('/admin/samples/view_detail/'.base64_encode($this->data['Health']['request_id']));			
	}

	function admin_all_labs()
	{
		$list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		$x['success'] = 'success';
		$x['lab_list'] = $list;
		$m['lab_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	function admin_change_lab()
	{
	
		$lab_id = $_REQUEST['lab_id'];
		$row_id = $_REQUEST['row_id'];
		$update = $this->Health->query("UPDATE healths SET assigned_lab='".$lab_id."' WHERE id='".$row_id."'");
		$lname = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$lab_id)));
		$x['success'] = 'success';
		$x['lab_name'] = $lname['Lab']['pcc_lab_value'];
		$m['suc_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
 	function admin_lab_message($req_id=NULL)
	{
		$dd = $this->Session->read('Admin.id');
		if(!empty($this->data))
		{
			$dec_id = base64_decode($req_id);
			
			$this->LabMessageMaster = ClassRegistry::init('LabMessageMaster');
			$this->LabMessageMaster->create();
			
			$this->data['LabMessageMaster']['request_id'] = $dec_id;
			$this->data['LabMessageMaster']['date'] = date('Y-m-d H:i:s');
			$this->data['LabMessageMaster']['message'] = $this->data['Health']['lab_message'];
			
			$this->LabMessageMaster->save($this->data);
			
			$update = $this->Health->query("UPDATE healths SET lab_message='".$this->data['Health']['lab_message']."',message_status='".$this->data['Health']['message_status']."'  ,last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$dec_id."'");
			$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$dec_id)));
			$lab_info_created = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['created_by'])));
			$order_id = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$dec_id)));
				$mail = new PHPMailer();
				
				$mail->setFrom('info@niramayapathlabs.com', 'NirAmaya PathLabs');
				$mail->addAddress($lab_info_created['Lab']['pcc_customer_service_email'], $lab_info_created['Lab']['pcc_name']);
				$mail->Subject = "Message From NirAmaya Pathlabs for ".$order_id['Billing']['order_id']." of ".strtoupper($req_info['Health']['name'])." ID-".$req_info['Health']['ref_num'];
				$mail->Body = "<table width='600' border='0' cellspacing='0' cellpadding='0' align='left'>
									<tr>
										<td>
											Dear ".$lab_info_created['Lab']['pcc_name']."
										</td>
									</tr>
									<tr>
										<td>
											&nbsp;
										</td>
									</tr>
									<tr>
										<td>
											Important Message for 
										</td>
									</tr>
									<tr>
										<td>
											Patient Name - ".strtoupper($req_info['Health']['name']);
											$mail->Body .="
										</td>
									</tr>
									<tr>
										<td>
											Request no - ".$order_id['Billing']['order_id']."
										</td>
									</tr>
									<tr>
										<td>
											Patient Id - ".$req_info['Health']['ref_num']."
										</td>
									</tr>
									<tr>
										<td>
											MRN - ".$req_info['Health']['medical_reference_number']."
										</td>
									</tr>
								<tr>
									<td>
										&nbsp; 
									</td>
								</tr><tr>
									<td>
										Message :
									</td>
								</tr>
								<tr>
									<td>
										<div style='width:400px;height:100px;border-style: groove;'>".$req_info['Health']['lab_message']."</div>
									</td>
								</tr>
								<tr>
									<td>
										&nbsp;
									</td>
								</tr>
								<tr>
									<td>
										Thank you for choosing NirAmaya PathLabs. 
										<br/>
										<br/>
										"; 
										$mail->Body .= "<br/>
										Please do not reply to this message. Replies to this message are routed to an unmonitored mailbox.
										<br/>
										kindly write back to helpline@niramayapathlabs.com or You may also call us at +91-7042191851
										<br/><br/>
										Best Regards,
										<br/>
										Lab Director
										<br/>
										Niramaya Pathlabs
									</td>
								</tr>
							</table>
								";
				$mail->isHTML(true);
				if(!$mail->send()) {
					$this->_activity_log($req_info['Health']['user_id'], $req_info['Health']['id'], 'report mail not sent');
					echo "Email not sent. " , $mail->ErrorInfo , PHP_EOL;
				} else {
					$this->_activity_log($req_info['Health']['user_id'], $req_info['Health']['id'],'lab message mail sent');	
					echo "Email sent!" , PHP_EOL;
				}
			
			if(!empty($this->data['Health']['login_action']) && $this->data['Health']['login_action'] == 'Super')
			{
				$this->redirect('/admin/samples/view_detail/'.$req_id);
			}
			else
			{
				$this->redirect('/admin/samples/view_detail_agent/'.$req_id);
			}
		}
	}
	// Mark as closed function start---------------->
	
	function admin_mark_closed($req_id=NULL)
	{
		$dd = $this->Session->read('Admin.id');
		if(!empty($this->data))
		{
			$dec_id = base64_decode($req_id);
			$update = $this->Health->query("UPDATE healths SET requ_status='".$this->data['Health']['requ_status']."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$dec_id."'");
			
			$health_data  = $this->Health->find('first',array('conditions'=>array('Health.id'=>$dec_id)));
			
			if($this->Utility->check_push_notification_for_pcc($health_data['Health']['created_by'],$health_data['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($health_data['Health']['id']);
			}
			
			$this->LabMessageMaster = ClassRegistry::init('LabMessageMaster');
			$this->LabMessageMaster->create();
			
			$this->data['LabMessageMaster']['request_id'] = $dec_id;
			$this->data['LabMessageMaster']['date'] = date('Y-m-d H:i:s');
			$this->data['LabMessageMaster']['message'] = $this->data['Health']['description'];
			
			$this->LabMessageMaster->save($this->data);
			if(!empty($this->data['Health']['login_action']) && $this->data['Health']['login_action'] == 'Super')
			{
				$this->redirect('/admin/samples/view_detail/'.$req_id);
			}
			else
			{
				$this->redirect('/admin/samples/view_detail_agent/'.$req_id);
			}
		}
	}

	function admin_partial_mark_closed($req_id=NULL)
	{
		$dd = $this->Session->read('Admin.id');
		if(!empty($this->data))
		{
			$dec_id = base64_decode($req_id);
			
			$health_data  = $this->Health->find('first',array('conditions'=>array('Health.id'=>$dec_id)));
			
					
			$update = $this->Health->query("UPDATE healths SET requ_status='".$this->data['Health']['requ_status']."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$dec_id."'");
			
			if($this->Utility->check_push_notification_for_pcc($health_data['Health']['created_by'],$health_data['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($health_data['Health']['id']);
			}
		
			$this->LabMessageMaster = ClassRegistry::init('LabMessageMaster');
			$this->LabMessageMaster->create();
			$this->data['LabMessageMaster']['request_id'] = $dec_id;
			$this->data['LabMessageMaster']['date'] = date('Y-m-d H:i:s');
			$this->data['LabMessageMaster']['message'] = $this->data['Health']['partial_description'];
			$this->LabMessageMaster->save($this->data);			
			if(!empty($this->data['Health']['login_action']) && $this->data['Health']['login_action'] == 'Super')
			{
				$this->redirect('/admin/samples/view_detail/'.$req_id);
			}
			else
			{
				$this->redirect('/admin/samples/view_detail_agent/'.$req_id);
			}
		}
	}

	function admin_agent_page()
	{
		$agent_id = $this->Session->read('Admin.id');
		$this->set('title_for_layout','Booked Request(s)');
		$this->paginate = array('Health' => array('limit' =>'20','order'=>array('Health.id'=>'DESC'),'conditions'=>array('Health.agent_id'=>$agent_id)));
		$samplerequestlist=$this->paginate('Health');
		$k = 0;
		foreach($samplerequestlist as $key => $val)
		{
			$visit_lab_2 = $val['Health']['sample_time'];
			$visit_lab_3 = $val['Health']['sample_date'];
			
			$home_collection_1 = $val['Health']['sample_time1'];
			$home_collection_2 = $val['Health']['sample_date1'];
			
			if(!empty($visit_lab_3))
			{
				$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
				$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
				
				$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];						
			}
			if(!empty($visit_lab_2))
			{
				$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$visit_lab_2];			
			}

			if(!empty($home_collection_2))
			{
				$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
				$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;	
			}

			if(!empty($home_collection_1))
			{
				$samplerequestlist[$k]['Health']['time_slot'] = $timelabs[$home_collection_1];
			}
			
			/*if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
			{
				$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
				$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
			}
			if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
			{
				$samplerequestlist[$k]['Health']['sample_req_type'] = 'Visit a Lab';
				$samplerequestlist[$k]['Health']['sample_req_date'] = $visit_lab_3;
			}
			
			
			if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
			{
				$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
				$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
			}
			
			if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
			{
				$samplerequestlist[$k]['Health']['sample_req_type'] = 'Home Collection';
				$samplerequestlist[$k]['Health']['sample_req_date'] = $home_collection_2;
			}*/
			
			//$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
			//$samplerequestlist[$k]['Health']['landline'] = $contact['User']['contact'];
			
			$city_name = $this->City->find('first',array('conditions'=>array('City.id'=>$val['Health']['visit_pat_city'])));
			$samplerequestlist[$k]['Health']['city_name'] = $city_name['City']['name'];
			
			
			$billing_status = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
			$samplerequestlist[$k]['Health']['bill_amount'] = $billing_status['Billing']['sub_total'];
			
			$user_email = $this->User->find('first',array('conditions'=>array('User.id'=>$val['Health']['user_id'])));
			$samplerequestlist[$k]['Health']['email'] = $user_email['User']['email'];
			
			$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$val['Health']['id'])));
			$samplerequestlist[$k]['Health']['order_num'] = $find_order_num['Billing']['order_id'];
			
			$lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$val['Health']['assigned_lab'])));
			$samplerequestlist[$k]['Health']['lab_name'] = $lab_name['Lab']['pcc_name'];
			$k++;
		}
		
		
		$j = 0;
		foreach($samplerequestlist as $key => $val)
		{
			$test_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val['Sample']['test_id'])));
			$samplerequestlist[$j]['Sample']['test_name'] = $test_name['Test']['test_parameter'];
			$j++;
		}	
		$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		$this->set('pcc_list',$pcc_list);
		$this->set('samplerequestlist',$samplerequestlist);
	}
	
	function admin_view_agent_detailing($reqId = NULL)
	{
		$this->set('title_for_layout', 'View Sample Request');
		$req_id = base64_decode($reqId);
		if(!empty($req_id))
		{
			$request_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			if(!empty($request_details))
			{
				$find_order_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request_details['Health']['id'])));
				$request_det['Health']['order_num'] = $find_order_num['Billing']['order_id'];
				if($request_details['Health']['gender'] == 1)
				{
					$gender = 'Male';
				}
				if($request_details['Health']['gender'] == 2)
				{
					$gender = 'Female';
				}
				if($request_details['Health']['discount_amount'] != 0)
				{
					$request_det['Health']['discount_amount'] = $request_details['Health']['discount_amount'];
					$request_det['Health']['discount_amount_reason'] = $request_details['Health']['discount_amount_reason'];
				}
				$request_det['Health']['message_status'] = $request_details['Health']['message_status'];
				$request_det['Health']['lab_message'] = $request_details['Health']['lab_message'];
				
				$request_det['Health']['published'] = $request_details['Health']['published'];
				$request_det['Health']['published_reason'] = $request_details['Health']['published_reason'];
				if($request_details['Health']['discount_id'] != 0)
				{
					$discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$request_details['Health']['discount_id'])));
					$request_det['Health']['discount_code'] = $discount['Discount']['discount_code'];
					$request_det['Health']['discount_info'] = $discount['Discount']['discount_description'];
					$request_det['Health']['discount_id'] = $request_details['Health']['discount_id'];
					if($discount['Discount']['type'] == 'Percent')
					{
						$request_det['Health']['discount_amt'] = $discount['Discount']['amount'].'%';
					}
					if($discount['Discount']['type'] == 'Rupees')
					{
						$request_det['Health']['discount_amt'] = 'Rs. '.$discount['Discount']['amount'];
					}
				}
				if($request_details['Health']['home_report'] != 0)
				{
					$request_det['Health']['home_report'] = $request_details['Health']['home_report'];
					$request_det['Health']['home_info'] = 'Rs.50 included of sending report at home.';
				}
				
				
				if(!empty($request_details['Health']['test_id']))
					{
						$explode_test = explode(',',$request_details['Health']['test_id']);
						$count_test = count($explode_test);
						if($count_test == 1)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'];
						}
						if($count_test == 2)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'];
						}
						if($count_test == 3)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'];
						}
						if($count_test == 4)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'];
						}
						if($count_test == 5)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'];
						}
						if($count_test == 6)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_idd'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'];
						}
						if($count_test == 7)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'];
						}
						if($count_test == 8)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'];
						}
						if($count_test == 9)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_9['RequestTest']['mrp'];
						}
						if($count_test == 10)
						{
							$test_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[0])));
							$test_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[1])));
							$test_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[2])));
							$test_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[3])));
							$test_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[4])));
							$test_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[5])));
							$test_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[6])));
							$test_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[7])));
							$test_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[8])));
							$test_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_test[9])));
							$save_db_test_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[0],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[1],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[2],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[3],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[4],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[5],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[6],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[7],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[8],'RequestTest.type'=>'TE')));
							$save_db_test_mrp_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_test[9],'RequestTest.type'=>'TE')));
							$test_name = '<strong>1-</strong> '.$test_1['Test']['testcode'].' - '.$test_1['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$test_2['Test']['testcode'].' - '.$test_2['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$test_3['Test']['testcode'].' - '.$test_3['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$test_4['Test']['testcode'].' - '.$test_4['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$test_5['Test']['testcode'].' - '.$test_5['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$test_6['Test']['testcode'].' - '.$test_6['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$test_7['Test']['testcode'].' - '.$test_7['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$test_8['Test']['testcode'].' - '.$test_8['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$test_9['Test']['testcode'].' - '.$test_9['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_9['RequestTest']['mrp'].'<br>'.'<strong>10-</strong> '.$test_10['Test']['testcode'].' - '.$test_10['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_10['RequestTest']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['profile_id']))
					{
						$explode_profile = explode(',',$request_details['Health']['profile_id']);
						$count_profile = count($explode_profile);
						if($count_profile == 1)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'];
						}
						if($count_profile == 2)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'];
						}
						if($count_profile == 3)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'];
						}
						if($count_profile == 4)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'];
						}
						if($count_profile == 5)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'];
						}
						if($count_profile == 6)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'];
						}
						if($count_profile == 7)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'];
						}
						if($count_profile == 8)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'];
						}
						if($count_profile == 9)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[8],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_9['RequestTest']['mrp'];
						}
						if($count_profile == 10)
						{
							$profile_1 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[0])));
							$profile_2 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[1])));
							$profile_3 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[2])));
							$profile_4 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[3])));
							$profile_5 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[4])));
							$profile_6 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[5])));
							$profile_7 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[6])));
							$profile_8 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[7])));
							$profile_9 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[8])));
							$profile_10 = $this->Test->find('first',array('conditions'=>array('Test.id'=>$explode_profile[9])));
							$save_db_profile_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[0],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[1],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[2],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[3],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[4],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[5],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[6],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[7],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_9 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[8],'RequestTest.type'=>'PR')));
							$save_db_profile_mrp_10 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_profile[9],'RequestTest.type'=>'PR')));
							$profile_name = '<strong>1-</strong> '.$profile_1['Test']['testcode'].' - '.$profile_1['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$profile_2['Test']['testcode'].' - '.$profile_2['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$profile_3['Test']['testcode'].' - '.$profile_3['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$profile_4['Test']['testcode'].' - '.$profile_4['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$profile_5['Test']['testcode'].' - '.$profile_5['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$profile_6['Test']['testcode'].' - '.$profile_6['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$profile_7['Test']['testcode'].' - '.$profile_7['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$profile_8['Test']['testcode'].' - '.$profile_8['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_8['RequestTest']['mrp'].'<br>'.'<strong>9-</strong> '.$profile_9['Test']['testcode'].' - '.$profile_9['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_9['RequestTest']['mrp'].'<br>'.'<strong>10-</strong> '.$profile_10['Test']['testcode'].' - '.$profile_10['Test']['test_parameter'].' - Rs.'.$save_db_profile_mrp_10['RequestTest']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['offer_id']))
					{
						$explode_offers = explode(',',$request_details['Health']['offer_id']);
						$count_offers= count($explode_offers);
						if($count_offers == 1)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'];
						}
						if($count_offers == 2)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'];
						}
						if($count_offers == 3)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'];
						}
						if($count_offers == 4)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'];
						}
						if($count_offers == 5)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'];
						}
						if($count_offers == 6)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'];
						}
						if($count_offers == 7)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_7['RequestTest']['mrp'];
						}
						if($count_offers == 8)
						{
							$offer_1 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[0])));
							$offer_2 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[1])));
							$offer_3 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[2])));
							$offer_4 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[3])));
							$offer_5 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[4])));
							$offer_6 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[5])));
							$offer_7 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[6])));
							$offer_8 = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$explode_offers[7])));
							$save_db_offer_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[0],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[1],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[2],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[3],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[4],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_6 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[5],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_7 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[6],'RequestTest.type'=>'OF')));
							$save_db_offer_mrp_8 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_offers[7],'RequestTest.type'=>'OF')));
							$offer_name = '<strong>1-</strong> '.$offer_1['Banner']['banner_code'].' - '.$offer_1['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$offer_2['Banner']['banner_code'].' - '.$offer_2['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$offer_3['Banner']['banner_code'].' - '.$offer_3['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$offer_4['Banner']['banner_code'].' - '.$offer_4['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$offer_5['Banner']['banner_code'].' - '.$offer_5['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_5['RequestTest']['mrp'].'<br>'.'<strong>6-</strong> '.$offer_6['Banner']['banner_code'].' - '.$offer_6['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_6['RequestTest']['mrp'].'<br>'.'<strong>7-</strong> '.$offer_7['Banner']['banner_code'].' - '.$offer_7['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_7['RequestTest']['mrp'].'<br>'.'<strong>8-</strong> '.$offer_8['Banner']['banner_code'].' - '.$offer_8['Banner']['banner_name'].' - Rs.'.$save_db_offer_mrp_8['RequestTest']['mrp'];
						}
					}
					
					if(!empty($request_details['Health']['package_id']))
					{
						$explode_packages = explode(',',$request_details['Health']['package_id']);
						$count_packages = count($explode_packages);
						if($count_packages == 1)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA')));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'];
						}
						if($count_packages == 2)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA')));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'];
						}
						if($count_packages == 3)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA')));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'];
						}
						if($count_packages == 4)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA')));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$save_db_package_mrp_4['RequestTest']['mrp'];
						}
						if($count_packages == 5)
						{
							$package_1 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[0])));
							$package_2 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[1])));
							$package_3 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[2])));
							$package_4 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[3])));
							$package_5 = $this->Package->find('first',array('conditions'=>array('Package.id'=>$explode_packages[4])));
							$save_db_package_mrp_1 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[0],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_2 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[1],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_3 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[2],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_4 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[3],'RequestTest.type'=>'PA')));
							$save_db_package_mrp_5 = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$explode_packages[4],'RequestTest.type'=>'PA')));
							$package_name = '<strong>1-</strong> '.$package_1['Package']['package_name'].' - Rs.'.$save_db_package_mrp_1['RequestTest']['mrp'].'<br>'.'<strong>2-</strong> '.$package_2['Package']['package_name'].' - Rs.'.$save_db_package_mrp_2['RequestTest']['mrp'].'<br>'.'<strong>3-</strong> '.$package_3['Package']['package_name'].' - Rs.'.$save_db_package_mrp_3['RequestTest']['mrp'].'<br>'.'<strong>4-</strong> '.$package_4['Package']['package_name'].' - Rs.'.$save_db_package_mrp_4['RequestTest']['mrp'].'<br>'.'<strong>5-</strong> '.$package_5['Package']['package_name'].' - Rs.'.$save_db_package_mrp_5['RequestTest']['mrp'];
						}
					}
				
				if(!empty($request_details['Health']['test_id']))
				{
					$expl_test = explode(',',$request_details['Health']['test_id']);
					$amt_test = 0;
					foreach($expl_test as $key => $val)
					{
						$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
						$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
						$amt_test = $amt_test;
					}
					$request_det['Health']['indi_test_amt'] = $amt_test;
				}
				if(empty($request_details['Health']['test_id']))
				{
					$amt_test = 0;
					$request_det['Health']['indi_test_amt'] = $amt_test;
				}
				
				if(!empty($request_details['Health']['profile_id']))
				{
					$expl_profile = explode(',',$request_details['Health']['profile_id']);
					$amt_profile = 0;
					foreach($expl_profile as $key => $val)
					{
						$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
						$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
						$amt_profile = $amt_profile;
					}
					$request_det['Health']['indi_profile_amt'] = $amt_profile;
				}
				if(empty($request_details['Health']['profile_id']))
				{
					$amt_profile = 0;
					$request_det['Health']['indi_profile_amt'] = $amt_profile;
				}
				
				if(!empty($request_details['Health']['offer_id']))
				{
					$expl_offer= explode(',',$request_details['Health']['offer_id']);
					$amt_offer = 0;
					foreach($expl_offer as $key => $val)
					{
						$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
						$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
						$amt_offer = $amt_offer;
					}
					$request_det['Health']['indi_offer_amt'] = $amt_offer;
				}
				if(empty($request_details['Health']['offer_id']))
				{
					$amt_offer = 0;
					$request_det['Health']['indi_offer_amt'] = $amt_offer;
				}
				
				if(!empty($request_details['Health']['package_id']))
				{
					$expl_package= explode(',',$request_details['Health']['package_id']);
					$amt_package = 0;
					foreach($expl_package as $key => $val)
					{
						$find_mrp_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
						$amt_package = ($find_mrp_package['Package']['package_mrp']+$amt_package);
						$amt_package = $amt_package;
					}
					$request_det['Health']['indi_package_amt'] = $amt_package;
				}
				if(empty($request_details['Health']['package_id']))
				{
					$amt_package = 0;
					$request_det['Health']['indi_package_amt'] = $amt_package;
				}
				$request_det['Health']['id'] = $request_details['Health']['id'];
				$request_det['Health']['patient_name'] = strtoupper($request_details['Health']['name']);
				$request_det['Health']['gender'] = $gender;
				$request_det['Health']['age'] = $request_details['Health']['age'].' Years';
				$request_det['Health']['balance_refund'] = $request_details['Health']['balance_refund'];
				$request_det['Health']['refund_status'] = $request_details['Health']['refund_status'];
				if($request_details['Health']['refund_status'] == 1)
				{
					$find_refund_person = $this->Paytrack->find('first',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Refund')));
					$explode_date_refund = explode(' ',$find_refund_person['Paytrack']['receive_date']);
					$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$find_refund_person['Paytrack']['admin_id'])));
					$request_det['Health']['refund_admin_name'] = 'Rs. '.$request_details['Health']['balance_refund'].' has been refunded by '.$admin_name['Admin']['name'].' on '.date('d-m-Y',strtotime($explode_date_refund[0]));
				}	
				
				if($request_details['Health']['received_amount'] != 0)
				{
					$find_receive_amounts = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Receive')));
					$c = 0;
					foreach($find_receive_amounts as $key => $val)
					{
						$admin_per_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$val['Paytrack']['admin_id'])));
						$find_receive_amounts[$c]['Paytrack']['admin_receive_name'] = $admin_per_name['Admin']['name'];
						
						$explode_rec_date = explode(' ',$val['Paytrack']['receive_date']);
						$find_receive_amounts[$c]['Paytrack']['admin_receive_date'] = $explode_rec_date[0];
						
						$c++;
					}
					$request_det['Health']['receive_tracks'] = $find_receive_amounts;
				}
				
				$request_det['Health']['test_names'] = $test_name;
				$request_det['Health']['profile_names'] = $profile_name;
				$request_det['Health']['offer_names'] = $offer_name;
				$request_det['Health']['package_names'] = $package_name;
				$request_det['Health']['test_sel_ids'] = str_replace(',','*',$request_details['Health']['test_id']);
				$request_det['Health']['profile_sel_ids'] = str_replace(',','*',$request_details['Health']['profile_id']);
				$request_det['Health']['offer_sel_ids'] = str_replace(',','*',$request_details['Health']['offer_id']);
				$request_det['Health']['package_sel_ids'] = str_replace(',','*',$request_details['Health']['package_id']);
				$request_det['Health']['UserID'] = $request_details['Health']['user_id'];
				$find_user_contact_email = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
				$request_det['Health']['email'] = $find_user_contact_email['User']['email'];
				$request_det['Health']['test_amt'] = $request_details['Health']['total_amount'];
				$request_det['Health']['remarks'] = $request_details['Health']['remarks'];
				$request_det['Health']['receive_amt'] = $request_details['Health']['received_amount'];
				if($request_details['Health']['received_amount'] == 0)
				{
					$request_det['Health']['balance_amt'] = $request_details['Health']['total_amount'];
				}
				if($request_details['Health']['received_amount'] != 0)
				{
					$request_det['Health']['balance_amt'] = $request_details['Health']['balance_amount'];
				}
				
				
				$visit_lab_1 = $request_details['Health']['city']; 
				$visit_lab_2 = $request_details['Health']['sample_time'];
				$visit_lab_3 = $request_details['Health']['sample_date'];
				
				$home_collection_1 = $request_details['Health']['sample_time1'];
				$home_collection_2 = $request_details['Health']['sample_date1'];
				$home_collection_3 = $request_details['Health']['address'];
				$this->Timelab = ClassRegistry::init('Timelab');
				$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));				
				if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
				{
					$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
					$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
					$visit_time = $timelabs[$visit_lab_2];						
					$request_det['Health']['visit_lab_collect_time'] = $visit_time;
					$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
				}
				
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
				{
					$collect_time = $timelabs[$home_collection_1];						
					$request_det['Health']['home_collect_time'] = $collect_time;
					$request_det['Health']['home_collect_date'] = $home_collection_2;
					$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
					$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
					$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
					$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
					$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
					$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
					$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
					$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
					$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
					$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
				}
				
				if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
				{
					$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
					$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
					$visit_time = $timelabs[$visit_lab_2];		
					$request_det['Health']['visit_lab_collect_time'] = $visit_time;
					$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
				}
				
				
				if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
				{
					$collect_time = $timelabs[$home_collection_1];						
					$request_det['Health']['home_collect_time'] = $collect_time;
					$request_det['Health']['home_collect_date'] = $home_collection_2;
					$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
					$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
					$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
					$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
					$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
					$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
					$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
					$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
					$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
					$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
				}
				$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
				$request_det['Health']['contact'] = $contact['User']['contact'];
				$request_det['Health']['remark'] = $request_details['Health']['remark'];
				$request_det['Health']['pay_status'] = $request_details['Health']['pay_status'];
				$request_det['Health']['patient_report'] = $request_details['Health']['patient_report'];
				$this->data = $request_det;
			}
			else
			{
				$this->Session->setFlash('Invalid Request','flash_failure');
				$this->redirect(array('controller'=>'samples','action'=>'index'));
			}
		}
		
		$tests = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'TEST')));
		$profiles = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE')));
		$offers = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1)));
		$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
		$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$this->set('city',$city);
		$state = $this->State->find('all',array('conditions'=>array('State.status'=>1)));
		$this->set('timelabs',$timelabs);
		$this->set('tests',$tests);
		$this->set('profiles',$profiles);
		$this->set('offers',$offers);
		$this->set('state',$state);
	}
	
	function admin_print_detail($req_id = NULL)
	{
		$this->layout = false;
		$request_details = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
		if(!empty($request_details))
		{
			$init_tot_amt = 0;
			$get_total_test_amt = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'])));
			foreach($get_total_test_amt as $tot_amt_key => $tot_amt_val)
			{
				$init_tot_amt = ($tot_amt_val['RequestTest']['mrp']+$init_tot_amt);
			}
			$request_det['Health']['total_test_amt'] = $init_tot_amt;
			
			$get_req_num = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$req_id)));
			$request_det['Health']['req_num'] = $get_req_num['Billing']['order_id'];
			
			if($request_details['Health']['gender'] == 1)
			{
				$gender = 'Male';
			}
			if($request_details['Health']['gender'] == 2)
			{
				$gender = 'Female';
			}
			if($request_details['Health']['discount_id'] != 0)
			{
				$discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$request_details['Health']['discount_id'])));
				$request_det['Health']['discount_code'] = $discount['Discount']['discount_code'];
				$request_det['Health']['discount_info'] = $discount['Discount']['discount_description'];
				$request_det['Health']['discount_id'] = $request_details['Health']['discount_id'];
				
				if($discount['Discount']['type'] == 'Percent')
				{
					$request_det['Health']['discount_amt'] = $discount['Discount']['amount'].'%';
				}
				if($discount['Discount']['type'] == 'Rupees')
				{
					$request_det['Health']['discount_amt'] = 'Rs. '.$discount['Discount']['amount'];
				}
			}
			if($request_details['Health']['discount_amount'] != 0)
			{
				$request_det['Health']['discount_amount'] = $request_details['Health']['discount_amount'];
				$request_det['Health']['discount_amount_reason'] = $request_details['Health']['discount_amount_reason'];
			}
			if($request_details['Health']['home_report'] != 0)
			{
				$request_det['Health']['home_report'] = $request_details['Health']['home_report'];
				$request_det['Health']['home_info'] = 'Rs.50 included of sending report at home.';
			}
			$package_name = "";
			$test_name="";
			$counter_seq=1;
			$sample_id = array(); 

			if(!empty($request_details['Health']['test_id']))
			{
				
				$explode_test = explode(',',$request_details['Health']['test_id']);
				$count_test = count($explode_test);
				$test_1 = $this->Test->find('all',array('conditions'=>array('Test.id'=>$explode_test)));
				$test_1_ids=array();
				foreach($test_1 as $key=>$value)
				{
					$testcount++;
					$test_1_ids[]=$value['Test']['id'];
					array_push($sample_id,$value['Test']['sample']);
				}
				$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$test_1_ids,'RequestTest.type'=>'TE','RequestTest.status'=>1)));
				$save_db_test_mrp_1_ids=array();
				foreach($save_db_test_mrp_1 as $key=>$value)
				{
					$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
				}
				
				
				foreach($test_1 as $key=>$value)
				{
					$test_name = $test_name.'<strong>'.$counter_seq.'-</strong> '.$value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Test']['id']].'<br>';
					$counter_seq++;
                }
			}
			if(!empty($request_details['Health']['profile_id']))
			{
				$explode_profile = explode(',',$request_details['Health']['profile_id']);
				$count_profile = count($explode_profile);
				
				$profile_1 = $this->Test->find('all',array('conditions'=>array('Test.id'=>$explode_profile)));
				$profile_1_ids=array();
				foreach($profile_1 as $key=>$value)
				{
					$testcount++;
					$profile_1_ids[]=$value['Test']['id'];
					array_push($sample_id,$value['Test']['sample']);
				}
				$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$profile_1_ids,'RequestTest.type'=>'PR','RequestTest.status'=>1)));
				
				$save_db_test_mrp_1_ids=array();
				foreach($save_db_test_mrp_1 as $key=>$value)
				{
					$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
				}
				//print_R($save_db_test_mrp_1_ids);die;
				//$counter_seq=1;
				foreach($profile_1 as $key=>$value)
				{
					$test_name = $test_name.'<strong>'.$counter_seq.'-</strong> '.$value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Test']['id']].'<br>';
					$counter_seq++;
                }
			
			}
			if(!empty($request_details['Health']['offer_id']))
			{
				$explode_offers = explode(',',$request_details['Health']['offer_id']);
				$count_offers= count($explode_offers);
				
				$banner_1 = $this->Banner->find('all',array('conditions'=>array('Banner.id'=>$explode_offers)));
				$banner_1_ids=array();
				foreach($banner_1 as $key=>$value)
				{
					$testcount++;
					$banner_1_ids[]=$value['Banner']['id'];
				}
				$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$banner_1_ids,'RequestTest.type'=>'TE','RequestTest.status'=>1)));
				$save_db_test_mrp_1_ids=array();
				foreach($save_db_test_mrp_1 as $key=>$value)
				{
					$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
				}
				
				//$counter_seq=1;
				foreach($banner_1 as $key=>$value)
				{
					$test_name = $test_name.'<strong>'.$counter_seq.'-</strong> '.$value['Banner']['banner_code'].' - '.$value['Banner']['banner_code'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Banner']['id']].'<br>';
					$counter_seq++;
                }
			}
			if(!empty($request_details['Health']['package_id']))
			{
				$explode_packages = explode(',',$request_details['Health']['package_id']);
				$count_packages = count($explode_packages);
				$package_1 = $this->Package->find('all',array('conditions'=>array('Package.id'=>$explode_packages)));
				$package_1_ids=array();
				foreach($package_1 as $key=>$value)
				{
					$testcount++;
					$package_1_ids[]=$value['Package']['id'];
				}
				$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$package_1_ids,'RequestTest.type'=>'PA','RequestTest.status'=>1)));
				$save_db_test_mrp_1_ids=array();
				foreach($save_db_test_mrp_1 as $key=>$value)
				{
					$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
				}
				
				//$counter_seq=1;
				foreach($package_1 as $key=>$value)
				{
					$package_name = $package_name.'<strong>'.$counter_seq.'-</strong> '.$value['Package']['package_code'].' - '.$value['Package']['package_name'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Package']['id']].'<br>';
					$counter_seq++;
                }
			}
			if(!empty($request_details['Health']['service_id']))
			{
				$explode_service = explode(',',$request_details['Health']['service_id']);
				$count_service = count($explode_service);
				$service_1 = $this->Test->find('all',array('conditions'=>array('Test.id'=>$explode_service)));
				$service_1_ids=array();
				foreach($service_1 as $key=>$value)
				{
					$testcount++;
					$servicecount++;
					$service_1_ids[]=$value['Test']['id'];
					array_push($sample_id,$value['Test']['sample']);
				}
				$save_db_test_mrp_1 = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.health_id'=>$request_details['Health']['id'],'RequestTest.test_id'=>$service_1_ids,'RequestTest.type'=>'SR','RequestTest.status'=>1)));
				$save_db_test_mrp_1_ids=array();
				foreach($save_db_test_mrp_1 as $key=>$value)
				{
					$save_db_test_mrp_1_ids[$value['RequestTest']['test_id']] = $value['RequestTest']['mrp'];
				}
				//$counter_seq=1;
				foreach($service_1 as $key=>$value)
				{
					$package_name = $package_name.'<strong>'.$counter_seq.'-</strong> '.$value['Test']['testcode'].' - '.$value['Test']['test_parameter'].' - Rs.'.$save_db_test_mrp_1_ids[$value['Test']['id']].'<br>';
					$counter_seq++;
                }
			}

			$sample_type = $this->Samplemaster->query("select shortname from sample_type_master where sample_id in (".implode(',',$sample_id).")");			
			$this->set('sample_type',$sample_type);
			
			if(!empty($request_details['Health']['test_id']))
			{
				$expl_test = explode(',',$request_details['Health']['test_id']);
				$amt_test = 0;
				foreach($expl_test as $key => $val)
				{
					$find_mrp_test = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
					$amt_test = ($find_mrp_test['Test']['mrp']+$amt_test);
					$amt_test = $amt_test;
				}
				$request_det['Health']['indi_test_amt'] = $amt_test;
			}
			if(empty($request_details['Health']['test_id']))
			{
				$amt_test = 0;
				$request_det['Health']['indi_test_amt'] = $amt_test;
			}
			
			if(!empty($request_details['Health']['profile_id']))
			{
				$expl_profile = explode(',',$request_details['Health']['profile_id']);
				$amt_profile = 0;
				foreach($expl_profile as $key => $val)
				{
					$find_mrp_profile = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
					$amt_profile = ($find_mrp_profile['Test']['mrp']+$amt_profile);
					$amt_profile = $amt_profile;
				}
				$request_det['Health']['indi_profile_amt'] = $amt_profile;
			}
			if(empty($request_details['Health']['profile_id']))
			{
				$amt_profile = 0;
				$request_det['Health']['indi_profile_amt'] = $amt_profile;
			}
			
			if(!empty($request_details['Health']['offer_id']))
			{
				$expl_offer= explode(',',$request_details['Health']['offer_id']);
				$amt_offer = 0;
				foreach($expl_offer as $key => $val)
				{
					$find_mrp_offer = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
					$amt_offer = ($find_mrp_offer['Banner']['banner_mrp']+$amt_offer);
					$amt_offer = $amt_offer;
				}
				$request_det['Health']['indi_offer_amt'] = $amt_offer;
			}
			if(empty($request_details['Health']['offer_id']))
			{
				$amt_offer = 0;
				$request_det['Health']['indi_offer_amt'] = $amt_offer;
			}
			
			if(!empty($request_details['Health']['package_id']))
			{
				$expl_package= explode(',',$request_details['Health']['package_id']);
				$amt_package = 0;
				foreach($expl_package as $key => $val)
				{
					$find_mrp_package = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
					$amt_package = ($find_mrp_package['Package']['package_mrp']+$amt_package);
					$amt_package = $amt_package;
				}
				$request_det['Health']['indi_package_amt'] = $amt_package;
			}
			if(empty($request_details['Health']['package_id']))
			{
				$amt_package = 0;
				$request_det['Health']['indi_package_amt'] = $amt_package;
			}
			$request_det['Health']['id'] = $request_details['Health']['id'];
			$request_det['Health']['patient_name'] = strtoupper($request_details['Health']['name']);
			$request_det['Health']['gender'] = $gender;
			$request_det['Health']['age'] = $request_details['Health']['age'].' Years';
			$request_det['Health']['balance_refund'] = $request_details['Health']['balance_refund'];
			$request_det['Health']['refund_status'] = $request_details['Health']['refund_status'];
			//11-09-13 Starts
			$request_det['Health']['register_sample'] = $request_details['Health']['register_sample'];
			$request_det['Health']['sent_pathcorp_admin'] = $request_details['Health']['sent_pathcorp_admin'];
			$find_admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$request_details['Health']['sent_pathcorp_admin'])));
			$request_det['Health']['sent_pathcorp_admin_name'] = $find_admin_name['Admin']['name'];
			
			
			$vial_info = $this->Vial->find('first',array('conditions'=>array('Vial.request_id'=>$req_id)));
			$request_det['Health']['vial_id'] = $vial_info['Vial']['id'];
			$request_det['Health']['vial_created'] = $vial_info['Vial']['created'];
			$request_det['Health']['col1'] = $vial_info['Vial']['col1'];
			$request_det['Health']['col2'] = $vial_info['Vial']['col2'];
			$request_det['Health']['col3'] = $vial_info['Vial']['col3'];
			$request_det['Health']['col4'] = $vial_info['Vial']['col4'];
			$request_det['Health']['col5'] = $vial_info['Vial']['col5'];
			$request_det['Health']['col6'] = $vial_info['Vial']['col6'];
			$request_det['Health']['col7'] = $vial_info['Vial']['col7'];
			$request_det['Health']['remark1'] = $vial_info['Vial']['remark1'];
			$request_det['Health']['remark2'] = $vial_info['Vial']['remark2'];
			$request_det['Health']['remark3'] = $vial_info['Vial']['remark3'];
			$request_det['Health']['remark4'] = $vial_info['Vial']['remark4'];
			$request_det['Health']['remark5'] = $vial_info['Vial']['remark5'];
			$request_det['Health']['remark6'] = $vial_info['Vial']['remark6'];
			$request_det['Health']['remark7'] = $vial_info['Vial']['remark7'];
			$request_det['Health']['sent_pathcorp_date'] = date('d-m-Y',strtotime($vial_info['Vial']['created']));
			
			//11-09-13 Ends
			
			//12-09-13 Starts
			$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1)));
			$this->set('timelabs',$timelabs);
			$request_det['Health']['cancelled_status'] = $request_details['Health']['cancelled_status'];
			$request_det['Health']['cancelled_reason'] = $request_details['Health']['cancelled_reason'];
			$request_det['Health']['reschduled'] = $request_details['Health']['reschduled'];
			$request_det['Health']['city_idd'] = $request_details['Health']['city_id'];
			
			
			//12-09-13 Ends
			if($request_details['Health']['refund_status'] == 1)
			{
				$find_refund_person = $this->Paytrack->find('first',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Refund')));
				$explode_date_refund = explode(' ',$find_refund_person['Paytrack']['receive_date']);
				$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$find_refund_person['Paytrack']['admin_id'])));
				$request_det['Health']['refund_admin_name'] = 'Rs. '.$request_details['Health']['balance_refund'].' has been refunded by '.$admin_name['Admin']['name'].' on '.date('d-m-Y',strtotime($explode_date_refund[0]));
			}	
			
			if($request_details['Health']['received_amount'] != 0)
			{
				$find_receive_amounts = $this->Paytrack->find('all',array('conditions'=>array('Paytrack.request_id'=>$request_details['Health']['id'],'Paytrack.type'=>'Receive')));
				$c = 0;
				foreach($find_receive_amounts as $key => $val)
				{
					$admin_per_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$val['Paytrack']['admin_id'])));
					$find_receive_amounts[$c]['Paytrack']['admin_receive_name'] = $admin_per_name['Admin']['name'];
					
					$explode_rec_date = explode(' ',$val['Paytrack']['receive_date']);
					$find_receive_amounts[$c]['Paytrack']['admin_receive_date'] = $explode_rec_date[0];
					
					$c++;
				}
				$request_det['Health']['receive_tracks'] = $find_receive_amounts;
			}
			
			$request_det['Health']['test_names'] = $test_name;
			$request_det['Health']['profile_names'] = $profile_name;
			$request_det['Health']['offer_names'] = $offer_name;
			$request_det['Health']['package_names'] = $package_name;
			$request_det['Health']['service_names'] = $service_name;
			
			$request_det['Health']['UserID'] = $request_details['Health']['user_id'];
			$find_user_contact_email = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
			$request_det['Health']['email'] = $find_user_contact_email['User']['email'];
			$request_det['Health']['test_amt'] = $request_details['Health']['total_amount'];
			$request_det['Health']['remarks'] = $request_details['Health']['remarks'];
			$request_det['Health']['receive_amt'] = $request_details['Health']['received_amount'];
			if($request_details['Health']['received_amount'] == 0)
			{
				$request_det['Health']['balance_amt'] = $request_details['Health']['total_amount'];
			}
			if($request_details['Health']['received_amount'] != 0)
			{
				$request_det['Health']['balance_amt'] = $request_details['Health']['balance_amount'];
			}
			
			
			$visit_lab_1 = $request_details['Health']['city']; 
			$visit_lab_2 = $request_details['Health']['sample_time'];
			$visit_lab_3 = $request_details['Health']['sample_date'];
			
			$home_collection_1 = $request_details['Health']['sample_time1'];
			$home_collection_2 = $request_details['Health']['sample_date1'];
			$home_collection_3 = $request_details['Health']['address'];
			$this->Timelab = ClassRegistry::init('Timelab');
			$timelabs = $this->Timelab->find('list',array('conditions'=>array('Timelab.status'=>1),'fields'=>array('Timelab.sequence','Timelab.phlebo_time')));
			
			if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == ''))
			{
				$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
				$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
				$visit_time = $timelabs[$visit_lab_2];						
				$request_det['Health']['visit_lab_collect_time'] = $visit_time;
				$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
				
			}
			
			if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == ''))
			{
				$collect_time = $timelabs[$home_collection_1];          
				$request_det['Health']['home_collect_time'] = $collect_time;
				$request_det['Health']['home_collect_date'] = $home_collection_2;
				$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
				$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
				$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
				$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
				$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
				$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
				$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
				$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
				$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
				$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
			}
			
			if(($visit_lab_2 != '' && $visit_lab_3 != '') && ($home_collection_1 == '' && $home_collection_2 == 'Please select a suitable date'))
			{
				$find_lab_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$visit_lab_1)));
				$request_det['Health']['visit_lab_location'] = $find_lab_name['Lab']['pcc_name'];
				$visit_time = $timelabs[$visit_lab_2];					
				$request_det['Health']['visit_lab_collect_time'] = $visit_time;
				$request_det['Health']['visit_lab_collect_date'] = $visit_lab_3;
			}
			
			
			if(($home_collection_1 != '' && $home_collection_2 != '') && ($visit_lab_2 == '' && $visit_lab_3 == 'Please select a suitable date'))
			{
				$collect_time = $timelabs[$home_collection_1];          
				$request_det['Health']['home_collect_time'] = $collect_time;
				$request_det['Health']['home_collect_date'] = $home_collection_2;
				$request_det['Health']['home_collect_address'] = $request_details['Health']['address'];
				$request_det['Health']['home_collect_locality'] = $request_details['Health']['locality'];
				$city_name_home = $this->City->find('first',array('conditions'=>array('City.id'=>$request_details['Health']['city_id'])));
				$request_det['Health']['home_collect_city_show'] = $city_name_home['City']['name'];
				$state_name_home = $this->State->find('first',array('conditions'=>array('State.id'=>$request_details['Health']['state'])));
				$request_det['Health']['home_collect_state_show'] = $state_name_home['State']['name'];
				$request_det['Health']['home_collect_city'] = $request_details['Health']['city_id'];
				$request_det['Health']['home_collect_state'] = $request_details['Health']['state'];
				$request_det['Health']['home_collect_pincode'] = $request_details['Health']['pincode'];
				$request_det['Health']['home_collect_landmark'] = $request_details['Health']['landmark'];
			}
			$contact = $this->User->find('first',array('conditions'=>array('User.id'=>$request_details['Health']['user_id'])));
			$request_det['Health']['contact'] = $contact['User']['contact'];
			$request_det['Health']['remark'] = $request_details['Health']['remark'];
			$request_det['Health']['pay_status'] = $request_details['Health']['pay_status'];
			$request_det['Health']['patient_report'] = $request_details['Health']['patient_report'];
			
			
			
			$this->data = $request_det;
		}
		else
		{
			$this->Session->setFlash('Invalid Request','flash_failure');
			$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',base64_encode($request_details['Health']['id'])));
		}
			
	}
	
	function admin_cancel_reason($req_id=NULL)
	{
		$dd = $this->Session->read('Admin.id');
		if(!empty($this->data))
		{
			//echo "<pre>"; print_r($this->data); exit;
			$dec_id = base64_decode($req_id);
			$update_request = $this->Health->query("UPDATE healths SET cancelled_status='".$this->data['Health']['cancelled_status']."',cancelled_reason='".$this->data['Health']['cancelled_reason']."',last_edited='".$dd."',last_edited_date='".date('Y-m-d H:i:s')."' WHERE id='".$dec_id."'");
			$this->redirect('/admin/samples/view_detail_agent/'.$req_id);
		}
	}
	
	function admin_view_front_user()
	{
		if(isset($this->params['named']['name']) && $this->params['named']['name']!='')
		{
			$this->data['Search']['name'] = $this->params['named']['name'];
			$options['name'] = $this->params['named']['name'];
		}
		if(isset($this->params['named']['contact']) && $this->params['named']['contact']!='')
		{
			$this->data['Search']['phone'] = $this->params['named']['contact'];
			$options['contact'] = $this->params['named']['contact'];
		}
		if(isset($this->params['named']['email']) && $this->params['named']['email']!='')
		{
			$this->data['Search']['email'] = $this->params['named']['email'];
			$options['email'] = $this->params['named']['email'];
		}
		
		if(!empty($this->data))
		{
			$name = $this->data['Search']['name'];
			$phone = $this->data['Search']['phone'];
			$email = $this->data['Search']['email'];
			
			if(isset($this->data['Search']['name']) && $this->data['Search']['name']!='')
			{
				$conditions['User.name LIKE'] = '%'.$name.'%';
				$options['name'] = $name;
			}
			if(isset($this->data['Search']['phone']) && $this->data['Search']['phone']!='')
			{
				$conditions['User.contact LIKE'] = '%'.$phone.'%';
				$options['contact'] = $phone;
			}
			if(isset($this->data['Search']['email']) && $this->data['Search']['email']!='')
			{
				$conditions['User.email LIKE'] = '%'.$email.'%';
				$options['email'] = $email;
			}
			$this->paginate = array('User' => array('limit' =>'10','order'=>array('User.id'=>'DESC'),'conditions'=>$conditions));
			$userlist=$this->paginate('User');
			$b = 0;
			foreach($userlist as $key => $val)	
			{
				$city = $this->City->find('first',array('conditions'=>array('City.id'=>$val['User']['city'])));
				$state = $this->State->find('first',array('conditions'=>array('State.id'=>$val['User']['state'])));
				if($val['User']['gender'] == 1)
				{
					$userlist[$b]['User']['gender'] = 'Male';
				}
				if($val['User']['gender'] == 2)
				{
					$userlist[$b]['User']['gender'] = 'Female';
				}
				$userlist[$b]['User']['city_name'] = $city['City']['name'];
				$userlist[$b]['User']['state_name'] = $state['State']['name'];
				$b++;
			}
			$this->set('userlist',$userlist);
			$this->set('name',$name);
			$this->set('phone',$phone);
			$this->set('email',$email);
			$this->set('options',$options);
		}
		else
		{
			$this->paginate = array('User' => array('limit' =>'10','order'=>array('User.id'=>'DESC')));
			$userlist=$this->paginate('User');
			$b = 0;
			foreach($userlist as $key => $val)	
			{
				$city = $this->City->find('first',array('conditions'=>array('City.id'=>$val['User']['city'])));
				$state = $this->State->find('first',array('conditions'=>array('State.id'=>$val['User']['state'])));
				$health = $this->Health->find('first',array('conditions'=>array('Health.user_id'=>$val['User']['id']),'order'=>array('id'=>'DESC')));
				if($val['User']['gender'] == 1)
				{
					$userlist[$b]['User']['gender'] = 'Male';
				}
				if($val['User']['gender'] == 2)
				{
					$userlist[$b]['User']['gender'] = 'Female';
				}
				$userlist[$b]['User']['city_name'] = $city['City']['name'];
				$userlist[$b]['User']['state_name'] = $state['State']['name'];
				$userlist[$b]['User']['health'] = $health['Health'];
				$b++;
			}
			$this->set('userlist',$userlist);
		}
	}
	
	function admin_view_user_detail($id=NULL)
	{
		$dec_id = base64_decode($id);
		$user = $this->User->find('first',array('conditions'=>array('User.id'=>$dec_id)));
		if($user['User']['gender'] == 1)
		{
			$user['User']['gender'] = 'Male';
		}
		if($user['User']['gender'] == 2)
		{
			$user['User']['gender'] = 'Female';
		}
		$city = $this->City->find('first',array('conditions'=>array('City.id'=>$user['User']['city'])));
		$user['User']['city_name'] = $city['City']['name'];
		$state = $this->State->find('first',array('conditions'=>array('State.id'=>$user['User']['state'])));
		$user['User']['state_name'] = $state['State']['name'];
		$this->set('user',$user);
	}
	
	function admin_edit_user_detail($id=NULL)
	{
		$dec_id = base64_decode($id);
		if(!empty($this->data))
		{
			$this->data['User']['name'] = $this->data['User']['first_name'].' '.$this->data['User']['last_name'];
			if(!empty($this->data['User']['address2']))
			{
				$this->data['User']['address'] = $this->data['User']['address1'].'*'.$this->data['User']['address2'];
			}
			else
			{
				$this->data['User']['address'] = $this->data['User']['address1'];
			}
			if($this->User->create($this->data))
			{
				if($this->User->save($this->data))
				{
					// To update email in health table
					$result = $this->Health->find('first', array('conditions'=>array('user_id'=>$this->data['User']['id'],'status_id'=>1),'order'=>array('id'=>'desc')));
					if (isset($result['Health']))
					{
						//$update_user_id = $this->Health->query("UPDATE healths SET email='".$this->data['User']['email']."' WHERE user_id='".$this->data['User']['id']."'");
                                                //update other fields
                                                $this->data['Health']['id'] = $result['Health']['id'];
                                                $this->data['Health']['user_id'] = $this->data['User']['id'];
                                                $this->data['Health']['name'] = strtoupper($this->data['User']['first_name']) .' '.strtoupper($this->data['User']['last_name']);
                                                $this->data['Health']['email'] = $this->data['User']['email'];
                                                $this->data['Health']['landline'] = $this->data['User']['contact'];
                                                $this->Health->save($this->data);
					}
					$this->redirect('/admin/samples/view_user_detail/'.base64_encode($this->data['User']['id']));
				}
			}
		}
		else
		{
			$user = $this->User->find('first',array('conditions'=>array('User.id'=>$dec_id)));
			$this->data = $user;
		}
		$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		$state = $this->State->find('all',array('conditions'=>array('State.status'=>1)));
		$this->set('city',$city);
		$this->set('state',$state);
	}
	
	function admin_reset_pass($id=NULL)
	{
		$dec_id = base64_decode($id);
		$find_user = $this->User->find('first',array('conditions'=>array('User.id'=>$dec_id)));
		$pass2 = substr(strtolower($find_user['User']['first_name']),0,1);
		$pass3 = substr($find_user['User']['contact'],-4,4);
		$password = $pass2.$pass3;
		$this->data['User']['id'] = $dec_id;
		$this->data['User']['passwd'] = $password;
		if($this->User->create($this->data))
		{
			if($this->User->save($this->data))
			{
				$this->Session->setFlash('Password reset successfully for '.$find_user['User']['name'].' now new password is :('.$password.')','flash_success');
				$this->redirect('/admin/samples/view_user_detail/'.base64_encode($dec_id));
			}
		}
	}
	
	function admin_reset_password($id=NULL)
	{
		$dec_id = base64_decode($id);
		$find_user = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$dec_id)));
		$user_name = strtolower(str_replace(' ','',$find_user['Admin']['name']));
		$two_alpha = substr($user_name,0,2);
		$password = $two_alpha.'@niramaya';
		$encr_pass = md5($password);
		$this->data['Admin']['id'] = $dec_id;
		$this->data['Admin']['password'] = $encr_pass;
		if($this->Admin->create($this->data))
		{
			if($this->Admin->save($this->data))
			{
				$this->Session->setFlash('Password reset successfully for '.$find_user['Admin']['name'].' now new password is :('.$password.')','flash_success');
				$this->redirect('/admin/samples/view_user');
			}
		}
	}
	
	function admin_reset_agent_pass($id=NULL)
	{
		$dec_id = base64_decode($id);
		$find_agent = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$dec_id)));
		$agent_name = strtolower(str_replace(' ','',$find_agent['Agent']['name']));
		$two_alpha = substr($agent_name,0,2);
		$password = $two_alpha.'@niramaya';
		$encr_pass = md5($password);
		$this->data['Agent']['id'] = $dec_id;
		$this->data['Agent']['password'] = $encr_pass;
		if($this->Agent->create($this->data))
		{
			if($this->Agent->save($this->data))
			{
				$this->Session->setFlash('Password reset successfully for '.$find_agent['Agent']['name'].' now new password is :('.$password.')','flash_success');
				$this->redirect('/admin/samples/view_agent');
			}
		}
	}
	
	function admin_view_front_user_help()
	{
		$this->paginate = array('User' => array('limit' =>'10','order'=>array('User.id'=>'DESC')));
		$userlist=$this->paginate('User');
		$b = 0;
		foreach($userlist as $key => $val)	
		{
			$city = $this->City->find('first',array('conditions'=>array('City.id'=>$val['User']['city'])));
			$state = $this->State->find('first',array('conditions'=>array('State.id'=>$val['User']['state'])));
			if($val['User']['gender'] == 1)
			{
				$userlist[$b]['User']['gender'] = 'Male';
			}
			if($val['User']['gender'] == 2)
			{
				$userlist[$b]['User']['gender'] = 'Female';
			}
			$userlist[$b]['User']['city_name'] = $city['City']['name'];
			$userlist[$b]['User']['state_name'] = $state['State']['name'];
			$b++;
		}
		$this->set('userlist',$userlist);
	}
	
	function admin_view_user_detail_help($id=NULL)
	{
		$dec_id = base64_decode($id);
		$user = $this->User->find('first',array('conditions'=>array('User.id'=>$dec_id)));
		if($user['User']['gender'] == 1)
		{
			$user['User']['gender'] = 'Male';
		}
		if($user['User']['gender'] == 2)
		{
			$user['User']['gender'] = 'Female';
		}
		$city = $this->City->find('first',array('conditions'=>array('City.id'=>$user['User']['city'])));
		$user['User']['city_name'] = $city['City']['name'];
		$state = $this->State->find('first',array('conditions'=>array('State.id'=>$user['User']['state'])));
		$user['User']['state_name'] = $state['State']['name'];
		$this->set('user',$user);
	}
	
	function admin_reset_pass_help($id=NULL)
	{
		$dec_id = base64_decode($id);
		$find_user = $this->User->find('first',array('conditions'=>array('User.id'=>$dec_id)));
		$pass2 = substr(strtolower($find_user['User']['first_name']),0,1);
		$pass3 = substr($find_user['User']['contact'],-4,4);
		$password = $pass2.$pass3;
		$this->data['User']['id'] = $dec_id;
		$this->data['User']['passwd'] = $password;
		if($this->User->create($this->data))
		{
			if($this->User->save($this->data))
			{
				$this->Session->setFlash('Password reset successfully for '.$find_user['User']['name'].' now new password is :('.$password.')','flash_success');
				$this->redirect('/admin/samples/view_user_detail_help/'.base64_encode($dec_id));
			}
		}
	}
	
	function admin_delete_row()
	{
		$req_id = $_REQUEST['id'];
		$update = $this->Health->query("UPDATE healths SET status='0' WHERE id='".$req_id."'");
		$x['success'] = 'success';
		$x['req_id'] = $req_id;
		$m['req_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	//FUNCTION FOR MIS DAILY REQUEST REPORT
	
	function admin_daily_request_report()	
	{
		$this->set('title_for_layout','Sales Report');
		$admin_u_type = $this->Session->read('Admin.userType');
		$admin_lab_type = $this->Session->read('Admin.labType');
		$requestStatus = Configure::read('RequestStatus');
		$this->set('requ_list',$requestStatus);
		if($admin_u_type != 'A' && $admin_u_type != 'BM' && $admin_u_type != 'Agent')
		{
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.id'=>$admin_lab_type)));
			$this->set('pcc',$pcc);
		}
		else
		{
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$this->set('pcc',$pcc);
		}
		$this->set('login_agent_type',$login_agent_type);
		if(!empty($this->params['named']['s_date']) && $this->params['named']['s_date'] != '')
		{
			$this->data['DailyRequestReport']['s_date'] = $this->params['named']['s_date'];
			$options['s_date'] = $this->params['named']['s_date'];
		}
		if(!empty($this->params['named']['from_date']) && $this->params['named']['from_date'] != '')
		{
			$this->data['DailyRequestReport']['from_date'] = $this->params['named']['from_date'];
			$options['from_date'] = $this->params['named']['from_date'];
		}
		if(!empty($this->params['named']['to_date']) && $this->params['named']['to_date'] != '')
		{
			$this->data['DailyRequestReport']['to_date'] = $this->params['named']['to_date'];
			$options['to_date'] = $this->params['named']['to_date'];
		}
		if(!empty($this->params['named']['lab']) && $this->params['named']['lab'] != '')
		{
			$this->data['DailyRequestReport']['pcc_list_id'] = $this->params['named']['lab'];
			$options['lab'] = $this->params['named']['lab'];
		}
		if(!empty($this->params['named']['requ_status']) && $this->params['named']['requ_status'] != '')
		{
			$this->data['DailyRequestReport']['requ_status'] = $this->params['named']['requ_status'];
			$options['requ_status'] = $this->params['named']['requ_status'];
		}
		if(!empty($this->params['named']['set_option']) && $this->params['named']['set_option'] != '')
		{
			$this->data['DailyRequestReport']['set_option'] = $this->params['named']['set_option'];
			$options['set_option'] = $this->params['named']['set_option'];
		}
		$payment_type = $this->PaymentType->find('list',array('fields'=>array('PaymentType.id','PaymentType.type')));
		if(!empty($this->data))
		{
			if($this->data['DailyRequestReport']['set_option'] == 'filter')
			{
				$s_date = $this->data['DailyRequestReport']['s_date']; 
				$from_date = $this->data['DailyRequestReport']['from_date']; 
				$to_date = $this->data['DailyRequestReport']['to_date'];
				$lab_id = $this->data['DailyRequestReport']['pcc_list_id'];
				$lab_id1 = $this->data['DailyRequestReport']['pcc_list_id1'];
				$requ_status = $this->data['DailyRequestReport']['requ_status'];
				$select_option = $this->data['DailyRequestReport']['set_option'];
				$filter_class="Result For ";
				if(!empty($s_date) && $s_date != '')
				{
					$conditions['Health.book_date >='] = date('Y-m-d 00:00:00',strtotime($s_date));
					$conditions['Health.book_date <='] = date('Y-m-d 23:59:59',strtotime($s_date));
					$options['s_date'] = $s_date;
					$filter_class.= "<font color='green'>From <strong>".$s_date."</strong></font>";
				}
				if(!empty($from_date) && $from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($from_date));
					$options['from_date'] = $from_date;
					$filter_class.= "<font color='green'>From <strong>".$from_date."</strong></font>";
				}
				if(!empty($to_date) && $to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($to_date));
					$options['to_date'] = $to_date;
					$filter_class.= "<font color='green'> till <strong>".$to_date."</strong></font>";
				}
				$lab_list_filter = $this->Lab->find('list',array('fields'=>array('id','pcc_name')));
				if(!empty($lab_id) && $lab_id != '')
				{
					$conditions['Health.assigned_lab'] = $lab_id;
					$options['lab'] = $lab_id;
					$filter_class.= "<font color='orange'> Serviced By : <strong>".$lab_list_filter[$lab_id]."</strong></font>";
				}
				else
				{
					$filter_class.= "<font color='orange'> Serviced By :<strong>All</strong></font>";
				}
				if(!empty($lab_id1) && $lab_id1 != '')
				{
					$conditions['Health.created_by'] = $lab_id1;
					$options['lab1'] = $lab_id1;
					$filter_class.= "<font color='red'> Booked By : <strong>".$lab_list_filter[$lab_id1]."</strong></font>";
				}
				else
				{
					$filter_class.= "<font color='red'> Booked By : <strong>All</strong></font>";
				}
					if(!empty($requ_status) && $requ_status != '')
				{
					$conditions['Health.requ_status'] = $requ_status;
					$options['agent'] = $requ_status;
					$filter_class.= " <font color='brown'> Request Status : <strong>".$requestStatus[$requ_status]."</strong></font>";
				}
				$conditions['Health.status'] = 1;
				$options['set_option'] = $select_option;
				$this->paginate = array('Health' => array('limit' =>'50','conditions'=>$conditions));
				$find_request = $this->paginate('Health');
				
				$this->set('s_date',$s_date);
				$this->set('filter_class',$filter_class);
				
				$reports = array();
				$k = 0;
				foreach($find_request as $sl_ky=>$sl_vl)
				{
					$parameter_count = 0;
					$count_expl_test = 0;
					$count_expl_profile = 0;
					$count_expl_offer = 0;
					$count_expl_package= 0;
					$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
					$pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
					$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
					$test_amt = 0;
					$test_code_arr = array();
					$test_name_arr = array();
					if(!empty($sl_vl['Health']['test_id']))
					{
				$expl_test = explode(',',$sl_vl['Health']['test_id']);
				$cnt_test = 0; 
				foreach($expl_test as $test_key => $test_val)
				{
					if(!empty($test_val))
					{
				$cnt_test++;
					}
					$test_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$test_val)));
					$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
					$test_code_arr[] = $test_detail['Test']['testcode'];
					$test_name_arr[] = $test_detail['Test']['test_parameter'];
					$test_amt = $test_code['RequestTest']['mrp']+$test_amt;
				}
				$count_expl_test = $cnt_test;
					}
				if(!empty($sl_vl['Health']['profile_id']))
					{
				$expl_test = explode(',',$sl_vl['Health']['profile_id']);
				$cnt_test = 0; 
				foreach($expl_test as $test_key => $test_val)
				{
					if(!empty($test_val))
					{
				$cnt_test++;
					}
					$test_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$test_val)));
					$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
					$test_code_arr[] = $test_detail['Test']['testcode'];
					$test_name_arr[] = $test_detail['Test']['test_parameter'];
					$test_amt = $test_code['RequestTest']['mrp']+$test_amt;
				}
				$count_expl_test = $cnt_test;
					}
				if(!empty($sl_vl['Health']['offer_id']))
					{
				$expl_offer = explode(',',$sl_vl['Health']['offer_id']);
				$cnt_offr = 0;
				foreach($expl_offer as $offer_key => $offer_val)
				{
					if(!empty($offer_val))
					{
				$cnt_offr++;
					}
					$offer_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$offer_val,'RequestTest.type'=>'OF')));
					$offer_detail = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
					$test_code_arr[] = $offer_detail['Banner']['banner_code'];
					$test_name_arr[] = $offer_detail['Banner']['banner_name'];
					$test_amt = $offer_code['RequestTest']['mrp']+$test_amt;
				}
				$count_expl_offer = $cnt_offr;
					}
				if(!empty($sl_vl['Health']['package_id']))
					{
				$expl_package = explode(',',$sl_vl['Health']['package_id']);
				$cnt_pck = 0;
				foreach($expl_package as $package_key => $package_val)
				{
					if(!empty($package_val))
					{
				$cnt_pck++;
					}
					$package_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$package_val,'RequestTest.type'=>'PA')));
					$package_detail = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
					$test_code_arr[] = $package_detail['Package']['package_code'];
					$test_name_arr[] = $package_detail['Package']['package_name'];
					$test_amt = $package_code['RequestTest']['mrp']+$test_amt;
				}
				$count_expl_package = $cnt_pck;
					}
				$parameter_count = $count_expl_test+$count_expl_profile+$count_expl_offer+$count_expl_package;
					$implode_parameter_code = implode(', ',$test_code_arr);
					$implode_parameter_name = implode(', ',$test_name_arr);
				if($sl_vl['Health']['gender'] == 1)
					{
				$gender = 'M';
					}
					if($sl_vl['Health']['gender'] == 2)
					{
				$gender = 'F';
					}
				if(!empty($sl_vl['Health']['remark']))
					{
				$refer_by = $sl_vl['Health']['remark'];
					}
					else
					{
				$refer_by = 'N/A';
					}
					$booking_from = substr($sl_vl['Health']['flags'], 0, 1);
					$booking_mode = '';
					
					if($booking_from == "1")
						$booking_mode = 'Online';
					if($booking_from == "2")
						$booking_mode = 'Manual';
					if($booking_from == "3")
						$booking_mode = 'Excel';
					if($booking_from == "4")
						$booking_mode = 'API';
					$reports[$k]['DailyRequestReport']['booking_mode'] = $booking_mode;
				$reports[$k]['DailyRequestReport']['s_date'] = date('d-M-Y',strtotime($sl_vl['Health']['book_date']));
					$reports[$k]['DailyRequestReport']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
					$reports[$k]['DailyRequestReport']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
					$reports[$k]['DailyRequestReport']['medical_reference_number'] = $sl_vl['Health']['medical_reference_number'];
					$reports[$k]['DailyRequestReport']['req_num'] = $requestNum['Billing']['order_id'];
					$reports[$k]['DailyRequestReport']['test_ref_num'] = $sl_vl['Health']['ref_num'];
					$reports[$k]['DailyRequestReport']['reference'] = $sl_vl['Health']['reference'];
					$reports[$k]['DailyRequestReport']['amount_collected'] = $sl_vl['Health']['amount_collected'];
					$reports[$k]['DailyRequestReport']['amount_to_be_collected'] = $sl_vl['Health']['amount_to_be_collected'];
					$reports[$k]['DailyRequestReport']['payment_type'] = $payment_type[$sl_vl['Health']['payment_type']];
					$reports[$k]['DailyRequestReport']['pincode'] = $sl_vl['Health']['pincode'];
					$reports[$k]['DailyRequestReport']['sample_collected_date'] = date('d-M-Y',strtotime($sl_vl['Health']['sample_date1']));
					$reports[$k]['DailyRequestReport']['sample_collected_time'] = Configure::read('TimeSlot.'.$sl_vl['Health']['sample_time1']);;
					$reports[$k]['DailyRequestReport']['patient_name'] = strtoupper($sl_vl['Health']['name']);
					$reports[$k]['DailyRequestReport']['patient_gender'] = $gender;
					$reports[$k]['DailyRequestReport']['patient_age'] = $sl_vl['Health']['age'];
					$reports[$k]['DailyRequestReport']['parameter_code'] = $implode_parameter_code;
					$reports[$k]['DailyRequestReport']['parameter_name'] = $implode_parameter_name;
					$reports[$k]['DailyRequestReport']['requ_status'] = $requestStatus[$sl_vl['Health']['requ_status']];
				if($sl_vl['Health']['cancelled_status'] == 1)
					{
				$reports[$k]['DailyRequestReport']['net_payble'] = 'Rs. '.($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
				$reports[$k]['DailyRequestReport']['balance_payment'] = 'Rs. '.$sl_vl['Health']['balance_amount'];
					}
					else
					{
					$reports[$k]['DailyRequestReport']['net_payble'] = ($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
					if($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount'] == 0)
				$reports[$k]['DailyRequestReport']['net_payble']=$sl_vl['Health']['total_amount'];
				$reports[$k]['DailyRequestReport']['balance_payment'] = 'Rs. '.($reports[$k]['DailyRequestReport']['net_payble']-$sl_vl['Health']['received_amount']);
				$reports[$k]['DailyRequestReport']['net_payble'] = 'Rs. '.$reports[$k]['DailyRequestReport']['net_payble'];
					}
					$k++;
				}
				$total_records = $this->Health->find('all',array('conditions'=>$conditions));
				
				$monthly_conditions = $conditions;
				$monthly_conditions['Health.book_date >='] = date('Y-m-1 00:00:00',strtotime($s_date));
				$monthly_conditions['Health.book_date <='] = date('Y-m-d 23:59:59',strtotime($s_date));
				//print_R($monthly_conditions);
				$monthly_total_records = $this->Health->find('all',array('conditions'=>$monthly_conditions));
				//print_R($monthly_total_records);die;
				$net_pay = 0;
				$net_rec = 0;
				$net_bal = 0;
				$total_test = 0;
				
				$total_payable_req = array();
				$request_status_req = array();
				$booked_by_total_req = array();
				$monthly_request_status_req = array();
				$monthly_booked_by_total_req = array();
				$yearly_request_status_req = array();
				$yearly_booked_by_total_req = array();
				
				foreach($total_records as $tr_ky => $tr_vl)
				{
					$tot_payable_amt=0;
					if(!is_array($booked_by_total_req[$tr_vl['Health']['created_by']]))
						$booked_by_total_req[$tr_vl['Health']['created_by']] = array();
					
					array_push($booked_by_total_req[$tr_vl['Health']['created_by']],$tr_vl['Health']['id']);
					
					if(!empty($tr_vl['Health']['test_id']))
					{
						$expl_test = explode(',',$tr_vl['Health']['test_id']);
						$cnt_1 = 0;
						foreach($expl_test as $k_1 => $v_1)
						{
							if(!empty($v_1))
							{
						$cnt_1++;
							}
						}
					}
					if(!empty($tr_vl['Health']['profile_id']))
					{
						$expl_prf = explode(',',$tr_vl['Health']['test_id']);
						$cnt_2 = 0;
						foreach($expl_test as $k_2 => $v_2)
						{
							if(!empty($v_2))
							{
						$cnt_2++;
							}
						}
					}
					if(!empty($tr_vl['Health']['offer_id']))
					{
						$expl_offer = explode(',',$tr_vl['Health']['offer_id']);
						$cnt_3 = 0;
						foreach($expl_test as $k_3 => $v_3)
						{
							if(!empty($v_3))
							{
						$cnt_3++;
							}
						}
					}
					if(!empty($tr_vl['Health']['package_id']))
					{
						$expl_pck = explode(',',$tr_vl['Health']['package_id']);
						$cnt_4 = 0;
						foreach($expl_test as $k_4 => $v_4)
						{
							if(!empty($v_4))
							{
						$cnt_4++;
							}
						}
					}
					$total_test_now = ($cnt_1+$cnt_2+$cnt_3+$cnt_4);
					$total_test = ($total_test_now+$total_test);
					$net_rec = ($tr_vl['Health']['received_amount']+$net_rec);
					$net_bal_amt=0;
					
					if($tr_vl['Health']['cancelled_status'] == 1)
					{
						$net_bal = ($tr_vl['Health']['balance_amount']+$net_bal);
						$net_bal_amt=$tr_vl['Health']['balance_amount'];
					}
					else
					{
						$net_pay_amt= ($tr_vl['Health']['received_amount']+$tr_vl['Health']['balance_amount']);
						if($net_pay_amt == 0)
						{
							$net_pay_amt=$tr_vl['Health']['total_amount'];
						}
						$net_bal_amt=$net_pay_amt-$tr_vl['Health']['received_amount'];
						$net_bal = ($net_bal_amt+$net_bal);
					}
					if(!is_array($total_payable_req[$tr_vl['Health']['created_by']]))
						$total_payable_req[$tr_vl['Health']['created_by']] = array();
					
					array_push($total_payable_req[$tr_vl['Health']['created_by']],$tr_vl['Health']['received_amount']+$net_bal_amt);
					$net_pay = ($net_rec+$net_bal);
					
					if(!is_array($request_status_req[$tr_vl['Health']['requ_status']]))
						$request_status_req[$tr_vl['Health']['requ_status']] = array();
					
					array_push($request_status_req[$tr_vl['Health']['requ_status']],$tr_vl['Health']['id']);
				}
				
				$yearly_conditions = $conditions;
				$yearly_conditions['Health.book_date >='] = date('Y-1-1 00:00:00',strtotime($s_date));
				$yearly_conditions['Health.book_date <='] = date('Y-m-d 23:59:59',strtotime($s_date));
				
				$monthly_total_records = $this->Health->find('all',array('conditions'=>$monthly_conditions));
				
				$yearly_total_records = $this->Health->find('all',array('conditions'=>$yearly_conditions));
				
				foreach($monthly_total_records as $tr_ky => $tr_vl)
				{
					if(!is_array($monthly_booked_by_total_req[$tr_vl['Health']['created_by']]))
						$monthly_booked_by_total_req[$tr_vl['Health']['created_by']] = array();
					
					array_push($monthly_booked_by_total_req[$tr_vl['Health']['created_by']],$tr_vl['Health']['id']);
					
					if(!is_array($monthly_request_status_req[$tr_vl['Health']['requ_status']]))
						$monthly_request_status_req[$tr_vl['Health']['requ_status']] = array();
					
					array_push($monthly_request_status_req[$tr_vl['Health']['requ_status']],$tr_vl['Health']['id']);
				}
				
				foreach($yearly_total_records as $tr_ky => $tr_vl)
				{
					if(!is_array($yearly_booked_by_total_req[$tr_vl['Health']['created_by']]))
						$yearly_booked_by_total_req[$tr_vl['Health']['created_by']] = array();
					
					array_push($yearly_booked_by_total_req[$tr_vl['Health']['created_by']],$tr_vl['Health']['id']);
					
					if(!is_array($yearly_request_status_req[$tr_vl['Health']['requ_status']]))
						$yearly_request_status_req[$tr_vl['Health']['requ_status']] = array();
					
					array_push($yearly_request_status_req[$tr_vl['Health']['requ_status']],$tr_vl['Health']['id']);
				}
				
				
				$total_payable_amount = array();
				$request_status_total = array();
				$booked_by_total = array();
				$monthly_request_status_total = array();
				$monthly_booked_by_total = array();
				$yearly_request_status_total = array();
				$yearly_booked_by_total = array();
				$agent_total = array();
				$lab_list = $this->Lab->find('list',array('fields'=>array('id','pcc_name')));
				$agent_list = $this->Agent->find('list',array('fields'=>array('id','name')));
				
				array_push($booked_by_total,array('Booked by','count'));
				array_push($total_payable_amount,array('Assigned Lab','count'));
				array_push($request_status_total,array('Request Status','count'));
				array_push($monthly_booked_by_total,array('Booked by','count'));
				array_push($monthly_request_status_total,array('Request Status','count'));
				array_push($yearly_booked_by_total,array('Booked by','count'));
				array_push($yearly_request_status_total,array('Request Status','count'));
				
				array_push($agent_total,array('Agent','count'));
				
				foreach($monthly_booked_by_total_req as $key=>$val)
				{
					array_push($monthly_booked_by_total,array($lab_list[$key]." - ".count($monthly_booked_by_total_req[$key]),count($monthly_booked_by_total_req[$key])));
				}
				
				foreach($monthly_request_status_req as $key=>$val)
				{
					array_push($monthly_request_status_total,array($requestStatus[$key]." - ".count($monthly_request_status_req[$key]),count($monthly_request_status_req[$key])));
				}
				
				foreach($yearly_booked_by_total_req as $key=>$val)
				{
					array_push($yearly_booked_by_total,array($lab_list[$key]." - ".count($yearly_booked_by_total_req[$key]),count($yearly_booked_by_total_req[$key])));
				}
				
				foreach($yearly_request_status_req as $key=>$val)
				{
					array_push($yearly_request_status_total,array($requestStatus[$key]." - ".count($yearly_request_status_req[$key]),count($yearly_request_status_req[$key])));
				}
				
				foreach($booked_by_total_req as $key=>$val)
				{
					array_push($booked_by_total,array($lab_list[$key]." - ".count($booked_by_total_req[$key]),count($booked_by_total_req[$key])));
				}
				foreach($total_payable_req as $key=>$val)
				{
					array_push($total_payable_amount,array($lab_list[$key]." - Rs. ".array_sum($total_payable_req[$key]),array_sum($total_payable_req[$key])));
				}
				
				foreach($request_status_req as $key=>$val)
				{
					array_push($request_status_total,array($requestStatus[$key]." - ".count($request_status_req[$key]),count($request_status_req[$key])));
				}
				
				$this->set('monthly_booked_by_total',json_encode($monthly_booked_by_total));
				$this->set('monthly_request_status_total',json_encode($monthly_request_status_total));
				$this->set('yearly_booked_by_total',json_encode($yearly_booked_by_total));
				$this->set('yearly_request_status_total',json_encode($yearly_request_status_total));
				$this->set('yearly_total_records',count($yearly_total_records));
				
				$this->set('booked_by_total',json_encode($booked_by_total));
				$this->set('total_payable_amount',json_encode($total_payable_amount));
				$this->set('request_status_total',json_encode($request_status_total));
				$this->set('total_records',count($total_records));
				$this->set('monthly_total_records',count($monthly_total_records));
				$this->set('total_test',$total_test);
				$this->set('net_pay',$net_pay);
				$this->set('net_rec',$net_rec);
				$this->set('net_bal',$net_bal);
				$this->set('reports',$reports);
				$this->set('lab_id',$lab_id);
				$this->set('lab_id1',$lab_id1);
				$this->set('requ_status',$requ_status);
				$this->set('options',$options);
				$user_list = $this->Admin->find('list',array('fields'=>array('id','name')));
				$this->set('user_list',$user_list);
			}
			
			if($this->data['DailyRequestReport']['set_option'] == 'export_excel')
			{
				$export_s_date = $this->data['DailyRequestReport']['s_date']; 
				$export_from_date = $this->data['DailyRequestReport']['from_date']; 
				$export_to_date = $this->data['DailyRequestReport']['to_date'];
				$export_lab_id = $this->data['DailyRequestReport']['pcc_list_id'];
				$export_lab_id1 = $this->data['DailyRequestReport']['pcc_list_id1'];
				$export_requ_status = $this->data['DailyRequestReport']['requ_status'];
				$export_req_status = $this->data['DailyRequestReport']['requ_status'];
				$user_list = $this->Admin->find('list',array('fields'=>array('id','name')));
				$this->set('user_list',$user_list);
				if(!empty($export_s_date) && $export_s_date != '')
				{
					$conditions['Health.book_date >='] = date('Y-m-d 00:00:00',strtotime($export_s_date));
					$conditions['Health.book_date <='] = date('Y-m-d 23:59:59',strtotime($export_s_date));
				}
				if(!empty($export_from_date) && $export_from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($export_from_date));
				}
				if(!empty($export_to_date) && $export_to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($export_to_date));
				}
				if(!empty($export_lab_id) && $export_lab_id != '')
				{
					$conditions['Health.assigned_lab'] = $export_lab_id;
				}
				if(!empty($export_lab_id1) && $export_lab_id1 != '')
				{
					$conditions['Health.created_by'] = $export_lab_id1;
				}
				if($export_lab_id == $export_lab_id1 && !empty($export_lab_id) && !empty($export_lab_id1))
				{
					unset($conditions['Health.assigned_lab']);
					unset($conditions['Health.created_by']);
					$conditions['OR']['Health.assigned_lab'] = $export_lab_id;
					$conditions['OR']['Health.created_by'] = $export_lab_id;
				}
				if(!empty($export_requ_status) && $export_requ_status != '')
				{
					$conditions['Health.requ_status'] = $export_requ_status;
				}
				$conditions['Health.status'] = 1;
				$find_request = $this->Health->find('all',array('conditions'=>$conditions));
				$reports = array();
				$k = 0;
				$s_no = 1;
				foreach($find_request as $sl_ky => $sl_vl)
				{
					$parameter_count = 0;
					$count_expl_test = 0;
					$count_expl_profile = 0;
					$count_expl_offer = 0;
					$count_expl_package= 0;
				$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
				$pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
					$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
					$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
					$test_amt = 0;
					$test_code_arr = array();
					$test_name_arr = array();
					if(!empty($sl_vl['Health']['test_id']))
					{
				$expl_test = explode(',',$sl_vl['Health']['test_id']);
				$cnt_test = 0; 
				foreach($expl_test as $test_key => $test_val)
				{
					if(!empty($test_val))
					{
				$cnt_test++;
					}
					$test_code = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
					$test_code_arr[] = $test_code['Test']['testcode'];
					$test_name_arr[] = $test_code['Test']['test_parameter'];
					$test_amt = ($test_code['Test']['mrp']+$test_amt);
				}
				$count_expl_test = $cnt_test;
					}
				if(!empty($sl_vl['Health']['profile_id']))
					{
				$expl_test = explode(',',$sl_vl['Health']['profile_id']);
				$cnt_test = 0; 
				foreach($expl_test as $test_key => $test_val)
				{
					if(!empty($test_val))
					{
				$cnt_test++;
					}
					$test_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$test_val)));
					$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
					$test_code_arr[] = $test_detail['Test']['testcode'];
					$test_name_arr[] = $test_detail['Test']['test_parameter'];
					$test_amt = ($test_code['RequestTest']['mrp']+$test_amt);
				}
				$count_expl_test = $cnt_test;
					}
					if(!empty($sl_vl['Health']['offer_id']))
					{
				$expl_offer = explode(',',$sl_vl['Health']['offer_id']);
				$cnt_offr = 0;
				foreach($expl_offer as $offer_key => $offer_val)
				{
					if(!empty($offer_val))
					{
				$cnt_offr++;
					}
					$offer_code = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
					$test_code_arr[] = $offer_code['Banner']['banner_code'];
					$test_name_arr[] = $offer_code['Banner']['banner_name'];
					$test_amt = ($offer_code['Banner']['banner_mrp']+$test_amt);
				}
				$count_expl_offer = count($cnt_offr);
					}
				if(!empty($sl_vl['Health']['package_id']))
					{
				$expl_package = explode(',',$sl_vl['Health']['package_id']);
				$cnt_pck = 0;
				foreach($expl_package as $package_key => $package_val)
				{
					if(!empty($package_val))
					{
				$cnt_pck++;
					}
					$package_code = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
					$test_code_arr[] = $package_code['Package']['package_code'];
					$test_name_arr[] = $package_code['Package']['package_name'];
					$test_amt = ($package_code['Package']['package_mrp']+$test_amt);
				}
				$count_expl_package = $cnt_pck;
					}
				$parameter_count = ($count_expl_test+$count_expl_profile+$count_expl_offer+$count_expl_package);
					$implode_parameter_code = implode(', ',$test_code_arr);
					$implode_parameter_name = implode(', ',$test_name_arr);
				if($sl_vl['Health']['gender'] == 1)
					{
				$gender = 'M';
					}
					if($sl_vl['Health']['gender'] == 2)
					{
				$gender = 'F';
					}
					if(!empty($sl_vl['Health']['remark']))
					{
				$refer_by = $sl_vl['Health']['remark'];
					}
					else
					{
				$refer_by = 'N/A';
					}
					$booking_from = substr($sl_vl['Health']['flags'], 0, 1);
					$booking_mode = '';
					
					if($booking_from == "1")
						$booking_mode = 'Online';
					if($booking_from == "2")
						$booking_mode = 'Manual';
					if($booking_from == "3")
						$booking_mode = 'Excel';
					if($booking_from == "4")
						$booking_mode = 'API';
					
					$reports[$k]['s_no'] = $s_no;
					$reports[$k]['s_date'] = date('d-M-Y',strtotime($sl_vl['Health']['book_date']));
					$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
					$reports[$k]['booking_mode'] = $booking_mode;
					
					$reports[$k]['reference'] = $sl_vl['Health']['reference'];
					$reports[$k]['medical_reference_number'] = $sl_vl['Health']['medical_reference_number'];
					$reports[$k]['pincode'] = $sl_vl['Health']['pincode'];
					$reports[$k]['sample_collected_date'] = date('d-M-Y',strtotime($sl_vl['Health']['sample_date1']));
					$reports[$k]['sample_collected_time'] = Configure::read('TimeSlot.'.$sl_vl['Health']['sample_time1']);;
					$reports[$k]['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
					$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
					$reports[$k]['patient_name'] = strtoupper($sl_vl['Health']['name']);
					$reports[$k]['patient_gender'] = $gender."/".$sl_vl['Health']['age'];
					$reports[$k]['parameter_name'] = $implode_parameter_name;
					$reports[$k]['parameter_code'] = $implode_parameter_code;
					if($sl_vl['Health']['cancelled_status'] == 1)
					{ 
				$reports[$k]['net_payble'] = ($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
				$reports[$k]['balance_payment'] = $sl_vl['Health']['balance_amount'];
					}
					else
					{
				$reports[$k]['net_payble'] = ($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
				if($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount'] == 0)
					$reports[$k]['net_payble']=$sl_vl['Health']['total_amount'];
				$reports[$k]['balance_payment'] = $reports[$k]['net_payble']-$sl_vl['Health']['received_amount'];
					}
					$reports[$k]['payment_type'] = $payment_type[$sl_vl['Health']['payment_type']];
					$reports[$k]['amount_collected'] = $sl_vl['Health']['amount_collected'];
					$reports[$k]['amount_to_be_collected'] = $sl_vl['Health']['amount_to_be_collected'];
					$reports[$k]['requ_status'] = $requestStatus[$sl_vl['Health']['requ_status']];
					$reports[$k]['test_ref_num'] = $sl_vl['Health']['ref_num'];
					$s_no++;
					$k++;
				}
				$total_records = $this->Health->find('all',array('conditions'=>$conditions));
				$net_pay = 0;
				$net_rec = 0;
				$net_bal = 0;
				$total_test = 0;
				foreach($total_records as $tr_ky => $tr_vl)
				{
					if(!empty($tr_vl['Health']['test_id']))
					{
				$expl_test = explode(',',$tr_vl['Health']['test_id']);
				$cnt_1 = 0;
				foreach($expl_test as $k_1 => $v_1)
				{
					if(!empty($v_1))
					{
				$cnt_1++;
					}
				}
					}
					if(!empty($tr_vl['Health']['profile_id']))
					{
				$expl_prf = explode(',',$tr_vl['Health']['test_id']);
				$cnt_2 = 0;
				foreach($expl_test as $k_2 => $v_2)
				{
					if(!empty($v_2))
					{
				$cnt_2++;
					}
				}
					}
					if(!empty($tr_vl['Health']['offer_id']))
					{
				$expl_offer = explode(',',$tr_vl['Health']['test_id']);
				$cnt_3 = 0;
				foreach($expl_test as $k_3 => $v_3)
				{
					if(!empty($v_3))
					{
				$cnt_3++;
					}
				}
					}
					if(!empty($tr_vl['Health']['package_id']))
					{
				$expl_pck = explode(',',$tr_vl['Health']['test_id']);
				$cnt_4 = 0;
				foreach($expl_test as $k_4 => $v_4)
				{
					if(!empty($v_4))
					{
				$cnt_4++;
					}
				}
					}
					$total_test_now = ($cnt_1+$cnt_2+$cnt_3+$cnt_4);
				$total_test = ($total_test_now+$total_test);
				$net_rec = ($tr_vl['Health']['received_amount']+$net_rec);
				if($tr_vl['Health']['cancelled_status'] == 1)
					{
				$net_bal = ($tr_vl['Health']['balance_amount']+$net_bal);
					}
					else
					{
				$net_pay_amt= ($tr_vl['Health']['received_amount']+$tr_vl['Health']['balance_amount']);
				if($net_pay_amt == 0)
					$net_pay_amt=$tr_vl['Health']['total_amount'];
				$net_bal_amt=$net_pay_amt-$tr_vl['Health']['received_amount'];
				$net_bal = ($net_bal_amt+$net_bal);
					}
					$net_pay = ($net_rec+$net_bal);
				}
				$total_no_records = count($total_records);
				$total_no_test = $total_test;
				$total_net_pay = $net_pay;
				$total_net_rec = $net_rec;
				$total_net_bal = $net_bal;
				header('Content-Type: text/csv; charset=utf-8');
				header('Content-Disposition: attachment; filename=daily_request_report_'.date('d-m-Y').'.csv');
				$output = fopen('php://output', 'w');
				fputcsv($output, array('Total No. of Requests', 'Total No. of Tests', 'Total Net Payable','Total Received Amount', 'Total Balance Due'));
				fputcsv($output, array($total_no_records,$total_no_test,$total_net_pay,$total_net_rec,$total_net_bal));
				fputcsv($output, array());
				fputcsv($output, array('S.No.', 'Date', 'ReqNo','Booking From','Reference No','Mrn No.','Pincode','Collection Date','Collection Time','Booked By PCC','Service By PCC','Patient Name' ,'Gender/Age','Test Names','Test Codes','Net Payble(Rs)','Balance Due(Rs)','Payment Type','Amount Collected By Pcc','Amount To Be Collected By NPL','Request Status','Lab Refrence No.'));
				foreach ($reports as $keys => $values) 
				{
					if(($values['fix_discount'] != 'N/A') && ($values['fix_discount'] == '100%'))
					{
				$values['test_amount'] = $values['test_amount'];
				$values['fix_discount'] = $values['fix_discount'];
				$values['disc_amt'] = $values['test_amount'];
				$values['net_payble'] = $values['net_payble'];
					}
					else
					{
				$values['test_amount'] = $values['test_amount'];
				$values['fix_discount'] = $values['fix_discount'];
				$values['disc_amt'] = $values['disc_amt'];
				$values['net_payble'] = $values['net_payble'];
					}
					fputcsv($output, $values);
				}
				die;
			}
		}	
	}
	
	//FUNCTION FOR MIS REPORTS STARTS
	function admin_sales_report()
	{
		$this->set('title_for_layout','Sales Report');
		$admin_u_type = $this->Session->read('Admin.userType');
		$admin_lab_type = $this->Session->read('Admin.labId');
		//print_R($this->Session->read('Admin'));die;
		$this->PaymentType = ClassRegistry::init('PaymentType');
		$p_type = $this->PaymentType->find('list',array('fields'=>array('PaymentType.id','PaymentType.type')));
		$this->set('p_type',$p_type);
		if(($admin_u_type != 'A') && ($admin_u_type != 'BM') && ($admin_u_type != 'Agent'))
		{
			//echo "<pre>"; print_r($this->Session->read('Admin')); exit;
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.id'=>$admin_lab_type)));
			$s_pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			
			$this->set('pcc',$pcc);
			$this->set('s_pcc',$s_pcc);
		}
		else
		{
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$s_pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			
			$this->set('pcc',$pcc);
			$this->set('s_pcc',$s_pcc);
		}
		
		$login_agent_type = $this->Session->read('Admin.login_agent_type');
		$login_agent_id = $this->Session->read('Admin.id');
		if($login_agent_type == 'Agent')
		{
			$agents = $this->Agent->find('all',array('conditions'=>array('Agent.id'=>$login_agent_id)));
			$this->set('agents',$agents);
		}
		else
		{
			$agents = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
			$this->set('agents',$agents);
		}
		
		$this->set('login_agent_type',$login_agent_type);
		
		if(!empty($this->params['named']['from_date']) && $this->params['named']['from_date'] != '')
		{
			$this->data['SalesReport']['from_date'] = $this->params['named']['from_date'];
			$options['from_date'] = $this->params['named']['from_date'];
		}
		if(!empty($this->params['named']['to_date']) && $this->params['named']['to_date'] != '')
		{
			$this->data['SalesReport']['to_date'] = $this->params['named']['to_date'];
			$options['to_date'] = $this->params['named']['to_date'];
		}
		if(!empty($this->params['named']['lab']) && $this->params['named']['lab'] != '')
		{
			$this->data['SalesReport']['pcc_list_id'] = $this->params['named']['lab'];
			$options['lab'] = $this->params['named']['lab'];
		}
		if(!empty($this->params['named']['agent']) && $this->params['named']['agent'] != '')
		{
			$this->data['SalesReport']['agent'] = $this->params['named']['agent'];
			$options['agent'] = $this->params['named']['agent'];
		}
		if(!empty($this->params['named']['set_option']) && $this->params['named']['set_option'] != '')
		{
			$this->data['SalesReport']['set_option'] = $this->params['named']['set_option'];
			$options['set_option'] = $this->params['named']['set_option'];
		}
		
		if(!empty($this->data))
		{
			if($this->data['SalesReport']['set_option'] == 'filter')
			{
				$from_date = $this->data['SalesReport']['from_date']; 
				$to_date = $this->data['SalesReport']['to_date'];
				$lab_id = $this->data['SalesReport']['pcc_list_id'];
                                $lab_id1 = $this->data['SalesReport']['pcc_list_id1'];
				$agent_id = $this->data['SalesReport']['agent_list_id'];
				$select_option = $this->data['SalesReport']['set_option'];
				$filter_class="Result For ";
				if(!empty($from_date) && $from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($from_date));
					$options['from_date'] = $from_date;
					$filter_class.= "<font color='green'>From <strong>".$from_date."</strong></font>";
				}
				if(!empty($to_date) && $to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($to_date));
					$options['to_date'] = $to_date;
					$filter_class.= "<font color='green'> till <strong>".$to_date."</strong></font>";
				}
				
				$lab_list_filter = $this->Lab->find('list',array('fields'=>array('id','pcc_name')));
				
				if(!empty($lab_id) && $lab_id != '')
				{
					$conditions['Health.assigned_lab'] = $lab_id;
					$options['lab'] = $lab_id;
					$filter_class.= "<font color='orange'> Serviced By : <strong>".$lab_list_filter[$lab_id]."</strong></font>";
				}
				else
				{
					$filter_class.= "<font color='orange'> Serviced By :<strong>All</strong></font>";
				}
                if(!empty($lab_id1) && $lab_id1 != '')
				{
					$conditions['Health.created_by'] = $lab_id1;
					$options['lab1'] = $lab_id1;
					$filter_class.= "<font color='red'> Booked By : <strong>".$lab_list_filter[$lab_id1]."</strong></font>";
				}
				else
				{
					$filter_class.= "<font color='red'> Booked By : <strong>All</strong></font>";
				}
				/*if not service by same lab*/
				if($lab_id == $lab_id1 && !empty($lab_id) && !empty($lab_id1))
				{
					unset($conditions['Health.assigned_lab']);
					unset($conditions['Health.created_by']);
					$conditions['OR']['Health.assigned_lab'] = $lab_id;
					$conditions['OR']['Health.created_by'] = $lab_id1;
					//$filter_class.= "<font color='red'> Booked By <strong>".$lab_list_filter[$lab_id1]."</strong></font> and <font color='orange'> Serviced By <strong>".$lab_list_filter[$lab_id]."</strong></font>";
				}
				
				$agent_list_filter = $this->Agent->find('list',array('fields'=>array('id','name')));
				if(!empty($agent_id) && $agent_id != '')
				{
					$conditions['Health.agent_id'] = $agent_id;
					$options['agent'] = $agent_id;
					$filter_class.= " <font color='brown'> Phlebo Name : <strong>".$agent_list_filter[$agent_id]."</strong></font>";
				}
				else
				{
					$filter_class.= " <font color='brown'> Phlebo : <strong>All</strong></font>";
				}
				$conditions['Health.status'] = 1;
				$options['set_option'] = $select_option;
				$this->paginate = array('Health' => array('limit' =>'50','conditions'=>$conditions));
				$find_request=$this->paginate('Health');
				
				$this->set('filter_class',$filter_class);
				
				$reports = array();
				$k = 0;
				foreach($find_request as $sl_ky => $sl_vl)
				{
					$parameter_count = 0;
					$count_expl_test = 0;
					$count_expl_profile = 0;
					$count_expl_offer = 0;
					$count_expl_package= 0;
					
					$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                        $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
					$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
					$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
					$test_amt = 0;
					$test_code_arr = array();
					$test_name_arr = array();
					if(!empty($sl_vl['Health']['test_id']))
					{
						$expl_test = explode(',',$sl_vl['Health']['test_id']);
						$cnt_test = 0; 
						foreach($expl_test as $test_key => $test_val)
						{
							if(!empty($test_val))
							{
								$cnt_test++;
							}
							$test_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$test_val)));
							$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
							$test_code_arr[] = $test_detail['Test']['testcode'];
							$test_name_arr[] = $test_detail['Test']['test_parameter'];
							$test_amt = ($test_code['RequestTest']['mrp']+$test_amt);
						}
						$count_expl_test = $cnt_test;
					}
					if(!empty($sl_vl['Health']['profile_id']))
					{
						$expl_test = explode(',',$sl_vl['Health']['profile_id']);
						$cnt_test = 0; 
						foreach($expl_test as $test_key => $test_val)
						{
							if(!empty($test_val))
							{
								$cnt_test++;
							}
							$test_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$test_val)));
							$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
							$test_code_arr[] = $test_detail['Test']['testcode'];
							$test_name_arr[] = $test_detail['Test']['test_parameter'];
							$test_amt = ($test_code['RequestTest']['mrp']+$test_amt);
						}
						$count_expl_test = $cnt_test;
					}
					
					if(!empty($sl_vl['Health']['offer_id']))
					{
						$expl_offer = explode(',',$sl_vl['Health']['offer_id']);
						$cnt_offr = 0;
						foreach($expl_offer as $offer_key => $offer_val)
						{
							if(!empty($offer_val))
							{
								$cnt_offr++;
							}
							$offer_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$offer_val,'RequestTest.type'=>'OF')));
							$offer_detail = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
							//$offer_code = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
							$test_code_arr[] = $offer_detail['Banner']['banner_code'];
							$test_name_arr[] = $offer_detail['Banner']['banner_name'];
							$test_amt = ($offer_code['RequestTest']['mrp']+$test_amt);
						}
						$count_expl_offer = count($cnt_offr);
					}
					
					if(!empty($sl_vl['Health']['package_id']))
					{
						$expl_package = explode(',',$sl_vl['Health']['package_id']);
						$cnt_pck = 0;
						foreach($expl_package as $package_key => $package_val)
						{
							if(!empty($package_val))
							{
								$cnt_pck++;
							}
							$package_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$package_val,'RequestTest.type'=>'PA')));
							$package_detail = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
							//$package_code = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
							$test_code_arr[] = $package_detail['Package']['package_code'];
							$test_name_arr[] = $package_detail['Package']['package_name'];
							$test_amt = ($package_code['RequestTest']['mrp']+$test_amt);
						}
						$count_expl_package = $cnt_pck;
					}
					
					$parameter_count = ($count_expl_test+$count_expl_profile+$count_expl_offer+$count_expl_package);
					$implode_parameter_code = implode(', ',$test_code_arr);
					$implode_parameter_name = implode(', ',$test_name_arr);
					
					if($sl_vl['Health']['gender'] == 1)
					{
						$gender = 'M';
					}
					if($sl_vl['Health']['gender'] == 2)
					{
						$gender = 'F';
					}
					if($sl_vl['Health']['discount_id'] != 0)
					{
						$fix_dicount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
						if($fix_dicount['Discount']['type'] == 'Percent')
						{
							$fix_discount = $fix_dicount['Discount']['amount'].'%';
						}
						if($fix_dicount['Discount']['type'] == 'Rupees')
						{
							$fix_discount = 'Rs. '.$fix_dicount['Discount']['amount'];
						}
					}
					else
					{
						$fix_discount = 'N/A';
					}
					if($sl_vl['Health']['discount_amount'] != 0)
					{
						$disc_amt = 'Rs. '.$sl_vl['Health']['discount_amount'];
					}
					else
					{
						$disc_amt = 'N/A';
					}
					if(!empty($sl_vl['Health']['remark']))
					{
						$refer_by = $sl_vl['Health']['remark'];
					}
					else
					{
						$refer_by = 'N/A';
					}
					$booking_from = substr($sl_vl['Health']['flags'], 0, 1);
					$booking_mode = '';
					
					if($booking_from == "1")
						$booking_mode = 'Online';
					if($booking_from == "2")
						$booking_mode = 'Manual';
					if($booking_from == "3")
						$booking_mode = 'Excel';
					if($booking_from == "4")
						$booking_mode = 'API';					
					$reports[$k]['SalesReport']['booking_mode'] = $booking_mode;
					$reports[$k]['SalesReport']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
					$reports[$k]['SalesReport']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                    $reports[$k]['SalesReport']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
					$reports[$k]['SalesReport']['agent_name'] = $agent_name['Agent']['name'];
					$reports[$k]['SalesReport']['req_num'] = $requestNum['Billing']['order_id'];
					$reports[$k]['SalesReport']['test_ref_num'] = $sl_vl['Health']['ref_num'];
					$reports[$k]['SalesReport']['reference'] = $sl_vl['Health']['reference'];
					$reports[$k]['SalesReport']['payment_type'] = $sl_vl['Health']['payment_type'];					
					$reports[$k]['SalesReport']['refer_by'] = $refer_by;
					$reports[$k]['SalesReport']['parameter_count'] = $parameter_count;
					$reports[$k]['SalesReport']['parameter_code'] = $implode_parameter_code;
					$reports[$k]['SalesReport']['parameter_name'] = $implode_parameter_name;
					$reports[$k]['SalesReport']['patient_name'] = strtoupper($sl_vl['Health']['name']);
					$reports[$k]['SalesReport']['patient_gender'] = $gender;
					$reports[$k]['SalesReport']['patient_age'] = $sl_vl['Health']['age'];
					//$yesterday = date("Y-m-d");
		//$yesterday1 = date('Y-m-d', strtotime('-7 days')); 
		//date("d-M-Y", mktime(0, 0, 0, date("d")-7, date("M") , date("Y")));
		//echo "<pre>"; print_r($yesterday); exit;
		//echo "<pre>"; print_r($yesterday1); exit;
		//$reports[$k]['SalesReport']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
		//echo "<pre>"; print_r($reports[$k]['SalesReport']['book_date']); exit;
					
					
					//if($admin_u_type == 'A')
					//{
					$reports[$k]['SalesReport']['patient_contact'] = $sl_vl['Health']['landline'];
					
				//	} else {
					//	if(($sl_vl['Health']['s_date']) >  ($yesterday1))
					//	{ 
					//		$reports[$k]['SalesReport']['patient_contact'] = $sl_vl['Health']['landline'];
					//	}
					//	else{
						//	$reports[$k]['SalesReport']['patient_contact'] = '##########';
					//	}
					
					//}
					
					$reports[$k]['SalesReport']['patient_email'] = $sl_vl['Health']['email'];
					$reports[$k]['SalesReport']['test_amount'] = 'Rs. '.$test_amt;
					$reports[$k]['SalesReport']['fix_discount'] = $fix_discount;
					$reports[$k]['SalesReport']['disc_amt'] = $disc_amt;
                                        $reports[$k]['SalesReport']['booked_by_user'] = $sl_vl['Health']['created_by_agent'];
					if($sl_vl['Health']['cancelled_status'] == 1)
					{
					$reports[$k]['SalesReport']['net_payble'] = 'Rs. '.($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
					$reports[$k]['SalesReport']['receive_payment'] = 'Rs. '.$sl_vl['Health']['received_amount'];
					$reports[$k]['SalesReport']['balance_payment'] = 'Rs. '.$sl_vl['Health']['balance_amount'];
					}
					else
					{
					$reports[$k]['SalesReport']['net_payble'] = ($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
					if($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount'] == 0)
						$reports[$k]['SalesReport']['net_payble']=$sl_vl['Health']['total_amount'];
					$reports[$k]['SalesReport']['receive_payment'] = 'Rs. '.$sl_vl['Health']['received_amount'];
					$reports[$k]['SalesReport']['balance_payment'] = 'Rs. '.($reports[$k]['SalesReport']['net_payble']-$sl_vl['Health']['received_amount']);
					$reports[$k]['SalesReport']['net_payble'] = 'Rs. '.$reports[$k]['SalesReport']['net_payble'];
					}
					$k++;
				}
				
				//echo "<pre>"; print_r($reports); exit;
				
				$total_records = $this->Health->find('all',array('conditions'=>$conditions));
				
				$net_pay = 0;
				$net_rec = 0;
				$net_bal = 0;
				$total_test = 0;
				
				$booked_by_total_req = array();
				
				$total_payable_req = array();
				
				foreach($total_records as $tr_ky => $tr_vl)
				{
					$tot_payable_amt=0;
					if(!is_array($booked_by_total_req[$tr_vl['Health']['created_by']]))
						$booked_by_total_req[$tr_vl['Health']['created_by']] = array();
					
					array_push($booked_by_total_req[$tr_vl['Health']['created_by']],$tr_vl['Health']['id']);
					
					if(!empty($tr_vl['Health']['test_id']))
					{
						$expl_test = explode(',',$tr_vl['Health']['test_id']);
						$cnt_1 = 0;
						foreach($expl_test as $k_1 => $v_1)
						{
							if(!empty($v_1))
							{
								$cnt_1++;
							}
						}
					}
					if(!empty($tr_vl['Health']['profile_id']))
					{
						$expl_prf = explode(',',$tr_vl['Health']['test_id']);
						$cnt_2 = 0;
						foreach($expl_test as $k_2 => $v_2)
						{
							if(!empty($v_2))
							{
								$cnt_2++;
							}
						}
					}
					if(!empty($tr_vl['Health']['offer_id']))
					{
						$expl_offer = explode(',',$tr_vl['Health']['test_id']);
						$cnt_3 = 0;
						foreach($expl_test as $k_3 => $v_3)
						{
							if(!empty($v_3))
							{
								$cnt_3++;
							}
						}
					}
					if(!empty($tr_vl['Health']['package_id']))
					{
						$expl_pck = explode(',',$tr_vl['Health']['test_id']);
						$cnt_4 = 0;
						foreach($expl_test as $k_4 => $v_4)
						{
							if(!empty($v_4))
							{
								$cnt_4++;
							}
						}
					}
					$total_test_now = ($cnt_1+$cnt_2+$cnt_3+$cnt_4);
					
					$total_test = ($total_test_now+$total_test);
					$net_rec = ($tr_vl['Health']['received_amount']+$net_rec);
					$net_bal_amt=0;
					if($tr_vl['Health']['cancelled_status'] == 1)
					{
						$net_bal = ($tr_vl['Health']['balance_amount']+$net_bal);
						$net_bal_amt=$tr_vl['Health']['balance_amount'];
					}
					else
					{
						$net_pay_amt= ($tr_vl['Health']['received_amount']+$tr_vl['Health']['balance_amount']);
						
						if($net_pay_amt == 0)
						{
							$net_pay_amt=$tr_vl['Health']['total_amount'];
							
						}
						
						$net_bal_amt=$net_pay_amt-$tr_vl['Health']['received_amount'];
						$net_bal = ($net_bal_amt+$net_bal);
					}
					
					if(!is_array($total_payable_req[$tr_vl['Health']['created_by']]))
						$total_payable_req[$tr_vl['Health']['created_by']] = array();
					
					array_push($total_payable_req[$tr_vl['Health']['created_by']],$tr_vl['Health']['received_amount']+$net_bal_amt);
					
					
					
					$net_pay = ($net_rec+$net_bal);
					
					
				}
				
				$booked_by_total = array();
				$total_payable_amount = array();
				$agent_total = array();
				$lab_list = $this->Lab->find('list',array('fields'=>array('id','pcc_name')));
				$agent_list = $this->Agent->find('list',array('fields'=>array('id','name')));
				
				array_push($booked_by_total,array('Booked by','count'));
				array_push($total_payable_amount,array('Assigned Lab','count'));
				array_push($agent_total,array('Agent','count'));
				
				foreach($booked_by_total_req as $key=>$val)
				{
					array_push($booked_by_total,array($lab_list[$key]." - ".count($booked_by_total_req[$key]),count($booked_by_total_req[$key])));
				}
				
				foreach($total_payable_req as $key=>$val)
				{
					array_push($total_payable_amount,array($lab_list[$key]." - Rs. ".array_sum($total_payable_req[$key]),array_sum($total_payable_req[$key])));
				}
				//print_R($total_payable_req);
				//print_R($total_payable_amount);
				//die;
				$this->set('booked_by_total',json_encode($booked_by_total));
				
				$this->set('total_payable_amount',json_encode($total_payable_amount));
				
				$this->set('total_records',count($total_records));
				$this->set('total_test',$total_test);
				$this->set('net_pay',$net_pay);
				$this->set('net_rec',$net_rec);
				$this->set('net_bal',$net_bal);
				$this->set('reports',$reports);
				$this->set('lab_id',$lab_id);
                                $this->set('lab_id1',$lab_id1);
				$this->set('agent_id',$agent_id);
				$this->set('options',$options);
                                //fetching user list
                                $user_list = $this->Admin->find('list',array('fields'=>array('id','name')));
                                $this->set('user_list',$user_list);
			}
			
			if($this->data['SalesReport']['set_option'] == 'export_excel')
			{
				$export_from_date = $this->data['SalesReport']['from_date']; 
				$export_to_date = $this->data['SalesReport']['to_date'];
				$export_lab_id = $this->data['SalesReport']['pcc_list_id'];
                                $export_lab_id1 = $this->data['SalesReport']['pcc_list_id1'];
				
				$export_agent_id = $this->data['SalesReport']['agent_list_id'];
				//fetching user list
                                $user_list = $this->Admin->find('list',array('fields'=>array('id','name')));
                                $this->set('user_list',$user_list);
				
				if(!empty($export_from_date) && $export_from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($export_from_date));
				}
				if(!empty($export_to_date) && $export_to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($export_to_date));
				}
				if(!empty($export_lab_id) && $export_lab_id != '')
				{
					$conditions['Health.assigned_lab'] = $export_lab_id;
				}
                                if(!empty($export_lab_id1) && $export_lab_id1 != '')
				{
					$conditions['Health.created_by'] = $export_lab_id1;
				}
				/*if not service by same lab*/
				
				if($export_lab_id == $export_lab_id1 && !empty($export_lab_id) && !empty($export_lab_id1))
				{
					unset($conditions['Health.assigned_lab']);
					unset($conditions['Health.created_by']);
					$conditions['OR']['Health.assigned_lab'] = $export_lab_id;
					$conditions['OR']['Health.created_by'] = $export_lab_id;
				}
				
				if(!empty($export_agent_id) && $export_agent_id != '')
				{
					$conditions['Health.agent_id'] = $export_agent_id;
				}
				$conditions['Health.status'] = 1;
				$find_request = $this->Health->find('all',array('conditions'=>$conditions));
				
				$reports = array();
				$k = 0;
				$s_no = 1;
				foreach($find_request as $sl_ky => $sl_vl)
				{
					$parameter_count = 0;
					$count_expl_test = 0;
					$count_expl_profile = 0;
					$count_expl_offer = 0;
					$count_expl_package= 0;
					
					$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                    $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
					$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
					$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
					$test_amt = 0;
					$test_code_arr = array();
					$test_name_arr = array();
					if(!empty($sl_vl['Health']['test_id']))
					{
						$expl_test = explode(',',$sl_vl['Health']['test_id']);
						$cnt_test = 0; 
						foreach($expl_test as $test_key => $test_val)
						{
							if(!empty($test_val))
							{
								$cnt_test++;
							}
							$test_code = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
							$test_code_arr[] = $test_code['Test']['testcode'];
							$test_name_arr[] = $test_code['Test']['test_parameter'];
							$test_amt = ($test_code['Test']['mrp']+$test_amt);
						}
						$count_expl_test = $cnt_test;
					}
										if(!empty($sl_vl['Health']['profile_id']))
					{
						$expl_test = explode(',',$sl_vl['Health']['profile_id']);
						$cnt_test = 0; 
						foreach($expl_test as $test_key => $test_val)
						{
							if(!empty($test_val))
							{
								$cnt_test++;
							}
							$test_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$test_val)));
							$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
							$test_code_arr[] = $test_detail['Test']['testcode'];
							$test_name_arr[] = $test_detail['Test']['test_parameter'];
							$test_amt = ($test_code['RequestTest']['mrp']+$test_amt);
						}
						$count_expl_test = $cnt_test;
					}
					if(!empty($sl_vl['Health']['offer_id']))
					{
						$expl_offer = explode(',',$sl_vl['Health']['offer_id']);
						$cnt_offr = 0;
						foreach($expl_offer as $offer_key => $offer_val)
						{
							if(!empty($offer_val))
							{
								$cnt_offr++;
							}
							$offer_code = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
							$test_code_arr[] = $offer_code['Banner']['banner_code'];
							$test_name_arr[] = $offer_code['Banner']['banner_name'];
							$test_amt = ($offer_code['Banner']['banner_mrp']+$test_amt);
						}
						$count_expl_offer = count($cnt_offr);
					}
					
					if(!empty($sl_vl['Health']['package_id']))
					{
						$expl_package = explode(',',$sl_vl['Health']['package_id']);
						$cnt_pck = 0;
						foreach($expl_package as $package_key => $package_val)
						{
							if(!empty($package_val))
							{
								$cnt_pck++;
							}
							$package_code = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
							$test_code_arr[] = $package_code['Package']['package_code'];
							$test_name_arr[] = $package_code['Package']['package_name'];
							$test_amt = ($package_code['Package']['package_mrp']+$test_amt);
						}
						$count_expl_package = $cnt_pck;
					}
					
					$parameter_count = ($count_expl_test+$count_expl_profile+$count_expl_offer+$count_expl_package);
					$implode_parameter_code = implode(', ',$test_code_arr);
					$implode_parameter_name = implode(', ',$test_name_arr);
			
					if($sl_vl['Health']['gender'] == 1)
					{
						$gender = 'M';
					}
					if($sl_vl['Health']['gender'] == 2)
					{
						$gender = 'F';
		
					}
					if($sl_vl['Health']['discount_id'] != 0)
					{
						$fix_dicount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
						if($fix_dicount['Discount']['type'] == 'Percent')
						{
							$fix_discount = $fix_dicount['Discount']['amount'].'%';
						}
						if($fix_dicount['Discount']['type'] == 'Rupees')
						{
							$fix_discount = 'Rs. '.$fix_dicount['Discount']['amount'];
						}
					}
					else
					{
						$fix_discount = 'N/A';
					}
					if($sl_vl['Health']['discount_amount'] != 0)
					{
						$disc_amt = $sl_vl['Health']['discount_amount'];
					}
					else
					{
						$disc_amt = 'N/A';
					}
					if(!empty($sl_vl['Health']['remark']))
					{
						$refer_by = $sl_vl['Health']['remark'];
					}
					else
					{
						$refer_by = 'N/A';
					}
					$booking_from = substr($sl_vl['Health']['flags'], 0, 1);
					$booking_mode = '';
					
					if($booking_from == "1")
						$booking_mode = 'Online';
					if($booking_from == "2")
						$booking_mode = 'Manual';
					if($booking_from == "3")
						$booking_mode = 'Excel';
					if($booking_from == "4")
						$booking_mode = 'API';					
					$reports[$k]['s_no'] = $s_no;
					$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
					$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
					$reports[$k]['booking_mode'] = $booking_mode;
                    $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                    $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
                    $reports[$k]['medical_reference_number'] = $sl_vl['Health']['medical_reference_number'];
					$reports[$k]['booked_by_user'] = isset($user_list[$sl_vl['Health']['created_by_agent']])?$user_list[$sl_vl['Health']['created_by_agent']]:'-';
                                        $reports[$k]['patient_name'] = strtoupper($sl_vl['Health']['name']);
					$reports[$k]['patient_gender'] = $gender.'/'.$sl_vl['Health']['age'];
					//$reports[$k]['patient_contact'] = $sl_vl['Health']['landline'];
					$reports[$k]['patient_contact'] = $this->Utility->show_mobile_hide($sl_vl['Health']['landline'],$sl_vl['Health']['s_date']);
					$reports[$k]['patient_email'] = $this->Utility->show_mobile_hide($sl_vl['Health']['email'],$sl_vl['Health']['s_date']);
					$reports[$k]['refer_by'] = $refer_by;
					$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
					$reports[$k]['parameter_count'] = $parameter_count;
					$reports[$k]['parameter_name'] = $implode_parameter_name;
					$reports[$k]['parameter_code'] = $implode_parameter_code;
					$reports[$k]['test_amount'] = $test_amt;
					$reports[$k]['fix_discount'] = $fix_discount;
					$reports[$k]['disc_amt'] = $disc_amt;
					
					if($sl_vl['Health']['cancelled_status'] == 1)
					{ 
					$reports[$k]['net_payble'] = ($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
					$reports[$k]['receive_payment'] = $sl_vl['Health']['received_amount'];
					$reports[$k]['balance_payment'] = $sl_vl['Health']['balance_amount'];
					}
					else
					{
					$reports[$k]['net_payble'] = ($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
					if($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount'] == 0)
						$reports[$k]['net_payble']=$sl_vl['Health']['total_amount'];
					$reports[$k]['receive_payment'] = $sl_vl['Health']['received_amount'];
					$reports[$k]['balance_payment'] = $reports[$k]['net_payble']-$sl_vl['Health']['received_amount'];
					}
					$reports[$k]['payment_type'] = $p_type[$sl_vl['Health']['payment_type']];
					$reports[$k]['test_ref_num'] = $sl_vl['Health']['ref_num'];
					$reports[$k]['reference'] = $sl_vl['Health']['reference'];
					$reports[$k]['request_status']="";
					if($sl_vl['Health']['requ_status'] == 4)
						$reports[$k]['request_status']="Phlebo Assigned";
					else if($sl_vl['Health']['requ_status'] == 5)
						$reports[$k]['request_status']="Sent to Lab";
					else if($sl_vl['Health']['requ_status'] == 6)
						$reports[$k]['request_status']="Report";
					else if($sl_vl['Health']['requ_status'] == 7)
						$reports[$k]['request_status']="Partial Report";
					else if($sl_vl['Health']['requ_status'] == 8)
						$reports[$k]['request_status']="Test Cancelled";
						
					else if($sl_vl['Health']['requ_status'] == 10)
						$reports[$k]['request_status']="Sample Collected";
					else if($sl_vl['Health']['requ_status'] == 12)
						$reports[$k]['request_status']="Partial Sent to Lab";
						
					else if($sl_vl['Health']['requ_status'] == 14)
						$reports[$k]['request_status']="Reg. in LIS";	
					
					else if($sl_vl['Health']['requ_status'] == 11)
						$reports[$k]['request_status']="Sample Rejected";	
						
					else if($sl_vl['Health']['requ_status'] == 13)
						$reports[$k]['request_status']="Rescheduled";
						
					else if($sl_vl['Health']['requ_status'] == 15)
						$reports[$k]['request_status']="Api New Booking";
						
					else if($sl_vl['Health']['requ_status'] == 16)
						$reports[$k]['request_status']="Specimen Drawn";
					
					else if($sl_vl['Health']['requ_status'] == 9)
						$reports[$k]['request_status']="Closed";
						
					else if($sl_vl['Health']['requ_status'] == 0)
						$reports[$k]['request_status']="New Booking";
					else if($sl_vl['Health']['requ_status'] == 1)
						$reports[$k]['request_status']="Slot Not Available";
						
					else if($sl_vl['Health']['requ_status'] == 2)
						$reports[$k]['request_status']="Slot Blocked";
						
					else if($sl_vl['Health']['requ_status'] == 3)
						$reports[$k]['request_status']="Follow Up";
						
					else if($sl_vl['Health']['requ_status'] == 17)
						$reports[$k]['request_status']="Partial Closed";
						
					else if($sl_vl['Health']['requ_status'] == 18)
						$reports[$k]['request_status']="Booking Confirmed";
						
					else if($sl_vl['Health']['requ_status'] == 19)
						$reports[$k]['request_status']="Phlebo Confirmed";
						
					else if($sl_vl['Health']['requ_status'] == 20)
						$reports[$k]['request_status']="Phlebo Tracking";
						
					else if($sl_vl['Health']['requ_status'] == 21)
						$reports[$k]['request_status']="Specimen On Hold";
					
					else if($sl_vl['Health']['requ_status'] == 22)
						$reports[$k]['request_status']="Cancellation Requested";
					
					else if($sl_vl['Health']['requ_status'] == 23)
						$reports[$k]['request_status']="Rejection Requested";
					
					else 
						$reports[$k]['request_status']="Pending";
					$s_no++;
					$k++;
				}
				
				$total_records = $this->Health->find('all',array('conditions'=>$conditions));
				$net_pay = 0;
				$net_rec = 0;
				$net_bal = 0;
				$total_test = 0;
				foreach($total_records as $tr_ky => $tr_vl)
				{
					if(!empty($tr_vl['Health']['test_id']))
					{
						$expl_test = explode(',',$tr_vl['Health']['test_id']);
						$cnt_1 = 0;
						foreach($expl_test as $k_1 => $v_1)
						{
							if(!empty($v_1))
							{
								$cnt_1++;
							}
						}
					}
					if(!empty($tr_vl['Health']['profile_id']))
					{
						$expl_prf = explode(',',$tr_vl['Health']['test_id']);
						$cnt_2 = 0;
						foreach($expl_test as $k_2 => $v_2)
						{
							if(!empty($v_2))
							{
								$cnt_2++;
							}
						}
					}
					if(!empty($tr_vl['Health']['offer_id']))
					{
						$expl_offer = explode(',',$tr_vl['Health']['test_id']);
						$cnt_3 = 0;
						foreach($expl_test as $k_3 => $v_3)
						{
							if(!empty($v_3))
							{
								$cnt_3++;
							}
						}
					}
					if(!empty($tr_vl['Health']['package_id']))
					{
						$expl_pck = explode(',',$tr_vl['Health']['test_id']);
						$cnt_4 = 0;
						foreach($expl_test as $k_4 => $v_4)
						{
							if(!empty($v_4))
							{
								$cnt_4++;
							}
						}
					}
					$total_test_now = ($cnt_1+$cnt_2+$cnt_3+$cnt_4);
					
					$total_test = ($total_test_now+$total_test);
					
					$net_rec = ($tr_vl['Health']['received_amount']+$net_rec);
					//$net_bal = ($tr_vl['Health']['balance_amount']+$net_bal);
					if($tr_vl['Health']['cancelled_status'] == 1)
					{
						$net_bal = ($tr_vl['Health']['balance_amount']+$net_bal);
					}
					else
					{
						$net_pay_amt= ($tr_vl['Health']['received_amount']+$tr_vl['Health']['balance_amount']);
						if($net_pay_amt == 0)
							$net_pay_amt=$tr_vl['Health']['total_amount'];
						$net_bal_amt=$net_pay_amt-$tr_vl['Health']['received_amount'];
						$net_bal = ($net_bal_amt+$net_bal);
					}
					$net_pay = ($net_rec+$net_bal);
				}
				$total_no_records = count($total_records);
				$total_no_test = $total_test;
				$total_net_pay = $net_pay;
				$total_net_rec = $net_rec;
				$total_net_bal = $net_bal;
				header('Content-Type: text/csv; charset=utf-8');
				header('Content-Disposition: attachment; filename=sales_report.csv');
				$output = fopen('php://output', 'w');
				fputcsv($output, array('Total No. of Requests', 'Total No. of Tests', 'Total Net Payable','Total Received Amount', 'Total Balance Due'));
				fputcsv($output, array($total_no_records,$total_no_test,$total_net_pay,$total_net_rec,$total_net_bal));
				fputcsv($output, array());
				
				fputcsv($output, array('S.No.', 'Date', 'ReqNo','Booking From','Booked By PCC','Service By PCC','Medical Reference Number','Booked By User' ,'Patient Name' ,'Gender/Age', 'Phone No.', 'Email','Reffered By','Agent Name','No. of Test', 'Test Names','Test Codes','Test Amount(Rs)', 'Discount%','Discount Amount(Rs)','Net Payble(Rs)','Payment Received(Rs)','Balance Due(Rs)','Payment Type','Lab Refrence No.','Reference','Request Status'));
				foreach ($reports as $keys => $values) 
				{
					if(($values['fix_discount'] != 'N/A') && ($values['fix_discount'] == '100%'))
					{
						$values['test_amount'] = $values['test_amount'];
						$values['fix_discount'] = $values['fix_discount'];
						$values['disc_amt'] = $values['test_amount'];
						$values['net_payble'] = $values['net_payble'];
					}
					else
					{
						$values['test_amount'] = $values['test_amount'];
						$values['fix_discount'] = $values['fix_discount'];
						$values['disc_amt'] = $values['disc_amt'];
						$values['net_payble'] = $values['net_payble'];
					}
					fputcsv($output, $values);
				}
				die;
			}
		}
	}
	
	function admin_daily_collection_report()
	{
		$this->set('title_for_layout','Daily Collection Report');
		$admin_u_type = $this->Session->read('Admin.userType');
		$admin_lab_id = $this->Session->read('Admin.labId');
                $admin_lab_type = $this->Session->read('Admin.labType');
                
                if(($admin_u_type != 'A') && ($admin_u_type != 'BM') && ($admin_u_type != 'Agent'))
		{
			//echo "<pre>"; print_r($this->Session->read('Admin')); exit;
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.id'=>$admin_lab_id)));
			$s_pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			
			$this->set('pcc',$pcc);
			$this->set('s_pcc',$s_pcc);
		}
		else
		{
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$s_pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			
			$this->set('pcc',$pcc);
			$this->set('s_pcc',$s_pcc);
		}
		if($admin_u_type == 'A' || $admin_u_type == 'BM')
		{
			$select_user = $this->Admin->find('all',array('conditions'=>array('Admin.userType <>'=>'Agent')));
			$this->set('select_user',$select_user);
			
			$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$this->set('pcc_list',$pcc_list);
		}
		else
		{
			$select_user = $this->Admin->find('all',array('conditions'=>array('Admin.labId'=>$admin_lab_id)));
			$this->set('select_user',$select_user);
		}
		
		if(!empty($this->params['named']['from_date']) && $this->params['named']['from_date'] != '')
		{
			$this->data['SalesReport']['from_date'] = $this->params['named']['from_date'];
			$options['from_date'] = $this->params['named']['from_date'];
		}
		if(!empty($this->params['named']['to_date']) && $this->params['named']['to_date'] != '')
		{
			$this->data['SalesReport']['to_date'] = $this->params['named']['to_date'];
			$options['to_date'] = $this->params['named']['to_date'];
		}
		if(!empty($this->params['named']['admin']) && $this->params['named']['admin'] != '')
		{
			$this->data['SalesReport']['admin_list_id'] = $this->params['named']['admin'];
			$options['admin'] = $this->params['named']['admin'];
		}
		if(!empty($this->params['named']['mode']) && $this->params['named']['mode'] != '')
		{
			$this->data['SalesReport']['paymode'] = $this->params['named']['mode'];
			$options['mode'] = $this->params['named']['mode'];
		}
		if(!empty($this->params['named']['set_option']) && $this->params['named']['set_option'] != '')
		{
			$this->data['SalesReport']['set_option'] = $this->params['named']['set_option'];
			$options['set_option'] = $this->params['named']['set_option'];
		}
		
		
		
		if(!empty($this->data))
		{
			if($this->data['SalesReport']['set_option'] == 'filter')
			{
				$from_date = $this->data['SalesReport']['from_date']; 
				$to_date = $this->data['SalesReport']['to_date'];
				$pcc_list_id = $this->data['SalesReport']['pcc_list_id'];
                                $pcc_list_id1 = $this->data['SalesReport']['pcc_list_id1'];
				$admin_user_id = $this->data['SalesReport']['admin_list_id'];
				$paymode = $this->data['SalesReport']['paymode'];
				$set_option = $this->data['SalesReport']['set_option'];
				
				if(!empty($from_date) && $from_date != '')
				{
					$conditions['Paytrack.receive_date >='] = date('Y-m-d 00:00:00',strtotime($from_date));
					$options['from_date'] = $from_date;
				}
				if(!empty($to_date) && $to_date != '')
				{
					$conditions['Paytrack.receive_date <='] = date('Y-m-d 23:59:59',strtotime($to_date));
					$options['to_date'] = $to_date;
				}
				if(!empty($admin_user_id) && $admin_user_id != '')
				{
					$conditions['Paytrack.admin_id'] = $admin_user_id;
					$options['admin'] = $admin_user_id;
				}
				if(!empty($paymode) && $paymode != '')
				{
					$conditions['Paytrack.pay_mode'] = $paymode;
					$options['mode'] = $paymode;
				}
				$options['set_option'] = $set_option;
				$collections = $this->Paytrack->find('all',array('conditions'=>$conditions));
				$reports = array();
				$k = 0;
				foreach($collections as $sl_ky => $sl_vl)
				{
					$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$sl_vl['Paytrack']['request_id'])));
					if((!empty($pcc_list_id) && $pcc_list_id != '') || (isset($pcc_list_id1) && !empty($pcc_list_id1)))
					{
						if($request['Health']['assigned_lab'] == $pcc_list_id || $request['Health']['created_by'] == $pcc_list_id1)
						{
							$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['assigned_lab'])));
                                                        $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['created_by'])));
							$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$request['Health']['agent_id'])));
							$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request['Health']['id'])));
							$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$sl_vl['Paytrack']['admin_id'])));
							
							$reports[$k]['SalesReport']['receive_date'] = date('d-M-Y H:i',strtotime($sl_vl['Paytrack']['receive_date']));
							$reports[$k]['SalesReport']['req_num'] = $requestNum['Billing']['order_id'];
							$reports[$k]['SalesReport']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                        $reports[$k]['SalesReport']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
							$reports[$k]['SalesReport']['agent_name'] = $agent_name['Agent']['name'];
							$reports[$k]['SalesReport']['receive_by'] = $admin_name['Admin']['name'];
							$reports[$k]['SalesReport']['patient_name'] = strtoupper($request['Health']['name']);
							$reports[$k]['SalesReport']['patient_contact'] = $request['Health']['landline'];
							$reports[$k]['SalesReport']['install_amt'] = $sl_vl['Paytrack']['pay_install'];
							$reports[$k]['SalesReport']['pay_mode'] = $sl_vl['Paytrack']['pay_mode'];
							$k++;
						}
					}
					else
					{
						$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['assigned_lab'])));
                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['created_by'])));
						$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$request['Health']['agent_id'])));
						$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request['Health']['id'])));
						$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$sl_vl['Paytrack']['admin_id'])));
						
						$reports[$k]['SalesReport']['receive_date'] = date('d-M-Y H:i',strtotime($sl_vl['Paytrack']['receive_date']));
						$reports[$k]['SalesReport']['req_num'] = $requestNum['Billing']['order_id'];
                                                $reports[$k]['SalesReport']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
						$reports[$k]['SalesReport']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
						$reports[$k]['SalesReport']['agent_name'] = $agent_name['Agent']['name'];
						$reports[$k]['SalesReport']['receive_by'] = $admin_name['Admin']['name'];
						$reports[$k]['SalesReport']['patient_name'] = strtoupper($request['Health']['name']);
						$reports[$k]['SalesReport']['patient_contact'] = $request['Health']['landline'];
						$reports[$k]['SalesReport']['install_amt'] = $sl_vl['Paytrack']['pay_install'];
						$reports[$k]['SalesReport']['pay_mode'] = $sl_vl['Paytrack']['pay_mode'];
						$k++;
					}
				}
				
				$collection_history = $this->Paytrack->find('all',array('conditions'=>$conditions));
				
				$total = 0;
	
				$paymenttopcc = 0;
				
				$cash = 0;
				$credit_card = 0;
				$cheque = 0;
				$adjust = 0;
                                $online = 0;
				foreach($collection_history as $tr_ky => $tr_vl)
				{
					$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$tr_vl['Paytrack']['request_id'])));
					if(!empty($pcc_list_id) && $pcc_list_id != '')
					{
						if($request['Health']['assigned_lab'] == $pcc_list_id)
						{
							$total = ($tr_vl['Paytrack']['pay_install']+$total);
							
							if($tr_vl['Paytrack']['pay_mode'] == 'paymenttopcc')
							{
								$paymenttopcc = ($tr_vl['Paytrack']['pay_install']+$paymenttopcc);
							}
							
							if($tr_vl['Paytrack']['pay_mode'] == 'cash')
							{
								$cash = ($tr_vl['Paytrack']['pay_install']+$cash);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'cheque')
							{
								$cheque = ($tr_vl['Paytrack']['pay_install']+$cheque);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'credit_card')
							{
								$credit_card = ($tr_vl['Paytrack']['pay_install']+$credit_card);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'adjust')
							{
								$adjust = ($tr_vl['Paytrack']['pay_install']+$adjust);
							}
                                                        if($tr_vl['Paytrack']['pay_mode'] == 'online')
							{
								$online = ($tr_vl['Paytrack']['pay_install']+$online);
							}
						}
					}
					else
					{
						$total = ($tr_vl['Paytrack']['pay_install']+$total);
						
						if($tr_vl['Paytrack']['pay_mode'] == 'paymenttopcc')
						{
							$paymenttopcc = ($tr_vl['Paytrack']['pay_install']+$paymenttopcc);
						}
							
						if($tr_vl['Paytrack']['pay_mode'] == 'cash')
						{
							$cash = ($tr_vl['Paytrack']['pay_install']+$cash);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'cheque')
						{
							$cheque = ($tr_vl['Paytrack']['pay_install']+$cheque);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'credit_card')
						{
							$credit_card = ($tr_vl['Paytrack']['pay_install']+$credit_card);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'adjust')
						{
							$adjust = ($tr_vl['Paytrack']['pay_install']+$adjust);
						}
                                                if($tr_vl['Paytrack']['pay_mode'] == 'online')
						{
							$online = ($tr_vl['Paytrack']['pay_install']+$online);
						}
					}
				}
				$this->set('total_amt',$total);
				
				$this->set('paymenttopcc_amt',$paymenttopcc);
								
				$this->set('cash_amt',$cash);
				$this->set('cheque_amt',$cheque);
				$this->set('credit_card_amt',$credit_card);
				$this->set('adjust_amt',$adjust);
                                $this->set('online_amt',$online);
				$this->set('options',$options);
				$this->set('reports',$reports);
				$this->set('select_user',$admin_user_id);
				$this->set('select_mode',$paymode);
				$this->set('pcc_list_id',$pcc_list_id);
                                $this->set('pcc_list_id1',$pcc_list_id1);
				$admin_u_type = $this->Session->read('Admin.userType');
				$admin_lab_id = $this->Session->read('Admin.labId');
				if($admin_u_type == 'A' || $admin_u_type == 'BM')
				{
					$select_user = $this->Admin->find('all',array('conditions'=>array('Admin.userType <>'=>'Agent')));
					$this->set('select_user',$select_user);
				}
				else
				{
					$select_user = $this->Admin->find('all',array('conditions'=>array('Admin.labId'=>$admin_lab_id)));
					$this->set('select_user',$select_user);
				}
			}
			
			if($this->data['SalesReport']['set_option'] == 'export_excel')
			{
				$excel_from_date = $this->data['SalesReport']['from_date']; 
				$excel_to_date = $this->data['SalesReport']['to_date'];
				$excel_pcc_list_id = $this->data['SalesReport']['pcc_list_id'];
                                $excel_pcc_list_id1 = $this->data['SalesReport']['pcc_list_id1'];
				$excel_admin_user_id = $this->data['SalesReport']['admin_list_id'];
				$excel_paymode = $this->data['SalesReport']['paymode'];
				
				if(!empty($excel_from_date) && $excel_from_date != '')
				{
					$conditions['Paytrack.receive_date >='] = date('Y-m-d 00:00:00',strtotime($excel_from_date));
				}
				if(!empty($excel_to_date) && $excel_to_date != '')
				{
					$conditions['Paytrack.receive_date <='] = date('Y-m-d 23:59:59',strtotime($excel_to_date));
				}
				if(!empty($excel_paymode) && $excel_paymode != '')
				{
					$conditions['Paytrack.pay_mode'] = $excel_paymode;
				}
				$collection_history = $this->Paytrack->find('all',array('conditions'=>$conditions));
				$reports = array();
				$k = 0;
				$s_no = 1;
				foreach($collection_history as $sl_ky => $sl_vl)
				{
					$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$sl_vl['Paytrack']['request_id'])));
					if(!empty($excel_pcc_list_id) && $excel_pcc_list_id != '')
					{
						if($request['Health']['assigned_lab'] == $excel_pcc_list_id)
						{
							$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['assigned_lab'])));
                                                        $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['created_by'])));
							$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$request['Health']['agent_id'])));
							$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request['Health']['id'])));
							$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$sl_vl['Paytrack']['admin_id'])));
							
							$reports[$k]['s_no'] = $s_no;
							$reports[$k]['receive_date'] = date('d-M-Y H:i',strtotime($sl_vl['Paytrack']['receive_date']));
							$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
							$reports[$k]['medical_reference_number'] = $sl_vl['Health']['medical_reference_number'];
							$reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name'])?$pcc_name1['Lab']['pcc_name']:'NPL';
						$reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name'])?$pcc_name['Lab']['pcc_name']:'NPL';
							$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
							$reports[$k]['receive_by'] = $admin_name['Admin']['name'];
							$reports[$k]['patient_name'] = strtoupper($request['Health']['name']);
							$reports[$k]['patient_contact'] = $request['Health']['landline'];
							$reports[$k]['install_amt'] = $sl_vl['Paytrack']['pay_install'];
							$reports[$k]['pay_mode'] = $sl_vl['Paytrack']['pay_mode'];
							$k++;
							$s_no++;
						}
					}
					else
					{
						$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$sl_vl['Paytrack']['request_id'])));
						$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['assigned_lab'])));
                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['created_by'])));
						$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$request['Health']['agent_id'])));
						$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request['Health']['id'])));
						$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$sl_vl['Paytrack']['admin_id'])));
						
						$reports[$k]['s_no'] = $s_no;
						$reports[$k]['receive_date'] = date('d-M-Y H:i',strtotime($sl_vl['Paytrack']['receive_date']));
						$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
						$reports[$k]['medical_reference_number'] = $sl_vl['Health']['medical_reference_number'];
                                                $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name'])?$pcc_name1['Lab']['pcc_name']:'NPL';
						$reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name'])?$pcc_name['Lab']['pcc_name']:'NPL';
                                                
						$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
						$reports[$k]['receive_by'] = $admin_name['Admin']['name'];
						$reports[$k]['patient_name'] = strtoupper($request['Health']['name']);
						$reports[$k]['patient_contact'] = $request['Health']['landline'];
						$reports[$k]['patient_contact'] = $this->Utility->show_mobile_hide($request['Health']['landline'],$sl_vl['Paytrack']['receive_date']);
						$reports[$k]['install_amt'] = $sl_vl['Paytrack']['pay_install'];
						$reports[$k]['pay_mode'] = $sl_vl['Paytrack']['pay_mode'];
						$k++;
						$s_no++;
					}
				}
				
				$collection_pay_history = $this->Paytrack->find('all',array('conditions'=>$conditions));
				$total = 0;
				$cash = 0;
				$credit_card = 0;
				$cheque = 0;
				$adjust = 0;
				
				$paymenttopcc = 0;
				
				foreach($collection_pay_history as $tr_ky => $tr_vl)
				{
					$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$tr_vl['Paytrack']['request_id'])));
					if(!empty($excel_pcc_list_id) && $excel_pcc_list_id != '')
					{
						if($request['Health']['assigned_lab'] == $excel_pcc_list_id)
						{
							$total = ($tr_vl['Paytrack']['pay_install']+$total);
							
							if($tr_vl['Paytrack']['pay_mode'] == 'paymenttopcc')
							{
								$paymenttopcc = ($tr_vl['Paytrack']['pay_install']+$paymenttopcc);
							}
						
							if($tr_vl['Paytrack']['pay_mode'] == 'cash')
							{
								$cash = ($tr_vl['Paytrack']['pay_install']+$cash);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'cheque')
							{
								$cheque = ($tr_vl['Paytrack']['pay_install']+$cheque);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'credit_card')
							{
								$credit_card = ($tr_vl['Paytrack']['pay_install']+$credit_card);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'adjust')
							{
								$adjust = ($tr_vl['Paytrack']['pay_install']+$adjust);
							}
						}
					}
					else
					{
						$total = ($tr_vl['Paytrack']['pay_install']+$total);
						
						if($tr_vl['Paytrack']['pay_mode'] == 'paymenttopcc')
						{
	
							$paymenttopcc = ($tr_vl['Paytrack']['pay_install']+$paymenttopcc);
						}
							
						if($tr_vl['Paytrack']['pay_mode'] == 'cash')
						{
							$cash = ($tr_vl['Paytrack']['pay_install']+$cash);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'cheque')
						{
							$cheque = ($tr_vl['Paytrack']['pay_install']+$cheque);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'credit_card')
						{
							$credit_card = ($tr_vl['Paytrack']['pay_install']+$credit_card);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'adjust')
						{
							$adjust = ($tr_vl['Paytrack']['pay_install']+$adjust);
						}
					}
				}
				
				//echo "<pre>"; print_r($reports); exit;
				
				header('Content-Type: text/csv; charset=utf-8');
				header('Content-Disposition: attachment; filename=daily_collection_report.csv');
				$output = fopen('php://output', 'w');
				fputcsv($output, array('Total Collection','Payment To PCC Collection', 'Cash Collection','Cheque Collection','Credit Card Collection','Adjustment'));
				fputcsv($output, array($total,$paymenttopcc,$cash,$cheque,$credit_card,$adjust));
				fputcsv($output, array());
				
				fputcsv($output, array('S.No.', 'Collection Date & Time','ReqNo','Medical Reference Number','Booked By PCC','Service By PCC','Agent Name','Received By','Patient Name','Contact No.','Installment Amount','Payment Mode'));
				foreach ($reports as $keys => $values) 
				{
					fputcsv($output, $values);
				}
				die;
			}
		}
	}
	
	function admin_user_daily_collection_report($submit_type=NULL)
	{
		$this->set('title_for_layout','User Daily Collection Report');
		$admin_u_type = $this->Session->read('Admin.userType');
		$admin_lab_id = $this->Session->read('Admin.labId');
                $admin_lab_type = $this->Session->read('Admin.labType');
                
                if(($admin_u_type != 'A') && ($admin_u_type != 'BM') && ($admin_u_type != 'Agent'))
		{
			//echo "<pre>"; print_r($this->Session->read('Admin')); exit;
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.id'=>$admin_lab_id)));
			$this->set('pcc',$pcc);
		}
		else
		{
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$this->set('pcc',$pcc);
		}
		if($admin_u_type == 'A' || $admin_u_type == 'BM')
		{
			$select_user = $this->Admin->find('all',array('conditions'=>array('Admin.userType <>'=>'Agent')));
			$this->set('select_user',$select_user);
			
			$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$this->set('pcc_list',$pcc_list);
		}
		else
		{
			$select_user = $this->Admin->find('all',array('conditions'=>array('Admin.labId'=>$admin_lab_id)));
			$this->set('select_user',$select_user);
		}
		
		if(!empty($this->params['named']['from_date']) && $this->params['named']['from_date'] != '')
		{
			$this->data['SalesReport']['from_date'] = $this->params['named']['from_date'];
			$options['from_date'] = $this->params['named']['from_date'];
		}
		if(!empty($this->params['named']['to_date']) && $this->params['named']['to_date'] != '')
		{
			$this->data['SalesReport']['to_date'] = $this->params['named']['to_date'];
			$options['to_date'] = $this->params['named']['to_date'];
		}
		if(!empty($this->params['named']['admin']) && $this->params['named']['admin'] != '')
		{
			$this->data['SalesReport']['admin_list_id'] = $this->params['named']['admin'];
			$options['admin'] = $this->params['named']['admin'];
		}
		if(!empty($this->params['named']['mode']) && $this->params['named']['mode'] != '')
		{
			$this->data['SalesReport']['paymode'] = $this->params['named']['mode'];
			$options['mode'] = $this->params['named']['mode'];
		}
		if(!empty($this->params['named']['set_option']) && $this->params['named']['set_option'] != '')
		{
			$this->data['SalesReport']['set_option'] = $this->params['named']['set_option'];
			$options['set_option'] = $this->params['named']['set_option'];
		}
		
		if(!empty($this->data))
		{
			if($submit_type != 'save_detail')
			{
				$from_date = $this->data['SalesReport']['from_date'];
				$admin_user_id = $this->data['SalesReport']['admin_list_id'];
				$pcc_list_id = $this->data['SalesReport']['pcc_list_id'];
                $pcc_list_id1 = $this->data['SalesReport']['pcc_list_id1'];
				if(!empty($from_date) && $from_date != '')
				{
					$conditions['Paytrack.receive_date >='] = date('Y-m-d 00:00:00',strtotime($from_date));
					$conditions['Paytrack.receive_date <='] = date('Y-m-d 23:59:59',strtotime($from_date));
					$options['from_date'] = $from_date;
				}
				
				//echo "<pre>"; print_r($conditions); exit;
				if(!empty($admin_user_id) && $admin_user_id != '')
				{
					$conditions['Paytrack.admin_id'] = $admin_user_id;
					$options['admin'] = $admin_user_id;
				}
				$collections = $this->Paytrack->find('all',array('conditions'=>$conditions));
				$reports = array();
				$k = 0;
				foreach($collections as $sl_ky => $sl_vl)
				{
					$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$sl_vl['Paytrack']['request_id'])));
					if((!empty($pcc_list_id) && $pcc_list_id != '') || (isset($pcc_list_id1) && !empty($pcc_list_id)))
					{
						if($request['Health']['assigned_lab'] == $pcc_list_id || $request['Health']['created_by'] == $pcc_list_id1)
						{
							$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['assigned_lab'])));
                            $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['created_by'])));
							$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$request['Health']['agent_id'])));
							$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request['Health']['id'])));
							$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$sl_vl['Paytrack']['admin_id'])));
							
							$reports[$k]['SalesReport']['receive_date'] = date('d-M-Y H:i',strtotime($sl_vl['Paytrack']['receive_date']));
							$reports[$k]['SalesReport']['req_num'] = $requestNum['Billing']['order_id'];
							$reports[$k]['SalesReport']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                            $reports[$k]['SalesReport']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
							$reports[$k]['SalesReport']['agent_name'] = $agent_name['Agent']['name'];
							$reports[$k]['SalesReport']['receive_by'] = $admin_name['Admin']['name'];
							$reports[$k]['SalesReport']['patient_name'] = strtoupper($request['Health']['name']);
							$reports[$k]['SalesReport']['patient_contact'] = $request['Health']['landline'];
							$reports[$k]['SalesReport']['install_amt'] = $sl_vl['Paytrack']['pay_install'];
							$reports[$k]['SalesReport']['pay_mode'] = $sl_vl['Paytrack']['pay_mode'];
							$k++;
						}
					}
					else
					{
						$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['assigned_lab'])));
						$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$request['Health']['agent_id'])));
						$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request['Health']['id'])));
						$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$sl_vl['Paytrack']['admin_id'])));
						
						$reports[$k]['SalesReport']['receive_date'] = date('d-M-Y H:i',strtotime($sl_vl['Paytrack']['receive_date']));
						$reports[$k]['SalesReport']['req_num'] = $requestNum['Billing']['order_id'];
						$reports[$k]['SalesReport']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
						$reports[$k]['SalesReport']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
						$reports[$k]['SalesReport']['agent_name'] = $agent_name['Agent']['name'];
						$reports[$k]['SalesReport']['receive_by'] = $admin_name['Admin']['name'];
						$reports[$k]['SalesReport']['patient_name'] = strtoupper($request['Health']['name']);
						$reports[$k]['SalesReport']['patient_contact'] = $request['Health']['landline'];
						$reports[$k]['SalesReport']['install_amt'] = $sl_vl['Paytrack']['pay_install'];
						$reports[$k]['SalesReport']['pay_mode'] = $sl_vl['Paytrack']['pay_mode'];
						$k++;
					}
				}
				
				$collection_history = $this->Paytrack->find('all',array('conditions'=>$conditions));
				
				$total = 0;
				$cash = 0;
				$credit_card = 0;
				$cheque = 0;
				$adjust = 0;
				foreach($collection_history as $tr_ky => $tr_vl)
				{
					$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$tr_vl['Paytrack']['request_id'])));
					if(!empty($pcc_list_id) && $pcc_list_id != '')
					{
						if($request['Health']['assigned_lab'] == $pcc_list_id)
						{
							$total = ($tr_vl['Paytrack']['pay_install']+$total);
							if($tr_vl['Paytrack']['pay_mode'] == 'cash')
							{
								$cash = ($tr_vl['Paytrack']['pay_install']+$cash);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'cheque')
							{
								$cheque = ($tr_vl['Paytrack']['pay_install']+$cheque);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'credit_card')
							{
								$credit_card = ($tr_vl['Paytrack']['pay_install']+$credit_card);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'adjust')
							{
								$adjust = ($tr_vl['Paytrack']['pay_install']+$adjust);
							}
						}
					}
					else
					{
						$total = ($tr_vl['Paytrack']['pay_install']+$total);
						if($tr_vl['Paytrack']['pay_mode'] == 'cash')
						{
							$cash = ($tr_vl['Paytrack']['pay_install']+$cash);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'cheque')
						{
							$cheque = ($tr_vl['Paytrack']['pay_install']+$cheque);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'credit_card')
						{
							$credit_card = ($tr_vl['Paytrack']['pay_install']+$credit_card);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'adjust')
						{
							$adjust = ($tr_vl['Paytrack']['pay_install']+$adjust);
						}
					}
				}
				$total = ($total-$adjust);
				$this->set('total_amt',$total);
				$this->set('cash_amt',$cash);
				$this->set('cheque_amt',$cheque);
				$this->set('credit_card_amt',$credit_card);
				$this->set('adjust_amt',$adjust);
				$this->set('options',$options);
				$this->set('reports',$reports);
				$this->set('select_user',$admin_user_id);
				
				$this->set('pcc_list_id',$pcc_list_id);
                $this->set('pcc_list_id1',$pcc_list_id1);
		$admin_u_type = $this->Session->read('Admin.userType');
				$admin_lab_id = $this->Session->read('Admin.labId');
				if($admin_u_type == 'A' || $admin_u_type == 'BM')
				{
					$select_user = $this->Admin->find('all',array('conditions'=>array('Admin.userType <>'=>'Agent')));
					$this->set('select_user',$select_user);
				}
				else
				{
					$select_user = $this->Admin->find('all',array('conditions'=>array('Admin.labId'=>$admin_lab_id)));
					$this->set('select_user',$select_user);
				}
				$this->set('date_report',$this->data['SalesReport']['from_date']);
			}
			else
			{
				$user_id = $this->Session->read('Admin.id');
				$from_date = $this->data['DailyCollection']['report_date'];
				$admin_user_id = $user_id;
				if(!empty($from_date) && $from_date != '')
				{
					$conditions['Paytrack.receive_date >='] = date('Y-m-d 00:00:00',strtotime($from_date));
					$conditions['Paytrack.receive_date <='] = date('Y-m-d 23:59:59',strtotime($from_date));
					$options['from_date'] = $from_date;
				}
				
				//echo "<pre>"; print_r($conditions); exit;
				if(!empty($admin_user_id) && $admin_user_id != '')
				{
					$conditions['Paytrack.admin_id'] = $admin_user_id;
					$options['admin'] = $admin_user_id;
				}
				$collections = $this->Paytrack->find('all',array('conditions'=>$conditions));
				$reports = array();
				$k = 0;
				foreach($collections as $sl_ky => $sl_vl)
				{
					$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$sl_vl['Paytrack']['request_id'])));
					if(!empty($pcc_list_id) && $pcc_list_id != '')
					{
						if($request['Health']['assigned_lab'] == $pcc_list_id)
						{
							$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['assigned_lab'])));
		$pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['created_by'])));
							$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$request['Health']['agent_id'])));
							$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request['Health']['id'])));
							$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$sl_vl['Paytrack']['admin_id'])));
							
							$reports[$k]['SalesReport']['receive_date'] = date('d-M-Y H:i',strtotime($sl_vl['Paytrack']['receive_date']));
							$reports[$k]['SalesReport']['req_num'] = $requestNum['Billing']['order_id'];
							$reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name'])?$pcc_name1['Lab']['pcc_name']:'NPL';
						$reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name'])?$pcc_name['Lab']['pcc_name']:'NPL';
							$reports[$k]['SalesReport']['agent_name'] = $agent_name['Agent']['name'];
							$reports[$k]['SalesReport']['receive_by'] = $admin_name['Admin']['name'];
							$reports[$k]['SalesReport']['patient_name'] = strtoupper($request['Health']['name']);
							$reports[$k]['SalesReport']['patient_contact'] = $request['Health']['landline'];
							$reports[$k]['SalesReport']['install_amt'] = $sl_vl['Paytrack']['pay_install'];
							$reports[$k]['SalesReport']['pay_mode'] = $sl_vl['Paytrack']['pay_mode'];
							$k++;
						}
					}
					else
					{
						$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['assigned_lab'])));
        $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$request['Health']['created_by'])));
						$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$request['Health']['agent_id'])));
						$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$request['Health']['id'])));
						$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$sl_vl['Paytrack']['admin_id'])));
						
						$reports[$k]['SalesReport']['receive_date'] = date('d-M-Y H:i',strtotime($sl_vl['Paytrack']['receive_date']));
						$reports[$k]['SalesReport']['req_num'] = $requestNum['Billing']['order_id'];
						$reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name'])?$pcc_name1['Lab']['pcc_name']:'NPL';
						$reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name'])?$pcc_name['Lab']['pcc_name']:'NPL';
						$reports[$k]['SalesReport']['agent_name'] = $agent_name['Agent']['name'];
						$reports[$k]['SalesReport']['receive_by'] = $admin_name['Admin']['name'];
						$reports[$k]['SalesReport']['patient_name'] = strtoupper($request['Health']['name']);
						$reports[$k]['SalesReport']['patient_contact'] = $request['Health']['landline'];
						$reports[$k]['SalesReport']['install_amt'] = $sl_vl['Paytrack']['pay_install'];
						$reports[$k]['SalesReport']['pay_mode'] = $sl_vl['Paytrack']['pay_mode'];
						$k++;
					}
				}
				
				$collection_history = $this->Paytrack->find('all',array('conditions'=>$conditions));
				
				$total = 0;
				$cash = 0;
				$credit_card = 0;
				$cheque = 0;
				$adjust = 0;
				foreach($collection_history as $tr_ky => $tr_vl)
				{
					$request = $this->Health->find('first',array('conditions'=>array('Health.id'=>$tr_vl['Paytrack']['request_id'])));
					if(!empty($pcc_list_id) && $pcc_list_id != '')
					{
						if($request['Health']['assigned_lab'] == $pcc_list_id)
						{
							$total = ($tr_vl['Paytrack']['pay_install']+$total);
							if($tr_vl['Paytrack']['pay_mode'] == 'cash')
							{
								$cash = ($tr_vl['Paytrack']['pay_install']+$cash);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'cheque')
							{
								$cheque = ($tr_vl['Paytrack']['pay_install']+$cheque);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'credit_card')
							{
								$credit_card = ($tr_vl['Paytrack']['pay_install']+$credit_card);
							}
							if($tr_vl['Paytrack']['pay_mode'] == 'adjust')
							{
								$adjust = ($tr_vl['Paytrack']['pay_install']+$adjust);
							}
						}
					}
					else
					{
						$total = ($tr_vl['Paytrack']['pay_install']+$total);
						if($tr_vl['Paytrack']['pay_mode'] == 'cash')
						{
							$cash = ($tr_vl['Paytrack']['pay_install']+$cash);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'cheque')
						{
							$cheque = ($tr_vl['Paytrack']['pay_install']+$cheque);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'credit_card')
						{
							$credit_card = ($tr_vl['Paytrack']['pay_install']+$credit_card);
						}
						if($tr_vl['Paytrack']['pay_mode'] == 'adjust')
						{
							$adjust = ($tr_vl['Paytrack']['pay_install']+$adjust);
						}
					}
				}
				$total = ($total-$adjust);
				$this->set('total_amt',$total);
				$this->set('cash_amt',$cash);
				$this->set('cheque_amt',$cheque);
				$this->set('credit_card_amt',$credit_card);
				$this->set('adjust_amt',$adjust);
				$this->set('options',$options);
				$this->set('reports',$reports);
				$this->set('select_user',$admin_user_id);
				$this->set('pcc_list_id',$pcc_list_id);
                $this->set('pcc_list_id1',$pcc_list_id1);
				
				
				
				$this->data['UserCollectionReport']['user_id'] = $user_id;
				$this->data['UserCollectionReport']['report_date'] = date('Y-m-d H:i:s',strtotime($this->data['DailyCollection']['report_date']));
				$this->data['UserCollectionReport']['upper_total_amount'] = $this->data['DailyCollection']['upper_total_amount'];
				$this->data['UserCollectionReport']['upper_cash_amount'] = $this->data['DailyCollection']['upper_cash_amount'];
				$this->data['UserCollectionReport']['upper_credit_card_amount'] = $this->data['DailyCollection']['upper_credit_card_amount'];
				$this->data['UserCollectionReport']['upper_cheque_amount'] = $this->data['DailyCollection']['upper_cheque_amount'];
				$this->data['UserCollectionReport']['adjustment_amount'] = $this->data['DailyCollection']['adjustment_amount'];
				$this->data['UserCollectionReport']['total_cash'] = $this->data['DailyCollection']['total_cash'];
				$this->data['UserCollectionReport']['total_cheque'] = $this->data['DailyCollection']['total_cheque'];
				$this->data['UserCollectionReport']['total_credit_card'] = $this->data['DailyCollection']['total_credit_card'];
				$this->data['UserCollectionReport']['total_deposit'] = $this->data['DailyCollection']['total_deposit'];
				$this->data['UserCollectionReport']['total_variation'] = $this->data['DailyCollection']['total_variation'];
				$this->data['UserCollectionReport']['submit_date'] = date('Y-m-d H:i:s');
				if($this->UserCollectionReport->create($this->data))
				{
					if($this->UserCollectionReport->save($this->data))
					{
						//$get_last_id = $this->UserCollectionReport->getLastInsertId();
						//echo "<script>";
						//echo "window.open('".SITE_URL."admin/samples/print_collection_detail/".base64_encode($get_last_id)."','name','height=500,width=800,scrollbars=yes');";
						/*echo "</script>";*/
						$this->redirect('/admin/samples/user_collection_deposit_list');
					}
				}
			}
		}
	}
	
	function admin_print_collection_detail($id=NULL)
	{
		$this->layout = false;
		$dec_id = $id;
		$find_detail = $this->UserCollectionReport->find('first',array('conditions'=>array('UserCollectionReport.id'=>$dec_id)));
		$admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$find_detail['UserCollectionReport']['user_id'])));
		$find_detail['UserCollectionReport']['admin_name'] = $admin_name['Admin']['name'];
		$this->set('find_detail',$find_detail);
		$this->set('print_id',$id);
	}
	
	function admin_delete_row_collection()
	{
		$rowid = $_REQUEST['id'];
		$delete_row = $this->UserCollectionReport->query("DELETE FROM user_collection_report WHERE id='".$rowid."'");
		$x['rowid'] = $rowid;
		$m['req_info'] = $x;
		echo json_encode($m);
		exit;
	}
	
	function admin_confirm_print_collection_detail($id=NULL)
	{
		$this->layout = false;
		$dec_id = base64_decode($id);
		$find_detail = $this->UserCollectionReport->find('first',array('conditions',array('UserCollectionReport.id'=>$dec_id)));
		$admin_name = $this->Admin->find('first',array('conditions',array('Admin.id'=>$find_detail['UserCollectionReport']['user_id'])));
		$find_detail['UserCollectionReport']['admin_name'] = $admin_name['Admin']['name'];
		$this->set('find_detail',$find_detail);
	}
	
	function admin_user_collection_deposit_list()
	{
		$user_id = $this->Session->read('Admin.id');
		$this->paginate = array('UserCollectionReport' => array('limit' =>'20','order'=>array('UserCollectionReport.submit_date'=>'DESC'),'conditions'=>array('UserCollectionReport.user_id'=>$user_id)));
		$all_stats=$this->paginate('UserCollectionReport');
		$k = 0;
		foreach($all_stats as $key => $val)
		{
			$get_admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$user_id)));
			$all_stats[$k]['UserCollectionReport']['admin_name'] = $get_admin_name['Admin']['name'];
			$k++;
		}
			
						
					
				
		$this->set('all_stats',$all_stats);
	}
	
	function admin_all_deposit_list()
	{
		$get_all_user = $this->Admin->find('all');
		$this->set('get_all_user',$get_all_user);
		
		if(isset($this->params['named']['fromdate']) && $this->params['named']['fromdate']!='')
		{
			$this->data['SalesReport']['from_date'] = $this->params['named']['fromdate'];
			$options['fromdate'] = $this->params['named']['fromdate'];
		}
		if(isset($this->params['named']['todate']) && $this->params['named']['todate']!='')
		{
			$this->data['SalesReport']['to_date'] = $this->params['named']['todate'];
			$options['todate'] = $this->params['named']['todate'];
		}
		if(isset($this->params['named']['user']) && $this->params['named']['user']!='')
		{
			$this->data['SalesReport']['admin_list_id'] = $this->params['named']['user'];
			$options['user'] = $this->params['named']['user'];
		}
		
		if(!empty($this->data))
		{
			$fromdate = $this->data['SalesReport']['from_date'];
			$todate = $this->data['SalesReport']['to_date'];
			$user_id = $this->data['SalesReport']['admin_list_id'];
			
			if(!empty($fromdate) && !empty($todate))
			{
				if($fromdate == $todate)
				{
					$conditions['UserCollectionReport.report_date'] = date('Y-m-d 00:00:00',strtotime($fromdate));
					$options['fromdate'] = $fromdate;
				}
				else
				{
					if(!empty($fromdate) && $fromdate != '')
					{
						$conditions['UserCollectionReport.report_date >='] = date('Y-m-d 00:00:00',strtotime($fromdate));
						$options['fromdate'] = $fromdate;
					}
					if(!empty($todate) && $todate != '')
					{
						$conditions['UserCollectionReport.report_date <='] = date('Y-m-d 00:00:00',strtotime($todate));
						$options['todate'] = $todate;
					}
				}
			}
			if(!empty($user_id) && $user_id != '')
			{
				$conditions['UserCollectionReport.user_id'] = $user_id;
				$options['user'] = $user_id;
			}
			$this->paginate = array('UserCollectionReport' => array('limit' =>'20','order'=>array('UserCollectionReport.submit_date'=>'DESC'),'conditions'=>$conditions));
			$all_stats=$this->paginate('UserCollectionReport');
			$k = 0;
			foreach($all_stats as $key => $val)
			{
				$get_admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$val['UserCollectionReport']['user_id'])));
				$all_stats[$k]['UserCollectionReport']['admin_name'] = $get_admin_name['Admin']['name'];
				$k++;
			}
			foreach($all_stats as $all_key => $all_val)
			{
				$total_amt = ($all_val['UserCollectionReport']['upper_total_amount']+$total_amt);
				$total_cash_amt = ($all_val['UserCollectionReport']['upper_cash_amount']+$total_cash_amt);
				$total_cheque_amt = ($all_val['UserCollectionReport']['upper_cheque_amount']+$total_cheque_amt);
				$total_credit_amt = ($all_val['UserCollectionReport']['upper_credit_card_amount']+$total_credit_amt);
				$total_adjustment = ($all_val['UserCollectionReport']['adjustment_amount']+$total_adjustment);
				$total_cash_deposit = ($all_val['UserCollectionReport']['total_cash']+$total_cash_deposit);
				$total_cheque_deposit = ($all_val['UserCollectionReport']['total_cheque']+$total_cheque_deposit);
				$total_credit_deposit = ($all_val['UserCollectionReport']['total_credit_card']+$total_credit_deposit);
				$total_amt_deposit = ($all_val['UserCollectionReport']['total_deposit']+$total_amt_deposit);
				$total_variant = ($all_val['UserCollectionReport']['total_variation']+$total_variant);
			}
			$this->set('total_amt',$total_amt);
			$this->set('total_cash_amt',$total_cash_amt);
			$this->set('total_cheque_amt',$total_cheque_amt);
			$this->set('total_credit_amt',$total_credit_amt);
			$this->set('total_adjustment',$total_adjustment);
			$this->set('total_cash_deposit',$total_cash_deposit);
			$this->set('total_cheque_deposit',$total_cheque_deposit);
			$this->set('total_credit_deposit',$total_credit_deposit);
			$this->set('total_amt_deposit',$total_amt_deposit);
			$this->set('total_variant',$total_variant);
			$this->set('all_stats',$all_stats);
			$this->set('select_user',$user_id);
		}
		else
		{
			$this->paginate = array('UserCollectionReport' => array('limit' =>'20','order'=>array('UserCollectionReport.submit_date'=>'DESC')));
			$all_stats=$this->paginate('UserCollectionReport');
			$k = 0;
			foreach($all_stats as $key => $val)
			{
				$get_admin_name = $this->Admin->find('first',array('conditions'=>array('Admin.id'=>$val['UserCollectionReport']['user_id'])));
				$all_stats[$k]['UserCollectionReport']['admin_name'] = $get_admin_name['Admin']['name'];
				$k++;
			}
			
			$total_amt = 0;
			$total_cash_amt = 0;
			$total_cheque_amt = 0;
			$total_credit_amt = 0;
			$total_adjustment = 0;
			$total_cash_deposit = 0;
			$total_cheque_deposit = 0;
			$total_credit_deposit = 0;
			$total_amt_deposit = 0;
			$total_variant = 0;
			
			foreach($all_stats as $all_key => $all_val)
			{
				$total_amt = ($all_val['UserCollectionReport']['upper_total_amount']+$total_amt);
				$total_cash_amt = ($all_val['UserCollectionReport']['upper_cash_amount']+$total_cash_amt);
				$total_cheque_amt = ($all_val['UserCollectionReport']['upper_cheque_amount']+$total_cheque_amt);
				$total_credit_amt = ($all_val['UserCollectionReport']['upper_credit_card_amount']+$total_credit_amt);
				$total_adjustment = ($all_val['UserCollectionReport']['adjustment_amount']+$total_adjustment);
				$total_cash_deposit = ($all_val['UserCollectionReport']['total_cash']+$total_cash_deposit);
				$total_cheque_deposit = ($all_val['UserCollectionReport']['total_cheque']+$total_cheque_deposit);
				$total_credit_deposit = ($all_val['UserCollectionReport']['total_credit_card']+$total_credit_deposit);
				$total_amt_deposit = ($all_val['UserCollectionReport']['total_deposit']+$total_amt_deposit);
				$total_variant = ($all_val['UserCollectionReport']['total_variation']+$total_variant);
			}
			$this->set('total_amt',$total_amt);
			$this->set('total_cash_amt',$total_cash_amt);
			$this->set('total_cheque_amt',$total_cheque_amt);
			$this->set('total_credit_amt',$total_credit_amt);
			$this->set('total_adjustment',$total_adjustment);
			$this->set('total_cash_deposit',$total_cash_deposit);
			$this->set('total_cheque_deposit',$total_cheque_deposit);
			$this->set('total_credit_deposit',$total_credit_deposit);
			$this->set('total_amt_deposit',$total_amt_deposit);
			$this->set('total_variant',$total_variant);
			$this->set('all_stats',$all_stats);
		}
	}
	
	function admin_product_sale_report()
	{
		$this->set('title_for_layout','Sales Report');
		$admin_u_type = $this->Session->read('Admin.userType');
		$admin_lab_type = $this->Session->read('Admin.labId');
		if(($admin_u_type != 'A') && ($admin_u_type != 'BM') && ($admin_u_type != 'Agent'))
		{
			//echo "<pre>"; print_r($this->Session->read('Admin')); exit;
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.id'=>$admin_lab_type)));
			$this->set('pcc',$pcc);
		}
		else
		{
			$pcc = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
			$this->set('pcc',$pcc);
		}
		
		$login_agent_type = $this->Session->read('Admin.login_agent_type');
		$login_agent_id = $this->Session->read('Admin.id');
		if($login_agent_type == 'Agent')
		{
			$agents = $this->Agent->find('all',array('conditions'=>array('Agent.id'=>$login_agent_id)));
			$this->set('agents',$agents);
		}
		else
		{
			$agents = $this->Agent->find('all',array('conditions'=>array('Agent.status'=>1)));
			$this->set('agents',$agents);
		}
		
		$this->set('login_agent_type',$login_agent_type);
		// To find all tests list
		$allTestLists = $this->Test->find('all', array('conditions'=>array('Test.type'=>'TEST'),'order'=>array('Test.test_parameter ASC')));
		$this->set('allTestLists',$allTestLists);
		if(!empty($this->data))
		{
			if($this->data['ProductReport']['set_option'] == 'filter')
			{
				$from_date = $this->data['ProductReport']['from_date']; 
				$to_date = $this->data['ProductReport']['to_date'];
				$lab_id = $this->data['ProductReport']['pcc_list_id'];
                
				$lab_id1 = $this->data['ProductReport']['pcc_list_id1'];
				$agent_id = $this->data['ProductReport']['agent_list_id'];
				$test_code = $this->data['ProductReport']['test_code'];
                                $test_id = $this->data['ProductReport']['test_list'];
				$profile_code = $this->data['ProductReport']['profile_code'];
				$offer_code = $this->data['ProductReport']['offer_code'];
				$package_code = $this->data['ProductReport']['package_code'];
				$select_option = $this->data['ProductReport']['set_option'];
				
				if(!empty($from_date) && $from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($from_date));
				}
				if(!empty($to_date) && $to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($to_date));
				}
				if(!empty($lab_id) && $lab_id != '')
				{
					$conditions['Health.assigned_lab'] = $lab_id;
				}
                                if(!empty($lab_id1) && $lab_id1 != '')
				{
					$conditions['Health.created_by'] = $lab_id1;
				}
				if(!empty($agent_id) && $agent_id != '')
				{
					$conditions['Health.agent_id'] = $agent_id;
				}
                                if(isset($test_id) && !empty($test_id))
                                {
                                    $conditions['Health.test_id LIKE'] = '%'.$test_id.'%';
                                }
				if(!empty($test_code) && $test_code != '')
				{
					$find_test_code = $this->Test->find('first',array('conditions'=>array('Test.testcode'=>$test_code)));
					$conditions['Health.test_id LIKE'] = '%'.$find_test_code['Test']['id'].'%';
				}
				if(!empty($offer_code) && $offer_code != '')
				{
					$find_offer_code = $this->Banner->find('first',array('conditions'=>array('Banner.banner_code'=>$offer_code)));
					$conditions['Health.offer_id LIKE'] = '%'.$find_offer_code['Banner']['id'].'%';
				}
				if(!empty($package_code) && $package_code != '')
				{
					$find_package_code = $this->Package->find('first',array('conditions'=>array('Package.package_code'=>$package_code)));
					$conditions['Health.package_id LIKE'] = '%'.$find_package_code['Package']['id'].'%';
				}
				$conditions['Health.status'] = 1;
				//print_R($conditions);
				$find_request = $this->Health->find('all',array('conditions'=>$conditions,'order'=>array('Health.s_date ASC')));
				
				$reports = array();
				$k = 0;
				$total_amount = 0;
				$net_amount = 0;
				foreach($find_request as $sl_ky => $sl_vl)
				{
					if(!empty($test_code) || !empty($profile_code) || !empty($offer_code) || !empty($package_code))
					{
						if(!empty($sl_vl['Health']['test_id']))
						{
							$explode_test = explode(',',$sl_vl['Health']['test_id']);
							foreach($explode_test as $test_key => $test_val)
							{
								$test_code_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								if($find_test_code['Test']['id'] == $test_code_name['Test']['id'])
								{
									$total_amount = ($test_code_name['Test']['mrp']+$total_amount);
									$reports[$k]['ProductSales']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
									$reports[$k]['ProductSales']['req_num'] = $requestNum['Billing']['order_id'];
									$reports[$k]['ProductSales']['test_code'] = $test_code_name['Test']['testcode'];
									$reports[$k]['ProductSales']['test_name'] = $test_code_name['Test']['test_parameter'];
									$reports[$k]['ProductSales']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                        $reports[$k]['ProductSales']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
									$reports[$k]['ProductSales']['agent_name'] = $agent_name['Agent']['name'];
									$reports[$k]['ProductSales']['test_amount'] = $test_code_name['Test']['mrp'];
									$reports[$k]['ProductSales']['discount_perc'] = $percentage_discount;
									$reports[$k]['ProductSales']['discount_amount'] = $disc_amount;
									$reports[$k]['ProductSales']['net_payable'] = $requestNum['Billing']['sub_total'];
									$k++;
								}
							}
						}
						
						/*if(!empty($sl_vl['Health']['profile_id']))
						{
							$explode_profile = explode(',',$sl_vl['Health']['profile_id']);
							foreach($explode_profile as $profile_key => $profile_val)
							{
								$profile_code_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								
								if($find_profile_code['Test']['id'] == $profile_code_name['Test']['id'])
								{
									$total_amount = ($profile_code_name['Test']['mrp']+$total_amount);
									$reports[$k]['ProductSales']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
									$reports[$k]['ProductSales']['req_num'] = $requestNum['Billing']['order_id'];
									$reports[$k]['ProductSales']['test_code'] = $profile_code_name['Test']['testcode'];
									$reports[$k]['ProductSales']['test_name'] = $profile_code_name['Test']['test_parameter'];
									$reports[$k]['ProductSales']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
									$reports[$k]['ProductSales']['agent_name'] = $agent_name['Agent']['name'];
									$reports[$k]['ProductSales']['test_amount'] = $profile_code_name['Test']['mrp'];
									$reports[$k]['ProductSales']['discount_perc'] = $percentage_discount;
									$reports[$k]['ProductSales']['discount_amount'] = $disc_amount;
									$reports[$k]['ProductSales']['net_payable'] = $requestNum['Billing']['sub_total'];
									$k++;
								}
							}
						}*/
						
						if(!empty($sl_vl['Health']['offer_id']))
						{
							$explode_offer = explode(',',$sl_vl['Health']['offer_id']);
							foreach($explode_offer as $offer_key => $offer_val)
							{
								$offer_code_name = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								if($find_offer_code['Banner']['id'] == $offer_code_name['Banner']['id'])
								{
									$total_amount = ($offer_code_name['Banner']['banner_mrp']+$total_amount);
									$reports[$k]['ProductSales']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
									$reports[$k]['ProductSales']['req_num'] = $requestNum['Billing']['order_id'];
									$reports[$k]['ProductSales']['test_code'] = $offer_code_name['Banner']['banner_code'];
									$reports[$k]['ProductSales']['test_name'] = $offer_code_name['Banner']['banner_name'];
									$reports[$k]['ProductSales']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                        $reports[$k]['ProductSales']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
									$reports[$k]['ProductSales']['agent_name'] = $agent_name['Agent']['name'];
									$reports[$k]['ProductSales']['test_amount'] = $offer_code_name['Banner']['banner_mrp'];
									$reports[$k]['ProductSales']['discount_perc'] = $percentage_discount;
									$reports[$k]['ProductSales']['discount_amount'] = $disc_amount;
									$reports[$k]['ProductSales']['net_payable'] = $requestNum['Billing']['sub_total'];
									$k++;
								}
							}
						}
						
						if(!empty($sl_vl['Health']['package_id']))
						{
							$package_offer = explode(',',$sl_vl['Health']['package_id']);
							foreach($package_offer as $package_key => $package_val)
							{
								$package_code_name = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								if($find_package_code['Package']['id'] == $package_code_name['Package']['id'])
								{
									$total_amount = ($package_code_name['Package']['package_mrp']+$total_amount);
									$reports[$k]['ProductSales']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
									$reports[$k]['ProductSales']['req_num'] = $requestNum['Billing']['order_id'];
									$reports[$k]['ProductSales']['test_code'] = $package_code_name['Package']['package_code'];
									$reports[$k]['ProductSales']['test_name'] = $package_code_name['Package']['package_name'];
									$reports[$k]['ProductSales']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                        $reports[$k]['ProductSales']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
									$reports[$k]['ProductSales']['agent_name'] = $agent_name['Agent']['name'];
									$reports[$k]['ProductSales']['test_amount'] = $package_code_name['Package']['package_mrp'];
									$reports[$k]['ProductSales']['discount_perc'] = $percentage_discount;
									$reports[$k]['ProductSales']['discount_amount'] = $disc_amount;
									$reports[$k]['ProductSales']['net_payable'] = $requestNum['Billing']['sub_total'];
									$k++;
								}
							}
						}
					}
					else
					{
						if(!empty($sl_vl['Health']['test_id']))
						{
							$explode_test = explode(',',$sl_vl['Health']['test_id']);
							foreach($explode_test as $test_key => $test_val)
							{
								$test_code_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								$total_amount = ($test_code_name['Test']['mrp']+$total_amount);
								$reports[$k]['ProductSales']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
								$reports[$k]['ProductSales']['req_num'] = $requestNum['Billing']['order_id'];
								$reports[$k]['ProductSales']['test_code'] = $test_code_name['Test']['testcode'];
								$reports[$k]['ProductSales']['test_name'] = $test_code_name['Test']['test_parameter'];
								$reports[$k]['ProductSales']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                $reports[$k]['ProductSales']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
								$reports[$k]['ProductSales']['agent_name'] = $agent_name['Agent']['name'];
								$reports[$k]['ProductSales']['test_amount'] = $test_code_name['Test']['mrp'];
								$reports[$k]['ProductSales']['discount_perc'] = $percentage_discount;
								$reports[$k]['ProductSales']['discount_amount'] = $disc_amount;
								$reports[$k]['ProductSales']['net_payable'] = $requestNum['Billing']['sub_total'];
								$k++;
							}
						}
						
						if(!empty($sl_vl['Health']['profile_id']))
						{
							$explode_profile = explode(',',$sl_vl['Health']['profile_id']);
							foreach($explode_profile as $profile_key => $profile_val)
							{
								$profile_code_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								$total_amount = ($profile_code_name['Test']['mrp']+$total_amount);
								$reports[$k]['ProductSales']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
								$reports[$k]['ProductSales']['req_num'] = $requestNum['Billing']['order_id'];
								$reports[$k]['ProductSales']['test_code'] = $profile_code_name['Test']['testcode'];
								$reports[$k]['ProductSales']['test_name'] = $profile_code_name['Test']['test_parameter'];
								$reports[$k]['ProductSales']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                $reports[$k]['ProductSales']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
								$reports[$k]['ProductSales']['agent_name'] = $agent_name['Agent']['name'];
								$reports[$k]['ProductSales']['test_amount'] = $profile_code_name['Test']['mrp'];
								$reports[$k]['ProductSales']['discount_perc'] = $percentage_discount;
								$reports[$k]['ProductSales']['discount_amount'] = $disc_amount;
								$reports[$k]['ProductSales']['net_payable'] = $requestNum['Billing']['sub_total'];
								$k++;
							}
						}
						
						if(!empty($sl_vl['Health']['offer_id']))
						{
							$explode_offer = explode(',',$sl_vl['Health']['offer_id']);
							foreach($explode_offer as $offer_key => $offer_val)
							{
								$offer_code_name = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								$total_amount = ($offer_code_name['Banner']['banner_mrp']+$total_amount);
								$reports[$k]['ProductSales']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
								$reports[$k]['ProductSales']['req_num'] = $requestNum['Billing']['order_id'];
								$reports[$k]['ProductSales']['test_code'] = $offer_code_name['Banner']['banner_code'];
								$reports[$k]['ProductSales']['test_name'] = $offer_code_name['Banner']['banner_name'];
								$reports[$k]['ProductSales']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                $reports[$k]['ProductSales']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
								$reports[$k]['ProductSales']['agent_name'] = $agent_name['Agent']['name'];
								$reports[$k]['ProductSales']['test_amount'] = $offer_code_name['Banner']['banner_mrp'];
								$reports[$k]['ProductSales']['discount_perc'] = $percentage_discount;
								$reports[$k]['ProductSales']['discount_amount'] = $disc_amount;
								$reports[$k]['ProductSales']['net_payable'] = $requestNum['Billing']['sub_total'];
								$k++;
							}
						}
						
						if(!empty($sl_vl['Health']['package_id']))
						{
							$package_offer = explode(',',$sl_vl['Health']['package_id']);
							foreach($package_offer as $package_key => $package_val)
							{
								$package_code_name = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								$total_amount = ($package_code_name['Package']['package_mrp']+$total_amount);
								$reports[$k]['ProductSales']['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
								$reports[$k]['ProductSales']['req_num'] = $requestNum['Billing']['order_id'];
								$reports[$k]['ProductSales']['test_code'] = $package_code_name['Package']['package_code'];
								$reports[$k]['ProductSales']['test_name'] = $package_code_name['Package']['package_name'];
								$reports[$k]['ProductSales']['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                $reports[$k]['ProductSales']['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
								$reports[$k]['ProductSales']['agent_name'] = $agent_name['Agent']['name'];
								$reports[$k]['ProductSales']['test_amount'] = $package_code_name['Package']['package_mrp'];
								$reports[$k]['ProductSales']['discount_perc'] = $percentage_discount;
								$reports[$k]['ProductSales']['discount_amount'] = $disc_amount;
								$reports[$k]['ProductSales']['net_payable'] = $requestNum['Billing']['sub_total'];
								$k++;
							}
						}
					}
					
					$net_amount = ($requestNum['Billing']['sub_total']+$net_amount);
				}
				$this->set('total_request',count($find_request));
				$this->set('reports',$reports);
				$this->set('total_amount',$total_amount);
				$this->set('net_amount',$net_amount);
				$this->set('lab_id',$lab_id);
				$this->set('agent_id',$agent_id);
			}
			
			
			if($this->data['ProductReport']['set_option'] == 'export_excel')
			{
				$from_date = $this->data['ProductReport']['from_date']; 
				$to_date = $this->data['ProductReport']['to_date'];
				$lab_id1 = $this->data['ProductReport']['pcc_list_id1'];
                                $lab_id = $this->data['ProductReport']['pcc_list_id'];
				$agent_id = $this->data['ProductReport']['agent_list_id'];
				$test_code = $this->data['ProductReport']['test_code'];
				$profile_code = $this->data['ProductReport']['profile_code'];
				$offer_code = $this->data['ProductReport']['offer_code'];
				$package_code = $this->data['ProductReport']['package_code'];
				$select_option = $this->data['ProductReport']['set_option'];
				
				if(!empty($from_date) && $from_date != '')
				{
					$conditions['Health.s_date >='] = date('Y-m-d',strtotime($from_date));
				}
				if(!empty($to_date) && $to_date != '')
				{
					$conditions['Health.s_date <='] = date('Y-m-d',strtotime($to_date));
				}
				if(!empty($lab_id) && $lab_id != '')
				{
					$conditions['Health.assigned_lab'] = $lab_id;
				}
                                if(!empty($lab_id1) && $lab_id1 != '')
				{
					$conditions['Health.created_by'] = $lab_id1;
				}
				if(!empty($agent_id) && $agent_id != '')
				{
					$conditions['Health.agent_id'] = $agent_id;
				}
				if(!empty($test_code) && $test_code != '')
				{
					$find_test_code = $this->Test->find('first',array('conditions'=>array('Test.testcode'=>$test_code,'Test.type'=>'TEST')));
					$conditions['Health.test_id LIKE'] = '%'.$find_test_code['Test']['id'].'%';
				}
				if(!empty($profile_code) && $profile_code != '')
				{
					$find_profile_code = $this->Test->find('first',array('conditions'=>array('Test.testcode'=>$profile_code,'Test.type'=>'PROFILE')));
					$conditions['Health.profile_id LIKE'] = '%'.$find_profile_code['Test']['id'].'%';
				}
				if(!empty($offer_code) && $offer_code != '')
				{
					$find_offer_code = $this->Banner->find('first',array('conditions'=>array('Banner.banner_code'=>$offer_code)));
					$conditions['Health.offer_id LIKE'] = '%'.$find_offer_code['Banner']['id'].'%';
				}
				if(!empty($package_code) && $package_code != '')
				{
					$find_package_code = $this->Package->find('first',array('conditions'=>array('Package.package_code'=>$package_code)));
					$conditions['Health.package_id LIKE'] = '%'.$find_package_code['Package']['id'].'%';
				}
				$conditions['Health.status'] = 1;
				$find_request = $this->Health->find('all',array('conditions'=>$conditions,'order'=>array('Health.s_date ASC')));
				
				$reports = array();
				$k = 0;
				$total_amount = 0;
				$net_amount = 0;
				foreach($find_request as $sl_ky => $sl_vl)
				{
					if(!empty($test_code) || !empty($profile_code) || !empty($offer_code) || !empty($package_code))
					{
						if(!empty($sl_vl['Health']['test_id']))
						{
							$explode_test = explode(',',$sl_vl['Health']['test_id']);
							foreach($explode_test as $test_key => $test_val)
							{
								$test_code_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								if($find_test_code['Test']['id'] == $test_code_name['Test']['id'])
								{
									$total_amount = ($test_code_name['Test']['mrp']+$total_amount);
									$reports[$k]['s_no'] = ($k+1);
									$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
									$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
									$reports[$k]['test_code'] = $test_code_name['Test']['testcode'];
									$reports[$k]['test_name'] = $test_code_name['Test']['test_parameter'];
									//$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                        $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                                                                        $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
									$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
									$reports[$k]['test_amount'] = $test_code_name['Test']['mrp'];
									$reports[$k]['discount_perc'] = $percentage_discount;
									$reports[$k]['discount_amount'] = $disc_amount;
									$reports[$k]['net_payable'] = $requestNum['Billing']['sub_total'];
									$k++;
								}
							}
						}
						
						if(!empty($sl_vl['Health']['profile_id']))
						{
							$explode_profile = explode(',',$sl_vl['Health']['profile_id']);
							foreach($explode_profile as $profile_key => $profile_val)
							{
								$profile_code_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								
								if($find_profile_code['Test']['id'] == $profile_code_name['Test']['id'])
								{
									$total_amount = ($profile_code_name['Test']['mrp']+$total_amount);
									$reports[$k]['s_no'] = ($k+1);
									$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
									$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
									$reports[$k]['test_code'] = $profile_code_name['Test']['testcode'];
									$reports[$k]['test_name'] = $profile_code_name['Test']['test_parameter'];
									//$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                        $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                                                                        $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
									$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
									$reports[$k]['test_amount'] = $profile_code_name['Test']['mrp'];
									$reports[$k]['discount_perc'] = $percentage_discount;
									$reports[$k]['discount_amount'] = $disc_amount;
									$reports[$k]['net_payable'] = $requestNum['Billing']['sub_total'];
									$k++;
								}
							}
						}
						
						if(!empty($sl_vl['Health']['offer_id']))
						{
							$explode_offer = explode(',',$sl_vl['Health']['offer_id']);
							foreach($explode_offer as $offer_key => $offer_val)
							{
								$offer_code_name = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								if($find_offer_code['Banner']['id'] == $offer_code_name['Banner']['id'])
								{
									$total_amount = ($offer_code_name['Banner']['banner_mrp']+$total_amount);
									$reports[$k]['s_no'] = ($k+1);
									$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
									$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
									$reports[$k]['test_code'] = $offer_code_name['Banner']['banner_code'];
									$reports[$k]['test_name'] = $offer_code_name['Banner']['banner_name'];
									//$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                        $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                                                                        $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
									$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
									$reports[$k]['test_amount'] = $offer_code_name['Banner']['banner_mrp'];
									$reports[$k]['discount_perc'] = $percentage_discount;
									$reports[$k]['discount_amount'] = $disc_amount;
									$reports[$k]['net_payable'] = $requestNum['Billing']['sub_total'];
									$k++;
								}
							}
						}
						
						if(!empty($sl_vl['Health']['package_id']))
						{
							$package_offer = explode(',',$sl_vl['Health']['package_id']);
							foreach($package_offer as $package_key => $package_val)
							{
								$package_code_name = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								if($find_package_code['Package']['id'] == $package_code_name['Package']['id'])
								{
									$total_amount = ($package_code_name['Package']['package_mrp']+$total_amount);
									$reports[$k]['s_no'] = ($k+1);
									$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
									$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
									$reports[$k]['test_code'] = $package_code_name['Package']['package_code'];
									$reports[$k]['test_name'] = $package_code_name['Package']['package_name'];
									//$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                        $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                                                                        $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
									$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
									$reports[$k]['test_amount'] = $package_code_name['Package']['package_mrp'];
									$reports[$k]['discount_perc'] = $percentage_discount;
									$reports[$k]['discount_amount'] = $disc_amount;
									$reports[$k]['net_payable'] = $requestNum['Billing']['sub_total'];
									$k++;
								}
							}
						}
					}
					else
					{
						if(!empty($sl_vl['Health']['test_id']))
						{
							$explode_test = explode(',',$sl_vl['Health']['test_id']);
							foreach($explode_test as $test_key => $test_val)
							{
								$test_code_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								$total_amount = ($test_code_name['Test']['mrp']+$total_amount);
								$reports[$k]['s_no'] = ($k+1);
								$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
								$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
								$reports[$k]['test_code'] = $test_code_name['Test']['testcode'];
								$reports[$k]['test_name'] = $test_code_name['Test']['test_parameter'];
								//$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                                                                $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
								$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
								$reports[$k]['test_amount'] = $test_code_name['Test']['mrp'];
								$reports[$k]['discount_perc'] = $percentage_discount;
								$reports[$k]['discount_amount'] = $disc_amount;
								$reports[$k]['net_payable'] = $requestNum['Billing']['sub_total'];
								$k++;
							}
						}
						
						if(!empty($sl_vl['Health']['profile_id']))
						{
							$explode_profile = explode(',',$sl_vl['Health']['profile_id']);
							foreach($explode_profile as $profile_key => $profile_val)
							{
								$profile_code_name = $this->Test->find('first',array('conditions'=>array('Test.id'=>$profile_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								$total_amount = ($profile_code_name['Test']['mrp']+$total_amount);
								$reports[$k]['s_no'] = ($k+1);
								$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
								$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
								$reports[$k]['test_code'] = $profile_code_name['Test']['testcode'];
								$reports[$k]['test_name'] = $profile_code_name['Test']['test_parameter'];
								//$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                                                                $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
								$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
								$reports[$k]['test_amount'] = $profile_code_name['Test']['mrp'];
								$reports[$k]['discount_perc'] = $percentage_discount;
								$reports[$k]['discount_amount'] = $disc_amount;
								$reports[$k]['net_payable'] = $requestNum['Billing']['sub_total'];
								$k++;
							}
						}
						
						if(!empty($sl_vl['Health']['offer_id']))
						{
							$explode_offer = explode(',',$sl_vl['Health']['offer_id']);
							foreach($explode_offer as $offer_key => $offer_val)
							{
								$offer_code_name = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								$total_amount = ($offer_code_name['Banner']['banner_mrp']+$total_amount);
								$reports[$k]['s_no'] = ($k+1);
								$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
								$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
								$reports[$k]['test_code'] = $offer_code_name['Banner']['banner_code'];
								$reports[$k]['test_name'] = $offer_code_name['Banner']['banner_name'];
								//$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                                                                $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
								$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
								$reports[$k]['test_amount'] = $offer_code_name['Banner']['banner_mrp'];
								$reports[$k]['discount_perc'] = $percentage_discount;
								$reports[$k]['discount_amount'] = $disc_amount;
								$reports[$k]['net_payable'] = $requestNum['Billing']['sub_total'];
								$k++;
							}
						}
						
						if(!empty($sl_vl['Health']['package_id']))
						{
							$package_offer = explode(',',$sl_vl['Health']['package_id']);
							foreach($package_offer as $package_key => $package_val)
							{
								$package_code_name = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
								$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
                                                                $pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
								$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
								$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
								if($sl_vl['Health']['discount_id'] != 0)
								{
									$get_discount = $this->Discount->find('first',array('conditions'=>array('Discount.id'=>$sl_vl['Health']['discount_id'])));
									if($get_discount['Discount']['type'] == 'Percent'){$percentage_discount = $get_discount['Discount']['amount'].'%';}
									if($get_discount['Discount']['type'] == 'Rupees'){$percentage_discount = $get_discount['Discount']['amount'];}
								}
								else{$percentage_discount = 0;}
								
								if($sl_vl['Health']['discount_amount'] != 0){$disc_amount = $sl_vl['Health']['discount_amount'];}
								else{$disc_amount = 0;}
								$total_amount = ($package_code_name['Package']['package_mrp']+$total_amount);
								$reports[$k]['s_no'] = ($k+1);
								$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['s_date']));
								$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
								$reports[$k]['test_code'] = $package_code_name['Package']['package_code'];
								$reports[$k]['test_name'] = $package_code_name['Package']['package_name'];
								//$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
                                                                $reports[$k]['pcc_name1'] = !empty($pcc_name1['Lab']['pcc_name']) ? $pcc_name1['Lab']['pcc_name'] : 'NPL';
                                                                $reports[$k]['pcc_name'] = !empty($pcc_name['Lab']['pcc_name']) ? $pcc_name['Lab']['pcc_name'] : 'NPL';
								$reports[$k]['agent_name'] = $agent_name['Agent']['name'];
								$reports[$k]['test_amount'] = $package_code_name['Package']['package_mrp'];
								$reports[$k]['discount_perc'] = $percentage_discount;
								$reports[$k]['discount_amount'] = $disc_amount;
								$reports[$k]['net_payable'] = $requestNum['Billing']['sub_total'];
								$k++;
							}
						}
					}
					
					$net_amount = ($requestNum['Billing']['sub_total']+$net_amount);
				}
				
				$p_total_request = count($find_request);
				$p_total_test = count($reports);
				$p_total_amount = $total_amount;
				$p_discount_amount = ($total_amount-$net_amount);
				$p_net_payable = $net_amount;
				
				
				header('Content-Type: text/csv; charset=utf-8');
				header('Content-Disposition: attachment; filename=product_sales_report.csv');
				$output = fopen('php://output', 'w');
				fputcsv($output, array('Total Requests', 'Total Tests','Total Amount','Discount Amount','Net Payable'));
				fputcsv($output, array($p_total_request,$p_total_test,$p_total_amount,$p_discount_amount,$p_net_payable));
				fputcsv($output, array());
				
				fputcsv($output, array('S.No.', 'Date','ReqNo','Test Code','Test Name','Booked By PCC','Service By PCC','Agent Name','Test Amount','Discount %','Discount Amount','Net Payable'));
				foreach ($reports as $keys => $values) 
				{
					fputcsv($output, $values);
				}
				die;
			}
		}
	}
	
	//FUNCTION FOR MIS REPORTS ENDS
	function entry_status()
	{
		$get_all_requests = $this->Health->find('all',array('conditions'=>array('Health.entry_status'=>0),'limit'=>2000));
		//echo "dasdasd<pre>"; print_r($get_all_requests); exit;
		foreach($get_all_requests as $key => $val)
		{
			//echo "<pre>"; print_r($val); exit;
			if(!empty($val['Health']['test_id']))
			{
				$explode_test_ids_db = explode(',',$val['Health']['test_id']);
				foreach($explode_test_ids_db as $k_test_db => $v_test_db)
				{
					$check_test_duplicate = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'TE','RequestTest.health_id'=>$val['Health']['id'],'RequestTest.test_id'=>$v_test_db)));
					if(empty($check_test_duplicate))
					{
						$find_test_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_test_db)));
						$this->data['RequestTest']['type'] = 'TE';
						$this->data['RequestTest']['health_id'] = $val['Health']['id'];
						$this->data['RequestTest']['test_id'] = $v_test_db; 
						$this->data['RequestTest']['mrp'] =$find_test_mrp['Test']['mrp'];
						$this->data['RequestTest']['test_book_date'] = $val['Health']['book_date'];
						$this->data['RequestTest']['status'] = 1;
						
						if($this->RequestTest->create($this->data))
						{
							$this->RequestTest->save($this->data);
						}
					}
				}
			}
			
			if(!empty($val['Health']['profile_id']))
			{
				$explode_profile_ids_db = explode(',',$val['Health']['profile_id']);
				foreach($explode_profile_ids_db as $k_profile_db => $v_profile_db)
				{
					$check_profile_duplicate = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'PR','RequestTest.health_id'=>$val['Health']['id'],'RequestTest.test_id'=>$v_profile_db)));
					if(empty($check_profile_duplicate))
					{
						$find_profile_mrp = $this->Test->find('first',array('conditions'=>array('Test.id'=>$v_profile_db)));
						$this->data['RequestTest']['type'] = 'PR';
						$this->data['RequestTest']['health_id'] = $val['Health']['id'];
						$this->data['RequestTest']['test_id'] = $v_profile_db; 
						$this->data['RequestTest']['mrp'] =$find_profile_mrp['Test']['mrp'];
						$this->data['RequestTest']['test_book_date'] =$val['Health']['book_date'];
						$this->data['RequestTest']['update_test_date'] = '0000-00-00 00:00:00';
						$this->data['RequestTest']['status'] = 1;
						
						if($this->RequestTest->create($this->data))
						{
							$this->RequestTest->save($this->data);
						}
					}
				}
			}
			
			if(!empty($val['Health']['offer_id']))
			{
				$explode_offer_ids_db = explode(',',$val['Health']['offer_id']);
				foreach($explode_offer_ids_db as $k_offer_db => $v_offer_db)
				{
					$check_offer_duplicate = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'OF','RequestTest.health_id'=>$val['Health']['id'],'RequestTest.test_id'=>$v_offer_db)));
					if(empty($check_offer_duplicate))
					{
						$find_offer_mrp = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$v_offer_db)));
						$this->data['RequestTest']['type'] = 'OF';
						$this->data['RequestTest']['health_id'] = $val['Health']['id'];
						$this->data['RequestTest']['test_id'] = $v_offer_db; 
						$this->data['RequestTest']['mrp'] =$find_offer_mrp['Banner']['banner_mrp'];
						$this->data['RequestTest']['test_book_date'] =$val['Health']['book_date'];
						$this->data['RequestTest']['status'] = 1;
						
						if($this->RequestTest->create($this->data))
						{
							$this->RequestTest->save($this->data);
						}
					}
				}
			}
			
			if(!empty($val['Health']['package_id']))
			{
				$explode_package_ids_db = explode(',',$val['Health']['package_id']);
				foreach($explode_package_ids_db as $k_package_db => $v_package_db)
				{
					$check_package_duplicate = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.type'=>'PA','RequestTest.health_id'=>$val['Health']['id'],'RequestTest.test_id'=>$v_package_db)));
					if(empty($check_package_duplicate))
					{
						$find_package_mrp = $this->Package->find('first',array('conditions'=>array('Package.id'=>$v_package_db)));
						$this->data['RequestTest']['type'] = 'PA';
						$this->data['RequestTest']['health_id'] = $val['Health']['id'];
						$this->data['RequestTest']['test_id'] = $v_package_db; 
						$this->data['RequestTest']['mrp'] =$find_package_mrp['Package']['package_mrp'];
						$this->data['RequestTest']['test_book_date'] =$val['Health']['book_date'];
						$this->data['RequestTest']['status'] = 1;
						
						if($this->RequestTest->create($this->data))
						{
							$this->RequestTest->save($this->data);
						}
					}
				}
			}
			$update_entry_status = $this->Health->query("UPDATE healths SET entry_status='1' WHERE id='".$val['Health']['id']."'");
		}
	}
	
	function change_price()
	{
		$select_data = $this->RequestTest->find('all',array('conditions'=>array('RequestTest.type'=>'PA','RequestTest.test_id'=>2,'RequestTest.test_book_date <='=>'2014-03-07 02:30:00')));
		foreach($select_data as $k => $v)
		{
			$update = $this->RequestTest->query("UPDATE request_test SET mrp='1399' WHERE id='".$v['RequestTest']['health_id']."'");
		}
	}
	
	function admin_patient_vital($req_id=NULL)
	{
		if(!empty($this->data))
		{
			//$dd = $this->Session->read('Admin.id');
			//echo "<pre>"; print_r($dd); exit;
			//Code For Inserting BMI value Starts
			if($this->data['Health']['select_bmi_opt'] == 1)
			{
				$pat_weight = $this->data['Health']['pat_weight'];
				$pat_height_feet = $this->data['Health']['pat_height_feet'];
				$pat_height_inch = $this->data['Health']['pat_height_inch'];
			
				$pat_height_feet_in_meter = ($pat_height_feet*0.3048);
				$pat_height_inch_in_meter = ($pat_height_inch*0.0254);
			
				$pat_height_in_meter = ($pat_height_feet_in_meter+$pat_height_inch_in_meter);
			
				$square_of_height_in_meter = ($pat_height_in_meter*$pat_height_in_meter);
				$bmi_of_pat = ($pat_weight/$square_of_height_in_meter);
				
				$this->data['Health']['pat_height_cms'] = 0;
			}
			if($this->data['Health']['select_bmi_opt'] == 2)
			{
				$pat_weight = $this->data['Health']['pat_weight'];
				$pat_height_feet_in_cm = $this->data['Health']['pat_height_cms'];
				
				$pat_height_in_meter = ($pat_height_feet_in_cm*0.01);
				$square_of_height_in_meter = ($pat_height_in_meter*$pat_height_in_meter);
				$bmi_of_pat = ($pat_weight/$square_of_height_in_meter);
				
				$this->data['Health']['pat_height_feet'] = 0;
				$this->data['Health']['pat_height_inch'] = 0;
			}
		
			if($bmi_of_pat < 18.5){$bmi_indicator = 'Underweight';}
			if($bmi_of_pat > 18.5 && $bmi_of_pat < 24.0){$bmi_indicator = 'Healthy';}
			if($bmi_of_pat > 24.0 && $bmi_of_pat < 29.0){$bmi_indicator = 'Overweight';}
			if($bmi_of_pat > 29.0 && $bmi_of_pat < 39.0){$bmi_indicator = 'Obese';}
			if($bmi_of_pat > 39.0){$bmi_indicator = 'Externely Obese';}
			
			if(!empty($this->data['Health']['pat_bp_time_hr']) && !empty($this->data['Health']['pat_bp_time_sec']))
			{
				$time_value = $this->data['Health']['pat_bp_time_hr'].':'.$this->data['Health']['pat_bp_time_sec'];
			}
			else
			{
				$time_value = '00:00';
			}
			
			$this->data['UserBmiBp']['id'] = $this->data['Health']['bmi_id'];
			$this->data['UserBmiBp']['weight'] = $this->data['Health']['pat_weight'];
			$this->data['UserBmiBp']['height_opt'] = $this->data['Health']['select_bmi_opt'];
			$this->data['UserBmiBp']['height_feet'] = $this->data['Health']['pat_height_feet'];
			$this->data['UserBmiBp']['height_inch'] = $this->data['Health']['pat_height_inch'];
			$this->data['UserBmiBp']['height_cm'] = $this->data['Health']['pat_height_cms'];
			$this->data['UserBmiBp']['bmi_value'] = $bmi_of_pat;
			$this->data['UserBmiBp']['bmi_indicator'] = $bmi_indicator;
			$this->data['UserBmiBp']['bp_systolic'] = $this->data['Health']['pat_systolic'];
			$this->data['UserBmiBp']['bp_diastolic'] = $this->data['Health']['pat_diaostolic'];
			$this->data['UserBmiBp']['bp_pulse'] = $this->data['Health']['pat_pulse_rate'];
			$this->data['UserBmiBp']['save_date'] = date('Y-m-d H:i:s',strtotime($this->data['Health']['vital_time']));//date('Y-m-d H:i:s');
			
			if($this->UserBmiBp->create($this->data))
			{
				if($this->UserBmiBp->save($this->data))
				{
					if($this->data['Health']['login_action'] == 'Super')
					{
						$this->redirect('/admin/samples/view_detail/'.$req_id);
					}
				}
			}
			
			//Code For Inserting BMI value Ends
		}
	}
	
	// TO SAVE ACTIVITY LOG INTO activity_log TABLE ON EDIT REQUEST
	function _activity_log($patient , $health, $action)
	{
		// To get page url to track activity
		$page_url = Router::url( $this->here, true );
		$this->ActivityLog = ClassRegistry::init('ActivityLog');
		
		$this->data['ActivityLog']['admin_id'] = $this->Session->read('Admin.id');
		$this->data['ActivityLog']['patient_id'] = $patient;
		$this->data['ActivityLog']['health_id'] = $health;
		$this->data['ActivityLog']['page_url']= $page_url;
		$this->data['ActivityLog']['action']= $action;
		$this->data['ActivityLog']['creation'] = date('Y-m-d H:i:s');
		//print_R($this->data);
		if($this->ActivityLog->create($this->data))
		{
			if($this->ActivityLog->save($this->data))
				return true;
			else
				return false;
		}
	}
	
	
    function confirm_call_status($id=null,$val=null)
    {
        $this->layout="";
        $record_id = explode('_',$id);
        $img="";
        if($val == 0)
        {
            $val =1;
            $img = "call_confirmed.png";
        }
        else
        {
            $val = 0;
            $img= "call_not_confirmed.png";
        }
            
        $this->Health = ClassRegistry::init('Health');
        if($this->Health->updateAll(array('Health.call_confirm_status'=>$val),array('Health.id'=>$record_id[1])))
        {
            echo json_encode(array('status'=>'success','value'=>$val,'img'=>$img));
        }
        $this->render(false);         
    }
		
	function admin_autostl()
	{
		$this->Health = ClassRegistry::init("Health");
		$this->Healthsample = ClassRegistry::init("Healthsample");
		$this->Lab = ClassRegistry::init("Lab");
		$this->Billing = ClassRegistry::init('Billing');
						
		$test = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_POST['id'])));
		$pccDetail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$test['Health']['created_by'])));
		$billingDetails = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$_POST['id'])));
		//print_R($billingDetails);die;
		$data = array(
				"APIKey"=> $pccDetail['Lab']['api_key'],
				"APIUser"=> $pccDetail['Lab']['api_user'],
				"CenterID"=> $pccDetail['Lab']['center_id'],
				"Order_id" => $test['Health']['reference'],
				"MRN_Id" => $test['Health']['medical_reference_number']
			);
		//print_R(json_encode($data));
		$ch = curl_init();
		$curlConfig = array(
			CURLOPT_URL            => "http://lis.niramayapathlabs.com/live/design/jsonreceive/SampleStatus.aspx",
			CURLOPT_POST           => true,
			CURLOPT_RETURNTRANSFER => true,
			CURLOPT_POSTFIELDS     => json_encode($data),
			CURLOPT_HTTPHEADER => array(
				"cache-control: no-cache",
				"content-type: application/json"
			),
		);
		curl_setopt_array($ch, $curlConfig);
		$result = curl_exec($ch);
				if(curl_error($ch))
			{
				print_R(curl_error($ch));die;
			}
		curl_close($ch);
		$resultjson = json_decode($result);
		//print_R("hello there----".$resultjson);die;
		$rowcount = $this->Healthsample->find('count', array('conditions' => array('Healthsample.health_id'=>$_POST['id'])));
		$totalcount=$rowcount;
		$totalrecieved = 0;
		$totalrejected = 0;
		foreach($resultjson->SamplesReceived as $key=>$val)
		{
			//$totalcount++;
			if($val->SampleStatus=='Received' && $val->BarcodeId!=''){
				$status = '1';
				$totalrecieved++;
			}
			if($val->SampleStatus=='Not Done' || $val->SampleStatus=='Pending'){
				$status = '3';
			}
			if($val->SampleStatus=='Reject'){ //&& $val->BarcodeId!=''
				$status = '2';
				$totalrejected++;
			}
			$remark = $val->SampleRemark;
			$sampledatetime = '';
			if(!empty($val->SampleReceivedDateTime))
				$sampledatetime = date('Y-m-d h:i:s',strtotime($val->SampleReceivedDateTime));
			//$this->Healthsample->deleteAll(array('Healthsample.health_id'=>$_POST['id']),false);
			$sampledata = $this->Healthsample->find('first',array('conditions'=>array('Healthsample.health_id'=>$_POST['id'],'OR'=>array('Healthsample.sample_id'=>$val->SampleTypeID,'Healthsample.barcode_id'=>$val->BarcodeId))));
			$sample['Healthsample']['id'] = $sampledata['Healthsample']['id'];
			$sample['Healthsample']['sample_status'] = $status;
			$sample['Healthsample']['sample_remark'] = $remark;
			$sample['Healthsample']['sample_recieved_datetime'] = $sampledatetime;
			$sample['Healthsample']['assigned_barcode_id'] = $val->BarcodeId;
			$sampleresult = $this->Healthsample->save($sample);
		}
		//print_R($totalcount."---------".$totalrecieved."-----".$totalrejected);die;
		$message_from_lab = '';
		if($resultjson->OrderStatus == 'Reject'){
		//if($totalrejected == $totalcount){	
			$test['Health']['requ_status']='11';
			$message_from_lab = 'All Samples rejected kindly contact Lab team for details - '.$sampledatetime;
			$test['Health']['order_sample_status'] = 'Samples Rejected';
		}
		else if($resultjson->OrderStatus == 'Patial Send To Lab'){
		//else if($totalrecieved < $totalcount && $totalrecieved >0){
			$test['Health']['requ_status']='12';
			$message_from_lab = 'One of more samples still pending kindly contact Lab team for details - '.$sampledatetime;
			$test['Health']['order_sample_status'] = 'Patial Send To Lab';
		}
		else if($resultjson->OrderStatus == 'Send To Lab'){
		//else if($totalrecieved == $totalcount){	
			$test['Health']['requ_status']='5';
			$message_from_lab = 'All Samples received & sent for testing - '.$sampledatetime;
			$test['Health']['order_sample_status'] = 'Send To Lab';
		}
		else
			$test['Health']['requ_status']='14';
		
		//$test['Health']['lab_message']=$message_from_lab;
		$test['Health']['remarks']=$message_from_lab;		
		$test['Health']['sent_pathcorp']='1';             
		
		print_R(json_encode($resultjson));
		if($this->Health->save($test))
		{
			if($this->Utility->check_push_notification_for_pcc($test['Health']['created_by'],$test['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($test['Health']['id']);
			}
			$this->_json_data($_POST['id'],date('Y-m-d h:i:s'),"sample status executed successfully",json_encode($data),$result);
			$this->admin_get_sample_data($_POST['id']);
		}
		else {
			$this->_json_data($_POST['id'],date('Y-m-d h:i:s'),"sample status failed",json_encode($data),$result);
			print_R("Failed");
		}
        die;
	}

	function admin_new_booking()
	{
		$this->User = ClassRegistry::init("User");
        $this->Admin = ClassRegistry::init('Admin');
        $agents_booked = $this->Admin->find('list',array('conditions'=>array('Admin.status'=>1)));
        $this->set('agents_booked',$agents_booked);
		$usertype = $this->Session->read('Admin.userType');
		$userlab = $this->Session->read('userlab');
		$this->set('usertype',$usertype);
		$this->set('title_for_layout','Add Sample');
		$login_type = $this->Session->read('Admin.userType');
        	if($login_type == 'A')
		{
			$this->set('LoginType','Super');
		}
		elseif($login_type == 'Agent')
		{
			$this->set('LoginType','Agent');
		}
		elseif($login_type == 'BM')
		{
			$this->set('LoginType','BM');
		}
		else
		{
			$this->set('LoginType','PCC');
		}
		//print_R($login_type);echo "<br>";
				$city = $this->City->find('all',array('conditions'=>array('City.status'=>1)));
		//print_R($city);echo "<br>";
				$state = $this->State->find('all',array('conditions'=>array('State.status'=>1)));
		//print_R($state);echo "<br>";
				$offers = $this->Banner->find('all',array('conditions'=>array('Banner.status'=>1),'order'=>array('Banner.banner_name ASC')));
		//print_R($offers);echo "<br>";
				$tests = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'TEST'),'order'=>array('Test.test_parameter ASC')));
		//print_R($tests);echo "<br>";	//ok
				$profiles = $this->Test->find('all',array('conditions'=>array('Test.status'=>1,'Test.type'=>'PROFILE'),'order'=>array('Test.test_parameter ASC')));
		//print_R($profiles);echo "<br>";
				$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1),'order'=>array('Timelab.sequence ASC')));
		//print_R($timelabs);echo "<br>";
				$users = $this->User->find('all',array('conditions'=>array('User.status'=>1)));
		//print_R($users);echo "<br>";die;
				$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1)));
		//print_R($pcc_list);echo "<br>";
				//$pcc_list = $this->Lab->find('all',array('conditions'=>array('Lab.status'=>1,'Lab.show_to_world'=>1),'order'=>array('Lab.sequence'=>'asc')));
		//die;
		$this->set('pcc_list',$pcc_list);
		$this->set('offers',$offers);
		$this->set('users',$users);
		$this->set('timelabs',$timelabs);
		$this->set('city',$city);
		$this->set('state',$state);
		$this->set('tests',$tests);
		$this->set('profiles',$profiles);
	}
	
	function admin_getcitystate()
	{
		$this->Pincodemaster = ClassRegistry::init("PincodeMaster");
		$pincodeMaster = $this->Pincodemaster->find('first',array('conditions'=>array('PincodeMaster.pincode'=>$_REQUEST['pin'])));
		$localityArray = array();
		//$localityArray['locality'] = array();
		if($pincodeMaster)
		{
			if($pincodeMaster['PincodeMaster']['servicable']==1)
			{
				$localityArray['city'] = $pincodeMaster['PincodeMaster']['city'];
				$localityArray['state'] = $pincodeMaster['PincodeMaster']['state'];
				$localityArray['error'] = "";
			}
			else
			{
				$localityArray['error'] = "Non Servicable Pincode";
			}
		}
		else
		{
			$localityArray['error'] = "Invalid Pincode";
		}
		print_R(json_encode($localityArray));die;
	}
	
	function admin_senttolab()
	{
		//print_R("sen to lab");die;
            //$api_url="http://182.73.179.75";/*lease line*/
			
            $this->Health = ClassRegistry::init("Health");
            $this->User = ClassRegistry::init("User");
            $this->Billing = ClassRegistry::init('Billing');
            $this->Test = ClassRegistry::init('Test');
            $this->Package = ClassRegistry::init('Package');
            $this->Banner = ClassRegistry::init('Banner');
            $this->Healthsample = ClassRegistry::init("Healthsample");
			$health_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_POST['id'])));
			$user_detail = $this->User->find('first',array('conditions'=>array('User.id'=>$health_detail['Health']['user_id'])));
			$test_list = explode(',',$health_detail['Health']['test_id']);
			$profile_list = explode(',',$health_detail['Health']['profile_id']);
			$service_list = explode(',',$health_detail['Health']['service_id']);
			$package_list = explode(',',$health_detail['Health']['package_id']);
			$offer_list = explode(',',$health_detail['Health']['offer_id']);
			$billing_detail = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$health_detail['Health']['id'])));
			$testList = array();
			$sampleList = array();
			$count = 0;
			if(!empty($health_detail['Health']['test_id']))
			{
				foreach($test_list as $key=>$val)
				{
					if($val!='')
					{
                    $test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
                    $testList[$count] = $test_detail['Test']['testcode'];
                    //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                    $count++;
					}
                }
            }
            if(!empty($health_detail['Health']['profile_id']))
            {
                foreach($profile_list as $key=>$val)
                {
					if($val!='')
					{
                    $test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
                    $testList[$count] = $test_detail['Test']['testcode'];
                    //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                    $count++;
					}
				}
			}
			if(!empty($health_detail['Health']['service_id']))
			{
				foreach($service_list as $key=>$val)
				{
					if($val!='')
					{
                    $test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
                    $testList[$count] = $test_detail['Test']['testcode'];
                    //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                    $count++;
					}
				}
			}
			if(!empty($health_detail['Health']['package_id']))
			{
				foreach($package_list as $key=>$val)
				{
					if($val!='')
					{
                    $test_detail = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
                    $testList[$count] = $test_detail['Package']['package_code'];
                    //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                    $count++;
					}
				}
			}
			if(!empty($health_detail['Health']['offer_id']))
			{
				foreach($offer_list as $key=>$val)
				{
					if($val!='')
					{
                    $test_detail = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
                    $testList[$count] = $test_detail['Package']['banner_code'];
                    //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                    $count++;
					}
				}
			}
			$sample_health = $this->Healthsample->find('all',array('conditions'=>array('Healthsample.health_id'=>$health_detail['Health']['id'])));
				
			if(!empty($sample_health))
			{   $count1=0;
				foreach($sample_health as $key=>$val)
				{
					//$sampleList[$count1]['SrlNo'] = $count1+1;
					$sampleList[$count1]['SampleId'] = $val['Healthsample']['sample_id'];
					$sampleList[$count1]['BarcodeId'] = $val['Healthsample']['barcode_id'];
					$count1++;
				}
			}
			$this->Timelab = ClassRegistry::init("Timelab");
			$timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1),'order'=>array('Timelab.sequence ASC')));
			$time=explode('-',$timelabs[$health_detail['Health']['sample_time1']]['Timelab']['name']);
			
			$this->Lab = ClassRegistry::init("Lab");
			$pccDetail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$health_detail['Health']['created_by'])));
			$servicePccDetail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$health_detail['Health']['assigned_lab'])));
			$servicePccDetail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$health_detail['Health']['assigned_lab'])));
			$referred_by = $health_detail['Health']['remark'];
			if(empty($health_detail['Health']['remark']))
				$referred_by = $user_detail['User']['name'];
			$dateTime = explode(" ",$health_detail['Health']['sample_collected_date']);
				$date =  date('d-m-Y',strtotime($dateTime[0]));
				$s_date_new = $dateTime[0];
				$datetime = $dateTime[1];
			$date=date('Y/m/d', strtotime($s_date_new))." ".$datetime;
				$reference = "NPL".$billing_detail['Billing']['order_id'];
				if(!empty($health_detail['Health']['reference']))
					$reference = $health_detail['Health']['reference'];
			$patientTitle = 'Mr.';
            $sex = 'male';
            $isurgent = 0;
            if($health_detail['Health']['is_urgent']=='true')
                $isurgent = 1;
                
            if($health_detail['Health']['gender']=='2')
            {
                $patientTitle = 'Mrs.';
                $sex = 'female';
            }
            $customerId = $health_detail['Health']['user_id'];
            if(!empty($health_detail['Health']['medical_reference_number']))
                $customerId = $health_detail['Health']['medical_reference_number'];
            $comment ='';
            if(!empty($health_detail['Health']['remarks']))
                $comment = $health_detail['Health']['remarks'];
            else
                $comment = $health_detail['Health']['discount_amount_reason'];
            $data = array(
                "APIKey"=> $pccDetail['Lab']['api_key'],
                "APIUser"=> $pccDetail['Lab']['api_user'],
                "Title"=>$patientTitle,
                "PatientName"=> strtoupper($health_detail['Health']['name']),
                "LastName"=> ".",
                "Referredby"=>$referred_by,
                "Sex"=> $sex,
                "Age"=> $health_detail['Health']['age'],
                "MobileNumber"=> $health_detail['Health']['landline'],
                "Address"=> $health_detail['Health']['address']." ".$health_detail['Health']['address1'],
                "PinCode"=> $health_detail['Health']['pincode'],
                "Landmark" => $health_detail['Health']['landmark'],
                "SampleCollectedDate"=> $date,
				"Order_id" => $health_detail['Health']['reference'],
				"MRN_Id" => $health_detail['Health']['medical_reference_number'],
                //"BookingID"=> $billing_detail['Billing']['order_id'],
                //"CustomerID"=> $customerId,
                "CenterID"=>$pccDetail['Lab']['center_id'],
                "PanelID"=>$pccDetail['Lab']['registration_number'],
                "IsUrgent"=>$isurgent,
                "Email"=>$health_detail['Health']['email'],
                "VisitType"=>"1",
                "ServiceBypanel"=>$servicePccDetail['Lab']['registration_number'],
                "Comment"=> $comment." Order Intiated via Nhcare",
                "TestList"=>$testList,
                "Samples"=>$sampleList
            );
			
			$resultArray  = array();
			$resultArray['request'] = json_encode($data);
			//print_R($data);die;
			$ch = curl_init();
			$curlConfig = array(
				CURLOPT_URL            => "http://lis.niramayapathlabs.com/live/design/jsonreceive/Postorder.aspx",
				CURLOPT_POST           => true,
				CURLOPT_RETURNTRANSFER => true,
				CURLOPT_POSTFIELDS     => json_encode($data),
				CURLOPT_HTTPHEADER => array(
					"cache-control: no-cache",
					"content-type: application/json"
				),
			);
			curl_setopt_array($ch, $curlConfig);
			$result = curl_exec($ch);
			curl_close($ch);
			print_R($result);die;
			$resultArray['response'] = json_decode($result);
			$decoded_result = json_decode($result) ;
			if(isset($decoded_result->Labno) && $decoded_result->Labno!=0)
			{
				$this->_json_data($order_val['healths']['id'],date('Y-m-d h:i:s'),"Send to lab executed",json_encode($data),$result);
				$this->_activity_log($health_detail['Health']['user_id'], $health_detail['Health']['id'], 'Order sent to Labmate - Sample');
				$update_query = $this->Health->query("UPDATE healths SET requ_status='14',ref_num='".$decoded_result->Labno."',sent_pathcorp='1',sent_pathcorp_admin='0' ,last_edited='0',last_edited_date='".date('Y-m-d H:i:s')."',netbilling='".$decoded_result->Netbilling."' WHERE id='".$health_detail['Health']['id']."'");
				if($this->Utility->check_push_notification_for_pcc($health_detail['Health']['created_by'],$health_detail['Health']['assigned_lab']) == 1)
				{
					$response = $this->Utility->send_notification($health_detail['Health']['id']);
				}
				$resultArray['status'] = "success";
				$resultArray['id'] = $decoded_result->Labno;
			}
			else
			{
				$this->_json_data($order_val['healths']['id'],date('Y-m-d h:i:s'),"Send to lab failed",json_encode($data),$result);
				$resultArray['status'] = "Failure";
			    $this->_activity_log($health_detail['Health']['user_id'], $health_detail['Health']['id'],$decoded_result);
			}
			echo json_encode($resultArray);
            die;
	}
	
	function _json_data($healthid,$date,$action,$request,$response)
	{
		$this->Jsondata = ClassRegistry::init('Jsondata');
		$this->data['Jsondata']['health_id'] = $healthid;
		$this->data['Jsondata']['date'] = $date;
		$this->data['Jsondata']['action'] = $action;
		$this->data['Jsondata']['request_data']= $request;
		$this->data['Jsondata']['response_data']= $response;
		
		if($this->Jsondata->create($this->data))
		{
			$this->Jsondata->save($this->data);
		}
	}
	
	function admin_sendmailtopcc()
	{
		//print_R($_POST);die;
		$id = $_POST['id'];
		$email = $_POST['email'];
		if(isset($id) && !empty($id))
		{
			$this->RequestTest = ClassRegistry::init('RequestTest');
			$this->RequestTest->updateAll(array('RequestTest.reporting_status'=>1),array('RequestTest.health_id'=>$id));
			
			$test_status = $this->Utility->get_test_completed_status($id);
			
			$this->Health = ClassRegistry::init('Health');
			$this->Health->bindModel(array('belongsTo'=>array(
				'Lab'=>array(
					'className'=>'Lab',
					'foreignKey'=>'created_by'
				)),
				'hasOne'=>array(
					'Billing'=>array(
					'className'=>'Billing',
					'foreignKey'=>'request_id'
				)
			)));
			
			$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$id)));
			$lab_info_booked = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$req_info['Health']['created_by'])));
				
			$header_image='';
			if($lab_info_booked['Lab']['custom_header_status']=='1')
				$header_image = '/files/header/'.$lab_info_booked['Lab']['custom_header'];
			else
				$header_image = '/fpdf/nirAmaya_Report_Header.jpg';
			
			if (strpos($req_info['Health']['patient_report_with_header'], 'http:') !== false || strpos($req_info['Health']['patient_report_with_header'], 'https:') !== false) { 
				file_put_contents("/home2/niramovh/public_html/app/webroot/files/reports/temp/".$req_info['Health']['ref_num'].".pdf",file_get_contents($req_info['Health']['patient_report_with_header']));
				$dec_rep_name = "/home2/niramovh/public_html/app/webroot/files/reports/temp/".$req_info['Health']['ref_num'].".pdf";
			}
			else{
				$dec_rep_name = "/home2/niramovh/public_html/app/webroot/files/reports/".$req_info['Health']['patient_report_with_header'];			
			}
			//				App::import('Vendor', '/fpdf/fpdf');
			//				App::import('Vendor', '/fpdf/fpdi');
			$pdf = new FPDI();
			$pdf->addPage();
			$pagecount = $pdf->setSourceFile($dec_rep_name);
			for ($i=1; $i <= $pagecount; $i++) {
					$tplidx = $pdf->ImportPage($i);
					$pdf->useTemplate($tplidx,0,0,0);
					$pdf->Image('/home2/niramovh/public_html/app/webroot'.$header_image,0,0,$pdf->w,30);
					if($i != $pagecount)
					{
							$pdf->addPage();
					}
			}
			
			$pdf->Output("/home2/niramovh/public_html/app/webroot/report_mail.pdf", "F");
			
			
			/*start of sending email*/
			$mrn='';
			if(isset($req_info['Health']['medical_reference_number']))
				$mrn = $req_info['Health']['medical_reference_number'];
			$email_stage = 'complete';
			
			$mail = new PHPMailer(); // create a new object
			//				print_R(json_encode($mail));die;
			$mail->IsSMTP(); // enable SMTP
			$mail->SMTPDebug = 1; // debugging: 1 = errors and messages, 2 = messages only
			$mail->SMTPAuth = true; // authentication enabled
			$mail->SMTPSecure = 'ssl'; // secure transfer enabled REQUIRED for Gmail
			$mail->Host = "smtp.gmail.com";
			$mail->Port = 465; // or 587
			$mail->IsHTML(true);
			$mail->setFrom('lab.reports@niramayapathlabs.com', 'NirAmaya PathLabs');
			$mail->addAddress($email, $req_info['Health']['name']);
			$mail->Username = 'lab.reports@niramayapathlabs.com';
			$mail->Password = 'Lab@Reports';
							//print_R(json_encode($mail));die;
			$mail->Subject = "Complete Report of ".strtoupper($req_info['Health']['name']).' MRN-'.$mrn;
			$mail->addAttachment(WWW_ROOT . 'report_mail.pdf','report.pdf');
			$mail->Body = "<table width='600' border='0' cellspacing='0' cellpadding='0' align='left'>
								<tr>
									<td>
										Dear ".$req_info['Health']['name']."
									</td>
								</tr>
								<tr>
									<td>
										&nbsp;
									</td>
								</tr>
								<tr>
									<td>
										Bill Date: ".date('d M Y',strtotime($req_info['Health']['s_date'])).' T'.date('H:i:s',strtotime($req_info['Health']['book_date']))."
									</td>
								</tr>
								<tr>
									<td>
										Bill Number: ";
										$mail->Body .= 'NPL'.!empty($req_info['Health']['ref_num'])?$req_info['Health']['ref_num'] : $req_info['Billing']['order_id'];
										$mail->Body .="
									</td>
								</tr>
								<tr>
									<td>
										&nbsp;
									</td>
								</tr>
								<tr>
								<td>
									Completed Tests:
									<ul style='list-style:none; margin:0px; padding:0px;'>";
									 
										$pending_test_count = 0;
										foreach($test_status as $key=>$value)
										{
											if($value['reporting_status'] == 1)
											{
												$mail->Body .= "<li style='margin:0px;'>*".$value['test_name']."</li>";
											}
											else
											{
												$pending_test_count++;
											}
										}
									$mail->Body .="
									</ul>
								</td>
							</tr>
							<tr>
								<td>
									&nbsp;
								</td>
							</tr>
							<tr>
								<td>";
									$mail->Body .= "Pending Tests: <br/>";
									if($pending_test_count == 0){
									$mail->Body .= "*No Pending Tests.";
									} else {
									$mail->Body .= "<ul style='list-style:none; margin:0px; padding:0px;'>";
									
										foreach($test_status as $key=>$value)
										{
											if($value['reporting_status'] == 0)
											{
												$mail->Body .= "<li style='margin:0px;'>*".$value['test_name']."</li>";
											}
										}
									
									$mail->Body .= "</ul>";
									 }
								$mail->Body .= "</td>
							</tr>
							<tr>
								<td>
									&nbsp;
								</td>
							</tr>
							
							<tr>
								<td>
									Thank you for choosing NirAmaya PathLabs. 
									<br/>
									<br/>
									"; 
									if(!empty($req_info['Health']['partial_reason']) && $email_stage =='partial'){
										$mail->Body .= "Note:- ".$req_info['Health']['partial_reason'];
									}
									
									$mail->Body .= "<br/>
									Please do not reply to this message. Replies to this message are routed to an unmonitored mailbox.
									<br/>
									kindly write back to helpline@niramayapathlabs.com or You may also call us at +91-7042191851
									<br/><br/>
									Best Regards,
									<br/>
									Lab Director
									<br/>
									Niramaya Pathlabs
								</td>
							</tr>
						</table>
							";
			/*$mail->SMTPAuth = true;
			$mail->SMTPSecure = 'tls';
			$mail->Port = 587;*/
			$mail->isHTML(true);
			print_R($mail->send());die;
		}
	}
	
	function admin_reportupdate()
	{
		$report_status = array();
		//print_R(json_encode($_POST));die;
		$this->Health = ClassRegistry::init('Health');
		$this->Lab = ClassRegistry::init("Lab");
		$this->Healthlabmateresponse = ClassRegistry::init('Healthlabmateresponse');
		$data = $this->Health->find('all',array('conditions'=>array('Health.id'=>$_POST['id'])));
		
		//print_R(JSON_ENCODE($data));die;
		if(count($data))
		{
			$success_count=0;
			$failure_count=0;
			foreach($data as $key=>$value)
			{
				//print_R($value);die;
				$pccDetail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$value['Health']['created_by'])));
				$api_url="http://lis.niramayapathlabs.com/live/design/jsonreceive/RequestStatus.aspx";
				//print_R($pccDetail);die;
				$data = array(
					"APIKey"=> $pccDetail['Lab']['api_key'],
					"APIUser"=> $pccDetail['Lab']['api_user'],
					"Panel_ID" => $pccDetail['Lab']['registration_number'],
					"Centre_ID"=> $pccDetail['Lab']['center_id'],
					"Order_id" => $value['Health']['reference'],
					"MRN_Id" => $value['Health']['medical_reference_number']
				);
				$ch = curl_init();
				$curlConfig = array(
					CURLOPT_URL            => $api_url,
					CURLOPT_POST           => true,
					CURLOPT_RETURNTRANSFER => true,
					CURLOPT_POSTFIELDS     => json_encode($data),
					CURLOPT_HTTPHEADER => array(
						"cache-control: no-cache",
						"content-type: application/json"
					),
				);
				 curl_setopt_array($ch, $curlConfig);
				$result = curl_exec($ch);
				$api_result = json_decode($result);
				//print_R($result);
				if($api_result->CurrentStatus == 'Completed')
				{
					$this->_json_data($value['Health']['id'],date('Y-m-d h:i:s'),"Full Report Mail executed",json_encode($data),$result);
					$this->Health->updateAll(array('Health.patient_report'=>"'".$api_result->ReportLink."'",'Health.requ_status'=>6,'Health.report_type'=>"'".'full'."'",'Health.last_edited'=>0,'Health.last_edited_date'=>"'".date('Y-m-d H:i:s')."'"),array('Health.id'=>$value['Health']['id']));
					
					if($this->Utility->check_push_notification_for_pcc($value['Health']['created_by'],$value['Health']['assigned_lab']) == 1)
					{
						$response = $this->Utility->send_notification($value['Health']['id']);
					}
					
					$this->Healthlabmateresponse->create();
					$this->data1['Healthlabmateresponse']['health_id'] = $value['Health']['id'];
					$this->data1['Healthlabmateresponse']['json_data'] = json_encode($api_result);
					$this->Healthlabmateresponse->save($this->data1);
					
					//$this->_auto_report_upload_notify($value['Health']['id']);
					//$this->_send_report_to_booked_pcc($value['Health']['id']);
					//print_R(json_encode(array('id'=>'test')));die;
				$call_health_api = $this->Utility->trigger_callhealth_results($value['Health']['id']);
					//$this->_activity_log($value['Health']['user_id'],$value['Health']['id'],'Updating patient report');
					//$this->_activity_log($value['Health']['user_id'], $value['Health']['id'], $call_health_api.'------- report mail sent');
					$report_status['status'] = 'success';
					$report_status['report'] = 'complete';
					$report_status['json'] = json_encode($api_result);
				}
				elseif($api_result->CurrentStatus=='Partial')
				{
					$this->_json_data($value['Health']['id'],date('Y-m-d h:i:s'),"Partial Report Mail executed",json_encode($data),$result);
					$this->Health->updateAll(array('Health.patient_report'=>"'".$api_result->ReportLink."'",'Health.requ_status'=>7,'Health.report_type'=>"'".'partial'."'",'Health.last_edited'=>0,'Health.last_edited_date'=>"'".date('Y-m-d H:i:s')."'"),array('Health.id'=>$value['Health']['id']));
					
					if($this->Utility->check_push_notification_for_pcc($value['Health']['created_by'],$value['Health']['assigned_lab']) == 1)
					{
						$response = $this->Utility->send_notification($value['Health']['id']);
					}
					
					$report_status['status'] = 'success';
					$report_status['report'] = 'partial';
				}
				else{
					$this->_json_data($value['Health']['id'],date('Y-m-d h:i:s'),"Report Mail Failure",json_encode($data),$result);
					$report_status['status'] = 'failed';	
				}
				print_R(json_encode($report_status));
			}
		   curl_close($ch);
		}
		die;
		$this->render(false);
		unlink('error_log');
		exit;
	}	
	
	function admin_ticketsubmit()
	{
		$this->Health = ClassRegistry::init('Health');
		$this->Ticket = ClassRegistry::init('Ticket');
		$this->TicketTracking = ClassRegistry::init('TicketTracking');
		//$this->Ticket->create();
		//print_R(json_encode($this->data));die;

		$healthdata = $this->Health->find('first',array('conditions'=>array('Health.id'=>$this->data['Health']['id'])));

		$ticket = array();

		$ticket['ticket_id'] = "T-".strtotime(date('Y-m-d H:i:s'));
		$ticket['category'] = $_POST['data']['Ticket']['category'];
		$ticket['priority'] = $_POST['data']['Ticket']['priority'];
		$ticket['date'] = date('Y-m-d h:i:s');
		$ticket['last_edited'] = date('Y-m-d h:i:s');
		$ticket['title'] = $_POST['data']['Ticket']['tickettitle'];
		$ticket['description'] = $_POST['data']['Ticket']['description'];
		$ticket['request_id'] = $_POST['data']['Health']['id'];
		$ticket['lab_no'] = $healthdata['Health']['ref_num'];
		$ticket['email'] = $_POST['data']['Ticket']['email'];
		$ticket['phone'] = $_POST['data']['Ticket']['phone'];
		$ticket['concern_raised'] = $_POST['data']['Ticket']['concern_raised'];
		$ticket['assigned_to'] = "296";
		$ticket['created_by'] = $this->Session->read('Admin.id');
		$ticket['status'] = 1;
		
		if($this->Ticket->save($ticket)){
			$last_ticket_id = $this->Ticket->getLastInsertId();
			$tickettracking['assigned_to'] = "296";
			$tickettracking['date'] = date('Y-m-d h:i:s');
			$tickettracking['ticket_id'] = $last_ticket_id;
			$tickettracking['description'] = $_POST['data']['Ticket']['description'];
			$$tickettracking['img_url'] = "";
			if(!empty($this->data['Ticket']['image_upload']))
			{
				$hfile = $this->File->uploadFile($this->data['Ticket']['image_upload'], PATIENT_TICKET_STORE_PATH, true,array('jpg','jpe','jpeg','gif','png','JPG','JPE','JPEG','GIF','PNG','PDF','pdf'));
				$tickettracking['img_url'] = $hfile['name'];
				
				//print_R(json_encode($hfile));
			}
			//$tickettracking['description'] = $_POST['data']['Ticket']['description'];
			
			//print_R(json_encode("success"));die;
			if($this->TicketTracking->save($tickettracking)){
				$this->Session->setFlash('Ticket has been raised.','flash_success');                            
				if(!empty($this->data['Health']['login_agent']) && $this->data['Health']['login_agent'] == 'Super')
				{
					$this->redirect(array('controller'=>'samples','action'=>'view_detail',base64_encode($this->data['Health']['id'])));
				}
				else
				{
					$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',base64_encode($this->data['Health']['id'])));
				}
			}
		}
		else {
			$this->Session->setFlash('unable to raise Ticket.','flash_failure');                            
		}
	}
	
	function admin_save_plab()
	{
		//print_R($_POST);die;
		$this->Health = ClassRegistry::init('Health');
		$this->Health->query('update healths set processing_lab="'.$_POST['labid'].'" where id="'.$_POST['health_id'].'"');
		die;
	}
	
	function admin_send_on_sms()
	{
		$this->Health = ClassRegistry::init('Health');
		$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_POST['health_id'])));
		
		$number = $req_info['Health']['landline'];
		
		$dec_rep_name = "";
		
		if (strpos($req_info['Health']['patient_report_with_header'], 'http:') !== false || strpos($req_info['Health']['patient_report_with_header'], 'https:') !== false) { 
			file_put_contents("/home2/niramovh/public_html/app/webroot/files/reports/temp/".$req_info['Health']['ref_num'].".pdf",file_get_contents($req_info['Health']['patient_report_with_header']));
			$dec_rep_name = "https://www.niramayahealthcare.com/files/reports/temp/".$req_info['Health']['ref_num'].".pdf";
		}
		else{
			$dec_rep_name = "https://www.niramayahealthcare.com/files/reports/".$req_info['Health']['patient_report_with_header'];			
		}
		
		$new_url = $this->get_tiny_url($dec_rep_name);

		$balance = $req_info['Health']['total_amount'] - $req_info['Health']['received_amount'];
		//print_R($req_info['Health']['total_amount'] - $req_info['Health']['received_amount']);die;

        $smsmessage='Dear '.$req_info['Health']['name'].' Your test report is available at '.$new_url;

		$messageurl =  urlencode($smsmessage);

		if($balance <= 0)
		{
			$url_sms='http://103.233.79.246//submitsms.jsp?user=nirAmaya&key=e2ceeba388XX&mobile='.$_POST['phone'].'&message='.$messageurl.'&senderid=NHCare&accusage=1';

			$ch_sms = curl_init();
			curl_setopt($ch_sms, CURLOPT_URL, $url_sms);
			curl_setopt($ch_sms, CURLOPT_FOLLOWLOCATION, TRUE);
			curl_setopt($ch_sms, CURLOPT_MAXREDIRS, 3);
			curl_setopt($ch_sms, CURLOPT_RETURNTRANSFER, TRUE);
			$result = curl_exec($ch_sms);
			print_R($result);
		}
		else
		{
			echo "Balance Due";
		}
		die;
	}

	function admin_send_on_whatsapp()
	{
		$this->Health = ClassRegistry::init('Health');
		$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_POST['health_id'])));
		
		$number = $req_info['Health']['landline'];
		
		$dec_rep_name = "";
		
		if (strpos($req_info['Health']['patient_report_with_header'], 'http:') !== false || strpos($req_info['Health']['patient_report_with_header'], 'https:') !== false) { 
			file_put_contents("/home2/niramovh/public_html/app/webroot/files/reports/temp/".$req_info['Health']['ref_num'].".pdf",file_get_contents($req_info['Health']['patient_report_with_header']));
			$dec_rep_name = "https://www.niramayahealthcare.com/files/reports/temp/".$req_info['Health']['ref_num'].".pdf";
		}
		else{
			$dec_rep_name = "https://www.niramayahealthcare.com/files/reports/".$req_info['Health']['patient_report_with_header'];			
		}
		
		$balance = $req_info['Health']['total_amount'] - $req_info['Health']['received_amount'];
		//print_R($req_info['Health']['total_amount'] - $req_info['Health']['received_amount']);die;
		if($balance <= 0)
		{
			$ch = curl_init();
			$curlConfig = array(
				CURLOPT_URL => "https://www.wtsapi.com/api/sendQuickMsg?token=ef6e126a849b23e7257f12593c076b3c66b602fe30b26c61af&phone=91".$_POST['phone']."&type=pdf&link=".$dec_rep_name,
				CURLOPT_RETURNTRANSFER => true,
				CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
				CURLOPT_HTTPHEADER => array(
					"content-type: application/json",
					"cache-control: no-cache"
				),
			);
			 curl_setopt_array($ch, $curlConfig);
			$result = curl_exec($ch);
			//print_R($result);die;
			curl_close($ch);
			//$balance
		}
			
		print_R($number);
		die;
	}
	
	function admin_specimen_save()	{		
		$this->Health = ClassRegistry::init('Health');	
		$health = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_POST['data']['Health']['id'])));
		$this->Health->query('update healths set requ_status="16" ,specimen_date="'.date('Y-m-d',(strtotime($_POST['data']['Health']['specimen_date']))).'",specimen_time="'.$_POST['data']['Health']['specimen_time'].'",specimen_by="'.$_POST['data']['Health']['specimen_by'].'",specimen_remarks="'.$_POST['data']['Health']['specimen_remarks'].'" where id="'.$_POST['data']['Health']['id'].'"');				
		
		if($this->Utility->check_push_notification_for_pcc($health['Health']['created_by'],$health['Health']['assigned_lab']) == 1)
		{
			$response = $this->Utility->send_notification($health['Health']['id']);
		}
		
		$this->Session->setFlash('Specimen Detail has been Submitted.','flash_success'); 		
		$entry = $this->_activity_log($health['Health']['user_id'], $_POST['data']['Health']['id'],'Specimen Detail Submitted');	
		//print_R($entry);die;
		if(!empty($this->data['Health']['login_agent']) && $this->data['Health']['login_agent'] == 'Super')		
		{			
			$this->redirect(array('controller'=>'samples','action'=>'view_detail',base64_encode($this->data['Health']['id'])));		
		}		
		else
		{
			$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',base64_encode($this->data['Health']['id'])));
		}
	}
	
	function admin_assign_agent_lab()
	{
		if($_REQUEST['lab'] != 'Home')
		{
			$lab_value = $_REQUEST['lab'];
		}
		else
		{
			$lab_value = 'Home';
		}
		$id = $_REQUEST['id'];
		$update = $this->Agent->query("UPDATE agents SET assigned_lab='$lab_value' WHERE id='".$id."'");
		exit;
	}
	
	function admin_assign_agent_role()
	{
		$lab_value = $_REQUEST['agent'];
		$id = $_REQUEST['id'];
		$update = $this->Agent->query("UPDATE agents SET role ='$lab_value' WHERE id='".$id."'");
		exit;
	}
	
	function admin_assign_lab_rate()
	{
		$rate_value = $_REQUEST['rate'];
		$id = $_REQUEST['id'];
		$update = $this->Lab->query("UPDATE labs SET ratelist ='$rate_value' WHERE id='".$id."'");
		exit;
	}
	
	function admin_assign_lab_type()
	{
		$type_value = $_REQUEST['type'];
		$id = $_REQUEST['id'];
		$update = $this->Lab->query("UPDATE labs SET pcc_type ='$type_value' WHERE id='".$id."'");
		exit;
	}
	
	function admin_confirm_booking($reqId=null)
	{
		$req_id = base64_decode($reqId);
		$dd = $this->Session->read('Admin.id');
		$this->ConfirmBooking = ClassRegistry::init('ConfirmBooking');
		$this->ConfirmBooking->create();
		$this->data['ConfirmBooking']['health_id'] =$req_id;
		$this->data['ConfirmBooking']['user_id'] =$dd;
		$this->data['ConfirmBooking']['created_on'] =date('Y-m-d h:i:s');
		
		$this->Billing = ClassRegistry::init('Billing');	
		$billing_data = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$req_id)));
			
		$this->ConfirmBooking->create();
		if($this->ConfirmBooking->save($this->data))
		{
			$this->Health = ClassRegistry::init('Health');	
			$this->Health->query('update healths set requ_status="18"  where id="'.$req_id.'"');
			
			$health = $this->Health->find('first',array('conditions'=>array('Health.id'=>$req_id)));
			
			if($this->Utility->check_push_notification_for_pcc($health['Health']['created_by'],$health['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($health['Health']['id']);
			}
			
			$this->Session->setFlash('Order No- '.$billing_data['Billing']['order_id'].' Updated Successfully','flash_success');
			$this->redirect(array('controller'=>'samples','action'=>'index'));
		}
		else
		{
			$this->Session->setFlash('Order No- '.$billing_data['Billing']['order_id'].' Updation Failed','flash_failure');
			$this->redirect(array('controller'=>'samples','action'=>'index'));
		}
		print_R($_POST);die;
	}
	
	function admin_get_agent_detail()
	{
		$id = $_REQUEST['id'];
		$this->Health = ClassRegistry::init('Health');
		$this->PhleboConfirmedNotify = ClassRegistry::init('PhleboConfirmedNotify');
		$phlebo_info = $this->PhleboConfirmedNotify->find('first',array('conditions'=>array('PhleboConfirmedNotify.health_id'=>$id)));
		
		if($phlebo_info)
		{
			echo $phlebo_info['PhleboConfirmedNotify']['name']."@@@".$phlebo_info['PhleboConfirmedNotify']['phone'];
		}
		else
		{
			$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$id)));
			//print_R(json_encode($req_info));die;
			$this->Agent = ClassRegistry::init('Agent');
			$agentdata = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$req_info['Health']['agent_id'])));
			
			echo $agentdata['Agent']['name']."@@@".$agentdata['Agent']['contact'];
		}
		//print_R(json_encode($agentdata));
		die;
	}
	
	function admin_savephlebodetail()
	{
		$dd = $this->Session->read('Admin.id');
		$this->PhleboConfirmedNotify = ClassRegistry::init('PhleboConfirmedNotify');
		$this->PhleboConfirmedNotify->query('Delete from phlebo_confirmed_notify where health_id='.$_POST['id']);
		
		$phlebo = array();
		$phlebo['health_id'] = $_POST['id'];
		$phlebo['name'] = $_POST['name'];
		$phlebo['phone'] = $_POST['contact'];
		$phlebo['date'] = date('Y-m-d h:i:s');
		
		if($this->PhleboConfirmedNotify->save($phlebo)){
			$this->Health = ClassRegistry::init('Health');
			$this->Health->query('update healths set agent_confirm=1,requ_status=19 where id='.$_POST['id']);//requ_status=19
			$response = $this->Utility->send_notification($_POST['id']);
			$this->_activity_log($dd, $phlebo['health_id'],'Phlebo Confirmed');	
			echo "success@@@".$phlebo['name']."@@@".$phlebo['phone'];
		}
		else
		{
			echo "failure";
		}
		die;
	}
	
	public function send_report()
	{
		$this->PaymentType = ClassRegistry::init('PaymentType');
		$this->Health = ClassRegistry::init('Health');
		$this->Lab = ClassRegistry::init('Lab');
		$this->Agent = ClassRegistry::init('Agent');
		$this->Billing = ClassRegistry::init('Billing');
		$this->RequestTest = ClassRegistry::init('RequestTest');
		$this->Test = ClassRegistry::init('Test');
		$this->Banner = ClassRegistry::init('Banner');
		$this->Package = ClassRegistry::init('Package');
		
		$filter = $_POST['data']['DailyRequestReport'];
		$s_date = $filter['s_date']; 
		$from_date = $filter['from_date']; 
		$to_date = $filter['to_date'];
		$lab_id = $filter['pcc_list_id'];
		$lab_id1 = $filter['pcc_list_id1'];
		$requ_status = $filter['requ_status'];
		
		$payment_type = $this->PaymentType->find('list',array('fields'=>array('PaymentType.id','PaymentType.type')));
		
		$requestStatus = Configure::read('RequestStatus');
		
		if(!empty($s_date) && $s_date != '')
		{
			$conditions['Health.book_date >='] = date('Y-1-1 00:00:00',strtotime($s_date));
			$conditions['Health.book_date <='] = date('Y-m-d 23:59:59',strtotime($s_date));
		}
		else
			$s_date = " ";
		
		/*if(!empty($from_date) && $from_date != '')
		{
			$conditions['Health.s_date >='] = date('Y-m-d',strtotime($from_date));
		}
		if(!empty($to_date) && $to_date != '')
		{
			$conditions['Health.s_date <='] = date('Y-m-d',strtotime($to_date));
		}*/
		
		$lab_list_filter = $this->Lab->find('list',array('fields'=>array('id','pcc_name')));
		
		if(!empty($lab_id) && $lab_id != '')
		{
			$conditions['Health.assigned_lab'] = $lab_id;
		}
		else
			$lab_id=" ";
		
		if(!empty($lab_id1) && $lab_id1 != '')
		{
			$conditions['Health.created_by'] = $lab_id1;
		}
		else
			$lab_id1 = " ";
		
		if(!empty($requ_status) && $requ_status != '')
		{
			$conditions['Health.requ_status'] = $requ_status;
		}
		else
			$requ_status = " ";
		$conditions['Health.status'] = 1;
		//print_R($conditions);die;
		
		$find_request = $this->Health->find('all',array('conditions'=>$conditions,'order'=>'Health.book_date DESC'));
		
		//print_R($find_request);die;
		$reports = array();
		$k = 0;
		$s_no = 1;
		foreach($find_request as $sl_ky => $sl_vl)
		{
			$parameter_count = 0;
			$count_expl_test = 0;
			$count_expl_profile = 0;
			$count_expl_offer = 0;
			$count_expl_package= 0;
			$pcc_name = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['assigned_lab'])));
			$pcc_name1 = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$sl_vl['Health']['created_by'])));
			$agent_name = $this->Agent->find('first',array('conditions'=>array('Agent.id'=>$sl_vl['Health']['agent_id'])));
			$requestNum = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$sl_vl['Health']['id'])));
			
			$test_amt = 0;
			$test_code_arr = array();
			$test_name_arr = array();
			if(!empty($sl_vl['Health']['test_id']))
			{
				$expl_test = explode(',',$sl_vl['Health']['test_id']);
				$cnt_test = 0; 
				foreach($expl_test as $test_key => $test_val)
				{
					if(!empty($test_val))
					{
						$cnt_test++;
					}
					$test_code = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
					$test_code_arr[] = $test_code['Test']['testcode'];
					$test_name_arr[] = $test_code['Test']['test_parameter'];
					$test_amt = ($test_code['Test']['mrp']+$test_amt);
				}
				$count_expl_test = $cnt_test;
			}
			
			if(!empty($sl_vl['Health']['profile_id']))
			{
				$expl_test = explode(',',$sl_vl['Health']['profile_id']);
				$cnt_test = 0; 
				foreach($expl_test as $test_key => $test_val)
				{
					if(!empty($test_val))
					{
						$cnt_test++;
					}
					$test_code = $this->RequestTest->find('first',array('conditions'=>array('RequestTest.health_id'=>$sl_vl['Health']['id'],'RequestTest.test_id'=>$test_val)));
					$test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$test_val)));
					$test_code_arr[] = $test_detail['Test']['testcode'];
					$test_name_arr[] = $test_detail['Test']['test_parameter'];
					$test_amt = ($test_code['RequestTest']['mrp']+$test_amt);
				}
				$count_expl_test = $cnt_test;
			}
			
			if(!empty($sl_vl['Health']['offer_id']))
			{
				$expl_offer = explode(',',$sl_vl['Health']['offer_id']);
				$cnt_offr = 0;
				foreach($expl_offer as $offer_key => $offer_val)
				{
					if(!empty($offer_val))
					{
				$cnt_offr++;
					}
					$offer_code = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$offer_val)));
					$test_code_arr[] = $offer_code['Banner']['banner_code'];
					$test_name_arr[] = $offer_code['Banner']['banner_name'];
					$test_amt = ($offer_code['Banner']['banner_mrp']+$test_amt);
				}
				$count_expl_offer = count($cnt_offr);
			}
			
			if(!empty($sl_vl['Health']['package_id']))
			{
				$expl_package = explode(',',$sl_vl['Health']['package_id']);
				$cnt_pck = 0;
				foreach($expl_package as $package_key => $package_val)
				{
					if(!empty($package_val))
					{
						$cnt_pck++;
					}
					$package_code = $this->Package->find('first',array('conditions'=>array('Package.id'=>$package_val)));
					$test_code_arr[] = $package_code['Package']['package_code'];
					$test_name_arr[] = $package_code['Package']['package_name'];
					$test_amt = ($package_code['Package']['package_mrp']+$test_amt);
				}
				$count_expl_package = $cnt_pck;
			}
			
			$parameter_count = ($count_expl_test+$count_expl_profile+$count_expl_offer+$count_expl_package);
			$implode_parameter_code = implode(', ',$test_code_arr);
			$implode_parameter_name = implode(', ',$test_name_arr);
			if($sl_vl['Health']['gender'] == 1)
			{
				$gender = 'M';
			}
			if($sl_vl['Health']['gender'] == 2)
			{
				$gender = 'F';
			}
			if(!empty($sl_vl['Health']['remark']))
			{
				$refer_by = $sl_vl['Health']['remark'];
			}
			else
			{
				$refer_by = 'N/A';
			}
			$reports[$k]['s_no'] = $s_no;
			$reports[$k]['book_date'] = date('d-M-Y',strtotime($sl_vl['Health']['book_date']));
			$reports[$k]['req_num'] = $requestNum['Billing']['order_id'];
			$reports[$k]['reference'] = $sl_vl['Health']['reference'];
			$reports[$k]['medical_reference_number'] = $sl_vl['Health']['medical_reference_number'];
			$reports[$k]['pincode'] = $sl_vl['Health']['pincode'];
			$reports[$k]['sample_collected_date'] = date('d-M-Y',strtotime($sl_vl['Health']['sample_date1']));
			$reports[$k]['sample_collected_time'] = Configure::read('TimeSlot.'.$sl_vl['Health']['sample_time1']);;
			$reports[$k]['pcc_name1'] = $pcc_name1['Lab']['pcc_name'];
			$reports[$k]['pcc_name'] = $pcc_name['Lab']['pcc_name'];
			$reports[$k]['patient_name'] = strtoupper($sl_vl['Health']['name']);
			$reports[$k]['patient_gender'] = $gender."/".$sl_vl['Health']['age'];
			$reports[$k]['parameter_name'] = $implode_parameter_name;
			$reports[$k]['parameter_code'] = $implode_parameter_code;
			if($sl_vl['Health']['cancelled_status'] == 1)
			{ 
				$reports[$k]['net_payble'] = ($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
				$reports[$k]['balance_payment'] = $sl_vl['Health']['balance_amount'];
			}
			else
			{
				$reports[$k]['net_payble'] = ($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount']);
				if($sl_vl['Health']['received_amount']+$sl_vl['Health']['balance_amount'] == 0)
					$reports[$k]['net_payble']=$sl_vl['Health']['total_amount'];
				$reports[$k]['balance_payment'] = $reports[$k]['net_payble']-$sl_vl['Health']['received_amount'];
			}
			$reports[$k]['payment_type'] = $payment_type[$sl_vl['Health']['payment_type']];
			$reports[$k]['amount_collected'] = $sl_vl['Health']['amount_collected'];
			$reports[$k]['amount_to_be_collected'] = $sl_vl['Health']['amount_to_be_collected'];
			$reports[$k]['requ_status'] = $requestStatus[$sl_vl['Health']['requ_status']];
			$reports[$k]['test_ref_num'] = $sl_vl['Health']['ref_num'];
			$s_no++;
			$k++;
		}
		//print_R($reports);die;
		$total_records = $this->Health->find('all',array('conditions'=>$conditions));
		
		$net_pay = 0;
		$net_rec = 0;
		$net_bal = 0;
		$total_test = 0;
		foreach($total_records as $tr_ky => $tr_vl)
		{
			if(!empty($tr_vl['Health']['test_id']))
			{
				$expl_test = explode(',',$tr_vl['Health']['test_id']);
				$cnt_1 = 0;
				foreach($expl_test as $k_1 => $v_1)
				{
					if(!empty($v_1))
					{
				$cnt_1++;
					}
				}
			}
			if(!empty($tr_vl['Health']['profile_id']))
			{
				$expl_prf = explode(',',$tr_vl['Health']['test_id']);
				$cnt_2 = 0;
				foreach($expl_test as $k_2 => $v_2)
				{
					if(!empty($v_2))
					{
				$cnt_2++;
					}
				}
			}
			if(!empty($tr_vl['Health']['offer_id']))
			{
				$expl_offer = explode(',',$tr_vl['Health']['test_id']);
				$cnt_3 = 0;
				foreach($expl_test as $k_3 => $v_3)
				{
					if(!empty($v_3))
					{
				$cnt_3++;
					}
				}
			}
			if(!empty($tr_vl['Health']['package_id']))
			{
				$expl_pck = explode(',',$tr_vl['Health']['test_id']);
				$cnt_4 = 0;
				foreach($expl_test as $k_4 => $v_4)
				{
					if(!empty($v_4))
					{
				$cnt_4++;
					}
				}
			}
			$total_test_now = ($cnt_1+$cnt_2+$cnt_3+$cnt_4);
			$total_test = ($total_test_now+$total_test);
			$net_rec = ($tr_vl['Health']['received_amount']+$net_rec);
			if($tr_vl['Health']['cancelled_status'] == 1)
			{
				$net_bal = ($tr_vl['Health']['balance_amount']+$net_bal);
			}
			else
			{
				$net_pay_amt= ($tr_vl['Health']['received_amount']+$tr_vl['Health']['balance_amount']);
				if($net_pay_amt == 0)
					$net_pay_amt=$tr_vl['Health']['total_amount'];
				$net_bal_amt=$net_pay_amt-$tr_vl['Health']['received_amount'];
				$net_bal = ($net_bal_amt+$net_bal);
			}
			$net_pay = ($net_rec+$net_bal);
		}
		$total_no_records = count($total_records);
		$total_no_test = $total_test;
		$total_net_pay = $net_pay;
		$total_net_rec = $net_rec;
		$total_net_bal = $net_bal;
		
		$output = fopen('/home2/niramovh/public_html/app/webroot/files/daily_reports/request_status_report_'.date('d-m-Y',strtotime($s_date)).'_manual.csv', 'w');
		fputcsv($output, array('Total No. of Requests', 'Total No. of Tests', 'Total Net Payable','Total Received Amount', 'Total Balance Due'));
		fputcsv($output, array($total_no_records,$total_no_test,$total_net_pay,$total_net_rec,$total_net_bal));
		fputcsv($output, array());
		fputcsv($output, array('S.No.', 'Date', 'ReqNo','Reference No','Mrn No.','Pincode','Collection Date','Collection Time','Booked By PCC','Service By PCC','Patient Name' ,'Gender/Age','Test Names','Test Codes','Net Payble(Rs)','Balance Due(Rs)','Payment Type','Amount Collected By Pcc','Amount To Be Collected By NPL','Request Status','Lab Refrence No.'));
		foreach ($reports as $keys => $values) 
		{
			if(($values['fix_discount'] != 'N/A') && ($values['fix_discount'] == '100%'))
			{
				$values['test_amount'] = $values['test_amount'];
				$values['fix_discount'] = $values['fix_discount'];
				$values['disc_amt'] = $values['test_amount'];
				$values['net_payble'] = $values['net_payble'];
			}
			else
			{
				$values['test_amount'] = $values['test_amount'];
				$values['fix_discount'] = $values['fix_discount'];
				$values['disc_amt'] = $values['disc_amt'];
				$values['net_payble'] = $values['net_payble'];
			}
			fputcsv($output, $values);
		}
		$pie_url = $this->get_tiny_url("https://www.niramayahealthcare.com/home/daily_pie_data/".base64_encode($lab_id1)."/".base64_encode($s_date));
		$this->send_daily_report($_POST['email'],'request_status_report_'.date('d-m-Y',strtotime($s_date))."_manual.csv",$pie_url,$s_date);
		die;
	}
	
	function get_tiny_url($url)  {  
		$ch = curl_init();  
		$timeout = 5;  
		curl_setopt($ch,CURLOPT_URL,'https://tinyurl.com/api-create.php?url='.$url);  
		curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);  
		curl_setopt($ch,CURLOPT_CONNECTTIMEOUT,$timeout);  
		$data = curl_exec($ch);  
		curl_close($ch);  
		return $data;  
	}
	
	function send_daily_report($email=null,$filename=null,$pie_url=null,$date=null)
	{
		//$this->Lab = ClassRegistry::init('Lab');
		//$lab_id = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$lab_id)));
		
		$mail = new PHPMailer(); // create a new object
							//print_R($mail);die;
			$mail->IsSMTP(); // enable SMTP
			$mail->SMTPDebug = 1; // debugging: 1 = errors and messages, 2 = messages only
			$mail->SMTPAuth = true; // authentication enabled
			$mail->SMTPSecure = 'ssl'; // secure transfer enabled REQUIRED for Gmail
			$mail->Host = "smtp.gmail.com";
			$mail->Port = 465; // or 587
			$mail->IsHTML(true);
			$mail->setFrom('lab.reports@niramayapathlabs.com', 'NirAmaya PathLabs');
			$mail->addAddress($email, $email);
			$mail->Username = 'lab.reports@niramayapathlabs.com';
			$mail->Password = 'Lab@Reports';
							//print_R(json_encode($mail));die;
			$mail->Subject = "Daily Request Report from ".date('1-m-Y',strtotime($date))." to ".date('d-m-Y',strtotime($date));
			$mail->addAttachment('/home2/niramovh/public_html/app/webroot/files/daily_reports/'.$filename,$filename);
			$mail->Body = "<table width='600' border='0' cellspacing='0' cellpadding='0' align='left'>
								<tr>
									<td>
										Dear User,
									</td>
								</tr>
								<tr>
									<td>
										&nbsp;
									</td>
								</tr>
								<tr>
									<td>
										Visual Representation for the Request Data for this Month from ".date('1-m-Y',strtotime($date))." till - ".date('d-m-Y',strtotime($date))." can be viewed by clicking below link:- 
									</td>
								</tr>
								<tr>
									<td>
										URL - ".$pie_url."
									</td>
								</tr>
								<tr>
									<td>
										&nbsp;
									</td>
								</tr>
							<tr>
								<td>
									&nbsp;
								</td>
							</tr>
							<tr>
								<td>
									&nbsp;
								</td>
							</tr>
							
							<tr>
								<td>
									Thank you for choosing NirAmaya PathLabs. 
									<br/>
									<br/>
									"; 			
							$mail->Body .= "<br/>
									Please do not reply to this message. Replies to this message are routed to an unmonitored mailbox.
									<br/>
									kindly write back to helpline@niramayapathlabs.com or You may also call us at +91-7042191851
									<br/><br/>
									Best Regards,
									<br/>
									Lab Director
									<br/>
									Niramaya Pathlabs
								</td>
							</tr>
						</table>
							";
			$mail->isHTML(true);
			print_R($mail->send());
	}
	
	function admin_reject_request($req_id=NULL)
	{
		$dd = $this->Session->read('Admin.id');
		$this->health = ClassRegistry::init('Health');
		if(!empty($this->data))
		{
			$dec_id = base64_decode($req_id);
			$health = $this->health->find('first',array('conditions'=>array('Health.id'=>$dec_id)));
			
			$this->health->query('update healths set requ_status="23",lab_message="'.$this->data['Health']['lab_message_rej'].'" where id="'.$dec_id.'"');
			$this->_activity_log($health['Health']['user_id'], $health['Health']['id'],'Request submitted for Rejecting Order with message "'.$this->data['Health']['lab_message'].'"');	
			$this->redirect('/admin/samples/view_detail/'.$req_id);
		}
	}
	
	function admin_cxl_request($req_id=NULL)
	{
		$closed_reason = array(
			"1"=>"Customer not available",
			"2"=>"In-correct address",
			"3"=>"Customer refused sample collection",
			"4"=>"Cancelled by Customer",
			"5"=>"Cancelled at customer point",
			"6"=>"Customer is not fasting",
			"7"=>"Phlebo couldn't contact customer",
			"8"=>"Others"
		);
		$dd = $this->Session->read('Admin.id');
		$this->health = ClassRegistry::init('Health');
		
		if(!empty($this->data))
		{
			$dec_id = base64_decode($req_id);
			print_R($this->data);
			$health = $this->health->find('first',array('conditions'=>array('Health.id'=>$dec_id)));
			echo "<br>";
			print_R($closed_reason[$this->data['Health']['closed_reason']]);
			//die;
			$this->health->query('update healths set requ_status="22",lab_message="'.$this->data['Health']['lab_message_cxl'].'" where id="'.$dec_id.'"');
			$this->_activity_log($health['Health']['user_id'], $health['Health']['id'],'Request submitted for Cancellation due to '.$closed_reason[$this->data['Health']['closed_reason']].' with message "'.$this->data['Health']['lab_message'].'"');
			$this->redirect('/admin/samples/view_detail/'.$req_id);
		}
	}
	
	public function admin_lab_pincode($lab_id=null)
	{
		$labId = base64_decode($lab_id);
		App::import('Vendor', 'phpexcel', array('file' => 'PHPExcel.php'));
		//print_R($labId);
		//print_R($_FILES);
		
		$this->LabPincodeServicibility = ClassRegistry::init("LabPincodeServicibility");
		if ($_FILES["file"]["error"] > 0) {
			$this->Session->setFlash('Error Uploading Pincodes to PCC.','flash_failure');  
			$this->redirect('/admin/samples/edit_pcc/'.$lab_id);	
		}
		else
		{
			//echo "<br>in else";
			$this->LabPincodeServicibility->query("Delete from lab_pincode_servicibility where lab_id = ".$labId);
			$hfile = $this->File->uploadFile($_FILES['file'], EXCEL_FILE, true,array('xls','xlsx'));
			$excelReader = PHPExcel_IOFactory::createReaderForFile(EXCEL_FILE.$hfile['name']);
			$excelReader->setReadDataOnly(true);
			$excelObj = $excelReader->load(EXCEL_FILE.$hfile['name']);
			$worksheet = $excelObj->getSheet(0);
			$lastRow = $excelObj->setActiveSheetIndex(0)->getHighestRow();
			$lastColumn = $excelObj->setActiveSheetIndex(0)->getHighestColumn();
			$lastColumn++;
			$sampleCounter = 0;
			for ($row = 2; $row <= $lastRow; $row++) {
				$this->data = $this->LabPincodeServicibility->create();
				//print_R($worksheet->getCell("A".$row)->getFormattedValue());
				//echo "<br>";
				$this->data['LabPincodeServicibility']['pincode'] = $worksheet->getCell("A".$row)->getFormattedValue();
				$this->data['LabPincodeServicibility']['lab_id'] = $labId;
				//print_R($this->data);
				//echo "<br>";
				$this->LabPincodeServicibility->save($this->data);
			}
			//die;
			$this->Session->setFlash('Pincodes Uploaded to PCC.','flash_success');  
			$this->redirect('/admin/samples/edit_pcc/'.$lab_id);	
		}
	}
	
	function admin_get_doc()
	{
		$test = $_REQUEST['tests'];
		$test_array = explode('@',$test);
		
		$html="";
		foreach($test_array as $val)
		{
			$testDetail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
			$doc_list = explode(',',$testDetail['Test']['document_type']);
			$docs = $this->DocumentTypeMaster->query("Select * from document_type_master where id in (".$testDetail['Test']['document_list'].")");
			$doc_array = array();
			foreach($docs as $val1)
			{
				$doc_array[$val1['document_type_master']['id']] = $val1;
			}
		}
		foreach($doc_array as $val) 
		{
			$html .= '<tr><td class="boldText" style="width: 200px;">'.$val['document_type_master']['name'].'</td><td>';
			$type = "";
			$length = !empty($val['document_type_master']['length'])? $val['document_type_master']['length']:"";
			$accept="";
			if($val['document_type_master']['doc_type']=="doc")
			{
				$html .= '<input type="file" name="data[DocumentTypeMaster]['.str_replace(" ","_",$val['document_type_master']['name']).']" class="input-text" style="width:200px;" accept=".doc,.docx,.xls,.xlsx,.pdf,.PDF" 0="0" id="DocumentTypeMaster'.str_replace(" ","",$val['document_type_master']['name']).'" required>';
			}
			if($val['document_type_master']['doc_type']=="number")
			{
				$html .= '<input name="data[DocumentTypeMaster]['.str_replace(" ","_",$val['document_type_master']['name']).']" type="number" class="input-text" style="width:200px;" onkeyup="checklength(this,12)" id="DocumentTypeMaster'.str_replace(" ","",$val['document_type_master']['name']).'" required>';
			}
			if($val['document_type_master']['doc_type']=="text")
			{ 
				$html .= $html .= '<input name="data[DocumentTypeMaster]['.str_replace(" ","_",$val['document_type_master']['name']).']" type="text" class="input-text" style="width:200px;" onkeyup="checklength(this,12)" id="DocumentTypeMaster'.str_replace(" ","",$val['document_type_master']['name']).'" required>';
			}
			$html .= '</td></tr>';
		}
		print_R($html);die;
	}
	
	public function reg_in_lis($health_id=null)
	{
		$health_id = $health_id;
		$this->Health = ClassRegistry::init("Health");
        $this->User = ClassRegistry::init("User");
        $this->Billing = ClassRegistry::init('Billing');
        $this->Test = ClassRegistry::init('Test');
        $this->Package = ClassRegistry::init('Package');
        $this->Banner = ClassRegistry::init('Banner');
        $this->Healthsample = ClassRegistry::init("Healthsample");
		$health_detail = $this->Health->find('first',array('conditions'=>array('Health.id'=>$health_id)));
        $user_detail = $this->User->find('first',array('conditions'=>array('User.id'=>$health_detail['Health']['user_id'])));
        $test_list = explode(',',$health_detail['Health']['test_id']);
        $profile_list = explode(',',$health_detail['Health']['profile_id']);
        $service_list = explode(',',$health_detail['Health']['service_id']);
        $package_list = explode(',',$health_detail['Health']['package_id']);
        $offer_list = explode(',',$health_detail['Health']['offer_id']);
        $billing_detail = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$health_id)));
        $testList = array();
        $sampleList = array();
        $count = 0;
        if(!empty($health_detail['Health']['test_id']))
        {
            foreach($test_list as $key=>$val)
            {
				if($val!='')
				{
                $test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
                $testList[$count] = $test_detail['Test']['testcode'];
                //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                $count++;
				}
            }
        }
        if(!empty($health_detail['Health']['profile_id']))
        {
            foreach($profile_list as $key=>$val)
            {
				if($val!='')
				{
                $test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
                $testList[$count] = $test_detail['Test']['testcode'];
                //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                $count++;
				}
            }
        }
        if(!empty($health_detail['Health']['service_id']))
        {
            foreach($service_list as $key=>$val)
            {
				if($val!='')
				{
                $test_detail = $this->Test->find('first',array('conditions'=>array('Test.id'=>$val)));
                $testList[$count] = $test_detail['Test']['testcode'];
                //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                $count++;
				}
            }
        }
        if(!empty($health_detail['Health']['package_id']))
        {
            foreach($package_list as $key=>$val)
            {
				if($val!='')
				{
                $test_detail = $this->Package->find('first',array('conditions'=>array('Package.id'=>$val)));
                $testList[$count] = $test_detail['Package']['package_code'];
                //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                $count++;
				}
            }
        }
        if(!empty($health_detail['Health']['offer_id']))
        {
            foreach($offer_list as $key=>$val)
            {
				if($val!='')
				{
                $test_detail = $this->Banner->find('first',array('conditions'=>array('Banner.id'=>$val)));
                $testList[$count] = $test_detail['Package']['banner_code'];
                //$testList[$count]['HOrder_ID'] = //$billing_detail['Billing']['order_id'];
                $count++;
				}
            }
        }
        $sample_health = $this->Healthsample->find('all',array('conditions'=>array('Healthsample.health_id'=>$health_id)));
        if(!empty($sample_health))
        {   $count1=0;
            foreach($sample_health as $key=>$val)
            {
                $sampleList[$count1]['SampleId'] = $val['Healthsample']['sample_id'];
                $sampleList[$count1]['BarcodeId'] = $val['Healthsample']['barcode_id'];
                $count1++;
            }
        }
        $this->Timelab = ClassRegistry::init("Timelab");
        $timelabs = $this->Timelab->find('all',array('conditions'=>array('Timelab.status'=>1),'order'=>array('Timelab.sequence ASC')));
        $time=explode('-',$timelabs[$health_detail['Health']['sample_time1']]['Timelab']['name']);
        $this->Lab = ClassRegistry::init("Lab");
        $pccDetail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$health_detail['Health']['created_by'])));
        $servicePccDetail = $this->Lab->find('first',array('conditions'=>array('Lab.id'=>$health_detail['Health']['assigned_lab'])));
        $referred_by = $health_detail['Health']['refered_by'];
        if(empty($health_detail['Health']['refered_by']))
            $referred_by = $user_detail['User']['name'];
        $dateTime = explode(" ",$health_detail['Health']['sample_collected_date']);
        $date =  date('d-m-Y',strtotime($dateTime[0]));
        $s_date_new = $dateTime[0];
        $datetime = $dateTime[1];
        $date=date('Y-m-d', strtotime($s_date_new))." ".$datetime;
        $reference = "NPL".$billing_detail['Billing']['order_id'];
        if(!empty($health_detail['Health']['reference']))
            $reference = $health_detail['Health']['reference'];
        $patientTitle = 'Mr.';
        $sex = 'male';
        $isurgent = 0;
        if($health_detail['Health']['is_urgent']=='true')
            $isurgent = 1;
            
        if($health_detail['Health']['gender']=='2')
        {
            $patientTitle = 'Mrs.';
            $sex = 'female';
        }
		
		$address = "";
		if(!empty($health_detail['Health']['address']) && $health_detail['Health']['address']!="")
			$address = $health_detail['Health']['address'];
		else
			$address = $health_detail['Health']['address1'];
		
        $customerId = $health_detail['Health']['user_id'];
        if(!empty($health_detail['Health']['medical_reference_number']))
            $customerId = $health_detail['Health']['medical_reference_number'];
        $comment ='';
        if(!empty($health_detail['Health']['remarks']))
            $comment = $health_detail['Health']['remarks'];
        else
            $comment = $health_detail['Health']['discount_amount_reason'];            
		
		$email="";
		if(!empty($health_detail['Health']['email']))
			$email = $health_detail['Health']['email'];
		else
			$email = ".";
		
		$data = array(
            "APIKey"=> $pccDetail['Lab']['api_key'],
            "APIUser"=> $pccDetail['Lab']['api_user'],
            "Title"=>$patientTitle,
            "PatientName"=> strtoupper($health_detail['Health']['name']),
            "LastName"=>".",
            "Referredby"=>$referred_by,
            "Sex"=> $sex,
            "Age"=> $health_detail['Health']['age'],
            "MobileNumber"=> $health_detail['Health']['landline'],
            "Address"=> $address,
            "PinCode"=> $health_detail['Health']['pincode'],
            "Landmark" => $health_detail['Health']['landmark'],
            "SampleCollectedDate"=> $date,
			"Order_id" => $health_detail['Health']['reference'],
			"MRN_Id" => $health_detail['Health']['medical_reference_number'],
            "CenterID"=>$pccDetail['Lab']['center_id'],
            "PanelID"=>$pccDetail['Lab']['registration_number'],
            "IsUrgent"=>$isurgent,
            "Email"=>$email,
            "VisitType"=>"1",
            "ServiceBypanel"=>$servicePccDetail['Lab']['registration_number'],
            "Comment"=> $comment." Order Intiated via Nhcare",
            "TestList"=>$testList,
            "Samples"=>$sampleList
        );
        $ch = curl_init();
        $curlConfig = array(
            CURLOPT_URL            => "http://lis.niramayapathlabs.com/dev/design/jsonreceive/Postorder.aspx",
            CURLOPT_POST           => true,
            CURLOPT_RETURNTRANSFER => true,
            CURLOPT_POSTFIELDS     => json_encode($data),
            CURLOPT_HTTPHEADER => array(
                "cache-control: no-cache",
                "content-type: application/json"
            ),
        );
        curl_setopt_array($ch, $curlConfig);
        $result = curl_exec($ch);
		if(curl_error($ch))
		{
			print_R(curl_error($ch));die;
		}
        curl_close($ch);
        $decoded_result = json_decode($result);
		$this->_json_data($health_detail['Health']['id'],date('Y-m-d h:i:s'),"Post Order Fired",json_encode($data),$result);
        if(isset($decoded_result->Labno) && $decoded_result->Labno!=0)
        {
            $this->_activity_log($health_detail['Health']['user_id'],$health_detail['Health']['id'], 'Order sent to Labmate');
            $update_query = $this->Health->query("UPDATE healths SET requ_status='14',ref_num='".$decoded_result->Labno."',sent_pathcorp='1',sent_pathcorp_admin='0' ,last_edited='0',last_edited_date='".date('Y-m-d H:i:s')."',netbilling='".$decoded_result->Netbilling."' WHERE id='".$health_id."'");

            //$this->Utility->lis_payment_update($order_val['healths']['id'],"all");
			if($this->Utility->check_push_notification_for_pcc($health_detail['Health']['created_by'],$health_detail['Health']['assigned_lab']) == 1)
			{
				$response = $this->Utility->send_notification($health_id);
			}
			return "success";
        }
        else
        {
            $this->_activity_log($health_detail['Health']['user_id'], $health_id,'Send to Labmate Failed');

            $message_from_lab = $decoded_result->message;
            $this->LabMessageMaster = ClassRegistry::init('LabMessageMaster');
			$this->LabMessageMaster->create();
			
			$this->data['LabMessageMaster']['request_id'] = $health_id;
			$this->data['LabMessageMaster']['date'] = date('Y-m-d H:i:s');
			$this->data['LabMessageMaster']['message'] = $message_from_lab;
			
			$this->LabMessageMaster->save($this->data);
			
			$update_query = $this->Health->query("UPDATE healths SET remarks='".$message_from_lab."' WHERE id='".$health_id."'");

            return "failure";
        }
	}

	public function admin_check_barcode()
	{
		$this->Healthsample = ClassRegistry::init('Healthsample');

		$health_sample_data = $this->Healthsample->query("Select * from health_sample where barcode_id='".$_POST['bcode']."' and health_id!='".$_POST['id']."'");
		$response = array();
		//$response['query'] = 'Select * from health_sample where barcode_id="'.$_POST['bcode'].'" and health_id!="'.$_POST['id'].'"';
		$response['count'] = count($health_sample_data);
		
		if(count($health_sample_data)>0)
		{
			$response['status'] = "failure";	
		}
		else
		{
			$response['status'] = "success";	
		}
		print_R(json_encode($response));
		die;
	} 

	public function admin_search_reference()
	{
		$ref = $_REQUEST['ref'];
		$this->Health = ClassRegistry::init('Health');

		$health = $this->Health->find('first',array('conditions'=>array('Health.reference'=>$ref)));

		if(empty($health))
			$response['status'] = "success";
		else
			$response['status'] = "failure";

		print_R(json_encode($response));
		die;
	}

	public function admin_pay_on_sms()
	{
		$this->Health = ClassRegistry::init('Health');
		$this->Billing = ClassRegistry::init('Billing');

		$req_info = $this->Health->find('first',array('conditions'=>array('Health.id'=>$_POST['health_id'])));
		$bill_info = $this->Billing->find('first',array('conditions'=>array('Billing.request_id'=>$_POST['health_id'])));


		$payment_link = $this->get_tiny_url("https://www.niramayahealthcare.com/home/checkbalance/".base64_encode($req_info['Health']['id']));
//print_R($payment_link);die;
		$smsmessage='Dear '.$req_info['Health']['name'].' Your Payment link for Order Number - '.$bill_info['Billing']['order_id'].' is '.$payment_link;

		$messageurl =  urlencode($smsmessage);

		$url_sms='http://103.233.79.246//submitsms.jsp?user=nirAmaya&key=e2ceeba388XX&mobile='.$_POST['phone'].'&message='.$messageurl.'&senderid=NHCare&accusage=1';

		$ch_sms = curl_init();
		curl_setopt($ch_sms, CURLOPT_URL, $url_sms);
		curl_setopt($ch_sms, CURLOPT_FOLLOWLOCATION, TRUE);
		curl_setopt($ch_sms, CURLOPT_MAXREDIRS, 3);
		curl_setopt($ch_sms, CURLOPT_RETURNTRANSFER, TRUE);
		$result = curl_exec($ch_sms);
		print_R($result);die;
	}

	public function admin_patient_doc($id=null)
	{
		print_R($_POST);
		$user_id = $this->Session->read('Admin.id');
		$hfile = $this->File->uploadFile($_FILES['patient_doc'], PATIENT_DOC_STORE_PATH, true,array('doc','docx','xls','xlsx','pdf','PDF'));
		$this->data['UserDocument']['value'] = urlencode(SITE_URL."files/patient_doc/".$hfile['name']);

		$this->UserDocument = ClassRegistry::init('UserDocument');

		$user_doc = $this->UserDocument->create();

		$user_doc['UserDocument']['request_id'] =  $_POST['data']['Health']['request_id'];
		$user_doc['UserDocument']['user_id'] =  $user_id;
		$user_doc['UserDocument']['document_id'] =  '8';
		$user_doc['UserDocument']['document_type'] =  'doc';
		$user_doc['UserDocument']['value'] =  urlencode(SITE_URL."files/patient_doc/".$hfile['name']);
		$user_doc['UserDocument']['description'] =  $_POST['doc_description'];
		if($this->UserDocument->save($user_doc))
		{
			$this->Session->setFlash('Patient Doc Successfully Uploaded','flash_success');
			$this->redirect(array('controller'=>'samples','action'=>'view_detail',$id));
		}
		else
		{
			$this->Session->setFlash('Error Uploading Doc. Please Try Again','flash_failure');
			$this->redirect(array('controller'=>'samples','action'=>'view_detail_agent',$id));
		}

	} 
}
?>